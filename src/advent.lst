ca65 V2.19 - Git 0fca835
Main file   : advent.s
Current file: advent.s

000000r 1               zp_sd_address = $40         ; 2 bytes
000000r 1               zp_sd_currentsector = $42   ; 4 bytes
000000r 1               zp_fat32_variables = $46    ; 49 bytes
000000r 1               
000000r 1               fat32_workspace = $200      ; two pages
000000r 1               
000000r 1               target_room = $700          ; 1 byte
000000r 1               target_verb = $701          ; 1 byte
000000r 1               input_seen = $702           ; 1 byte
000000r 1               
000000r 1               field_lo = $703             ; 2 bytes
000000r 1               field_hi = $704
000000r 1               dest_lo = $705              ; 2 bytes
000000r 1               dest_hi = $706
000000r 1               verb_lo = $707              ; 2 bytes
000000r 1               verb_hi = $708
000000r 1               cond_lo = $709              ; 2 bytes
000000r 1               cond_hi = $70A
000000r 1               
000000r 1               tmp_digit = $70B            ; 1 byte
000000r 1               old_lo = $70C               ; 2 bytes
000000r 1               old_hi = $70D
000000r 1               mul_lo = $70E               ; 2 bytes
000000r 1               mul_hi = $70F
000000r 1               
000000r 1               work_lo = $710              ; 2 bytes
000000r 1               work_hi = $711
000000r 1               hundreds = $712             ; 1 byte
000000r 1               tens = $713                 ; 1 byte
000000r 1               line_idx = $714             ; 1 byte
000000r 1               pct_roll = $715             ; 1 byte (0..99)
000000r 1               carried_obj = $716          ; 1 byte carried object id entry input
000000r 1               present_obj = $717          ; 1 byte present object id entry input
000000r 1               cond_group = $718           ; 1 byte rcond/100
000000r 1               cond_object = $719          ; 1 byte rcond%100
000000r 1               prop_obj_id = $71A          ; 1 byte object id for prop override
000000r 1               prop_obj_state = $71B       ; 1 byte prop state override
000000r 1               entry_count = $71C          ; 1 byte number of entries to read
000000r 1               entries_left = $71D         ; 1 byte loop counter
000000r 1               room_in_section = $71E      ; 1 byte room text section state
000000r 1               room_line_start = $71F      ; 1 byte room text line-start flag
000000r 1               
000000r 1               line_buf = $720             ; 80 bytes
000000r 1               prop_table = $780           ; 100-byte prop[] table for object ids 0..99
000000r 1               toting_table = $7E4         ; 100-byte toting[] table for object ids 0..99
000000r 1               present_table = $848        ; 100-byte atloc[] table for object ids 0..99
000000r 1               room_marker_num = $8AC      ; 1 byte parsed room marker number
000000r 1               room_char = $8AD            ; 1 byte room text char buffer
000000r 1               visited_table = $900        ; 200-byte room visited flags
000000r 1               place_table = $2000         ; 100-byte place[] table for object ids 0..99
000000r 1               cmd_len = $770              ; 1 byte command token length
000000r 1               cmd_idx = $771              ; 1 byte command parser index
000000r 1               cmd_buf = $720              ; 16-byte command token buffer (known-good RAM)
000000r 1               noun_len = $772             ; 1 byte noun token length
000000r 1               command_type = $773         ; 0=motion,1=take,2=drop,3=inventory,4=look,5=quit,6=examine,7=read,8=parse_error,9=openish,10=closeish,11=help,12=light,13=dark,14=eat,15=drink,16=fill,17=pour,18=wave,19=find,20=say,21=kill,22=throw,23=feed,24=break,25=rub,26=wake,27=blast,28=score,29=calm,30=walk,31=nothing,32=brief,33=suspend,34=hours,35=log,36=load,37=foo
000000r 1               command_object = $774       ; object id for action command
000000r 1               parse_error = $775          ; 0=ok,1=unknown word,2=unknown object,3=missing object
000000r 1               desc_mode = $776            ; 0=long room text, 1=short room text
000000r 1               msg_target = $777           ; 1 byte target message id for ADVENT4
000000r 1               prl_guard_lo = $778         ; 2-byte read guard for print_room_long
000000r 1               prl_guard_hi = $779
000000r 1               rng_state = $77A            ; 1-byte RNG state
000000r 1               noun_buf = $730             ; 16-byte noun token buffer
000000r 1               
000000r 1               snapshot_base = $700        ; save/load snapshot base address
000000r 1               snapshot_buf = $2200        ; packed snapshot staging buffer
000000r 1               snapshot_size_lo = $28      ; packed snapshot size = $0328 bytes
000000r 1               snapshot_size_hi = $03
000000r 1               snapshot_block1_base = $700
000000r 1               snapshot_block1_len_lo = $C8 ; $02C8 bytes ($700..$9C7)
000000r 1               snapshot_block1_len_hi = $02
000000r 1               snapshot_block2_base = $2000
000000r 1               snapshot_block2_len_lo = $64 ; $0064 bytes (place_table)
000000r 1               snapshot_block2_len_hi = $00
000000r 1               
000000r 1                 .org $A000
00A000  1               reset:
00A000  1  A2 FF          ldx #$ff
00A002  1  9A             txs
00A003  1               
00A003  1  20 E3 E4       jsr via_init
00A006  1  20 EE E4       jsr sd_init
00A009  1  20 AB E6       jsr fat32_init
00A00C  1  90 0E          bcc _initsuccess
00A00E  1               
00A00E  1  A9 5A          lda #'Z'
00A010  1  20 B2 ED       jsr print_char
00A013  1  AD 5A 00       lda fat32_errorstage
00A016  1  20 B6 ED       jsr print_hex
00A019  1  4C 9E A4       jmp halt_loop
00A01C  1               
00A01C  1               _initsuccess:
00A01C  1  A9 5D          lda #$5D
00A01E  1  8D 7A 07       sta rng_state
00A021  1               
00A021  1  20 A7 ED       jsr newline
00A024  1  A2 5A          ldx #<msg_welcome_1
00A026  1  A0 F4          ldy #>msg_welcome_1
00A028  1  20 4D DD       jsr print_zstr_xy
00A02B  1  20 A7 ED       jsr newline
00A02E  1  A2 83          ldx #<msg_welcome_2
00A030  1  A0 F4          ldy #>msg_welcome_2
00A032  1  20 4D DD       jsr print_zstr_xy
00A035  1  20 A7 ED       jsr newline
00A038  1  A2 84          ldx #<msg_welcome_3
00A03A  1  A0 F4          ldy #>msg_welcome_3
00A03C  1  20 4D DD       jsr print_zstr_xy
00A03F  1  20 A7 ED       jsr newline
00A042  1  A2 B4          ldx #<msg_welcome_4
00A044  1  A0 F4          ldy #>msg_welcome_4
00A046  1  20 4D DD       jsr print_zstr_xy
00A049  1  20 A7 ED       jsr newline
00A04C  1  A2 B5          ldx #<msg_welcome_5
00A04E  1  A0 F4          ldy #>msg_welcome_5
00A050  1  20 4D DD       jsr print_zstr_xy
00A053  1  20 A7 ED       jsr newline
00A056  1  A2 ED          ldx #<msg_welcome_6
00A058  1  A0 F4          ldy #>msg_welcome_6
00A05A  1  20 4D DD       jsr print_zstr_xy
00A05D  1  20 A7 ED       jsr newline
00A060  1  A2 22          ldx #<msg_welcome_7
00A062  1  A0 F5          ldy #>msg_welcome_7
00A064  1  20 4D DD       jsr print_zstr_xy
00A067  1  20 A7 ED       jsr newline
00A06A  1  20 A7 ED       jsr newline
00A06D  1  A2 58          ldx #<msg_ask_instructions
00A06F  1  A0 F5          ldy #>msg_ask_instructions
00A071  1  20 4D DD       jsr print_zstr_xy
00A074  1  20 A7 ED       jsr newline
00A077  1  20 A7 ED       jsr newline
00A07A  1  20 4D D9       jsr prompt_yes_no
00A07D  1  08             php
00A07E  1  20 A7 ED       jsr newline
00A081  1  28             plp
00A082  1  90 49          bcc :+
00A084  1  A2 75          ldx #<msg_intro_help_1
00A086  1  A0 F5          ldy #>msg_intro_help_1
00A088  1  20 4D DD       jsr print_zstr_xy
00A08B  1  20 A7 ED       jsr newline
00A08E  1  A2 BC          ldx #<msg_intro_help_2
00A090  1  A0 F5          ldy #>msg_intro_help_2
00A092  1  20 4D DD       jsr print_zstr_xy
00A095  1  20 A7 ED       jsr newline
00A098  1  A2 02          ldx #<msg_intro_help_3
00A09A  1  A0 F6          ldy #>msg_intro_help_3
00A09C  1  20 4D DD       jsr print_zstr_xy
00A09F  1  20 A7 ED       jsr newline
00A0A2  1  A2 47          ldx #<msg_intro_help_4
00A0A4  1  A0 F6          ldy #>msg_intro_help_4
00A0A6  1  20 4D DD       jsr print_zstr_xy
00A0A9  1  20 A7 ED       jsr newline
00A0AC  1  A2 8B          ldx #<msg_intro_help_5
00A0AE  1  A0 F6          ldy #>msg_intro_help_5
00A0B0  1  20 4D DD       jsr print_zstr_xy
00A0B3  1  20 A7 ED       jsr newline
00A0B6  1  A2 D2          ldx #<msg_intro_help_6
00A0B8  1  A0 F6          ldy #>msg_intro_help_6
00A0BA  1  20 4D DD       jsr print_zstr_xy
00A0BD  1  20 A7 ED       jsr newline
00A0C0  1  A2 14          ldx #<msg_intro_help_7
00A0C2  1  A0 F7          ldy #>msg_intro_help_7
00A0C4  1  20 4D DD       jsr print_zstr_xy
00A0C7  1  20 A7 ED       jsr newline
00A0CA  1  20 A7 ED       jsr newline
00A0CD  1               :
00A0CD  1               
00A0CD  1  20 28 DB       jsr init_toting_table
00A0D0  1  20 35 DB       jsr init_present_table
00A0D3  1  20 11 DB       jsr init_prop_table
00A0D6  1  20 4F DB       jsr init_place_table
00A0D9  1  20 42 DB       jsr init_visited_table
00A0DC  1               
00A0DC  1  A9 01          lda #1
00A0DE  1  8D 00 07       sta target_room
00A0E1  1  A9 00          lda #0
00A0E3  1  8D 02 07       sta input_seen
00A0E6  1  20 A7 ED       jsr newline
00A0E9  1  A9 00          lda #0
00A0EB  1  8D 76 07       sta desc_mode
00A0EE  1  20 E5 E0       jsr print_room_long
00A0F1  1  20 E1 DC       jsr print_room_objects
00A0F4  1  AE 00 07       ldx target_room
00A0F7  1  A9 01          lda #1
00A0F9  1  9D 00 09       sta visited_table,x
00A0FC  1  20 A7 ED       jsr newline
00A0FF  1               
00A0FF  1               turn_loop:
00A0FF  1                 ; Guard against cumulative stack drift across long play sessions.
00A0FF  1  A2 FF          ldx #$ff
00A101  1  9A             txs
00A102  1               
00A102  1  20 C1 DC       jsr sync_present_from_room
00A105  1  20 0D A5       jsr read_verb_id
00A108  1  AD 73 07       lda command_type
00A10B  1  F0 06          beq _turn_motion
00A10D  1  20 7A C8       jsr execute_action_command
00A110  1  4C FF A0       jmp turn_loop
00A113  1               
00A113  1               _turn_motion:
00A113  1  20 28 D9       jsr read_pct_roll
00A116  1               
00A116  1  20 93 E9       jsr fat32_openroot
00A119  1  A2 C2          ldx #<filename
00A11B  1  A0 ED          ldy #>filename
00A11D  1  20 5A EC       jsr fat32_finddirent
00A120  1  90 15          bcc _found_file
00A122  1               
00A122  1  A9 46          lda #'F'
00A124  1  20 B2 ED       jsr print_char
00A127  1  A9 4E          lda #'N'
00A129  1  20 B2 ED       jsr print_char
00A12C  1  A9 46          lda #'F'
00A12E  1  20 B2 ED       jsr print_char
00A131  1  20 A7 ED       jsr newline
00A134  1  4C FF A0       jmp turn_loop
00A137  1               
00A137  1               _found_file:
00A137  1  20 E0 EA       jsr fat32_opendirent
00A13A  1               
00A13A  1               _find_room:
00A13A  1  20 D6 E2       jsr read_line
00A13D  1  90 03          bcc _fr_got
00A13F  1  4C 84 A3       jmp _room_not_found
00A142  1               _fr_got:
00A142  1  20 1E E3       jsr find_hash_in_line
00A145  1  90 03          bcc _fr_parse
00A147  1  4C 3A A1       jmp _find_room
00A14A  1               _fr_parse:
00A14A  1  20 33 E3       jsr parse_u16_field
00A14D  1  AD 04 07       lda field_hi
00A150  1  D0 E8          bne _find_room
00A152  1  AD 03 07       lda field_lo
00A155  1  CD 00 07       cmp target_room
00A158  1  D0 E0          bne _find_room
00A15A  1  A9 00          lda #0
00A15C  1  8D 02 07       sta input_seen           ; dotrav hitflag
00A15F  1               
00A15F  1               _scan_room:
00A15F  1  20 D6 E2       jsr read_line
00A162  1  90 03          bcc _sr_got
00A164  1  4C 99 A3       jmp _no_move
00A167  1               _sr_got:
00A167  1  20 1E E3       jsr find_hash_in_line
00A16A  1  B0 03          bcs _sr_not_marker
00A16C  1  4C 99 A3       jmp _no_move
00A16F  1               _sr_not_marker:
00A16F  1               
00A16F  1  A0 00          ldy #0
00A171  1  20 33 E3       jsr parse_u16_field
00A174  1  AD 03 07       lda field_lo
00A177  1  8D 05 07       sta dest_lo
00A17A  1  AD 04 07       lda field_hi
00A17D  1  8D 06 07       sta dest_hi
00A180  1               
00A180  1  20 33 E3       jsr parse_u16_field
00A183  1  AD 03 07       lda field_lo
00A186  1  8D 07 07       sta verb_lo
00A189  1  AD 04 07       lda field_hi
00A18C  1  8D 08 07       sta verb_hi
00A18F  1               
00A18F  1  20 33 E3       jsr parse_u16_field
00A192  1  AD 03 07       lda field_lo
00A195  1  8D 09 07       sta cond_lo
00A198  1  AD 04 07       lda field_hi
00A19B  1  8D 0A 07       sta cond_hi
00A19E  1               
00A19E  1                 ; dotrav verb gating:
00A19E  1                 ; before first hit, require rverb==1 or rverb==motion.
00A19E  1                 ; after first hit, all following entries are candidates.
00A19E  1  AD 02 07       lda input_seen
00A1A1  1  D0 16          bne _sr_have_hitflag
00A1A3  1  AD 08 07       lda verb_hi
00A1A6  1  D0 B7          bne _scan_room
00A1A8  1  AD 07 07       lda verb_lo
00A1AB  1  C9 01          cmp #1
00A1AD  1  F0 05          beq _sr_set_hitflag
00A1AF  1  CD 01 07       cmp target_verb
00A1B2  1  D0 AB          bne _scan_room
00A1B4  1               _sr_set_hitflag:
00A1B4  1  A9 01          lda #1
00A1B6  1  8D 02 07       sta input_seen
00A1B9  1               _sr_have_hitflag:
00A1B9  1               
00A1B9  1                 ; Evaluate rcond.
00A1B9  1  20 B5 E3       jsr cond_matches
00A1BC  1  90 A1          bcc _scan_room
00A1BE  1               
00A1BE  1                 ; Handle special destinations without changing room:
00A1BE  1                 ;   >500: message id (dest-500), print from ADVENT4
00A1BE  1                 ;   >300: scaffold path (dest-300)
00A1BE  1  AD 06 07       lda dest_hi
00A1C1  1  D0 03          bne :+
00A1C3  1  4C 3A A3       jmp _sr_dest_room_check
00A1C6  1               :
00A1C6  1  C9 01          cmp #1
00A1C8  1  D0 0A          bne _sr_dest_over300
00A1CA  1  AD 05 07       lda dest_lo
00A1CD  1  C9 2D          cmp #$2D                ; 301 decimal
00A1CF  1  B0 03          bcs :+
00A1D1  1  4C 3A A3       jmp _sr_dest_room_check
00A1D4  1               :
00A1D4  1               
00A1D4  1               _sr_dest_over300:
00A1D4  1                 ; Check >500 (501+)
00A1D4  1  AD 06 07       lda dest_hi
00A1D7  1  C9 01          cmp #1
00A1D9  1  90 48          bcc _sr_dest_spc300
00A1DB  1  D0 07          bne _sr_dest_msg500
00A1DD  1  AD 05 07       lda dest_lo
00A1E0  1  C9 F5          cmp #$F5                ; 501 decimal
00A1E2  1  90 3F          bcc _sr_dest_spc300
00A1E4  1               
00A1E4  1               _sr_dest_msg500:
00A1E4  1  38             sec
00A1E5  1  AD 05 07       lda dest_lo
00A1E8  1  E9 F4          sbc #$F4
00A1EA  1  8D 10 07       sta work_lo
00A1ED  1  AD 06 07       lda dest_hi
00A1F0  1  E9 01          sbc #$01
00A1F2  1  8D 11 07       sta work_hi
00A1F5  1  AD 11 07       lda work_hi
00A1F8  1  D0 11          bne _sr_msg500_fallback
00A1FA  1  AD 10 07       lda work_lo
00A1FD  1  8D 77 07       sta msg_target
00A200  1  20 A7 ED       jsr newline
00A203  1  20 C6 E1       jsr print_special_message
00A206  1  B0 03          bcs _sr_msg500_fallback
00A208  1  4C 34 A3       jmp _sr_dest_ok
00A20B  1               _sr_msg500_fallback:
00A20B  1  20 A7 ED       jsr newline
00A20E  1  A9 4D          lda #'M'
00A210  1  20 B2 ED       jsr print_char
00A213  1  A9 3D          lda #'='
00A215  1  20 B2 ED       jsr print_char
00A218  1  A9 20          lda #' '
00A21A  1  20 B2 ED       jsr print_char
00A21D  1  20 6D E4       jsr print_u16_dec
00A220  1  4C 34 A3       jmp _sr_dest_ok
00A223  1               
00A223  1               _sr_dest_spc300:
00A223  1  38             sec
00A224  1  AD 05 07       lda dest_lo
00A227  1  E9 2C          sbc #$2C                ; 300 decimal
00A229  1  8D 10 07       sta work_lo
00A22C  1  AD 06 07       lda dest_hi
00A22F  1  E9 01          sbc #$01
00A231  1  8D 11 07       sta work_hi
00A234  1  AD 11 07       lda work_hi
00A237  1  F0 03          beq :+
00A239  1  4C 31 A3       jmp _sr_spc_fallback
00A23C  1               :
00A23C  1  AD 10 07       lda work_lo
00A23F  1  C9 01          cmp #1
00A241  1  F0 0B          beq _sr_spc1_plover
00A243  1  C9 02          cmp #2
00A245  1  F0 3E          beq _sr_spc2_drop_emerald
00A247  1  C9 03          cmp #3
00A249  1  F0 55          beq _sr_spc3_troll
00A24B  1  4C 31 A3       jmp _sr_spc_fallback
00A24E  1               
00A24E  1               _sr_spc1_plover:
00A24E  1  20 6E DF       jsr count_holding
00A251  1  AD 1C 07       lda entry_count
00A254  1  F0 1E          beq _sr_spc1_move
00A256  1  C9 01          cmp #1
00A258  1  D0 07          bne _sr_spc1_blocked
00A25A  1  A2 3B          ldx #59                  ; EMERALD
00A25C  1  BD E4 07       lda toting_table,x
00A25F  1  D0 13          bne _sr_spc1_move
00A261  1               _sr_spc1_blocked:
00A261  1  A9 75          lda #117
00A263  1  8D 77 07       sta msg_target
00A266  1  20 A7 ED       jsr newline
00A269  1  20 C6 E1       jsr print_special_message
00A26C  1  B0 03          bcs :+
00A26E  1  4C 34 A3       jmp _sr_dest_ok
00A271  1               :
00A271  1  4C 31 A3       jmp _sr_spc_fallback
00A274  1               _sr_spc1_move:
00A274  1  A9 C7          lda #199
00A276  1  38             sec
00A277  1  ED 00 07       sbc target_room
00A27A  1  8D 05 07       sta dest_lo
00A27D  1  A9 00          lda #0
00A27F  1  8D 06 07       sta dest_hi
00A282  1  4C 3A A3       jmp _sr_dest_room_check
00A285  1               
00A285  1               _sr_spc2_drop_emerald:
00A285  1  A2 3B          ldx #59                  ; EMERALD
00A287  1  BD E4 07       lda toting_table,x
00A28A  1  D0 03          bne :+
00A28C  1  4C 34 A3       jmp _sr_dest_ok
00A28F  1               :
00A28F  1  A9 00          lda #0
00A291  1  9D E4 07       sta toting_table,x
00A294  1  9D 48 08       sta present_table,x
00A297  1  AD 00 07       lda target_room
00A29A  1  9D 00 20       sta place_table,x
00A29D  1  4C 34 A3       jmp _sr_dest_ok
00A2A0  1               
00A2A0  1               _sr_spc3_troll:
00A2A0  1                 ; Adventure parity branch: if troll is already in "seen once" state,
00A2A0  1                 ; crossing causes the troll to withdraw and no room change occurs.
00A2A0  1  A2 21          ldx #33                  ; TROLL
00A2A2  1  BD 80 07       lda prop_table,x
00A2A5  1  C9 01          cmp #1
00A2A7  1  D0 1C          bne _sr_spc3_move
00A2A9  1  A9 00          lda #0
00A2AB  1  9D 80 07       sta prop_table,x
00A2AE  1  A2 22          ldx #34                  ; TROLL2
00A2B0  1  A9 00          lda #0
00A2B2  1  9D E4 07       sta toting_table,x
00A2B5  1  9D 48 08       sta present_table,x
00A2B8  1  9D 00 20       sta place_table,x
00A2BB  1  A2 21          ldx #33                  ; TROLL
00A2BD  1  A9 75          lda #117
00A2BF  1  9D 00 20       sta place_table,x
00A2C2  1  4C 34 A3       jmp _sr_dest_ok
00A2C5  1               
00A2C5  1               _sr_spc3_move:
00A2C5  1                 ; Normal crossing toggles side 117<->122.
00A2C5  1  AD 00 07       lda target_room
00A2C8  1  C9 75          cmp #117
00A2CA  1  D0 0D          bne _sr_spc3_chk122
00A2CC  1  A9 7A          lda #122
00A2CE  1  8D 05 07       sta dest_lo
00A2D1  1  A9 00          lda #0
00A2D3  1  8D 06 07       sta dest_hi
00A2D6  1  4C EA A2       jmp _sr_spc3_have_dest
00A2D9  1               _sr_spc3_chk122:
00A2D9  1  AD 00 07       lda target_room
00A2DC  1  C9 7A          cmp #122
00A2DE  1  D0 51          bne _sr_spc_fallback
00A2E0  1  A9 75          lda #117
00A2E2  1  8D 05 07       sta dest_lo
00A2E5  1  A9 00          lda #0
00A2E7  1  8D 06 07       sta dest_hi
00A2EA  1               _sr_spc3_have_dest:
00A2EA  1                 ; First crossing marks troll as active.
00A2EA  1  A2 21          ldx #33                  ; TROLL
00A2EC  1  BD 80 07       lda prop_table,x
00A2EF  1  D0 03          bne _sr_spc3_check_bear
00A2F1  1  FE 80 07       inc prop_table,x
00A2F4  1               _sr_spc3_check_bear:
00A2F4  1                 ; Carrying the bear collapses bridge parity state.
00A2F4  1  A2 23          ldx #35                  ; BEAR
00A2F6  1  BD E4 07       lda toting_table,x
00A2F9  1  F0 33          beq _sr_spc3_finish_move
00A2FB  1  A9 A2          lda #162
00A2FD  1  8D 77 07       sta msg_target
00A300  1  20 A7 ED       jsr newline
00A303  1  20 C6 E1       jsr print_special_message
00A306  1  B0 29          bcs _sr_spc_fallback
00A308  1               
00A308  1  A2 20          ldx #32                  ; CHASM
00A30A  1  A9 01          lda #1
00A30C  1  9D 80 07       sta prop_table,x
00A30F  1  A2 21          ldx #33                  ; TROLL
00A311  1  A9 02          lda #2
00A313  1  9D 80 07       sta prop_table,x
00A316  1  A2 23          ldx #35                  ; BEAR
00A318  1  A9 00          lda #0
00A31A  1  9D E4 07       sta toting_table,x
00A31D  1  9D 48 08       sta present_table,x
00A320  1  AD 05 07       lda dest_lo
00A323  1  9D 00 20       sta place_table,x
00A326  1  A9 03          lda #3
00A328  1  9D 80 07       sta prop_table,x
00A32B  1  4C 34 A3       jmp _sr_dest_ok
00A32E  1               _sr_spc3_finish_move:
00A32E  1  4C 3A A3       jmp _sr_dest_room_check
00A331  1               
00A331  1               _sr_spc_fallback:
00A331  1  4C 99 A3       jmp _no_move
00A334  1               
00A334  1               _sr_dest_ok:
00A334  1  20 A7 ED       jsr newline
00A337  1  4C FF A0       jmp turn_loop
00A33A  1               
00A33A  1               _sr_dest_room_check:
00A33A  1                 ; If destination is a normal room id (1..255), show long description.
00A33A  1  AD 06 07       lda dest_hi
00A33D  1  D0 32          bne _skip_dest_room_text
00A33F  1  AD 05 07       lda dest_lo
00A342  1  F0 2D          beq _skip_dest_room_text
00A344  1  8D 00 07       sta target_room
00A347  1  20 C1 DC       jsr sync_present_from_room
00A34A  1  AD 00 07       lda target_room
00A34D  1  AA             tax
00A34E  1  BD 00 09       lda visited_table,x
00A351  1  F0 08          beq _sr_first_visit
00A353  1  A9 01          lda #1
00A355  1  8D 76 07       sta desc_mode
00A358  1  4C 60 A3       jmp _sr_print_desc
00A35B  1               _sr_first_visit:
00A35B  1  A9 00          lda #0
00A35D  1  8D 76 07       sta desc_mode
00A360  1               _sr_print_desc:
00A360  1  20 A7 ED       jsr newline
00A363  1  20 E5 E0       jsr print_room_long
00A366  1  20 E1 DC       jsr print_room_objects
00A369  1  AE 00 07       ldx target_room
00A36C  1  A9 01          lda #1
00A36E  1  9D 00 09       sta visited_table,x
00A371  1               _skip_dest_room_text:
00A371  1               
00A371  1  20 A7 ED       jsr newline
00A374  1  A9 4F          lda #'O'
00A376  1  20 B2 ED       jsr print_char
00A379  1  A9 4B          lda #'K'
00A37B  1  20 B2 ED       jsr print_char
00A37E  1  20 A7 ED       jsr newline
00A381  1  4C FF A0       jmp turn_loop
00A384  1               
00A384  1               _room_not_found:
00A384  1  A9 52          lda #'R'
00A386  1  20 B2 ED       jsr print_char
00A389  1  A9 4E          lda #'N'
00A38B  1  20 B2 ED       jsr print_char
00A38E  1  A9 46          lda #'F'
00A390  1  20 B2 ED       jsr print_char
00A393  1  20 A7 ED       jsr newline
00A396  1  4C FF A0       jmp turn_loop
00A399  1               
00A399  1               _no_move:
00A399  1                 ; Parity: from below the grate, ENTER with locked grate should
00A399  1                 ; report the locked-grate text instead of generic NM.
00A399  1  AD 00 07       lda target_room
00A39C  1  C9 09          cmp #9
00A39E  1  D0 2E          bne _no_move_check_look
00A3A0  1  AD 01 07       lda target_verb
00A3A3  1  C9 03          cmp #3
00A3A5  1  D0 27          bne _no_move_check_look
00A3A7  1  A2 03          ldx #3
00A3A9  1  BD 80 07       lda prop_table,x
00A3AC  1  D0 20          bne _no_move_check_look
00A3AE  1  20 A7 ED       jsr newline
00A3B1  1  A2 6B          ldx #<msg_locked_grate
00A3B3  1  A0 F1          ldy #>msg_locked_grate
00A3B5  1  20 4D DD       jsr print_zstr_xy
00A3B8  1  20 A7 ED       jsr newline
00A3BB  1  20 A7 ED       jsr newline
00A3BE  1  A9 4F          lda #'O'
00A3C0  1  20 B2 ED       jsr print_char
00A3C3  1  A9 4B          lda #'K'
00A3C5  1  20 B2 ED       jsr print_char
00A3C8  1  20 A7 ED       jsr newline
00A3CB  1  4C FF A0       jmp turn_loop
00A3CE  1               _no_move_check_look:
00A3CE  1  20 05 A4       jsr motion_no_move_is_look
00A3D1  1  90 17          bcc _no_move_nm
00A3D3  1  20 C1 DC       jsr sync_present_from_room
00A3D6  1  A9 00          lda #0
00A3D8  1  8D 76 07       sta desc_mode
00A3DB  1  20 A7 ED       jsr newline
00A3DE  1  20 E5 E0       jsr print_room_long
00A3E1  1  20 E1 DC       jsr print_room_objects
00A3E4  1  20 A7 ED       jsr newline
00A3E7  1  4C FF A0       jmp turn_loop
00A3EA  1               _no_move_nm:
00A3EA  1  20 38 A4       jsr select_badmove_message
00A3ED  1  20 A7 ED       jsr newline
00A3F0  1  20 C6 E1       jsr print_special_message
00A3F3  1  90 0A          bcc :+
00A3F5  1  A9 4E          lda #'N'
00A3F7  1  20 B2 ED       jsr print_char
00A3FA  1  A9 4D          lda #'M'
00A3FC  1  20 B2 ED       jsr print_char
00A3FF  1               :
00A3FF  1  20 A7 ED       jsr newline
00A402  1  4C FF A0       jmp turn_loop
00A405  1               
00A405  1               motion_no_move_is_look:
00A405  1                 ; Treat "go to where I already am" as LOOK for core place words.
00A405  1  AD 00 07       lda target_room
00A408  1  C9 03          cmp #3
00A40A  1  D0 0A          bne _mnmil_check_depression
00A40C  1  AD 01 07       lda target_verb
00A40F  1  C9 0C          cmp #12
00A411  1  F0 13          beq _mnmil_yes
00A413  1  4C 24 A4       jmp _mnmil_no
00A416  1               _mnmil_check_depression:
00A416  1  AD 00 07       lda target_room
00A419  1  C9 08          cmp #8
00A41B  1  D0 07          bne _mnmil_no
00A41D  1  AD 01 07       lda target_verb
00A420  1  C9 3F          cmp #63
00A422  1  F0 02          beq _mnmil_yes
00A424  1               _mnmil_no:
00A424  1  18             clc
00A425  1  60             rts
00A426  1               _mnmil_yes:
00A426  1  38             sec
00A427  1  60             rts
00A428  1               
00A428  1               get_input_filtered:
00A428  1                 ; Filter idle NUL returns from monitor GETCH and throttle polling
00A428  1                 ; so prompts remain readable instead of flooding with NUL bytes.
00A428  1               _gif_loop:
00A428  1  20 BA ED       jsr get_input
00A42B  1  29 7F          and #$7F
00A42D  1  D0 08          bne _gif_done
00A42F  1  A2 40          ldx #$40
00A431  1               _gif_delay:
00A431  1  CA             dex
00A432  1  D0 FD          bne _gif_delay
00A434  1  4C 28 A4       jmp _gif_loop
00A437  1               _gif_done:
00A437  1  60             rts
00A438  1               
00A438  1               select_badmove_message:
00A438  1                 ; Approximate Adventure badmove() messaging by motion id.
00A438  1  A9 0C          lda #12
00A43A  1  8D 77 07       sta msg_target
00A43D  1               
00A43D  1  AD 01 07       lda target_verb
00A440  1  C9 2B          cmp #43
00A442  1  90 09          bcc _sbm_chk29
00A444  1  C9 33          cmp #51
00A446  1  B0 05          bcs _sbm_chk29
00A448  1  A9 09          lda #9
00A44A  1  8D 77 07       sta msg_target
00A44D  1               _sbm_chk29:
00A44D  1  AD 01 07       lda target_verb
00A450  1  C9 1D          cmp #29
00A452  1  F0 04          beq _sbm_set9
00A454  1  C9 1E          cmp #30
00A456  1  D0 05          bne _sbm_chk7
00A458  1               _sbm_set9:
00A458  1  A9 09          lda #9
00A45A  1  8D 77 07       sta msg_target
00A45D  1               _sbm_chk7:
00A45D  1  AD 01 07       lda target_verb
00A460  1  C9 07          cmp #7
00A462  1  F0 08          beq _sbm_set10
00A464  1  C9 24          cmp #36
00A466  1  F0 04          beq _sbm_set10
00A468  1  C9 25          cmp #37
00A46A  1  D0 05          bne _sbm_chk11
00A46C  1               _sbm_set10:
00A46C  1  A9 0A          lda #10
00A46E  1  8D 77 07       sta msg_target
00A471  1               _sbm_chk11:
00A471  1  AD 01 07       lda target_verb
00A474  1  C9 0B          cmp #11
00A476  1  F0 04          beq _sbm_set11
00A478  1  C9 13          cmp #19
00A47A  1  D0 05          bne _sbm_chk62
00A47C  1               _sbm_set11:
00A47C  1  A9 0B          lda #11
00A47E  1  8D 77 07       sta msg_target
00A481  1               _sbm_chk62:
00A481  1  AD 01 07       lda target_verb
00A484  1  C9 3E          cmp #62
00A486  1  F0 04          beq _sbm_set42
00A488  1  C9 41          cmp #65
00A48A  1  D0 05          bne _sbm_chk17
00A48C  1               _sbm_set42:
00A48C  1  A9 2A          lda #42
00A48E  1  8D 77 07       sta msg_target
00A491  1               _sbm_chk17:
00A491  1  AD 01 07       lda target_verb
00A494  1  C9 11          cmp #17
00A496  1  D0 05          bne _sbm_done
00A498  1  A9 50          lda #80
00A49A  1  8D 77 07       sta msg_target
00A49D  1               _sbm_done:
00A49D  1  60             rts
00A49E  1               
00A49E  1               halt_loop:
00A49E  1  20 4F 1C       jsr EXIT
00A4A1  1  4C 9E A4       jmp halt_loop
00A4A4  1               
00A4A4  1               read_room_id:
00A4A4  1  A9 01          lda #1
00A4A6  1  8D 00 07       sta target_room
00A4A9  1  A9 00          lda #0
00A4AB  1  8D 02 07       sta input_seen
00A4AE  1               
00A4AE  1  A9 52          lda #'R'
00A4B0  1  20 B2 ED       jsr print_char
00A4B3  1  A9 3F          lda #'?'
00A4B5  1  20 B2 ED       jsr print_char
00A4B8  1  A9 20          lda #' '
00A4BA  1  20 B2 ED       jsr print_char
00A4BD  1               
00A4BD  1               _rr_loop:
00A4BD  1  20 28 A4       jsr get_input_filtered
00A4C0  1  C9 0D          cmp #$0D
00A4C2  1  F0 36          beq _rr_eol
00A4C4  1  C9 0A          cmp #$0A
00A4C6  1  F0 32          beq _rr_eol
00A4C8  1  C9 30          cmp #'0'
00A4CA  1  90 F1          bcc _rr_loop
00A4CC  1  C9 3A          cmp #('9'+1)
00A4CE  1  B0 ED          bcs _rr_loop
00A4D0  1               
00A4D0  1  29 0F          and #$0F
00A4D2  1  8D 0B 07       sta tmp_digit
00A4D5  1  AD 02 07       lda input_seen
00A4D8  1  D0 05          bne _rr_accum
00A4DA  1  A9 00          lda #0
00A4DC  1  8D 00 07       sta target_room
00A4DF  1               _rr_accum:
00A4DF  1  A9 01          lda #1
00A4E1  1  8D 02 07       sta input_seen
00A4E4  1               
00A4E4  1  AD 00 07       lda target_room
00A4E7  1  0A             asl
00A4E8  1  8D 0E 07       sta mul_lo
00A4EB  1  0A             asl
00A4EC  1  0A             asl
00A4ED  1  18             clc
00A4EE  1  6D 0E 07       adc mul_lo
00A4F1  1  6D 0B 07       adc tmp_digit
00A4F4  1  8D 00 07       sta target_room
00A4F7  1  4C BD A4       jmp _rr_loop
00A4FA  1               
00A4FA  1               _rr_eol:
00A4FA  1  AD 02 07       lda input_seen
00A4FD  1  F0 BE          beq _rr_loop
00A4FF  1               
00A4FF  1               _rr_done:
00A4FF  1  20 A7 ED       jsr newline
00A502  1  AD 00 07       lda target_room
00A505  1  D0 05          bne _rr_ok
00A507  1  A9 01          lda #1
00A509  1  8D 00 07       sta target_room
00A50C  1               _rr_ok:
00A50C  1  60             rts
00A50D  1               
00A50D  1               read_verb_id:
00A50D  1                 ; Read command line with up to two tokens: VERB [NOUN].
00A50D  1  A9 01          lda #1
00A50F  1  8D 01 07       sta target_verb
00A512  1  A9 00          lda #0
00A514  1  8D 70 07       sta cmd_len
00A517  1  8D 72 07       sta noun_len
00A51A  1  8D 73 07       sta command_type
00A51D  1  8D 74 07       sta command_object
00A520  1  8D 75 07       sta parse_error
00A523  1  8D 71 07       sta cmd_idx              ; saw-command-char flag
00A526  1  8D 02 07       sta input_seen            ; 0=first token, 1=second token, 2=ignore rest
00A529  1               
00A529  1  A9 3E          lda #'>'
00A52B  1  20 B2 ED       jsr print_char
00A52E  1  A9 20          lda #' '
00A530  1  20 B2 ED       jsr print_char
00A533  1               
00A533  1               _rv_loop:
00A533  1  20 28 A4       jsr get_input_filtered
00A536  1  C9 08          cmp #$08
00A538  1  D0 03          bne :+
00A53A  1  4C FC A5       jmp _rv_backspace
00A53D  1               :
00A53D  1  C9 7F          cmp #$7F
00A53F  1  D0 03          bne :+
00A541  1  4C FC A5       jmp _rv_backspace
00A544  1               :
00A544  1  C9 0D          cmp #$0D
00A546  1  D0 03          bne _rv_chk_lf
00A548  1  4C 30 A6       jmp _rv_eol
00A54B  1               _rv_chk_lf:
00A54B  1  C9 0A          cmp #$0A
00A54D  1  D0 03          bne _rv_after_eol_checks
00A54F  1  4C 30 A6       jmp _rv_eol
00A552  1               _rv_after_eol_checks:
00A552  1               
00A552  1                 ; Token separators: space/tab
00A552  1  C9 20          cmp #' '
00A554  1  F0 5E          beq _rv_space
00A556  1  C9 09          cmp #$09
00A558  1  F0 5A          beq _rv_space
00A55A  1               
00A55A  1                 ; Convert lowercase to uppercase
00A55A  1  C9 61          cmp #'a'
00A55C  1  90 06          bcc _rv_store
00A55E  1  C9 7B          cmp #('z'+1)
00A560  1  B0 02          bcs _rv_store
00A562  1  29 DF          and #$DF
00A564  1               
00A564  1               _rv_store:
00A564  1                 ; Ignore non-alphanumeric bytes (e.g. polling noise / NUL).
00A564  1  C9 30          cmp #'0'
00A566  1  90 CB          bcc _rv_loop
00A568  1  C9 3A          cmp #('9'+1)
00A56A  1  90 08          bcc _rv_store_ok
00A56C  1  C9 41          cmp #'A'
00A56E  1  90 C3          bcc _rv_loop
00A570  1  C9 5B          cmp #('Z'+1)
00A572  1  B0 BF          bcs _rv_loop
00A574  1               
00A574  1               _rv_store_ok:
00A574  1  8D 0B 07       sta tmp_digit
00A577  1  AD 02 07       lda input_seen
00A57A  1  C9 01          cmp #1
00A57C  1  F0 1D          beq _rv_store_noun
00A57E  1  C9 00          cmp #0
00A580  1  D0 B1          bne _rv_loop
00A582  1               
00A582  1  AE 70 07       ldx cmd_len
00A585  1  E0 0F          cpx #15
00A587  1  B0 AA          bcs _rv_loop
00A589  1  AD 0B 07       lda tmp_digit
00A58C  1  9D 20 07       sta cmd_buf,x
00A58F  1  E8             inx
00A590  1  8E 70 07       stx cmd_len
00A593  1  A9 01          lda #1
00A595  1  8D 71 07       sta cmd_idx
00A598  1  4C 33 A5       jmp _rv_loop
00A59B  1               
00A59B  1               _rv_store_noun:
00A59B  1  AE 72 07       ldx noun_len
00A59E  1  E0 0F          cpx #15
00A5A0  1  B0 91          bcs _rv_loop
00A5A2  1  AD 0B 07       lda tmp_digit
00A5A5  1  9D 30 07       sta noun_buf,x
00A5A8  1  E8             inx
00A5A9  1  8E 72 07       stx noun_len
00A5AC  1  A9 01          lda #1
00A5AE  1  8D 71 07       sta cmd_idx
00A5B1  1  4C 33 A5       jmp _rv_loop
00A5B4  1               
00A5B4  1               _rv_space:
00A5B4  1  AD 02 07       lda input_seen
00A5B7  1  C9 00          cmp #0
00A5B9  1  D0 10          bne _rv_space_second
00A5BB  1  AD 70 07       lda cmd_len
00A5BE  1  D0 03          bne _rv_space_set_second
00A5C0  1  4C 33 A5       jmp _rv_loop
00A5C3  1               _rv_space_set_second:
00A5C3  1  A9 01          lda #1
00A5C5  1  8D 02 07       sta input_seen
00A5C8  1  4C 33 A5       jmp _rv_loop
00A5CB  1               
00A5CB  1               _rv_space_second:
00A5CB  1  C9 01          cmp #1
00A5CD  1  D0 2A          bne _rv_space_second_not1
00A5CF  1  AD 72 07       lda noun_len
00A5D2  1  D0 03          bne _rv_space_second_setdone
00A5D4  1  4C 33 A5       jmp _rv_loop
00A5D7  1               _rv_space_second_setdone:
00A5D7  1  20 FE DD       jsr noun_is_filler_word
00A5DA  1  90 08          bcc _rv_space_second_check_desc
00A5DC  1  A9 00          lda #0
00A5DE  1  8D 72 07       sta noun_len
00A5E1  1  4C 33 A5       jmp _rv_loop
00A5E4  1               _rv_space_second_check_desc:
00A5E4  1  20 DA DE       jsr noun_is_descriptor_word
00A5E7  1  90 08          bcc _rv_space_second_freeze
00A5E9  1  A9 00          lda #0
00A5EB  1  8D 72 07       sta noun_len
00A5EE  1  4C 33 A5       jmp _rv_loop
00A5F1  1               _rv_space_second_freeze:
00A5F1  1  A9 02          lda #2
00A5F3  1  8D 02 07       sta input_seen
00A5F6  1  4C 33 A5       jmp _rv_loop
00A5F9  1               _rv_space_second_not1:
00A5F9  1  4C 33 A5       jmp _rv_loop
00A5FC  1               
00A5FC  1               _rv_backspace:
00A5FC  1  AD 02 07       lda input_seen
00A5FF  1  C9 02          cmp #2
00A601  1  D0 05          bne _rv_bs_check_second
00A603  1  A9 01          lda #1
00A605  1  8D 02 07       sta input_seen
00A608  1               _rv_bs_check_second:
00A608  1  AD 02 07       lda input_seen
00A60B  1  C9 01          cmp #1
00A60D  1  D0 13          bne _rv_bs_first
00A60F  1  AD 72 07       lda noun_len
00A612  1  F0 06          beq _rv_bs_unspace
00A614  1  CE 72 07       dec noun_len
00A617  1  4C 33 A5       jmp _rv_loop
00A61A  1               _rv_bs_unspace:
00A61A  1  A9 00          lda #0
00A61C  1  8D 02 07       sta input_seen
00A61F  1  4C 33 A5       jmp _rv_loop
00A622  1               _rv_bs_first:
00A622  1  AD 70 07       lda cmd_len
00A625  1  D0 03          bne :+
00A627  1  4C 33 A5       jmp _rv_loop
00A62A  1               :
00A62A  1  CE 70 07       dec cmd_len
00A62D  1  4C 33 A5       jmp _rv_loop
00A630  1               
00A630  1               _rv_eol:
00A630  1                 ; If the noun token ended as a filler word (e.g. "GO TO"),
00A630  1                 ; drop it before dispatch so command-specific defaults apply.
00A630  1  AD 02 07       lda input_seen
00A633  1  C9 01          cmp #1
00A635  1  D0 0F          bne :+
00A637  1  AD 72 07       lda noun_len
00A63A  1  F0 0A          beq :+
00A63C  1  20 FE DD       jsr noun_is_filler_word
00A63F  1  90 05          bcc :+
00A641  1  A9 00          lda #0
00A643  1  8D 72 07       sta noun_len
00A646  1               :
00A646  1  AD 71 07       lda cmd_idx
00A649  1  D0 03          bne _rv_done
00A64B  1  4C 33 A5       jmp _rv_loop
00A64E  1               
00A64E  1               _rv_done:
00A64E  1  AE 70 07       ldx cmd_len
00A651  1  A9 00          lda #0
00A653  1  9D 20 07       sta cmd_buf,x
00A656  1  AE 72 07       ldx noun_len
00A659  1  9D 30 07       sta noun_buf,x
00A65C  1               
00A65C  1  AD 70 07       lda cmd_len
00A65F  1  D0 03          bne _rv_has_token
00A661  1  4C AC A8       jmp _rv_emit_done
00A664  1               _rv_has_token:
00A664  1               
00A664  1                 ; Numeric fallback
00A664  1  A2 00          ldx #0
00A666  1  BD 20 07       lda cmd_buf,x
00A669  1  C9 30          cmp #'0'
00A66B  1  90 46          bcc _rv_try_word
00A66D  1  C9 3A          cmp #('9'+1)
00A66F  1  B0 42          bcs _rv_try_word
00A671  1  A9 00          lda #0
00A673  1  8D 01 07       sta target_verb
00A676  1  8E 71 07       stx cmd_idx
00A679  1               _rv_num_loop:
00A679  1  AE 71 07       ldx cmd_idx
00A67C  1  EC 70 07       cpx cmd_len
00A67F  1  90 03          bcc :+
00A681  1  4C AC A8       jmp _rv_emit_done
00A684  1               :
00A684  1  BD 20 07       lda cmd_buf,x
00A687  1  C9 30          cmp #'0'
00A689  1  B0 03          bcs :+
00A68B  1  4C AC A8       jmp _rv_emit_done
00A68E  1               :
00A68E  1  C9 3A          cmp #('9'+1)
00A690  1  90 03          bcc :+
00A692  1  4C AC A8       jmp _rv_emit_done
00A695  1               :
00A695  1  29 0F          and #$0F
00A697  1  8D 0B 07       sta tmp_digit
00A69A  1  AD 01 07       lda target_verb
00A69D  1  0A             asl
00A69E  1  8D 0E 07       sta mul_lo
00A6A1  1  0A             asl
00A6A2  1  0A             asl
00A6A3  1  18             clc
00A6A4  1  6D 0E 07       adc mul_lo
00A6A7  1  6D 0B 07       adc tmp_digit
00A6AA  1  8D 01 07       sta target_verb
00A6AD  1  EE 71 07       inc cmd_idx
00A6B0  1  4C 79 A6       jmp _rv_num_loop
00A6B3  1               
00A6B3  1               _rv_try_word:
00A6B3  1  20 20 A9       jsr decode_action_word
00A6B6  1  AD 73 07       lda command_type
00A6B9  1  D0 03          bne :+
00A6BB  1  4C 27 A8       jmp _rv_try_motion
00A6BE  1               :
00A6BE  1  C9 03          cmp #3
00A6C0  1  D0 03          bne :+
00A6C2  1  4C AC A8       jmp _rv_emit_done
00A6C5  1               :
00A6C5  1  C9 05          cmp #5
00A6C7  1  D0 03          bne :+
00A6C9  1  4C AC A8       jmp _rv_emit_done
00A6CC  1               :
00A6CC  1  C9 04          cmp #4
00A6CE  1  D0 03          bne :+
00A6D0  1  4C 02 A8       jmp _rv_look_object
00A6D3  1               :
00A6D3  1  C9 0C          cmp #12
00A6D5  1  D0 03          bne :+
00A6D7  1  4C B0 A8       jmp _rv_normalize_light
00A6DA  1               :
00A6DA  1  C9 0D          cmp #13
00A6DC  1  D0 03          bne :+
00A6DE  1  4C B0 A8       jmp _rv_normalize_light
00A6E1  1               :
00A6E1  1  C9 14          cmp #20
00A6E3  1  D0 03          bne :+
00A6E5  1  4C AC A8       jmp _rv_emit_done
00A6E8  1               :
00A6E8  1  AD 73 07       lda command_type
00A6EB  1  C9 1B          cmp #27
00A6ED  1  90 07          bcc :+
00A6EF  1  C9 26          cmp #38
00A6F1  1  B0 03          bcs :+
00A6F3  1  4C AC A8       jmp _rv_emit_done
00A6F6  1               :
00A6F6  1  AD 73 07       lda command_type
00A6F9  1  C9 01          cmp #1
00A6FB  1  F0 04          beq _rv_check_all
00A6FD  1  C9 02          cmp #2
00A6FF  1  D0 10          bne _rv_need_obj
00A701  1               _rv_check_all:
00A701  1  AD 72 07       lda noun_len
00A704  1  D0 03          bne :+
00A706  1  4C 11 A7       jmp _rv_need_obj
00A709  1               :
00A709  1  20 4E DF       jsr noun_is_all
00A70C  1  90 03          bcc _rv_need_obj
00A70E  1  4C AC A8       jmp _rv_emit_done
00A711  1               _rv_need_obj:
00A711  1  AD 72 07       lda noun_len
00A714  1  D0 03          bne :+
00A716  1  4C 1C A7       jmp _rv_need_obj_no_noun
00A719  1               :
00A719  1  4C EA A7       jmp _rv_have_noun
00A71C  1               _rv_need_obj_no_noun:
00A71C  1  AD 73 07       lda command_type
00A71F  1  C9 09          cmp #9
00A721  1  D0 03          bne :+
00A723  1  4C BF A7       jmp _rv_default_grate
00A726  1               :
00A726  1  C9 0A          cmp #10
00A728  1  D0 03          bne :+
00A72A  1  4C BF A7       jmp _rv_default_grate
00A72D  1               :
00A72D  1  C9 0C          cmp #12
00A72F  1  D0 03          bne :+
00A731  1  4C C7 A7       jmp _rv_default_lamp
00A734  1               :
00A734  1  C9 0D          cmp #13
00A736  1  D0 03          bne :+
00A738  1  4C C7 A7       jmp _rv_default_lamp
00A73B  1               :
00A73B  1  C9 0E          cmp #14
00A73D  1  D0 03          bne :+
00A73F  1  4C CF A7       jmp _rv_default_food
00A742  1               :
00A742  1  C9 0F          cmp #15
00A744  1  D0 03          bne :+
00A746  1  4C D7 A7       jmp _rv_default_bottle
00A749  1               :
00A749  1  C9 10          cmp #16
00A74B  1  D0 03          bne :+
00A74D  1  4C D7 A7       jmp _rv_default_bottle
00A750  1               :
00A750  1  C9 11          cmp #17
00A752  1  D0 03          bne :+
00A754  1  4C D7 A7       jmp _rv_default_bottle
00A757  1               :
00A757  1  C9 12          cmp #18
00A759  1  D0 03          bne :+
00A75B  1  4C DF A7       jmp _rv_default_rod
00A75E  1               :
00A75E  1  C9 0B          cmp #11
00A760  1  D0 03          bne :+
00A762  1  4C AC A8       jmp _rv_emit_done
00A765  1               :
00A765  1  C9 15          cmp #21
00A767  1  D0 03          bne :+
00A769  1  4C AC A8       jmp _rv_emit_done
00A76C  1               :
00A76C  1  C9 1A          cmp #26
00A76E  1  D0 03          bne :+
00A770  1  4C AC A8       jmp _rv_emit_done
00A773  1               :
00A773  1  AD 73 07       lda command_type
00A776  1  C9 1B          cmp #27
00A778  1  90 07          bcc :+
00A77A  1  C9 26          cmp #38
00A77C  1  B0 03          bcs :+
00A77E  1  4C AC A8       jmp _rv_emit_done
00A781  1               :
00A781  1  AD 73 07       lda command_type
00A784  1  C9 02          cmp #2
00A786  1  D0 5F          bne _rv_missing_object_jump
00A788  1  AD 70 07       lda cmd_len
00A78B  1  C9 05          cmp #5
00A78D  1  90 58          bcc _rv_missing_object_jump
00A78F  1  AD 20 07       lda cmd_buf
00A792  1  C9 4C          cmp #'L'
00A794  1  D0 51          bne _rv_missing_object_jump
00A796  1  AD 21 07       lda cmd_buf+1
00A799  1  C9 45          cmp #'E'
00A79B  1  D0 4A          bne _rv_missing_object_jump
00A79D  1  AD 22 07       lda cmd_buf+2
00A7A0  1  C9 41          cmp #'A'
00A7A2  1  D0 43          bne _rv_missing_object_jump
00A7A4  1  AD 23 07       lda cmd_buf+3
00A7A7  1  C9 56          cmp #'V'
00A7A9  1  D0 3C          bne _rv_missing_object_jump
00A7AB  1  AD 24 07       lda cmd_buf+4
00A7AE  1  C9 45          cmp #'E'
00A7B0  1  D0 35          bne _rv_missing_object_jump
00A7B2  1  A9 00          lda #0
00A7B4  1  8D 73 07       sta command_type
00A7B7  1  A9 0B          lda #11
00A7B9  1  8D 01 07       sta target_verb
00A7BC  1  4C AC A8       jmp _rv_emit_done
00A7BF  1               _rv_default_grate:
00A7BF  1  A9 03          lda #3
00A7C1  1  8D 74 07       sta command_object
00A7C4  1  4C AC A8       jmp _rv_emit_done
00A7C7  1               _rv_default_lamp:
00A7C7  1  A9 02          lda #2
00A7C9  1  8D 74 07       sta command_object
00A7CC  1  4C AC A8       jmp _rv_emit_done
00A7CF  1               _rv_default_food:
00A7CF  1  A9 13          lda #19
00A7D1  1  8D 74 07       sta command_object
00A7D4  1  4C AC A8       jmp _rv_emit_done
00A7D7  1               _rv_default_bottle:
00A7D7  1  A9 14          lda #20
00A7D9  1  8D 74 07       sta command_object
00A7DC  1  4C AC A8       jmp _rv_emit_done
00A7DF  1               _rv_default_rod:
00A7DF  1  A9 05          lda #5
00A7E1  1  8D 74 07       sta command_object
00A7E4  1  4C AC A8       jmp _rv_emit_done
00A7E7  1               _rv_missing_object_jump:
00A7E7  1  4C A2 A8       jmp _rv_missing_object
00A7EA  1               _rv_have_noun:
00A7EA  1  20 18 B6       jsr decode_object_word
00A7ED  1  AD 74 07       lda command_object
00A7F0  1  F0 03          beq :+
00A7F2  1  4C AC A8       jmp _rv_emit_done
00A7F5  1               :
00A7F5  1  A9 02          lda #2
00A7F7  1  8D 75 07       sta parse_error
00A7FA  1  A9 08          lda #8
00A7FC  1  8D 73 07       sta command_type
00A7FF  1  4C AC A8       jmp _rv_emit_done
00A802  1               
00A802  1               _rv_look_object:
00A802  1  AD 72 07       lda noun_len
00A805  1  D0 03          bne :+
00A807  1  4C AC A8       jmp _rv_emit_done
00A80A  1               :
00A80A  1  20 18 B6       jsr decode_object_word
00A80D  1  AD 74 07       lda command_object
00A810  1  D0 0D          bne :+
00A812  1  A9 02          lda #2
00A814  1  8D 75 07       sta parse_error
00A817  1  A9 08          lda #8
00A819  1  8D 73 07       sta command_type
00A81C  1  4C AC A8       jmp _rv_emit_done
00A81F  1               :
00A81F  1  A9 06          lda #6
00A821  1  8D 73 07       sta command_type
00A824  1  4C AC A8       jmp _rv_emit_done
00A827  1               
00A827  1               _rv_try_motion:
00A827  1  20 BA BE       jsr decode_motion_word
00A82A  1  AD 01 07       lda target_verb
00A82D  1  C9 01          cmp #1
00A82F  1  D0 7B          bne _rv_emit_done
00A831  1  AD 72 07       lda noun_len
00A834  1  F0 2B          beq _rv_motion_unknown
00A836  1  20 41 B4       jsr verb_uses_noun_motion
00A839  1  90 26          bcc _rv_motion_unknown
00A83B  1  A2 00          ldx #0
00A83D  1               _rv_motion_copy:
00A83D  1  EC 72 07       cpx noun_len
00A840  1  B0 0A          bcs _rv_motion_copied
00A842  1  BD 30 07       lda noun_buf,x
00A845  1  9D 20 07       sta cmd_buf,x
00A848  1  E8             inx
00A849  1  4C 3D A8       jmp _rv_motion_copy
00A84C  1               _rv_motion_copied:
00A84C  1  A9 00          lda #0
00A84E  1  9D 20 07       sta cmd_buf,x
00A851  1  AD 72 07       lda noun_len
00A854  1  8D 70 07       sta cmd_len
00A857  1  20 BA BE       jsr decode_motion_word
00A85A  1  AD 01 07       lda target_verb
00A85D  1  C9 01          cmp #1
00A85F  1  D0 4B          bne _rv_emit_done
00A861  1               _rv_motion_unknown:
00A861  1                 ; For movement verbs like "GO" with no target, report missing object.
00A861  1                 ; Non-movement unknown words should remain unknown-word.
00A861  1  AD 72 07       lda noun_len
00A864  1  D0 08          bne _rv_motion_unknown_have_noun
00A866  1  20 41 B4       jsr verb_uses_noun_motion
00A869  1  B0 1D          bcs _rv_motion_missing_object
00A86B  1  4C 95 A8       jmp _rv_motion_unknown_word
00A86E  1               
00A86E  1               _rv_motion_unknown_have_noun:
00A86E  1                 ; Treat filler-only GO target like "GO TO" as missing object.
00A86E  1  20 41 B4       jsr verb_uses_noun_motion
00A871  1  90 22          bcc _rv_motion_unknown_word
00A873  1  AD 72 07       lda noun_len
00A876  1  C9 02          cmp #2
00A878  1  D0 1B          bne _rv_motion_unknown_word
00A87A  1  AD 30 07       lda noun_buf
00A87D  1  C9 54          cmp #'T'
00A87F  1  D0 14          bne _rv_motion_unknown_word
00A881  1  AD 31 07       lda noun_buf+1
00A884  1  C9 4F          cmp #'O'
00A886  1  D0 0D          bne _rv_motion_unknown_word
00A888  1               _rv_motion_missing_object:
00A888  1  A9 03          lda #3
00A88A  1  8D 75 07       sta parse_error
00A88D  1  A9 08          lda #8
00A88F  1  8D 73 07       sta command_type
00A892  1  4C AC A8       jmp _rv_emit_done
00A895  1               _rv_motion_unknown_word:
00A895  1  A9 01          lda #1
00A897  1  8D 75 07       sta parse_error
00A89A  1  A9 08          lda #8
00A89C  1  8D 73 07       sta command_type
00A89F  1  4C AC A8       jmp _rv_emit_done
00A8A2  1               
00A8A2  1               _rv_missing_object:
00A8A2  1  A9 03          lda #3
00A8A4  1  8D 75 07       sta parse_error
00A8A7  1  A9 08          lda #8
00A8A9  1  8D 73 07       sta command_type
00A8AC  1               
00A8AC  1               _rv_emit_done:
00A8AC  1  20 A7 ED       jsr newline
00A8AF  1  60             rts
00A8B0  1               
00A8B0  1               _rv_normalize_light:
00A8B0  1                 ; Accept "TURN ON/OFF" and "SWITCH ON/OFF" style input where noun token
00A8B0  1                 ; is ON/OFF rather than an object; normalize to lamp command.
00A8B0  1  AD 72 07       lda noun_len
00A8B3  1  F0 21          beq _rv_norm_light_done
00A8B5  1  20 D9 A8       jsr noun_is_onoff_word
00A8B8  1  90 1C          bcc _rv_norm_light_done
00A8BA  1  20 00 A9       jsr noun_is_off_word
00A8BD  1  90 08          bcc :+
00A8BF  1  A9 0D          lda #13
00A8C1  1  8D 73 07       sta command_type
00A8C4  1  4C CC A8       jmp _rv_norm_light_set_lamp
00A8C7  1               :
00A8C7  1  A9 0C          lda #12
00A8C9  1  8D 73 07       sta command_type
00A8CC  1               _rv_norm_light_set_lamp:
00A8CC  1  A9 02          lda #2
00A8CE  1  8D 74 07       sta command_object
00A8D1  1  A9 00          lda #0
00A8D3  1  8D 72 07       sta noun_len
00A8D6  1               _rv_norm_light_done:
00A8D6  1  4C 01 A7       jmp _rv_check_all
00A8D9  1               
00A8D9  1               noun_is_onoff_word:
00A8D9  1  20 E7 A8       jsr noun_is_on_word
00A8DC  1  B0 07          bcs _nio_yes
00A8DE  1  20 00 A9       jsr noun_is_off_word
00A8E1  1  B0 02          bcs _nio_yes
00A8E3  1  18             clc
00A8E4  1  60             rts
00A8E5  1               _nio_yes:
00A8E5  1  38             sec
00A8E6  1  60             rts
00A8E7  1               
00A8E7  1               noun_is_on_word:
00A8E7  1  AD 72 07       lda noun_len
00A8EA  1  C9 02          cmp #2
00A8EC  1  D0 10          bne _niow_no
00A8EE  1  AD 30 07       lda noun_buf
00A8F1  1  C9 4F          cmp #'O'
00A8F3  1  D0 09          bne _niow_no
00A8F5  1  AD 31 07       lda noun_buf+1
00A8F8  1  C9 4E          cmp #'N'
00A8FA  1  D0 02          bne _niow_no
00A8FC  1  38             sec
00A8FD  1  60             rts
00A8FE  1               _niow_no:
00A8FE  1  18             clc
00A8FF  1  60             rts
00A900  1               
00A900  1               noun_is_off_word:
00A900  1  AD 72 07       lda noun_len
00A903  1  C9 03          cmp #3
00A905  1  D0 17          bne _niof_no
00A907  1  AD 30 07       lda noun_buf
00A90A  1  C9 4F          cmp #'O'
00A90C  1  D0 10          bne _niof_no
00A90E  1  AD 31 07       lda noun_buf+1
00A911  1  C9 46          cmp #'F'
00A913  1  D0 09          bne _niof_no
00A915  1  AD 32 07       lda noun_buf+2
00A918  1  C9 46          cmp #'F'
00A91A  1  D0 02          bne _niof_no
00A91C  1  38             sec
00A91D  1  60             rts
00A91E  1               _niof_no:
00A91E  1  18             clc
00A91F  1  60             rts
00A920  1               
00A920  1               decode_action_word:
00A920  1                 ; Writes command_type:
00A920  1                 ; 1=TAKE, 2=DROP, 3=INVENTORY, 4=LOOK, 5=QUIT, 6=EXAMINE, 7=READ
00A920  1                 ; 9=openish,10=closeish,11=help,12=light,13=dark,14=eat,15=drink,16=fill,17=pour,18=wave,19=find
00A920  1                 ; 20=say,21=kill/attack,22=throw/toss,23=feed,24=break,25=rub,26=wake
00A920  1                 ; 27=blast,28=score,29=calm,30=walk,31=nothing,32=brief,33=suspend,34=hours,35=log,36=load,37=foo
00A920  1                 ; Prefix matching makes this robust against trailing chars.
00A920  1  AD 70 07       lda cmd_len
00A923  1  C9 01          cmp #1
00A925  1  B0 01          bcs _daw_have_len
00A927  1  60             rts
00A928  1               _daw_have_len:
00A928  1  F0 09          beq _daw_len1
00A92A  1  C9 02          cmp #2
00A92C  1  F0 47          beq _daw_len2
00A92E  1  C9 03          cmp #3
00A930  1  B0 58          bcs _daw_ge3
00A932  1  60             rts
00A933  1               _daw_len1:
00A933  1                 ; L
00A933  1  AD 20 07       lda cmd_buf
00A936  1  C9 4C          cmp #'L'
00A938  1  D0 06          bne _daw_check_q1
00A93A  1  A9 04          lda #4
00A93C  1  8D 73 07       sta command_type
00A93F  1  60             rts
00A940  1               _daw_check_q1:
00A940  1                 ; Q
00A940  1  AD 20 07       lda cmd_buf
00A943  1  C9 51          cmp #'Q'
00A945  1  D0 06          bne _daw_check_x1
00A947  1  A9 05          lda #5
00A949  1  8D 73 07       sta command_type
00A94C  1  60             rts
00A94D  1               
00A94D  1               _daw_check_x1:
00A94D  1                 ; X
00A94D  1  AD 20 07       lda cmd_buf
00A950  1  C9 58          cmp #'X'
00A952  1  D0 06          bne _daw_check_i1
00A954  1  A9 06          lda #6
00A956  1  8D 73 07       sta command_type
00A959  1  60             rts
00A95A  1               _daw_check_i1:
00A95A  1                 ; I
00A95A  1  AD 20 07       lda cmd_buf
00A95D  1  C9 49          cmp #'I'
00A95F  1  D0 06          bne _daw_check_r1
00A961  1  A9 03          lda #3
00A963  1  8D 73 07       sta command_type
00A966  1  60             rts
00A967  1               _daw_check_r1:
00A967  1                 ; R
00A967  1  AD 20 07       lda cmd_buf
00A96A  1  C9 52          cmp #'R'
00A96C  1  D0 06          bne _daw_no1
00A96E  1  A9 07          lda #7
00A970  1  8D 73 07       sta command_type
00A973  1  60             rts
00A974  1               _daw_no1:
00A974  1  60             rts
00A975  1               
00A975  1               _daw_len2:
00A975  1                 ; ON
00A975  1  AD 20 07       lda cmd_buf
00A978  1  C9 4F          cmp #'O'
00A97A  1  D0 0D          bne _daw_no2
00A97C  1  AD 21 07       lda cmd_buf+1
00A97F  1  C9 4E          cmp #'N'
00A981  1  D0 06          bne _daw_no2
00A983  1  A9 0C          lda #12
00A985  1  8D 73 07       sta command_type
00A988  1  60             rts
00A989  1               _daw_no2:
00A989  1  60             rts
00A98A  1               _daw_ge3:
00A98A  1               
00A98A  1                 ; GET*
00A98A  1  AD 20 07       lda cmd_buf
00A98D  1  C9 47          cmp #'G'
00A98F  1  D0 14          bne _daw_check_read
00A991  1  AD 21 07       lda cmd_buf+1
00A994  1  C9 45          cmp #'E'
00A996  1  D0 0D          bne _daw_check_read
00A998  1  AD 22 07       lda cmd_buf+2
00A99B  1  C9 54          cmp #'T'
00A99D  1  D0 06          bne _daw_check_read
00A99F  1  A9 01          lda #1
00A9A1  1  8D 73 07       sta command_type
00A9A4  1  60             rts
00A9A5  1               
00A9A5  1               _daw_check_read:
00A9A5  1                 ; HELP* (early catch to avoid noun-required fallthrough)
00A9A5  1  AD 70 07       lda cmd_len
00A9A8  1  C9 04          cmp #4
00A9AA  1  90 22          bcc _daw_check_read_real
00A9AC  1  AD 20 07       lda cmd_buf
00A9AF  1  C9 48          cmp #'H'
00A9B1  1  D0 1B          bne _daw_check_read_real
00A9B3  1  AD 21 07       lda cmd_buf+1
00A9B6  1  C9 45          cmp #'E'
00A9B8  1  D0 14          bne _daw_check_read_real
00A9BA  1  AD 22 07       lda cmd_buf+2
00A9BD  1  C9 4C          cmp #'L'
00A9BF  1  D0 0D          bne _daw_check_read_real
00A9C1  1  AD 23 07       lda cmd_buf+3
00A9C4  1  C9 50          cmp #'P'
00A9C6  1  D0 06          bne _daw_check_read_real
00A9C8  1  A9 0B          lda #11
00A9CA  1  8D 73 07       sta command_type
00A9CD  1  60             rts
00A9CE  1               _daw_check_read_real:
00A9CE  1                 ; READ*
00A9CE  1  AD 70 07       lda cmd_len
00A9D1  1  C9 04          cmp #4
00A9D3  1  90 22          bcc _daw_check_light
00A9D5  1  AD 20 07       lda cmd_buf
00A9D8  1  C9 52          cmp #'R'
00A9DA  1  D0 1B          bne _daw_check_light
00A9DC  1  AD 21 07       lda cmd_buf+1
00A9DF  1  C9 45          cmp #'E'
00A9E1  1  D0 14          bne _daw_check_light
00A9E3  1  AD 22 07       lda cmd_buf+2
00A9E6  1  C9 41          cmp #'A'
00A9E8  1  D0 0D          bne _daw_check_light
00A9EA  1  AD 23 07       lda cmd_buf+3
00A9ED  1  C9 44          cmp #'D'
00A9EF  1  D0 06          bne _daw_check_light
00A9F1  1  A9 07          lda #7
00A9F3  1  8D 73 07       sta command_type
00A9F6  1  60             rts
00A9F7  1               
00A9F7  1               _daw_check_light:
00A9F7  1                 ; LIGHT*
00A9F7  1  AD 70 07       lda cmd_len
00A9FA  1  C9 05          cmp #5
00A9FC  1  90 29          bcc _daw_check_extinguish
00A9FE  1  AD 20 07       lda cmd_buf
00AA01  1  C9 4C          cmp #'L'
00AA03  1  D0 22          bne _daw_check_extinguish
00AA05  1  AD 21 07       lda cmd_buf+1
00AA08  1  C9 49          cmp #'I'
00AA0A  1  D0 1B          bne _daw_check_extinguish
00AA0C  1  AD 22 07       lda cmd_buf+2
00AA0F  1  C9 47          cmp #'G'
00AA11  1  D0 14          bne _daw_check_extinguish
00AA13  1  AD 23 07       lda cmd_buf+3
00AA16  1  C9 48          cmp #'H'
00AA18  1  D0 0D          bne _daw_check_extinguish
00AA1A  1  AD 24 07       lda cmd_buf+4
00AA1D  1  C9 54          cmp #'T'
00AA1F  1  D0 06          bne _daw_check_extinguish
00AA21  1  A9 0C          lda #12
00AA23  1  8D 73 07       sta command_type
00AA26  1  60             rts
00AA27  1               
00AA27  1               _daw_check_extinguish:
00AA27  1                 ; EXTINGUISH* / OFF*
00AA27  1  AD 70 07       lda cmd_len
00AA2A  1  C9 0A          cmp #10
00AA2C  1  90 4C          bcc _daw_check_off
00AA2E  1  AD 20 07       lda cmd_buf
00AA31  1  C9 45          cmp #'E'
00AA33  1  D0 45          bne _daw_check_off
00AA35  1  AD 21 07       lda cmd_buf+1
00AA38  1  C9 58          cmp #'X'
00AA3A  1  D0 3E          bne _daw_check_off
00AA3C  1  AD 22 07       lda cmd_buf+2
00AA3F  1  C9 54          cmp #'T'
00AA41  1  D0 37          bne _daw_check_off
00AA43  1  AD 23 07       lda cmd_buf+3
00AA46  1  C9 49          cmp #'I'
00AA48  1  D0 30          bne _daw_check_off
00AA4A  1  AD 24 07       lda cmd_buf+4
00AA4D  1  C9 4E          cmp #'N'
00AA4F  1  D0 29          bne _daw_check_off
00AA51  1  AD 25 07       lda cmd_buf+5
00AA54  1  C9 47          cmp #'G'
00AA56  1  D0 22          bne _daw_check_off
00AA58  1  AD 26 07       lda cmd_buf+6
00AA5B  1  C9 55          cmp #'U'
00AA5D  1  D0 1B          bne _daw_check_off
00AA5F  1  AD 27 07       lda cmd_buf+7
00AA62  1  C9 49          cmp #'I'
00AA64  1  D0 14          bne _daw_check_off
00AA66  1  AD 28 07       lda cmd_buf+8
00AA69  1  C9 53          cmp #'S'
00AA6B  1  D0 0D          bne _daw_check_off
00AA6D  1  AD 29 07       lda cmd_buf+9
00AA70  1  C9 48          cmp #'H'
00AA72  1  D0 06          bne _daw_check_off
00AA74  1  A9 0D          lda #13
00AA76  1  8D 73 07       sta command_type
00AA79  1  60             rts
00AA7A  1               
00AA7A  1               _daw_check_off:
00AA7A  1  AD 70 07       lda cmd_len
00AA7D  1  C9 03          cmp #3
00AA7F  1  90 1B          bcc _daw_check_eat
00AA81  1  AD 20 07       lda cmd_buf
00AA84  1  C9 4F          cmp #'O'
00AA86  1  D0 14          bne _daw_check_eat
00AA88  1  AD 21 07       lda cmd_buf+1
00AA8B  1  C9 46          cmp #'F'
00AA8D  1  D0 0D          bne _daw_check_eat
00AA8F  1  AD 22 07       lda cmd_buf+2
00AA92  1  C9 46          cmp #'F'
00AA94  1  D0 06          bne _daw_check_eat
00AA96  1  A9 0D          lda #13
00AA98  1  8D 73 07       sta command_type
00AA9B  1  60             rts
00AA9C  1               
00AA9C  1               _daw_check_eat:
00AA9C  1                 ; EAT*
00AA9C  1  AD 70 07       lda cmd_len
00AA9F  1  C9 03          cmp #3
00AAA1  1  90 1B          bcc _daw_check_drink
00AAA3  1  AD 20 07       lda cmd_buf
00AAA6  1  C9 45          cmp #'E'
00AAA8  1  D0 14          bne _daw_check_drink
00AAAA  1  AD 21 07       lda cmd_buf+1
00AAAD  1  C9 41          cmp #'A'
00AAAF  1  D0 0D          bne _daw_check_drink
00AAB1  1  AD 22 07       lda cmd_buf+2
00AAB4  1  C9 54          cmp #'T'
00AAB6  1  D0 06          bne _daw_check_drink
00AAB8  1  A9 0E          lda #14
00AABA  1  8D 73 07       sta command_type
00AABD  1  60             rts
00AABE  1               
00AABE  1               _daw_check_drink:
00AABE  1                 ; DRINK*
00AABE  1  AD 70 07       lda cmd_len
00AAC1  1  C9 05          cmp #5
00AAC3  1  90 29          bcc _daw_check_fill
00AAC5  1  AD 20 07       lda cmd_buf
00AAC8  1  C9 44          cmp #'D'
00AACA  1  D0 22          bne _daw_check_fill
00AACC  1  AD 21 07       lda cmd_buf+1
00AACF  1  C9 52          cmp #'R'
00AAD1  1  D0 1B          bne _daw_check_fill
00AAD3  1  AD 22 07       lda cmd_buf+2
00AAD6  1  C9 49          cmp #'I'
00AAD8  1  D0 14          bne _daw_check_fill
00AADA  1  AD 23 07       lda cmd_buf+3
00AADD  1  C9 4E          cmp #'N'
00AADF  1  D0 0D          bne _daw_check_fill
00AAE1  1  AD 24 07       lda cmd_buf+4
00AAE4  1  C9 4B          cmp #'K'
00AAE6  1  D0 06          bne _daw_check_fill
00AAE8  1  A9 0F          lda #15
00AAEA  1  8D 73 07       sta command_type
00AAED  1  60             rts
00AAEE  1               
00AAEE  1               _daw_check_fill:
00AAEE  1                 ; FILL*
00AAEE  1  AD 70 07       lda cmd_len
00AAF1  1  C9 04          cmp #4
00AAF3  1  90 22          bcc _daw_check_pour
00AAF5  1  AD 20 07       lda cmd_buf
00AAF8  1  C9 46          cmp #'F'
00AAFA  1  D0 1B          bne _daw_check_pour
00AAFC  1  AD 21 07       lda cmd_buf+1
00AAFF  1  C9 49          cmp #'I'
00AB01  1  D0 14          bne _daw_check_pour
00AB03  1  AD 22 07       lda cmd_buf+2
00AB06  1  C9 4C          cmp #'L'
00AB08  1  D0 0D          bne _daw_check_pour
00AB0A  1  AD 23 07       lda cmd_buf+3
00AB0D  1  C9 4C          cmp #'L'
00AB0F  1  D0 06          bne _daw_check_pour
00AB11  1  A9 10          lda #16
00AB13  1  8D 73 07       sta command_type
00AB16  1  60             rts
00AB17  1               
00AB17  1               _daw_check_pour:
00AB17  1                 ; POUR*
00AB17  1  AD 70 07       lda cmd_len
00AB1A  1  C9 04          cmp #4
00AB1C  1  90 22          bcc _daw_check_empty
00AB1E  1  AD 20 07       lda cmd_buf
00AB21  1  C9 50          cmp #'P'
00AB23  1  D0 1B          bne _daw_check_empty
00AB25  1  AD 21 07       lda cmd_buf+1
00AB28  1  C9 4F          cmp #'O'
00AB2A  1  D0 14          bne _daw_check_empty
00AB2C  1  AD 22 07       lda cmd_buf+2
00AB2F  1  C9 55          cmp #'U'
00AB31  1  D0 0D          bne _daw_check_empty
00AB33  1  AD 23 07       lda cmd_buf+3
00AB36  1  C9 52          cmp #'R'
00AB38  1  D0 06          bne _daw_check_empty
00AB3A  1  A9 11          lda #17
00AB3C  1  8D 73 07       sta command_type
00AB3F  1  60             rts
00AB40  1               
00AB40  1               _daw_check_empty:
00AB40  1                 ; EMPTY*
00AB40  1  AD 70 07       lda cmd_len
00AB43  1  C9 05          cmp #5
00AB45  1  90 29          bcc _daw_check_wave
00AB47  1  AD 20 07       lda cmd_buf
00AB4A  1  C9 45          cmp #'E'
00AB4C  1  D0 22          bne _daw_check_wave
00AB4E  1  AD 21 07       lda cmd_buf+1
00AB51  1  C9 4D          cmp #'M'
00AB53  1  D0 1B          bne _daw_check_wave
00AB55  1  AD 22 07       lda cmd_buf+2
00AB58  1  C9 50          cmp #'P'
00AB5A  1  D0 14          bne _daw_check_wave
00AB5C  1  AD 23 07       lda cmd_buf+3
00AB5F  1  C9 54          cmp #'T'
00AB61  1  D0 0D          bne _daw_check_wave
00AB63  1  AD 24 07       lda cmd_buf+4
00AB66  1  C9 59          cmp #'Y'
00AB68  1  D0 06          bne _daw_check_wave
00AB6A  1  A9 11          lda #17
00AB6C  1  8D 73 07       sta command_type
00AB6F  1  60             rts
00AB70  1               
00AB70  1               _daw_check_wave:
00AB70  1                 ; WAVE*
00AB70  1  AD 70 07       lda cmd_len
00AB73  1  C9 04          cmp #4
00AB75  1  90 22          bcc _daw_check_turn
00AB77  1  AD 20 07       lda cmd_buf
00AB7A  1  C9 57          cmp #'W'
00AB7C  1  D0 1B          bne _daw_check_turn
00AB7E  1  AD 21 07       lda cmd_buf+1
00AB81  1  C9 41          cmp #'A'
00AB83  1  D0 14          bne _daw_check_turn
00AB85  1  AD 22 07       lda cmd_buf+2
00AB88  1  C9 56          cmp #'V'
00AB8A  1  D0 0D          bne _daw_check_turn
00AB8C  1  AD 23 07       lda cmd_buf+3
00AB8F  1  C9 45          cmp #'E'
00AB91  1  D0 06          bne _daw_check_turn
00AB93  1  A9 12          lda #18
00AB95  1  8D 73 07       sta command_type
00AB98  1  60             rts
00AB99  1               
00AB99  1               _daw_check_turn:
00AB99  1                 ; TURN* / SWITCH* as light control verbs; ON/OFF interpretation happens
00AB99  1                 ; after tokenization in _rv_normalize_light.
00AB99  1  AD 70 07       lda cmd_len
00AB9C  1  C9 04          cmp #4
00AB9E  1  90 22          bcc _daw_check_switch
00ABA0  1  AD 20 07       lda cmd_buf
00ABA3  1  C9 54          cmp #'T'
00ABA5  1  D0 1B          bne _daw_check_switch
00ABA7  1  AD 21 07       lda cmd_buf+1
00ABAA  1  C9 55          cmp #'U'
00ABAC  1  D0 14          bne _daw_check_switch
00ABAE  1  AD 22 07       lda cmd_buf+2
00ABB1  1  C9 52          cmp #'R'
00ABB3  1  D0 0D          bne _daw_check_switch
00ABB5  1  AD 23 07       lda cmd_buf+3
00ABB8  1  C9 4E          cmp #'N'
00ABBA  1  D0 06          bne _daw_check_switch
00ABBC  1  A9 0C          lda #12
00ABBE  1  8D 73 07       sta command_type
00ABC1  1  60             rts
00ABC2  1               _daw_check_switch:
00ABC2  1  AD 70 07       lda cmd_len
00ABC5  1  C9 06          cmp #6
00ABC7  1  90 30          bcc _daw_check_exam
00ABC9  1  AD 20 07       lda cmd_buf
00ABCC  1  C9 53          cmp #'S'
00ABCE  1  D0 29          bne _daw_check_exam
00ABD0  1  AD 21 07       lda cmd_buf+1
00ABD3  1  C9 57          cmp #'W'
00ABD5  1  D0 22          bne _daw_check_exam
00ABD7  1  AD 22 07       lda cmd_buf+2
00ABDA  1  C9 49          cmp #'I'
00ABDC  1  D0 1B          bne _daw_check_exam
00ABDE  1  AD 23 07       lda cmd_buf+3
00ABE1  1  C9 54          cmp #'T'
00ABE3  1  D0 14          bne _daw_check_exam
00ABE5  1  AD 24 07       lda cmd_buf+4
00ABE8  1  C9 43          cmp #'C'
00ABEA  1  D0 0D          bne _daw_check_exam
00ABEC  1  AD 25 07       lda cmd_buf+5
00ABEF  1  C9 48          cmp #'H'
00ABF1  1  D0 06          bne _daw_check_exam
00ABF3  1  A9 0C          lda #12
00ABF5  1  8D 73 07       sta command_type
00ABF8  1  60             rts
00ABF9  1               
00ABF9  1               _daw_check_exam:
00ABF9  1                 ; EXAM* / EXAMINE*
00ABF9  1  AD 70 07       lda cmd_len
00ABFC  1  C9 04          cmp #4
00ABFE  1  90 22          bcc _daw_check_open
00AC00  1  AD 20 07       lda cmd_buf
00AC03  1  C9 45          cmp #'E'
00AC05  1  D0 1B          bne _daw_check_open
00AC07  1  AD 21 07       lda cmd_buf+1
00AC0A  1  C9 58          cmp #'X'
00AC0C  1  D0 14          bne _daw_check_open
00AC0E  1  AD 22 07       lda cmd_buf+2
00AC11  1  C9 41          cmp #'A'
00AC13  1  D0 0D          bne _daw_check_open
00AC15  1  AD 23 07       lda cmd_buf+3
00AC18  1  C9 4D          cmp #'M'
00AC1A  1  D0 06          bne _daw_check_open
00AC1C  1  A9 06          lda #6
00AC1E  1  8D 73 07       sta command_type
00AC21  1  60             rts
00AC22  1               
00AC22  1               _daw_check_open:
00AC22  1                 ; OPEN*
00AC22  1  AD 70 07       lda cmd_len
00AC25  1  C9 04          cmp #4
00AC27  1  90 22          bcc _daw_check_close
00AC29  1  AD 20 07       lda cmd_buf
00AC2C  1  C9 4F          cmp #'O'
00AC2E  1  D0 1B          bne _daw_check_close
00AC30  1  AD 21 07       lda cmd_buf+1
00AC33  1  C9 50          cmp #'P'
00AC35  1  D0 14          bne _daw_check_close
00AC37  1  AD 22 07       lda cmd_buf+2
00AC3A  1  C9 45          cmp #'E'
00AC3C  1  D0 0D          bne _daw_check_close
00AC3E  1  AD 23 07       lda cmd_buf+3
00AC41  1  C9 4E          cmp #'N'
00AC43  1  D0 06          bne _daw_check_close
00AC45  1  A9 09          lda #9
00AC47  1  8D 73 07       sta command_type
00AC4A  1  60             rts
00AC4B  1               
00AC4B  1               _daw_check_close:
00AC4B  1                 ; CLOSE*/LOCK*/UNLOCK*
00AC4B  1  AD 70 07       lda cmd_len
00AC4E  1  C9 04          cmp #4
00AC50  1  90 30          bcc _daw_check_lock
00AC52  1  AD 20 07       lda cmd_buf
00AC55  1  C9 43          cmp #'C'
00AC57  1  D0 29          bne _daw_check_lock
00AC59  1  AD 21 07       lda cmd_buf+1
00AC5C  1  C9 4C          cmp #'L'
00AC5E  1  D0 22          bne _daw_check_lock
00AC60  1  AD 22 07       lda cmd_buf+2
00AC63  1  C9 4F          cmp #'O'
00AC65  1  D0 1B          bne _daw_check_lock
00AC67  1  AD 23 07       lda cmd_buf+3
00AC6A  1  C9 53          cmp #'S'
00AC6C  1  D0 14          bne _daw_check_lock
00AC6E  1  AD 70 07       lda cmd_len
00AC71  1  C9 05          cmp #5
00AC73  1  90 07          bcc _daw_close_match
00AC75  1  AD 24 07       lda cmd_buf+4
00AC78  1  C9 45          cmp #'E'
00AC7A  1  D0 06          bne _daw_check_lock
00AC7C  1               _daw_close_match:
00AC7C  1  A9 0A          lda #10
00AC7E  1  8D 73 07       sta command_type
00AC81  1  60             rts
00AC82  1               _daw_check_lock:
00AC82  1  AD 20 07       lda cmd_buf
00AC85  1  C9 4C          cmp #'L'
00AC87  1  D0 1B          bne _daw_check_unlock
00AC89  1  AD 21 07       lda cmd_buf+1
00AC8C  1  C9 4F          cmp #'O'
00AC8E  1  D0 14          bne _daw_check_unlock
00AC90  1  AD 22 07       lda cmd_buf+2
00AC93  1  C9 43          cmp #'C'
00AC95  1  D0 0D          bne _daw_check_unlock
00AC97  1  AD 23 07       lda cmd_buf+3
00AC9A  1  C9 4B          cmp #'K'
00AC9C  1  D0 06          bne _daw_check_unlock
00AC9E  1  A9 0A          lda #10
00ACA0  1  8D 73 07       sta command_type
00ACA3  1  60             rts
00ACA4  1               _daw_check_unlock:
00ACA4  1  AD 70 07       lda cmd_len
00ACA7  1  C9 06          cmp #6
00ACA9  1  90 30          bcc _daw_check_inspect
00ACAB  1  AD 20 07       lda cmd_buf
00ACAE  1  C9 55          cmp #'U'
00ACB0  1  D0 29          bne _daw_check_inspect
00ACB2  1  AD 21 07       lda cmd_buf+1
00ACB5  1  C9 4E          cmp #'N'
00ACB7  1  D0 22          bne _daw_check_inspect
00ACB9  1  AD 22 07       lda cmd_buf+2
00ACBC  1  C9 4C          cmp #'L'
00ACBE  1  D0 1B          bne _daw_check_inspect
00ACC0  1  AD 23 07       lda cmd_buf+3
00ACC3  1  C9 4F          cmp #'O'
00ACC5  1  D0 14          bne _daw_check_inspect
00ACC7  1  AD 24 07       lda cmd_buf+4
00ACCA  1  C9 43          cmp #'C'
00ACCC  1  D0 0D          bne _daw_check_inspect
00ACCE  1  AD 25 07       lda cmd_buf+5
00ACD1  1  C9 4B          cmp #'K'
00ACD3  1  D0 06          bne _daw_check_inspect
00ACD5  1  A9 09          lda #9
00ACD7  1  8D 73 07       sta command_type
00ACDA  1  60             rts
00ACDB  1               
00ACDB  1               _daw_check_inspect:
00ACDB  1                 ; INSP* / INSPECT*
00ACDB  1  AD 70 07       lda cmd_len
00ACDE  1  C9 04          cmp #4
00ACE0  1  90 22          bcc _daw_check_inv
00ACE2  1  AD 20 07       lda cmd_buf
00ACE5  1  C9 49          cmp #'I'
00ACE7  1  D0 1B          bne _daw_check_inv
00ACE9  1  AD 21 07       lda cmd_buf+1
00ACEC  1  C9 4E          cmp #'N'
00ACEE  1  D0 14          bne _daw_check_inv
00ACF0  1  AD 22 07       lda cmd_buf+2
00ACF3  1  C9 53          cmp #'S'
00ACF5  1  D0 0D          bne _daw_check_inv
00ACF7  1  AD 23 07       lda cmd_buf+3
00ACFA  1  C9 50          cmp #'P'
00ACFC  1  D0 06          bne _daw_check_inv
00ACFE  1  A9 06          lda #6
00AD00  1  8D 73 07       sta command_type
00AD03  1  60             rts
00AD04  1               
00AD04  1               _daw_check_inv:
00AD04  1                 ; INV*
00AD04  1  AD 20 07       lda cmd_buf
00AD07  1  C9 49          cmp #'I'
00AD09  1  D0 14          bne _daw_check_take
00AD0B  1  AD 21 07       lda cmd_buf+1
00AD0E  1  C9 4E          cmp #'N'
00AD10  1  D0 0D          bne _daw_check_take
00AD12  1  AD 22 07       lda cmd_buf+2
00AD15  1  C9 56          cmp #'V'
00AD17  1  D0 06          bne _daw_check_take
00AD19  1  A9 03          lda #3
00AD1B  1  8D 73 07       sta command_type
00AD1E  1  60             rts
00AD1F  1               
00AD1F  1               _daw_check_take:
00AD1F  1  AD 70 07       lda cmd_len
00AD22  1  C9 04          cmp #4
00AD24  1  B0 03          bcs :+
00AD26  1  4C B1 AD       jmp _daw_check_put
00AD29  1               :
00AD29  1  AD 20 07       lda cmd_buf
00AD2C  1  C9 54          cmp #'T'
00AD2E  1  D0 1B          bne _daw_check_pick
00AD30  1  AD 21 07       lda cmd_buf+1
00AD33  1  C9 41          cmp #'A'
00AD35  1  D0 14          bne _daw_check_pick
00AD37  1  AD 22 07       lda cmd_buf+2
00AD3A  1  C9 4B          cmp #'K'
00AD3C  1  D0 0D          bne _daw_check_pick
00AD3E  1  AD 23 07       lda cmd_buf+3
00AD41  1  C9 45          cmp #'E'
00AD43  1  D0 06          bne _daw_check_pick
00AD45  1  A9 01          lda #1
00AD47  1  8D 73 07       sta command_type
00AD4A  1  60             rts
00AD4B  1               _daw_check_pick:
00AD4B  1  AD 20 07       lda cmd_buf
00AD4E  1  C9 50          cmp #'P'
00AD50  1  D0 1B          bne _daw_check_grab
00AD52  1  AD 21 07       lda cmd_buf+1
00AD55  1  C9 49          cmp #'I'
00AD57  1  D0 14          bne _daw_check_grab
00AD59  1  AD 22 07       lda cmd_buf+2
00AD5C  1  C9 43          cmp #'C'
00AD5E  1  D0 0D          bne _daw_check_grab
00AD60  1  AD 23 07       lda cmd_buf+3
00AD63  1  C9 4B          cmp #'K'
00AD65  1  D0 06          bne _daw_check_grab
00AD67  1  A9 01          lda #1
00AD69  1  8D 73 07       sta command_type
00AD6C  1  60             rts
00AD6D  1               _daw_check_grab:
00AD6D  1  AD 20 07       lda cmd_buf
00AD70  1  C9 47          cmp #'G'
00AD72  1  D0 1B          bne _daw_check_drop
00AD74  1  AD 21 07       lda cmd_buf+1
00AD77  1  C9 52          cmp #'R'
00AD79  1  D0 14          bne _daw_check_drop
00AD7B  1  AD 22 07       lda cmd_buf+2
00AD7E  1  C9 41          cmp #'A'
00AD80  1  D0 0D          bne _daw_check_drop
00AD82  1  AD 23 07       lda cmd_buf+3
00AD85  1  C9 42          cmp #'B'
00AD87  1  D0 06          bne _daw_check_drop
00AD89  1  A9 01          lda #1
00AD8B  1  8D 73 07       sta command_type
00AD8E  1  60             rts
00AD8F  1               
00AD8F  1               _daw_check_drop:
00AD8F  1  AD 20 07       lda cmd_buf
00AD92  1  C9 44          cmp #'D'
00AD94  1  D0 1B          bne _daw_check_put
00AD96  1  AD 21 07       lda cmd_buf+1
00AD99  1  C9 52          cmp #'R'
00AD9B  1  D0 14          bne _daw_check_put
00AD9D  1  AD 22 07       lda cmd_buf+2
00ADA0  1  C9 4F          cmp #'O'
00ADA2  1  D0 0D          bne _daw_check_put
00ADA4  1  AD 23 07       lda cmd_buf+3
00ADA7  1  C9 50          cmp #'P'
00ADA9  1  D0 06          bne _daw_check_put
00ADAB  1  A9 02          lda #2
00ADAD  1  8D 73 07       sta command_type
00ADB0  1  60             rts
00ADB1  1               _daw_check_put:
00ADB1  1  AD 20 07       lda cmd_buf
00ADB4  1  C9 50          cmp #'P'
00ADB6  1  D0 14          bne _daw_check_carry
00ADB8  1  AD 21 07       lda cmd_buf+1
00ADBB  1  C9 55          cmp #'U'
00ADBD  1  D0 0D          bne _daw_check_carry
00ADBF  1  AD 22 07       lda cmd_buf+2
00ADC2  1  C9 54          cmp #'T'
00ADC4  1  D0 06          bne _daw_check_carry
00ADC6  1  A9 02          lda #2
00ADC8  1  8D 73 07       sta command_type
00ADCB  1  60             rts
00ADCC  1               
00ADCC  1               _daw_check_carry:
00ADCC  1  AD 70 07       lda cmd_len
00ADCF  1  C9 05          cmp #5
00ADD1  1  90 61          bcc _daw_check_look_quit
00ADD3  1  AD 20 07       lda cmd_buf
00ADD6  1  C9 4C          cmp #'L'
00ADD8  1  D0 22          bne _daw_check_carry_word
00ADDA  1  AD 21 07       lda cmd_buf+1
00ADDD  1  C9 45          cmp #'E'
00ADDF  1  D0 1B          bne _daw_check_carry_word
00ADE1  1  AD 22 07       lda cmd_buf+2
00ADE4  1  C9 41          cmp #'A'
00ADE6  1  D0 14          bne _daw_check_carry_word
00ADE8  1  AD 23 07       lda cmd_buf+3
00ADEB  1  C9 56          cmp #'V'
00ADED  1  D0 0D          bne _daw_check_carry_word
00ADEF  1  AD 24 07       lda cmd_buf+4
00ADF2  1  C9 45          cmp #'E'
00ADF4  1  D0 06          bne _daw_check_carry_word
00ADF6  1  A9 02          lda #2
00ADF8  1  8D 73 07       sta command_type
00ADFB  1  60             rts
00ADFC  1               _daw_check_carry_word:
00ADFC  1  AD 20 07       lda cmd_buf
00ADFF  1  C9 43          cmp #'C'
00AE01  1  F0 03          beq :+
00AE03  1  4C 34 AE       jmp _daw_check_look_quit
00AE06  1               :
00AE06  1  AD 21 07       lda cmd_buf+1
00AE09  1  C9 41          cmp #'A'
00AE0B  1  F0 03          beq :+
00AE0D  1  4C 34 AE       jmp _daw_check_look_quit
00AE10  1               :
00AE10  1  AD 22 07       lda cmd_buf+2
00AE13  1  C9 52          cmp #'R'
00AE15  1  F0 03          beq :+
00AE17  1  4C 34 AE       jmp _daw_check_look_quit
00AE1A  1               :
00AE1A  1  AD 23 07       lda cmd_buf+3
00AE1D  1  C9 52          cmp #'R'
00AE1F  1  F0 03          beq :+
00AE21  1  4C 34 AE       jmp _daw_check_look_quit
00AE24  1               :
00AE24  1  AD 24 07       lda cmd_buf+4
00AE27  1  C9 59          cmp #'Y'
00AE29  1  F0 03          beq :+
00AE2B  1  4C 34 AE       jmp _daw_check_look_quit
00AE2E  1               :
00AE2E  1  A9 01          lda #1
00AE30  1  8D 73 07       sta command_type
00AE33  1  60             rts
00AE34  1               
00AE34  1               _daw_check_look_quit:
00AE34  1                 ; LOOK*
00AE34  1  AD 70 07       lda cmd_len
00AE37  1  C9 04          cmp #4
00AE39  1  90 22          bcc _daw_check_quit
00AE3B  1  AD 20 07       lda cmd_buf
00AE3E  1  C9 4C          cmp #'L'
00AE40  1  D0 1B          bne _daw_check_quit
00AE42  1  AD 21 07       lda cmd_buf+1
00AE45  1  C9 4F          cmp #'O'
00AE47  1  D0 14          bne _daw_check_quit
00AE49  1  AD 22 07       lda cmd_buf+2
00AE4C  1  C9 4F          cmp #'O'
00AE4E  1  D0 0D          bne _daw_check_quit
00AE50  1  AD 23 07       lda cmd_buf+3
00AE53  1  C9 4B          cmp #'K'
00AE55  1  D0 06          bne _daw_check_quit
00AE57  1  A9 04          lda #4
00AE59  1  8D 73 07       sta command_type
00AE5C  1  60             rts
00AE5D  1               
00AE5D  1               _daw_check_quit:
00AE5D  1                 ; QUIT*
00AE5D  1  AD 70 07       lda cmd_len
00AE60  1  C9 04          cmp #4
00AE62  1  90 22          bcc _daw_check_help
00AE64  1  AD 20 07       lda cmd_buf
00AE67  1  C9 51          cmp #'Q'
00AE69  1  D0 1B          bne _daw_check_help
00AE6B  1  AD 21 07       lda cmd_buf+1
00AE6E  1  C9 55          cmp #'U'
00AE70  1  D0 14          bne _daw_check_help
00AE72  1  AD 22 07       lda cmd_buf+2
00AE75  1  C9 49          cmp #'I'
00AE77  1  D0 0D          bne _daw_check_help
00AE79  1  AD 23 07       lda cmd_buf+3
00AE7C  1  C9 54          cmp #'T'
00AE7E  1  D0 06          bne _daw_check_help
00AE80  1  A9 05          lda #5
00AE82  1  8D 73 07       sta command_type
00AE85  1  60             rts
00AE86  1               
00AE86  1               _daw_check_help:
00AE86  1                 ; HELP*
00AE86  1  AD 70 07       lda cmd_len
00AE89  1  C9 04          cmp #4
00AE8B  1  B0 03          bcs :+
00AE8D  1  4C BE AE       jmp _daw_check_find
00AE90  1               :
00AE90  1  AD 20 07       lda cmd_buf
00AE93  1  C9 48          cmp #'H'
00AE95  1  F0 03          beq :+
00AE97  1  4C BE AE       jmp _daw_check_find
00AE9A  1               :
00AE9A  1  AD 21 07       lda cmd_buf+1
00AE9D  1  C9 45          cmp #'E'
00AE9F  1  F0 03          beq :+
00AEA1  1  4C BE AE       jmp _daw_check_find
00AEA4  1               :
00AEA4  1  AD 22 07       lda cmd_buf+2
00AEA7  1  C9 4C          cmp #'L'
00AEA9  1  F0 03          beq :+
00AEAB  1  4C BE AE       jmp _daw_check_find
00AEAE  1               :
00AEAE  1  AD 23 07       lda cmd_buf+3
00AEB1  1  C9 50          cmp #'P'
00AEB3  1  F0 03          beq :+
00AEB5  1  4C BE AE       jmp _daw_check_find
00AEB8  1               :
00AEB8  1  A9 0B          lda #11
00AEBA  1  8D 73 07       sta command_type
00AEBD  1  60             rts
00AEBE  1               
00AEBE  1               _daw_check_find:
00AEBE  1                 ; FIND*
00AEBE  1  AD 70 07       lda cmd_len
00AEC1  1  C9 04          cmp #4
00AEC3  1  90 22          bcc _daw_check_say
00AEC5  1  AD 20 07       lda cmd_buf
00AEC8  1  C9 46          cmp #'F'
00AECA  1  D0 1B          bne _daw_check_say
00AECC  1  AD 21 07       lda cmd_buf+1
00AECF  1  C9 49          cmp #'I'
00AED1  1  D0 14          bne _daw_check_say
00AED3  1  AD 22 07       lda cmd_buf+2
00AED6  1  C9 4E          cmp #'N'
00AED8  1  D0 0D          bne _daw_check_say
00AEDA  1  AD 23 07       lda cmd_buf+3
00AEDD  1  C9 44          cmp #'D'
00AEDF  1  D0 06          bne _daw_check_say
00AEE1  1  A9 13          lda #19
00AEE3  1  8D 73 07       sta command_type
00AEE6  1  60             rts
00AEE7  1               
00AEE7  1               _daw_check_say:
00AEE7  1                 ; SAY*
00AEE7  1  AD 70 07       lda cmd_len
00AEEA  1  C9 03          cmp #3
00AEEC  1  90 1B          bcc _daw_check_kill
00AEEE  1  AD 20 07       lda cmd_buf
00AEF1  1  C9 53          cmp #'S'
00AEF3  1  D0 14          bne _daw_check_kill
00AEF5  1  AD 21 07       lda cmd_buf+1
00AEF8  1  C9 41          cmp #'A'
00AEFA  1  D0 0D          bne _daw_check_kill
00AEFC  1  AD 22 07       lda cmd_buf+2
00AEFF  1  C9 59          cmp #'Y'
00AF01  1  D0 06          bne _daw_check_kill
00AF03  1  A9 14          lda #20
00AF05  1  8D 73 07       sta command_type
00AF08  1  60             rts
00AF09  1               
00AF09  1               _daw_check_kill:
00AF09  1                 ; KILL* / ATTACK*
00AF09  1  AD 70 07       lda cmd_len
00AF0C  1  C9 04          cmp #4
00AF0E  1  90 59          bcc _daw_check_throw
00AF10  1  AD 20 07       lda cmd_buf
00AF13  1  C9 4B          cmp #'K'
00AF15  1  D0 1B          bne _daw_check_attack
00AF17  1  AD 21 07       lda cmd_buf+1
00AF1A  1  C9 49          cmp #'I'
00AF1C  1  D0 14          bne _daw_check_attack
00AF1E  1  AD 22 07       lda cmd_buf+2
00AF21  1  C9 4C          cmp #'L'
00AF23  1  D0 0D          bne _daw_check_attack
00AF25  1  AD 23 07       lda cmd_buf+3
00AF28  1  C9 4C          cmp #'L'
00AF2A  1  D0 06          bne _daw_check_attack
00AF2C  1  A9 15          lda #21
00AF2E  1  8D 73 07       sta command_type
00AF31  1  60             rts
00AF32  1               _daw_check_attack:
00AF32  1  AD 70 07       lda cmd_len
00AF35  1  C9 06          cmp #6
00AF37  1  90 30          bcc _daw_check_throw
00AF39  1  AD 20 07       lda cmd_buf
00AF3C  1  C9 41          cmp #'A'
00AF3E  1  D0 29          bne _daw_check_throw
00AF40  1  AD 21 07       lda cmd_buf+1
00AF43  1  C9 54          cmp #'T'
00AF45  1  D0 22          bne _daw_check_throw
00AF47  1  AD 22 07       lda cmd_buf+2
00AF4A  1  C9 54          cmp #'T'
00AF4C  1  D0 1B          bne _daw_check_throw
00AF4E  1  AD 23 07       lda cmd_buf+3
00AF51  1  C9 41          cmp #'A'
00AF53  1  D0 14          bne _daw_check_throw
00AF55  1  AD 24 07       lda cmd_buf+4
00AF58  1  C9 43          cmp #'C'
00AF5A  1  D0 0D          bne _daw_check_throw
00AF5C  1  AD 25 07       lda cmd_buf+5
00AF5F  1  C9 4B          cmp #'K'
00AF61  1  D0 06          bne _daw_check_throw
00AF63  1  A9 15          lda #21
00AF65  1  8D 73 07       sta command_type
00AF68  1  60             rts
00AF69  1               
00AF69  1               _daw_check_throw:
00AF69  1                 ; THROW* / TOSS*
00AF69  1  AD 70 07       lda cmd_len
00AF6C  1  C9 05          cmp #5
00AF6E  1  90 29          bcc _daw_check_toss
00AF70  1  AD 20 07       lda cmd_buf
00AF73  1  C9 54          cmp #'T'
00AF75  1  D0 22          bne _daw_check_toss
00AF77  1  AD 21 07       lda cmd_buf+1
00AF7A  1  C9 48          cmp #'H'
00AF7C  1  D0 1B          bne _daw_check_toss
00AF7E  1  AD 22 07       lda cmd_buf+2
00AF81  1  C9 52          cmp #'R'
00AF83  1  D0 14          bne _daw_check_toss
00AF85  1  AD 23 07       lda cmd_buf+3
00AF88  1  C9 4F          cmp #'O'
00AF8A  1  D0 0D          bne _daw_check_toss
00AF8C  1  AD 24 07       lda cmd_buf+4
00AF8F  1  C9 57          cmp #'W'
00AF91  1  D0 06          bne _daw_check_toss
00AF93  1  A9 16          lda #22
00AF95  1  8D 73 07       sta command_type
00AF98  1  60             rts
00AF99  1               _daw_check_toss:
00AF99  1  AD 70 07       lda cmd_len
00AF9C  1  C9 04          cmp #4
00AF9E  1  90 22          bcc _daw_check_feed
00AFA0  1  AD 20 07       lda cmd_buf
00AFA3  1  C9 54          cmp #'T'
00AFA5  1  D0 1B          bne _daw_check_feed
00AFA7  1  AD 21 07       lda cmd_buf+1
00AFAA  1  C9 4F          cmp #'O'
00AFAC  1  D0 14          bne _daw_check_feed
00AFAE  1  AD 22 07       lda cmd_buf+2
00AFB1  1  C9 53          cmp #'S'
00AFB3  1  D0 0D          bne _daw_check_feed
00AFB5  1  AD 23 07       lda cmd_buf+3
00AFB8  1  C9 53          cmp #'S'
00AFBA  1  D0 06          bne _daw_check_feed
00AFBC  1  A9 16          lda #22
00AFBE  1  8D 73 07       sta command_type
00AFC1  1  60             rts
00AFC2  1               
00AFC2  1               _daw_check_feed:
00AFC2  1                 ; FEED*
00AFC2  1  AD 70 07       lda cmd_len
00AFC5  1  C9 04          cmp #4
00AFC7  1  90 22          bcc _daw_check_break
00AFC9  1  AD 20 07       lda cmd_buf
00AFCC  1  C9 46          cmp #'F'
00AFCE  1  D0 1B          bne _daw_check_break
00AFD0  1  AD 21 07       lda cmd_buf+1
00AFD3  1  C9 45          cmp #'E'
00AFD5  1  D0 14          bne _daw_check_break
00AFD7  1  AD 22 07       lda cmd_buf+2
00AFDA  1  C9 45          cmp #'E'
00AFDC  1  D0 0D          bne _daw_check_break
00AFDE  1  AD 23 07       lda cmd_buf+3
00AFE1  1  C9 44          cmp #'D'
00AFE3  1  D0 06          bne _daw_check_break
00AFE5  1  A9 17          lda #23
00AFE7  1  8D 73 07       sta command_type
00AFEA  1  60             rts
00AFEB  1               
00AFEB  1               _daw_check_break:
00AFEB  1                 ; BREAK*
00AFEB  1  AD 70 07       lda cmd_len
00AFEE  1  C9 04          cmp #4
00AFF0  1  90 22          bcc _daw_check_rub
00AFF2  1  AD 20 07       lda cmd_buf
00AFF5  1  C9 42          cmp #'B'
00AFF7  1  D0 1B          bne _daw_check_rub
00AFF9  1  AD 21 07       lda cmd_buf+1
00AFFC  1  C9 52          cmp #'R'
00AFFE  1  D0 14          bne _daw_check_rub
00B000  1  AD 22 07       lda cmd_buf+2
00B003  1  C9 45          cmp #'E'
00B005  1  D0 0D          bne _daw_check_rub
00B007  1  AD 23 07       lda cmd_buf+3
00B00A  1  C9 41          cmp #'A'
00B00C  1  D0 06          bne _daw_check_rub
00B00E  1  A9 18          lda #24
00B010  1  8D 73 07       sta command_type
00B013  1  60             rts
00B014  1               
00B014  1               _daw_check_rub:
00B014  1                 ; RUB*
00B014  1  AD 70 07       lda cmd_len
00B017  1  C9 03          cmp #3
00B019  1  90 1B          bcc _daw_check_wake
00B01B  1  AD 20 07       lda cmd_buf
00B01E  1  C9 52          cmp #'R'
00B020  1  D0 14          bne _daw_check_wake
00B022  1  AD 21 07       lda cmd_buf+1
00B025  1  C9 55          cmp #'U'
00B027  1  D0 0D          bne _daw_check_wake
00B029  1  AD 22 07       lda cmd_buf+2
00B02C  1  C9 42          cmp #'B'
00B02E  1  D0 06          bne _daw_check_wake
00B030  1  A9 19          lda #25
00B032  1  8D 73 07       sta command_type
00B035  1  60             rts
00B036  1               
00B036  1               _daw_check_wake:
00B036  1                 ; WAKE*
00B036  1  AD 70 07       lda cmd_len
00B039  1  C9 04          cmp #4
00B03B  1  90 22          bcc _daw_check_blast
00B03D  1  AD 20 07       lda cmd_buf
00B040  1  C9 57          cmp #'W'
00B042  1  D0 1B          bne _daw_check_blast
00B044  1  AD 21 07       lda cmd_buf+1
00B047  1  C9 41          cmp #'A'
00B049  1  D0 14          bne _daw_check_blast
00B04B  1  AD 22 07       lda cmd_buf+2
00B04E  1  C9 4B          cmp #'K'
00B050  1  D0 0D          bne _daw_check_blast
00B052  1  AD 23 07       lda cmd_buf+3
00B055  1  C9 45          cmp #'E'
00B057  1  D0 06          bne _daw_check_blast
00B059  1  A9 1A          lda #26
00B05B  1  8D 73 07       sta command_type
00B05E  1  60             rts
00B05F  1               
00B05F  1               _daw_check_blast:
00B05F  1                 ; BLAST* / BLOWUP* / DETONATE* / IGNITE*
00B05F  1  AD 70 07       lda cmd_len
00B062  1  C9 05          cmp #5
00B064  1  90 29          bcc _daw_check_blowup
00B066  1  AD 20 07       lda cmd_buf
00B069  1  C9 42          cmp #'B'
00B06B  1  D0 22          bne _daw_check_blowup
00B06D  1  AD 21 07       lda cmd_buf+1
00B070  1  C9 4C          cmp #'L'
00B072  1  D0 1B          bne _daw_check_blowup
00B074  1  AD 22 07       lda cmd_buf+2
00B077  1  C9 41          cmp #'A'
00B079  1  D0 14          bne _daw_check_blowup
00B07B  1  AD 23 07       lda cmd_buf+3
00B07E  1  C9 53          cmp #'S'
00B080  1  D0 0D          bne _daw_check_blowup
00B082  1  AD 24 07       lda cmd_buf+4
00B085  1  C9 54          cmp #'T'
00B087  1  D0 06          bne _daw_check_blowup
00B089  1  A9 1B          lda #27
00B08B  1  8D 73 07       sta command_type
00B08E  1  60             rts
00B08F  1               _daw_check_blowup:
00B08F  1  AD 70 07       lda cmd_len
00B092  1  C9 06          cmp #6
00B094  1  90 30          bcc _daw_check_detonate
00B096  1  AD 20 07       lda cmd_buf
00B099  1  C9 42          cmp #'B'
00B09B  1  D0 29          bne _daw_check_detonate
00B09D  1  AD 21 07       lda cmd_buf+1
00B0A0  1  C9 4C          cmp #'L'
00B0A2  1  D0 22          bne _daw_check_detonate
00B0A4  1  AD 22 07       lda cmd_buf+2
00B0A7  1  C9 4F          cmp #'O'
00B0A9  1  D0 1B          bne _daw_check_detonate
00B0AB  1  AD 23 07       lda cmd_buf+3
00B0AE  1  C9 57          cmp #'W'
00B0B0  1  D0 14          bne _daw_check_detonate
00B0B2  1  AD 24 07       lda cmd_buf+4
00B0B5  1  C9 55          cmp #'U'
00B0B7  1  D0 0D          bne _daw_check_detonate
00B0B9  1  AD 25 07       lda cmd_buf+5
00B0BC  1  C9 50          cmp #'P'
00B0BE  1  D0 06          bne _daw_check_detonate
00B0C0  1  A9 1B          lda #27
00B0C2  1  8D 73 07       sta command_type
00B0C5  1  60             rts
00B0C6  1               _daw_check_detonate:
00B0C6  1  AD 70 07       lda cmd_len
00B0C9  1  C9 08          cmp #8
00B0CB  1  90 3E          bcc _daw_check_ignite
00B0CD  1  AD 20 07       lda cmd_buf
00B0D0  1  C9 44          cmp #'D'
00B0D2  1  D0 37          bne _daw_check_ignite
00B0D4  1  AD 21 07       lda cmd_buf+1
00B0D7  1  C9 45          cmp #'E'
00B0D9  1  D0 30          bne _daw_check_ignite
00B0DB  1  AD 22 07       lda cmd_buf+2
00B0DE  1  C9 54          cmp #'T'
00B0E0  1  D0 29          bne _daw_check_ignite
00B0E2  1  AD 23 07       lda cmd_buf+3
00B0E5  1  C9 4F          cmp #'O'
00B0E7  1  D0 22          bne _daw_check_ignite
00B0E9  1  AD 24 07       lda cmd_buf+4
00B0EC  1  C9 4E          cmp #'N'
00B0EE  1  D0 1B          bne _daw_check_ignite
00B0F0  1  AD 25 07       lda cmd_buf+5
00B0F3  1  C9 41          cmp #'A'
00B0F5  1  D0 14          bne _daw_check_ignite
00B0F7  1  AD 26 07       lda cmd_buf+6
00B0FA  1  C9 54          cmp #'T'
00B0FC  1  D0 0D          bne _daw_check_ignite
00B0FE  1  AD 27 07       lda cmd_buf+7
00B101  1  C9 45          cmp #'E'
00B103  1  D0 06          bne _daw_check_ignite
00B105  1  A9 1B          lda #27
00B107  1  8D 73 07       sta command_type
00B10A  1  60             rts
00B10B  1               _daw_check_ignite:
00B10B  1  AD 70 07       lda cmd_len
00B10E  1  C9 06          cmp #6
00B110  1  90 30          bcc _daw_check_score
00B112  1  AD 20 07       lda cmd_buf
00B115  1  C9 49          cmp #'I'
00B117  1  D0 29          bne _daw_check_score
00B119  1  AD 21 07       lda cmd_buf+1
00B11C  1  C9 47          cmp #'G'
00B11E  1  D0 22          bne _daw_check_score
00B120  1  AD 22 07       lda cmd_buf+2
00B123  1  C9 4E          cmp #'N'
00B125  1  D0 1B          bne _daw_check_score
00B127  1  AD 23 07       lda cmd_buf+3
00B12A  1  C9 49          cmp #'I'
00B12C  1  D0 14          bne _daw_check_score
00B12E  1  AD 24 07       lda cmd_buf+4
00B131  1  C9 54          cmp #'T'
00B133  1  D0 0D          bne _daw_check_score
00B135  1  AD 25 07       lda cmd_buf+5
00B138  1  C9 45          cmp #'E'
00B13A  1  D0 06          bne _daw_check_score
00B13C  1  A9 1B          lda #27
00B13E  1  8D 73 07       sta command_type
00B141  1  60             rts
00B142  1               
00B142  1               _daw_check_score:
00B142  1                 ; SCORE*
00B142  1  AD 70 07       lda cmd_len
00B145  1  C9 05          cmp #5
00B147  1  90 29          bcc _daw_check_calm
00B149  1  AD 20 07       lda cmd_buf
00B14C  1  C9 53          cmp #'S'
00B14E  1  D0 22          bne _daw_check_calm
00B150  1  AD 21 07       lda cmd_buf+1
00B153  1  C9 43          cmp #'C'
00B155  1  D0 1B          bne _daw_check_calm
00B157  1  AD 22 07       lda cmd_buf+2
00B15A  1  C9 4F          cmp #'O'
00B15C  1  D0 14          bne _daw_check_calm
00B15E  1  AD 23 07       lda cmd_buf+3
00B161  1  C9 52          cmp #'R'
00B163  1  D0 0D          bne _daw_check_calm
00B165  1  AD 24 07       lda cmd_buf+4
00B168  1  C9 45          cmp #'E'
00B16A  1  D0 06          bne _daw_check_calm
00B16C  1  A9 1C          lda #28
00B16E  1  8D 73 07       sta command_type
00B171  1  60             rts
00B172  1               
00B172  1               _daw_check_calm:
00B172  1                 ; CALM* / PLACATE*
00B172  1  AD 70 07       lda cmd_len
00B175  1  C9 04          cmp #4
00B177  1  90 22          bcc _daw_check_placate
00B179  1  AD 20 07       lda cmd_buf
00B17C  1  C9 43          cmp #'C'
00B17E  1  D0 1B          bne _daw_check_placate
00B180  1  AD 21 07       lda cmd_buf+1
00B183  1  C9 41          cmp #'A'
00B185  1  D0 14          bne _daw_check_placate
00B187  1  AD 22 07       lda cmd_buf+2
00B18A  1  C9 4C          cmp #'L'
00B18C  1  D0 0D          bne _daw_check_placate
00B18E  1  AD 23 07       lda cmd_buf+3
00B191  1  C9 4D          cmp #'M'
00B193  1  D0 06          bne _daw_check_placate
00B195  1  A9 1D          lda #29
00B197  1  8D 73 07       sta command_type
00B19A  1  60             rts
00B19B  1               _daw_check_placate:
00B19B  1  AD 70 07       lda cmd_len
00B19E  1  C9 07          cmp #7
00B1A0  1  90 37          bcc _daw_check_walk2
00B1A2  1  AD 20 07       lda cmd_buf
00B1A5  1  C9 50          cmp #'P'
00B1A7  1  D0 30          bne _daw_check_walk2
00B1A9  1  AD 21 07       lda cmd_buf+1
00B1AC  1  C9 4C          cmp #'L'
00B1AE  1  D0 29          bne _daw_check_walk2
00B1B0  1  AD 22 07       lda cmd_buf+2
00B1B3  1  C9 41          cmp #'A'
00B1B5  1  D0 22          bne _daw_check_walk2
00B1B7  1  AD 23 07       lda cmd_buf+3
00B1BA  1  C9 43          cmp #'C'
00B1BC  1  D0 1B          bne _daw_check_walk2
00B1BE  1  AD 24 07       lda cmd_buf+4
00B1C1  1  C9 41          cmp #'A'
00B1C3  1  D0 14          bne _daw_check_walk2
00B1C5  1  AD 25 07       lda cmd_buf+5
00B1C8  1  C9 54          cmp #'T'
00B1CA  1  D0 0D          bne _daw_check_walk2
00B1CC  1  AD 26 07       lda cmd_buf+6
00B1CF  1  C9 45          cmp #'E'
00B1D1  1  D0 06          bne _daw_check_walk2
00B1D3  1  A9 1D          lda #29
00B1D5  1  8D 73 07       sta command_type
00B1D8  1  60             rts
00B1D9  1               
00B1D9  1               _daw_check_walk2:
00B1D9  1                 ; WALK*
00B1D9  1  AD 70 07       lda cmd_len
00B1DC  1  C9 04          cmp #4
00B1DE  1  90 22          bcc _daw_check_nothing
00B1E0  1  AD 20 07       lda cmd_buf
00B1E3  1  C9 57          cmp #'W'
00B1E5  1  D0 1B          bne _daw_check_nothing
00B1E7  1  AD 21 07       lda cmd_buf+1
00B1EA  1  C9 41          cmp #'A'
00B1EC  1  D0 14          bne _daw_check_nothing
00B1EE  1  AD 22 07       lda cmd_buf+2
00B1F1  1  C9 4C          cmp #'L'
00B1F3  1  D0 0D          bne _daw_check_nothing
00B1F5  1  AD 23 07       lda cmd_buf+3
00B1F8  1  C9 4B          cmp #'K'
00B1FA  1  D0 06          bne _daw_check_nothing
00B1FC  1  A9 1E          lda #30
00B1FE  1  8D 73 07       sta command_type
00B201  1  60             rts
00B202  1               
00B202  1               _daw_check_nothing:
00B202  1                 ; NOTHING*
00B202  1  AD 70 07       lda cmd_len
00B205  1  C9 07          cmp #7
00B207  1  90 37          bcc _daw_check_brief
00B209  1  AD 20 07       lda cmd_buf
00B20C  1  C9 4E          cmp #'N'
00B20E  1  D0 30          bne _daw_check_brief
00B210  1  AD 21 07       lda cmd_buf+1
00B213  1  C9 4F          cmp #'O'
00B215  1  D0 29          bne _daw_check_brief
00B217  1  AD 22 07       lda cmd_buf+2
00B21A  1  C9 54          cmp #'T'
00B21C  1  D0 22          bne _daw_check_brief
00B21E  1  AD 23 07       lda cmd_buf+3
00B221  1  C9 48          cmp #'H'
00B223  1  D0 1B          bne _daw_check_brief
00B225  1  AD 24 07       lda cmd_buf+4
00B228  1  C9 49          cmp #'I'
00B22A  1  D0 14          bne _daw_check_brief
00B22C  1  AD 25 07       lda cmd_buf+5
00B22F  1  C9 4E          cmp #'N'
00B231  1  D0 0D          bne _daw_check_brief
00B233  1  AD 26 07       lda cmd_buf+6
00B236  1  C9 47          cmp #'G'
00B238  1  D0 06          bne _daw_check_brief
00B23A  1  A9 1F          lda #31
00B23C  1  8D 73 07       sta command_type
00B23F  1  60             rts
00B240  1               
00B240  1               _daw_check_brief:
00B240  1                 ; BRIEF*
00B240  1  AD 70 07       lda cmd_len
00B243  1  C9 05          cmp #5
00B245  1  90 29          bcc _daw_check_suspend
00B247  1  AD 20 07       lda cmd_buf
00B24A  1  C9 42          cmp #'B'
00B24C  1  D0 22          bne _daw_check_suspend
00B24E  1  AD 21 07       lda cmd_buf+1
00B251  1  C9 52          cmp #'R'
00B253  1  D0 1B          bne _daw_check_suspend
00B255  1  AD 22 07       lda cmd_buf+2
00B258  1  C9 49          cmp #'I'
00B25A  1  D0 14          bne _daw_check_suspend
00B25C  1  AD 23 07       lda cmd_buf+3
00B25F  1  C9 45          cmp #'E'
00B261  1  D0 0D          bne _daw_check_suspend
00B263  1  AD 24 07       lda cmd_buf+4
00B266  1  C9 46          cmp #'F'
00B268  1  D0 06          bne _daw_check_suspend
00B26A  1  A9 20          lda #32
00B26C  1  8D 73 07       sta command_type
00B26F  1  60             rts
00B270  1               
00B270  1               _daw_check_suspend:
00B270  1                 ; SUSPEND* / PAUSE* / SAVE*
00B270  1  AD 70 07       lda cmd_len
00B273  1  C9 07          cmp #7
00B275  1  90 37          bcc _daw_check_pause
00B277  1  AD 20 07       lda cmd_buf
00B27A  1  C9 53          cmp #'S'
00B27C  1  D0 30          bne _daw_check_pause
00B27E  1  AD 21 07       lda cmd_buf+1
00B281  1  C9 55          cmp #'U'
00B283  1  D0 29          bne _daw_check_pause
00B285  1  AD 22 07       lda cmd_buf+2
00B288  1  C9 53          cmp #'S'
00B28A  1  D0 22          bne _daw_check_pause
00B28C  1  AD 23 07       lda cmd_buf+3
00B28F  1  C9 50          cmp #'P'
00B291  1  D0 1B          bne _daw_check_pause
00B293  1  AD 24 07       lda cmd_buf+4
00B296  1  C9 45          cmp #'E'
00B298  1  D0 14          bne _daw_check_pause
00B29A  1  AD 25 07       lda cmd_buf+5
00B29D  1  C9 4E          cmp #'N'
00B29F  1  D0 0D          bne _daw_check_pause
00B2A1  1  AD 26 07       lda cmd_buf+6
00B2A4  1  C9 44          cmp #'D'
00B2A6  1  D0 06          bne _daw_check_pause
00B2A8  1  A9 21          lda #33
00B2AA  1  8D 73 07       sta command_type
00B2AD  1  60             rts
00B2AE  1               _daw_check_pause:
00B2AE  1  AD 70 07       lda cmd_len
00B2B1  1  C9 05          cmp #5
00B2B3  1  90 29          bcc _daw_check_save
00B2B5  1  AD 20 07       lda cmd_buf
00B2B8  1  C9 50          cmp #'P'
00B2BA  1  D0 22          bne _daw_check_save
00B2BC  1  AD 21 07       lda cmd_buf+1
00B2BF  1  C9 41          cmp #'A'
00B2C1  1  D0 1B          bne _daw_check_save
00B2C3  1  AD 22 07       lda cmd_buf+2
00B2C6  1  C9 55          cmp #'U'
00B2C8  1  D0 14          bne _daw_check_save
00B2CA  1  AD 23 07       lda cmd_buf+3
00B2CD  1  C9 53          cmp #'S'
00B2CF  1  D0 0D          bne _daw_check_save
00B2D1  1  AD 24 07       lda cmd_buf+4
00B2D4  1  C9 45          cmp #'E'
00B2D6  1  D0 06          bne _daw_check_save
00B2D8  1  A9 21          lda #33
00B2DA  1  8D 73 07       sta command_type
00B2DD  1  60             rts
00B2DE  1               _daw_check_save:
00B2DE  1  AD 70 07       lda cmd_len
00B2E1  1  C9 04          cmp #4
00B2E3  1  90 22          bcc _daw_check_hours
00B2E5  1  AD 20 07       lda cmd_buf
00B2E8  1  C9 53          cmp #'S'
00B2EA  1  D0 1B          bne _daw_check_hours
00B2EC  1  AD 21 07       lda cmd_buf+1
00B2EF  1  C9 41          cmp #'A'
00B2F1  1  D0 14          bne _daw_check_hours
00B2F3  1  AD 22 07       lda cmd_buf+2
00B2F6  1  C9 56          cmp #'V'
00B2F8  1  D0 0D          bne _daw_check_hours
00B2FA  1  AD 23 07       lda cmd_buf+3
00B2FD  1  C9 45          cmp #'E'
00B2FF  1  D0 06          bne _daw_check_hours
00B301  1  A9 21          lda #33
00B303  1  8D 73 07       sta command_type
00B306  1  60             rts
00B307  1               
00B307  1               _daw_check_hours:
00B307  1                 ; HOURS*
00B307  1  AD 70 07       lda cmd_len
00B30A  1  C9 05          cmp #5
00B30C  1  90 29          bcc _daw_check_log
00B30E  1  AD 20 07       lda cmd_buf
00B311  1  C9 48          cmp #'H'
00B313  1  D0 22          bne _daw_check_log
00B315  1  AD 21 07       lda cmd_buf+1
00B318  1  C9 4F          cmp #'O'
00B31A  1  D0 1B          bne _daw_check_log
00B31C  1  AD 22 07       lda cmd_buf+2
00B31F  1  C9 55          cmp #'U'
00B321  1  D0 14          bne _daw_check_log
00B323  1  AD 23 07       lda cmd_buf+3
00B326  1  C9 52          cmp #'R'
00B328  1  D0 0D          bne _daw_check_log
00B32A  1  AD 24 07       lda cmd_buf+4
00B32D  1  C9 53          cmp #'S'
00B32F  1  D0 06          bne _daw_check_log
00B331  1  A9 22          lda #34
00B333  1  8D 73 07       sta command_type
00B336  1  60             rts
00B337  1               
00B337  1               _daw_check_log:
00B337  1                 ; LOG*
00B337  1  AD 70 07       lda cmd_len
00B33A  1  C9 03          cmp #3
00B33C  1  90 1B          bcc _daw_check_load
00B33E  1  AD 20 07       lda cmd_buf
00B341  1  C9 4C          cmp #'L'
00B343  1  D0 14          bne _daw_check_load
00B345  1  AD 21 07       lda cmd_buf+1
00B348  1  C9 4F          cmp #'O'
00B34A  1  D0 0D          bne _daw_check_load
00B34C  1  AD 22 07       lda cmd_buf+2
00B34F  1  C9 47          cmp #'G'
00B351  1  D0 06          bne _daw_check_load
00B353  1  A9 23          lda #35
00B355  1  8D 73 07       sta command_type
00B358  1  60             rts
00B359  1               
00B359  1               _daw_check_load:
00B359  1                 ; LOAD* / RESTORE*
00B359  1  AD 70 07       lda cmd_len
00B35C  1  C9 04          cmp #4
00B35E  1  90 22          bcc _daw_check_restore
00B360  1  AD 20 07       lda cmd_buf
00B363  1  C9 4C          cmp #'L'
00B365  1  D0 1B          bne _daw_check_restore
00B367  1  AD 21 07       lda cmd_buf+1
00B36A  1  C9 4F          cmp #'O'
00B36C  1  D0 14          bne _daw_check_restore
00B36E  1  AD 22 07       lda cmd_buf+2
00B371  1  C9 41          cmp #'A'
00B373  1  D0 0D          bne _daw_check_restore
00B375  1  AD 23 07       lda cmd_buf+3
00B378  1  C9 44          cmp #'D'
00B37A  1  D0 06          bne _daw_check_restore
00B37C  1  A9 24          lda #36
00B37E  1  8D 73 07       sta command_type
00B381  1  60             rts
00B382  1               _daw_check_restore:
00B382  1  AD 70 07       lda cmd_len
00B385  1  C9 07          cmp #7
00B387  1  90 37          bcc _daw_check_foo
00B389  1  AD 20 07       lda cmd_buf
00B38C  1  C9 52          cmp #'R'
00B38E  1  D0 30          bne _daw_check_foo
00B390  1  AD 21 07       lda cmd_buf+1
00B393  1  C9 45          cmp #'E'
00B395  1  D0 29          bne _daw_check_foo
00B397  1  AD 22 07       lda cmd_buf+2
00B39A  1  C9 53          cmp #'S'
00B39C  1  D0 22          bne _daw_check_foo
00B39E  1  AD 23 07       lda cmd_buf+3
00B3A1  1  C9 54          cmp #'T'
00B3A3  1  D0 1B          bne _daw_check_foo
00B3A5  1  AD 24 07       lda cmd_buf+4
00B3A8  1  C9 4F          cmp #'O'
00B3AA  1  D0 14          bne _daw_check_foo
00B3AC  1  AD 25 07       lda cmd_buf+5
00B3AF  1  C9 52          cmp #'R'
00B3B1  1  D0 0D          bne _daw_check_foo
00B3B3  1  AD 26 07       lda cmd_buf+6
00B3B6  1  C9 45          cmp #'E'
00B3B8  1  D0 06          bne _daw_check_foo
00B3BA  1  A9 24          lda #36
00B3BC  1  8D 73 07       sta command_type
00B3BF  1  60             rts
00B3C0  1               
00B3C0  1               _daw_check_foo:
00B3C0  1                 ; FOO/FEE/FIE/FOE/FUM*
00B3C0  1  AD 70 07       lda cmd_len
00B3C3  1  C9 03          cmp #3
00B3C5  1  90 57          bcc _daw_check_fum
00B3C7  1  AD 20 07       lda cmd_buf
00B3CA  1  C9 46          cmp #'F'
00B3CC  1  D0 50          bne _daw_check_fum
00B3CE  1  AD 21 07       lda cmd_buf+1
00B3D1  1  C9 4F          cmp #'O'
00B3D3  1  D0 0D          bne _daw_check_fee
00B3D5  1  AD 22 07       lda cmd_buf+2
00B3D8  1  C9 4F          cmp #'O'
00B3DA  1  D0 42          bne _daw_check_fum
00B3DC  1  A9 25          lda #37
00B3DE  1  8D 73 07       sta command_type
00B3E1  1  60             rts
00B3E2  1               _daw_check_fee:
00B3E2  1  AD 21 07       lda cmd_buf+1
00B3E5  1  C9 45          cmp #'E'
00B3E7  1  D0 0D          bne _daw_check_fie
00B3E9  1  AD 22 07       lda cmd_buf+2
00B3EC  1  C9 45          cmp #'E'
00B3EE  1  D0 06          bne _daw_check_fie
00B3F0  1  A9 25          lda #37
00B3F2  1  8D 73 07       sta command_type
00B3F5  1  60             rts
00B3F6  1               _daw_check_fie:
00B3F6  1  AD 21 07       lda cmd_buf+1
00B3F9  1  C9 49          cmp #'I'
00B3FB  1  D0 0D          bne _daw_check_foe
00B3FD  1  AD 22 07       lda cmd_buf+2
00B400  1  C9 45          cmp #'E'
00B402  1  D0 06          bne _daw_check_foe
00B404  1  A9 25          lda #37
00B406  1  8D 73 07       sta command_type
00B409  1  60             rts
00B40A  1               _daw_check_foe:
00B40A  1  AD 21 07       lda cmd_buf+1
00B40D  1  C9 4F          cmp #'O'
00B40F  1  D0 0D          bne _daw_check_fum
00B411  1  AD 22 07       lda cmd_buf+2
00B414  1  C9 45          cmp #'E'
00B416  1  D0 06          bne _daw_check_fum
00B418  1  A9 25          lda #37
00B41A  1  8D 73 07       sta command_type
00B41D  1  60             rts
00B41E  1               _daw_check_fum:
00B41E  1  AD 70 07       lda cmd_len
00B421  1  C9 03          cmp #3
00B423  1  90 1B          bcc _daw_no
00B425  1  AD 20 07       lda cmd_buf
00B428  1  C9 46          cmp #'F'
00B42A  1  D0 14          bne _daw_no
00B42C  1  AD 21 07       lda cmd_buf+1
00B42F  1  C9 55          cmp #'U'
00B431  1  D0 0D          bne _daw_no
00B433  1  AD 22 07       lda cmd_buf+2
00B436  1  C9 4D          cmp #'M'
00B438  1  D0 06          bne _daw_no
00B43A  1  A9 25          lda #37
00B43C  1  8D 73 07       sta command_type
00B43F  1  60             rts
00B440  1               
00B440  1               _daw_no:
00B440  1  60             rts
00B441  1               
00B441  1               verb_uses_noun_motion:
00B441  1                 ; Returns C set for GO/WALK/RUN/MOVE/HEAD and common travel aliases.
00B441  1  AD 70 07       lda cmd_len
00B444  1  C9 02          cmp #2
00B446  1  B0 03          bcs :+
00B448  1  4C 16 B6       jmp _vunm_no
00B44B  1               :
00B44B  1                 ; GO
00B44B  1  AD 70 07       lda cmd_len
00B44E  1  C9 02          cmp #2
00B450  1  D0 11          bne _vunm_chk_run
00B452  1  AD 20 07       lda cmd_buf
00B455  1  C9 47          cmp #'G'
00B457  1  D0 0A          bne _vunm_chk_run
00B459  1  AD 21 07       lda cmd_buf+1
00B45C  1  C9 4F          cmp #'O'
00B45E  1  D0 03          bne _vunm_chk_run
00B460  1  4C 14 B6       jmp _vunm_yes
00B463  1               
00B463  1               _vunm_chk_run:
00B463  1                 ; RUN
00B463  1  AD 70 07       lda cmd_len
00B466  1  C9 03          cmp #3
00B468  1  D0 18          bne _vunm_chk_walk
00B46A  1  AD 20 07       lda cmd_buf
00B46D  1  C9 52          cmp #'R'
00B46F  1  D0 11          bne _vunm_chk_walk
00B471  1  AD 21 07       lda cmd_buf+1
00B474  1  C9 55          cmp #'U'
00B476  1  D0 0A          bne _vunm_chk_walk
00B478  1  AD 22 07       lda cmd_buf+2
00B47B  1  C9 4E          cmp #'N'
00B47D  1  D0 03          bne _vunm_chk_walk
00B47F  1  4C 14 B6       jmp _vunm_yes
00B482  1               
00B482  1               _vunm_chk_walk:
00B482  1                 ; WALK
00B482  1  AD 70 07       lda cmd_len
00B485  1  C9 04          cmp #4
00B487  1  D0 1F          bne _vunm_chk_move
00B489  1  AD 20 07       lda cmd_buf
00B48C  1  C9 57          cmp #'W'
00B48E  1  D0 18          bne _vunm_chk_move
00B490  1  AD 21 07       lda cmd_buf+1
00B493  1  C9 41          cmp #'A'
00B495  1  D0 11          bne _vunm_chk_move
00B497  1  AD 22 07       lda cmd_buf+2
00B49A  1  C9 4C          cmp #'L'
00B49C  1  D0 0A          bne _vunm_chk_move
00B49E  1  AD 23 07       lda cmd_buf+3
00B4A1  1  C9 4B          cmp #'K'
00B4A3  1  D0 03          bne _vunm_chk_move
00B4A5  1  4C 14 B6       jmp _vunm_yes
00B4A8  1               
00B4A8  1               _vunm_chk_move:
00B4A8  1                 ; MOVE
00B4A8  1  AD 70 07       lda cmd_len
00B4AB  1  C9 04          cmp #4
00B4AD  1  D0 1F          bne _vunm_chk_head
00B4AF  1  AD 20 07       lda cmd_buf
00B4B2  1  C9 4D          cmp #'M'
00B4B4  1  D0 18          bne _vunm_chk_head
00B4B6  1  AD 21 07       lda cmd_buf+1
00B4B9  1  C9 4F          cmp #'O'
00B4BB  1  D0 11          bne _vunm_chk_head
00B4BD  1  AD 22 07       lda cmd_buf+2
00B4C0  1  C9 56          cmp #'V'
00B4C2  1  D0 0A          bne _vunm_chk_head
00B4C4  1  AD 23 07       lda cmd_buf+3
00B4C7  1  C9 45          cmp #'E'
00B4C9  1  D0 03          bne _vunm_chk_head
00B4CB  1  4C 14 B6       jmp _vunm_yes
00B4CE  1               
00B4CE  1               _vunm_chk_head:
00B4CE  1                 ; HEAD
00B4CE  1  AD 70 07       lda cmd_len
00B4D1  1  C9 04          cmp #4
00B4D3  1  D0 1F          bne _vunm_chk_step
00B4D5  1  AD 20 07       lda cmd_buf
00B4D8  1  C9 48          cmp #'H'
00B4DA  1  D0 18          bne _vunm_chk_step
00B4DC  1  AD 21 07       lda cmd_buf+1
00B4DF  1  C9 45          cmp #'E'
00B4E1  1  D0 11          bne _vunm_chk_step
00B4E3  1  AD 22 07       lda cmd_buf+2
00B4E6  1  C9 41          cmp #'A'
00B4E8  1  D0 0A          bne _vunm_chk_step
00B4EA  1  AD 23 07       lda cmd_buf+3
00B4ED  1  C9 44          cmp #'D'
00B4EF  1  D0 03          bne _vunm_chk_step
00B4F1  1  4C 14 B6       jmp _vunm_yes
00B4F4  1               
00B4F4  1               _vunm_chk_step:
00B4F4  1                 ; STEP
00B4F4  1  AD 70 07       lda cmd_len
00B4F7  1  C9 04          cmp #4
00B4F9  1  D0 1F          bne _vunm_chk_turn
00B4FB  1  AD 20 07       lda cmd_buf
00B4FE  1  C9 53          cmp #'S'
00B500  1  D0 18          bne _vunm_chk_turn
00B502  1  AD 21 07       lda cmd_buf+1
00B505  1  C9 54          cmp #'T'
00B507  1  D0 11          bne _vunm_chk_turn
00B509  1  AD 22 07       lda cmd_buf+2
00B50C  1  C9 45          cmp #'E'
00B50E  1  D0 0A          bne _vunm_chk_turn
00B510  1  AD 23 07       lda cmd_buf+3
00B513  1  C9 50          cmp #'P'
00B515  1  D0 03          bne _vunm_chk_turn
00B517  1  4C 14 B6       jmp _vunm_yes
00B51A  1               
00B51A  1               _vunm_chk_turn:
00B51A  1                 ; TURN
00B51A  1  AD 70 07       lda cmd_len
00B51D  1  C9 04          cmp #4
00B51F  1  D0 1F          bne _vunm_chk_climb
00B521  1  AD 20 07       lda cmd_buf
00B524  1  C9 54          cmp #'T'
00B526  1  D0 18          bne _vunm_chk_climb
00B528  1  AD 21 07       lda cmd_buf+1
00B52B  1  C9 55          cmp #'U'
00B52D  1  D0 11          bne _vunm_chk_climb
00B52F  1  AD 22 07       lda cmd_buf+2
00B532  1  C9 52          cmp #'R'
00B534  1  D0 0A          bne _vunm_chk_climb
00B536  1  AD 23 07       lda cmd_buf+3
00B539  1  C9 4E          cmp #'N'
00B53B  1  D0 03          bne _vunm_chk_climb
00B53D  1  4C 14 B6       jmp _vunm_yes
00B540  1               
00B540  1               _vunm_chk_climb:
00B540  1                 ; CLIMB
00B540  1  AD 70 07       lda cmd_len
00B543  1  C9 05          cmp #5
00B545  1  D0 26          bne _vunm_chk_travel
00B547  1  AD 20 07       lda cmd_buf
00B54A  1  C9 43          cmp #'C'
00B54C  1  D0 1F          bne _vunm_chk_travel
00B54E  1  AD 21 07       lda cmd_buf+1
00B551  1  C9 4C          cmp #'L'
00B553  1  D0 18          bne _vunm_chk_travel
00B555  1  AD 22 07       lda cmd_buf+2
00B558  1  C9 49          cmp #'I'
00B55A  1  D0 11          bne _vunm_chk_travel
00B55C  1  AD 23 07       lda cmd_buf+3
00B55F  1  C9 4D          cmp #'M'
00B561  1  D0 0A          bne _vunm_chk_travel
00B563  1  AD 24 07       lda cmd_buf+4
00B566  1  C9 42          cmp #'B'
00B568  1  D0 03          bne _vunm_chk_travel
00B56A  1  4C 14 B6       jmp _vunm_yes
00B56D  1               
00B56D  1               _vunm_chk_travel:
00B56D  1                 ; TRAVEL
00B56D  1  AD 70 07       lda cmd_len
00B570  1  C9 06          cmp #6
00B572  1  D0 2D          bne _vunm_chk_advance
00B574  1  AD 20 07       lda cmd_buf
00B577  1  C9 54          cmp #'T'
00B579  1  D0 26          bne _vunm_chk_advance
00B57B  1  AD 21 07       lda cmd_buf+1
00B57E  1  C9 52          cmp #'R'
00B580  1  D0 1F          bne _vunm_chk_advance
00B582  1  AD 22 07       lda cmd_buf+2
00B585  1  C9 41          cmp #'A'
00B587  1  D0 18          bne _vunm_chk_advance
00B589  1  AD 23 07       lda cmd_buf+3
00B58C  1  C9 56          cmp #'V'
00B58E  1  D0 11          bne _vunm_chk_advance
00B590  1  AD 24 07       lda cmd_buf+4
00B593  1  C9 45          cmp #'E'
00B595  1  D0 0A          bne _vunm_chk_advance
00B597  1  AD 25 07       lda cmd_buf+5
00B59A  1  C9 4C          cmp #'L'
00B59C  1  D0 03          bne _vunm_chk_advance
00B59E  1  4C 14 B6       jmp _vunm_yes
00B5A1  1               
00B5A1  1               _vunm_chk_advance:
00B5A1  1                 ; ADVANCE
00B5A1  1  AD 70 07       lda cmd_len
00B5A4  1  C9 07          cmp #7
00B5A6  1  D0 34          bne _vunm_chk_proceed
00B5A8  1  AD 20 07       lda cmd_buf
00B5AB  1  C9 41          cmp #'A'
00B5AD  1  D0 2D          bne _vunm_chk_proceed
00B5AF  1  AD 21 07       lda cmd_buf+1
00B5B2  1  C9 44          cmp #'D'
00B5B4  1  D0 26          bne _vunm_chk_proceed
00B5B6  1  AD 22 07       lda cmd_buf+2
00B5B9  1  C9 56          cmp #'V'
00B5BB  1  D0 1F          bne _vunm_chk_proceed
00B5BD  1  AD 23 07       lda cmd_buf+3
00B5C0  1  C9 41          cmp #'A'
00B5C2  1  D0 18          bne _vunm_chk_proceed
00B5C4  1  AD 24 07       lda cmd_buf+4
00B5C7  1  C9 4E          cmp #'N'
00B5C9  1  D0 11          bne _vunm_chk_proceed
00B5CB  1  AD 25 07       lda cmd_buf+5
00B5CE  1  C9 43          cmp #'C'
00B5D0  1  D0 0A          bne _vunm_chk_proceed
00B5D2  1  AD 26 07       lda cmd_buf+6
00B5D5  1  C9 45          cmp #'E'
00B5D7  1  D0 03          bne _vunm_chk_proceed
00B5D9  1  4C 14 B6       jmp _vunm_yes
00B5DC  1               
00B5DC  1               _vunm_chk_proceed:
00B5DC  1                 ; PROCEED
00B5DC  1  AD 70 07       lda cmd_len
00B5DF  1  C9 07          cmp #7
00B5E1  1  D0 33          bne _vunm_no
00B5E3  1  AD 20 07       lda cmd_buf
00B5E6  1  C9 50          cmp #'P'
00B5E8  1  D0 2C          bne _vunm_no
00B5EA  1  AD 21 07       lda cmd_buf+1
00B5ED  1  C9 52          cmp #'R'
00B5EF  1  D0 25          bne _vunm_no
00B5F1  1  AD 22 07       lda cmd_buf+2
00B5F4  1  C9 4F          cmp #'O'
00B5F6  1  D0 1E          bne _vunm_no
00B5F8  1  AD 23 07       lda cmd_buf+3
00B5FB  1  C9 43          cmp #'C'
00B5FD  1  D0 17          bne _vunm_no
00B5FF  1  AD 24 07       lda cmd_buf+4
00B602  1  C9 45          cmp #'E'
00B604  1  D0 10          bne _vunm_no
00B606  1  AD 25 07       lda cmd_buf+5
00B609  1  C9 45          cmp #'E'
00B60B  1  D0 09          bne _vunm_no
00B60D  1  AD 26 07       lda cmd_buf+6
00B610  1  C9 44          cmp #'D'
00B612  1  D0 02          bne _vunm_no
00B614  1               _vunm_yes:
00B614  1  38             sec
00B615  1  60             rts
00B616  1               _vunm_no:
00B616  1  18             clc
00B617  1  60             rts
00B618  1               
00B618  1               decode_object_word:
00B618  1                 ; Converts noun token to object id in command_object.
00B618  1  A9 00          lda #0
00B61A  1  8D 74 07       sta command_object
00B61D  1  AD 72 07       lda noun_len
00B620  1  C9 03          cmp #3
00B622  1  D0 6D          bne _dow_len4
00B624  1               
00B624  1                 ; AXE
00B624  1  AD 30 07       lda noun_buf
00B627  1  C9 41          cmp #'A'
00B629  1  D0 14          bne _dow_rod3
00B62B  1  AD 31 07       lda noun_buf+1
00B62E  1  C9 58          cmp #'X'
00B630  1  D0 0D          bne _dow_rod3
00B632  1  AD 32 07       lda noun_buf+2
00B635  1  C9 45          cmp #'E'
00B637  1  D0 06          bne _dow_rod3
00B639  1  A9 1C          lda #28
00B63B  1  8D 74 07       sta command_object
00B63E  1  60             rts
00B63F  1               
00B63F  1               _dow_rod3:
00B63F  1                 ; ROD
00B63F  1  AD 30 07       lda noun_buf
00B642  1  C9 52          cmp #'R'
00B644  1  D0 14          bne _dow_key3
00B646  1  AD 31 07       lda noun_buf+1
00B649  1  C9 4F          cmp #'O'
00B64B  1  D0 0D          bne _dow_key3
00B64D  1  AD 32 07       lda noun_buf+2
00B650  1  C9 44          cmp #'D'
00B652  1  D0 06          bne _dow_key3
00B654  1  A9 05          lda #5
00B656  1  8D 74 07       sta command_object
00B659  1  60             rts
00B65A  1               
00B65A  1               _dow_key3:
00B65A  1                 ; KEY
00B65A  1  AD 30 07       lda noun_buf
00B65D  1  C9 4B          cmp #'K'
00B65F  1  D0 14          bne _dow_oil3
00B661  1  AD 31 07       lda noun_buf+1
00B664  1  C9 45          cmp #'E'
00B666  1  D0 0D          bne _dow_oil3
00B668  1  AD 32 07       lda noun_buf+2
00B66B  1  C9 59          cmp #'Y'
00B66D  1  D0 06          bne _dow_oil3
00B66F  1  A9 01          lda #1
00B671  1  8D 74 07       sta command_object
00B674  1  60             rts
00B675  1               _dow_oil3:
00B675  1                 ; OIL
00B675  1  AD 30 07       lda noun_buf
00B678  1  C9 4F          cmp #'O'
00B67A  1  D0 14          bne _dow_no3
00B67C  1  AD 31 07       lda noun_buf+1
00B67F  1  C9 49          cmp #'I'
00B681  1  D0 0D          bne _dow_no3
00B683  1  AD 32 07       lda noun_buf+2
00B686  1  C9 4C          cmp #'L'
00B688  1  D0 06          bne _dow_no3
00B68A  1  A9 16          lda #22
00B68C  1  8D 74 07       sta command_object
00B68F  1  60             rts
00B690  1               _dow_no3:
00B690  1  60             rts
00B691  1               
00B691  1               _dow_len4:
00B691  1  C9 04          cmp #4
00B693  1  F0 03          beq _dow_do4
00B695  1  4C 4C B8       jmp _dow_len5
00B698  1               _dow_do4:
00B698  1               
00B698  1                 ; GATE (alias for GRATE)
00B698  1  AD 30 07       lda noun_buf
00B69B  1  C9 47          cmp #'G'
00B69D  1  D0 1B          bne _dow_lamp4
00B69F  1  AD 31 07       lda noun_buf+1
00B6A2  1  C9 41          cmp #'A'
00B6A4  1  D0 14          bne _dow_lamp4
00B6A6  1  AD 32 07       lda noun_buf+2
00B6A9  1  C9 54          cmp #'T'
00B6AB  1  D0 0D          bne _dow_lamp4
00B6AD  1  AD 33 07       lda noun_buf+3
00B6B0  1  C9 45          cmp #'E'
00B6B2  1  D0 06          bne _dow_lamp4
00B6B4  1  A9 03          lda #3
00B6B6  1  8D 74 07       sta command_object
00B6B9  1  60             rts
00B6BA  1               
00B6BA  1               _dow_lamp4:
00B6BA  1               
00B6BA  1                 ; LAMP
00B6BA  1  AD 30 07       lda noun_buf
00B6BD  1  C9 4C          cmp #'L'
00B6BF  1  D0 1B          bne _dow_cage4
00B6C1  1  AD 31 07       lda noun_buf+1
00B6C4  1  C9 41          cmp #'A'
00B6C6  1  D0 14          bne _dow_cage4
00B6C8  1  AD 32 07       lda noun_buf+2
00B6CB  1  C9 4D          cmp #'M'
00B6CD  1  D0 0D          bne _dow_cage4
00B6CF  1  AD 33 07       lda noun_buf+3
00B6D2  1  C9 50          cmp #'P'
00B6D4  1  D0 06          bne _dow_cage4
00B6D6  1  A9 02          lda #2
00B6D8  1  8D 74 07       sta command_object
00B6DB  1  60             rts
00B6DC  1               
00B6DC  1               _dow_cage4:
00B6DC  1                 ; CAGE
00B6DC  1  AD 30 07       lda noun_buf
00B6DF  1  C9 43          cmp #'C'
00B6E1  1  D0 1B          bne _dow_bird4
00B6E3  1  AD 31 07       lda noun_buf+1
00B6E6  1  C9 41          cmp #'A'
00B6E8  1  D0 14          bne _dow_bird4
00B6EA  1  AD 32 07       lda noun_buf+2
00B6ED  1  C9 47          cmp #'G'
00B6EF  1  D0 0D          bne _dow_bird4
00B6F1  1  AD 33 07       lda noun_buf+3
00B6F4  1  C9 45          cmp #'E'
00B6F6  1  D0 06          bne _dow_bird4
00B6F8  1  A9 04          lda #4
00B6FA  1  8D 74 07       sta command_object
00B6FD  1  60             rts
00B6FE  1               
00B6FE  1               _dow_bird4:
00B6FE  1                 ; BIRD
00B6FE  1  AD 30 07       lda noun_buf
00B701  1  C9 42          cmp #'B'
00B703  1  D0 1B          bne _dow_vase4
00B705  1  AD 31 07       lda noun_buf+1
00B708  1  C9 49          cmp #'I'
00B70A  1  D0 14          bne _dow_vase4
00B70C  1  AD 32 07       lda noun_buf+2
00B70F  1  C9 52          cmp #'R'
00B711  1  D0 0D          bne _dow_vase4
00B713  1  AD 33 07       lda noun_buf+3
00B716  1  C9 44          cmp #'D'
00B718  1  D0 06          bne _dow_vase4
00B71A  1  A9 08          lda #8
00B71C  1  8D 74 07       sta command_object
00B71F  1  60             rts
00B720  1               
00B720  1               _dow_vase4:
00B720  1                 ; VASE
00B720  1  AD 30 07       lda noun_buf
00B723  1  C9 56          cmp #'V'
00B725  1  D0 1B          bne _dow_coin4
00B727  1  AD 31 07       lda noun_buf+1
00B72A  1  C9 41          cmp #'A'
00B72C  1  D0 14          bne _dow_coin4
00B72E  1  AD 32 07       lda noun_buf+2
00B731  1  C9 53          cmp #'S'
00B733  1  D0 0D          bne _dow_coin4
00B735  1  AD 33 07       lda noun_buf+3
00B738  1  C9 45          cmp #'E'
00B73A  1  D0 06          bne _dow_coin4
00B73C  1  A9 3A          lda #58
00B73E  1  8D 74 07       sta command_object
00B741  1  60             rts
00B742  1               
00B742  1               _dow_coin4:
00B742  1                   ; COIN
00B742  1  AD 30 07         lda noun_buf
00B745  1  C9 43            cmp #'C'
00B747  1  D0 1B            bne _dow_keys4
00B749  1  AD 31 07         lda noun_buf+1
00B74C  1  C9 4F            cmp #'O'
00B74E  1  D0 14            bne _dow_keys4
00B750  1  AD 32 07         lda noun_buf+2
00B753  1  C9 49            cmp #'I'
00B755  1  D0 0D            bne _dow_keys4
00B757  1  AD 33 07         lda noun_buf+3
00B75A  1  C9 4E            cmp #'N'
00B75C  1  D0 06            bne _dow_keys4
00B75E  1  A9 36            lda #54
00B760  1  8D 74 07         sta command_object
00B763  1  60               rts
00B764  1               
00B764  1               _dow_keys4:
00B764  1                   ; KEYS
00B764  1  AD 30 07         lda noun_buf
00B767  1  C9 4B            cmp #'K'
00B769  1  D0 1B            bne _dow_food4
00B76B  1  AD 31 07         lda noun_buf+1
00B76E  1  C9 45            cmp #'E'
00B770  1  D0 14            bne _dow_food4
00B772  1  AD 32 07         lda noun_buf+2
00B775  1  C9 59            cmp #'Y'
00B777  1  D0 0D            bne _dow_food4
00B779  1  AD 33 07         lda noun_buf+3
00B77C  1  C9 53            cmp #'S'
00B77E  1  D0 06            bne _dow_food4
00B780  1  A9 01            lda #1
00B782  1  8D 74 07         sta command_object
00B785  1  60               rts
00B786  1               
00B786  1               _dow_food4:
00B786  1                   ; FOOD
00B786  1  AD 30 07         lda noun_buf
00B789  1  C9 46            cmp #'F'
00B78B  1  D0 1B            bne _dow_door4
00B78D  1  AD 31 07         lda noun_buf+1
00B790  1  C9 4F            cmp #'O'
00B792  1  D0 14            bne _dow_door4
00B794  1  AD 32 07         lda noun_buf+2
00B797  1  C9 4F            cmp #'O'
00B799  1  D0 0D            bne _dow_door4
00B79B  1  AD 33 07         lda noun_buf+3
00B79E  1  C9 44            cmp #'D'
00B7A0  1  D0 06            bne _dow_door4
00B7A2  1  A9 13            lda #19
00B7A4  1  8D 74 07         sta command_object
00B7A7  1  60               rts
00B7A8  1               _dow_door4:
00B7A8  1                   ; DOOR
00B7A8  1  AD 30 07         lda noun_buf
00B7AB  1  C9 44            cmp #'D'
00B7AD  1  D0 1B            bne _dow_clam4
00B7AF  1  AD 31 07         lda noun_buf+1
00B7B2  1  C9 4F            cmp #'O'
00B7B4  1  D0 14            bne _dow_clam4
00B7B6  1  AD 32 07         lda noun_buf+2
00B7B9  1  C9 4F            cmp #'O'
00B7BB  1  D0 0D            bne _dow_clam4
00B7BD  1  AD 33 07         lda noun_buf+3
00B7C0  1  C9 52            cmp #'R'
00B7C2  1  D0 06            bne _dow_clam4
00B7C4  1  A9 09            lda #9
00B7C6  1  8D 74 07         sta command_object
00B7C9  1  60               rts
00B7CA  1               _dow_clam4:
00B7CA  1                   ; CLAM
00B7CA  1  AD 30 07         lda noun_buf
00B7CD  1  C9 43            cmp #'C'
00B7CF  1  D0 1B            bne _dow_bear4
00B7D1  1  AD 31 07         lda noun_buf+1
00B7D4  1  C9 4C            cmp #'L'
00B7D6  1  D0 14            bne _dow_bear4
00B7D8  1  AD 32 07         lda noun_buf+2
00B7DB  1  C9 41            cmp #'A'
00B7DD  1  D0 0D            bne _dow_bear4
00B7DF  1  AD 33 07         lda noun_buf+3
00B7E2  1  C9 4D            cmp #'M'
00B7E4  1  D0 06            bne _dow_bear4
00B7E6  1  A9 0E            lda #14
00B7E8  1  8D 74 07         sta command_object
00B7EB  1  60               rts
00B7EC  1               _dow_bear4:
00B7EC  1                   ; BEAR
00B7EC  1  AD 30 07         lda noun_buf
00B7EF  1  C9 42            cmp #'B'
00B7F1  1  D0 1B            bne _dow_rug4
00B7F3  1  AD 31 07         lda noun_buf+1
00B7F6  1  C9 45            cmp #'E'
00B7F8  1  D0 14            bne _dow_rug4
00B7FA  1  AD 32 07         lda noun_buf+2
00B7FD  1  C9 41            cmp #'A'
00B7FF  1  D0 0D            bne _dow_rug4
00B801  1  AD 33 07         lda noun_buf+3
00B804  1  C9 52            cmp #'R'
00B806  1  D0 06            bne _dow_rug4
00B808  1  A9 23            lda #35
00B80A  1  8D 74 07         sta command_object
00B80D  1  60               rts
00B80E  1               _dow_rug4:
00B80E  1                   ; RUG
00B80E  1  AD 30 07         lda noun_buf
00B811  1  C9 52            cmp #'R'
00B813  1  D0 14            bne _dow_eggs4
00B815  1  AD 31 07         lda noun_buf+1
00B818  1  C9 55            cmp #'U'
00B81A  1  D0 0D            bne _dow_eggs4
00B81C  1  AD 32 07         lda noun_buf+2
00B81F  1  C9 47            cmp #'G'
00B821  1  D0 06            bne _dow_eggs4
00B823  1  A9 3E            lda #62
00B825  1  8D 74 07         sta command_object
00B828  1  60               rts
00B829  1               _dow_eggs4:
00B829  1                   ; EGGS
00B829  1  AD 30 07         lda noun_buf
00B82C  1  C9 45            cmp #'E'
00B82E  1  D0 1B            bne _dow_no4
00B830  1  AD 31 07         lda noun_buf+1
00B833  1  C9 47            cmp #'G'
00B835  1  D0 14            bne _dow_no4
00B837  1  AD 32 07         lda noun_buf+2
00B83A  1  C9 47            cmp #'G'
00B83C  1  D0 0D            bne _dow_no4
00B83E  1  AD 33 07         lda noun_buf+3
00B841  1  C9 53            cmp #'S'
00B843  1  D0 06            bne _dow_no4
00B845  1  A9 38            lda #56
00B847  1  8D 74 07         sta command_object
00B84A  1  60               rts
00B84B  1               _dow_no4:
00B84B  1  60               rts
00B84C  1               
00B84C  1               _dow_len5:
00B84C  1  C9 05            cmp #5
00B84E  1  F0 03            beq :+
00B850  1  4C 40 BA         jmp _dow_len6
00B853  1               :
00B853  1               
00B853  1                   ; GRATE
00B853  1  AD 30 07         lda noun_buf
00B856  1  C9 47            cmp #'G'
00B858  1  D0 22            bne _dow_coin5
00B85A  1  AD 31 07         lda noun_buf+1
00B85D  1  C9 52            cmp #'R'
00B85F  1  D0 1B            bne _dow_coin5
00B861  1  AD 32 07         lda noun_buf+2
00B864  1  C9 41            cmp #'A'
00B866  1  D0 14            bne _dow_coin5
00B868  1  AD 33 07         lda noun_buf+3
00B86B  1  C9 54            cmp #'T'
00B86D  1  D0 0D            bne _dow_coin5
00B86F  1  AD 34 07         lda noun_buf+4
00B872  1  C9 45            cmp #'E'
00B874  1  D0 06            bne _dow_coin5
00B876  1  A9 03            lda #3
00B878  1  8D 74 07         sta command_object
00B87B  1  60               rts
00B87C  1               
00B87C  1               _dow_coin5:
00B87C  1                   ; COINS
00B87C  1  AD 30 07         lda noun_buf
00B87F  1  C9 43            cmp #'C'
00B881  1  D0 22            bne _dow_food5
00B883  1  AD 31 07         lda noun_buf+1
00B886  1  C9 4F            cmp #'O'
00B888  1  D0 1B            bne _dow_food5
00B88A  1  AD 32 07         lda noun_buf+2
00B88D  1  C9 49            cmp #'I'
00B88F  1  D0 14            bne _dow_food5
00B891  1  AD 33 07         lda noun_buf+3
00B894  1  C9 4E            cmp #'N'
00B896  1  D0 0D            bne _dow_food5
00B898  1  AD 34 07         lda noun_buf+4
00B89B  1  C9 53            cmp #'S'
00B89D  1  D0 06            bne _dow_food5
00B89F  1  A9 36            lda #54
00B8A1  1  8D 74 07         sta command_object
00B8A4  1  60               rts
00B8A5  1               
00B8A5  1               _dow_food5:
00B8A5  1                   ; WATER
00B8A5  1  AD 30 07         lda noun_buf
00B8A8  1  C9 57            cmp #'W'
00B8AA  1  D0 22            bne _dow_keys5
00B8AC  1  AD 31 07         lda noun_buf+1
00B8AF  1  C9 41            cmp #'A'
00B8B1  1  D0 1B            bne _dow_keys5
00B8B3  1  AD 32 07         lda noun_buf+2
00B8B6  1  C9 54            cmp #'T'
00B8B8  1  D0 14            bne _dow_keys5
00B8BA  1  AD 33 07         lda noun_buf+3
00B8BD  1  C9 45            cmp #'E'
00B8BF  1  D0 0D            bne _dow_keys5
00B8C1  1  AD 34 07         lda noun_buf+4
00B8C4  1  C9 52            cmp #'R'
00B8C6  1  D0 06            bne _dow_keys5
00B8C8  1  A9 15            lda #21
00B8CA  1  8D 74 07         sta command_object
00B8CD  1  60               rts
00B8CE  1               
00B8CE  1               _dow_keys5:
00B8CE  1                   ; KEYS.
00B8CE  1                   ; Accept 5-letter misspelling "KEYES" as a fallback.
00B8CE  1  AD 30 07         lda noun_buf
00B8D1  1  C9 4B            cmp #'K'
00B8D3  1  D0 22            bne _dow_snake5
00B8D5  1  AD 31 07         lda noun_buf+1
00B8D8  1  C9 45            cmp #'E'
00B8DA  1  D0 1B            bne _dow_snake5
00B8DC  1  AD 32 07         lda noun_buf+2
00B8DF  1  C9 59            cmp #'Y'
00B8E1  1  D0 14            bne _dow_snake5
00B8E3  1  AD 33 07         lda noun_buf+3
00B8E6  1  C9 45            cmp #'E'
00B8E8  1  D0 0D            bne _dow_snake5
00B8EA  1  AD 34 07         lda noun_buf+4
00B8ED  1  C9 53            cmp #'S'
00B8EF  1  D0 06            bne _dow_snake5
00B8F1  1  A9 01            lda #1
00B8F3  1  8D 74 07         sta command_object
00B8F6  1  60               rts
00B8F7  1               _dow_snake5:
00B8F7  1                   ; SNAKE
00B8F7  1  AD 30 07         lda noun_buf
00B8FA  1  C9 53            cmp #'S'
00B8FC  1  D0 22            bne _dow_dwarf5
00B8FE  1  AD 31 07         lda noun_buf+1
00B901  1  C9 4E            cmp #'N'
00B903  1  D0 1B            bne _dow_dwarf5
00B905  1  AD 32 07         lda noun_buf+2
00B908  1  C9 41            cmp #'A'
00B90A  1  D0 14            bne _dow_dwarf5
00B90C  1  AD 33 07         lda noun_buf+3
00B90F  1  C9 4B            cmp #'K'
00B911  1  D0 0D            bne _dow_dwarf5
00B913  1  AD 34 07         lda noun_buf+4
00B916  1  C9 45            cmp #'E'
00B918  1  D0 06            bne _dow_dwarf5
00B91A  1  A9 0B            lda #11
00B91C  1  8D 74 07         sta command_object
00B91F  1  60               rts
00B920  1               _dow_dwarf5:
00B920  1                   ; DWARF
00B920  1  AD 30 07         lda noun_buf
00B923  1  C9 44            cmp #'D'
00B925  1  D0 22            bne _dow_chest5
00B927  1  AD 31 07         lda noun_buf+1
00B92A  1  C9 57            cmp #'W'
00B92C  1  D0 1B            bne _dow_chest5
00B92E  1  AD 32 07         lda noun_buf+2
00B931  1  C9 41            cmp #'A'
00B933  1  D0 14            bne _dow_chest5
00B935  1  AD 33 07         lda noun_buf+3
00B938  1  C9 52            cmp #'R'
00B93A  1  D0 0D            bne _dow_chest5
00B93C  1  AD 34 07         lda noun_buf+4
00B93F  1  C9 46            cmp #'F'
00B941  1  D0 06            bne _dow_chest5
00B943  1  A9 11            lda #17
00B945  1  8D 74 07         sta command_object
00B948  1  60               rts
00B949  1               _dow_chest5:
00B949  1                   ; CHEST
00B949  1  AD 30 07         lda noun_buf
00B94C  1  C9 43            cmp #'C'
00B94E  1  D0 22            bne _dow_plant5
00B950  1  AD 31 07         lda noun_buf+1
00B953  1  C9 48            cmp #'H'
00B955  1  D0 1B            bne _dow_plant5
00B957  1  AD 32 07         lda noun_buf+2
00B95A  1  C9 45            cmp #'E'
00B95C  1  D0 14            bne _dow_plant5
00B95E  1  AD 33 07         lda noun_buf+3
00B961  1  C9 53            cmp #'S'
00B963  1  D0 0D            bne _dow_plant5
00B965  1  AD 34 07         lda noun_buf+4
00B968  1  C9 54            cmp #'T'
00B96A  1  D0 06            bne _dow_plant5
00B96C  1  A9 37            lda #55
00B96E  1  8D 74 07         sta command_object
00B971  1  60               rts
00B972  1               _dow_plant5:
00B972  1                   ; PLANT
00B972  1  AD 30 07         lda noun_buf
00B975  1  C9 50            cmp #'P'
00B977  1  D0 22            bne _dow_steps5
00B979  1  AD 31 07         lda noun_buf+1
00B97C  1  C9 4C            cmp #'L'
00B97E  1  D0 1B            bne _dow_steps5
00B980  1  AD 32 07         lda noun_buf+2
00B983  1  C9 41            cmp #'A'
00B985  1  D0 14            bne _dow_steps5
00B987  1  AD 33 07         lda noun_buf+3
00B98A  1  C9 4E            cmp #'N'
00B98C  1  D0 0D            bne _dow_steps5
00B98E  1  AD 34 07         lda noun_buf+4
00B991  1  C9 54            cmp #'T'
00B993  1  D0 06            bne _dow_steps5
00B995  1  A9 18            lda #24
00B997  1  8D 74 07         sta command_object
00B99A  1  60               rts
00B99B  1               _dow_steps5:
00B99B  1                   ; STEPS
00B99B  1  AD 30 07         lda noun_buf
00B99E  1  C9 53            cmp #'S'
00B9A0  1  D0 22            bne _dow_troll5
00B9A2  1  AD 31 07         lda noun_buf+1
00B9A5  1  C9 54            cmp #'T'
00B9A7  1  D0 1B            bne _dow_troll5
00B9A9  1  AD 32 07         lda noun_buf+2
00B9AC  1  C9 45            cmp #'E'
00B9AE  1  D0 14            bne _dow_troll5
00B9B0  1  AD 33 07         lda noun_buf+3
00B9B3  1  C9 50            cmp #'P'
00B9B5  1  D0 0D            bne _dow_troll5
00B9B7  1  AD 34 07         lda noun_buf+4
00B9BA  1  C9 53            cmp #'S'
00B9BC  1  D0 06            bne _dow_troll5
00B9BE  1  A9 07            lda #7
00B9C0  1  8D 74 07         sta command_object
00B9C3  1  60               rts
00B9C4  1               _dow_troll5:
00B9C4  1                   ; TROLL
00B9C4  1  AD 30 07         lda noun_buf
00B9C7  1  C9 54            cmp #'T'
00B9C9  1  D0 22            bne _dow_chain5
00B9CB  1  AD 31 07         lda noun_buf+1
00B9CE  1  C9 52            cmp #'R'
00B9D0  1  D0 1B            bne _dow_chain5
00B9D2  1  AD 32 07         lda noun_buf+2
00B9D5  1  C9 4F            cmp #'O'
00B9D7  1  D0 14            bne _dow_chain5
00B9D9  1  AD 33 07         lda noun_buf+3
00B9DC  1  C9 4C            cmp #'L'
00B9DE  1  D0 0D            bne _dow_chain5
00B9E0  1  AD 34 07         lda noun_buf+4
00B9E3  1  C9 4C            cmp #'L'
00B9E5  1  D0 06            bne _dow_chain5
00B9E7  1  A9 21            lda #33
00B9E9  1  8D 74 07         sta command_object
00B9EC  1  60               rts
00B9ED  1               _dow_chain5:
00B9ED  1                   ; CHAIN
00B9ED  1  AD 30 07         lda noun_buf
00B9F0  1  C9 43            cmp #'C'
00B9F2  1  D0 22            bne _dow_pearl5
00B9F4  1  AD 31 07         lda noun_buf+1
00B9F7  1  C9 48            cmp #'H'
00B9F9  1  D0 1B            bne _dow_pearl5
00B9FB  1  AD 32 07         lda noun_buf+2
00B9FE  1  C9 41            cmp #'A'
00BA00  1  D0 14            bne _dow_pearl5
00BA02  1  AD 33 07         lda noun_buf+3
00BA05  1  C9 49            cmp #'I'
00BA07  1  D0 0D            bne _dow_pearl5
00BA09  1  AD 34 07         lda noun_buf+4
00BA0C  1  C9 4E            cmp #'N'
00BA0E  1  D0 06            bne _dow_pearl5
00BA10  1  A9 3F            lda #63
00BA12  1  8D 74 07         sta command_object
00BA15  1  60               rts
00BA16  1               _dow_pearl5:
00BA16  1                   ; PEARL
00BA16  1  AD 30 07         lda noun_buf
00BA19  1  C9 50            cmp #'P'
00BA1B  1  D0 22            bne _dow_no5
00BA1D  1  AD 31 07         lda noun_buf+1
00BA20  1  C9 45            cmp #'E'
00BA22  1  D0 1B            bne _dow_no5
00BA24  1  AD 32 07         lda noun_buf+2
00BA27  1  C9 41            cmp #'A'
00BA29  1  D0 14            bne _dow_no5
00BA2B  1  AD 33 07         lda noun_buf+3
00BA2E  1  C9 52            cmp #'R'
00BA30  1  D0 0D            bne _dow_no5
00BA32  1  AD 34 07         lda noun_buf+4
00BA35  1  C9 4C            cmp #'L'
00BA37  1  D0 06            bne _dow_no5
00BA39  1  A9 3D            lda #61
00BA3B  1  8D 74 07         sta command_object
00BA3E  1  60               rts
00BA3F  1               _dow_no5:
00BA3F  1  60             rts
00BA40  1               
00BA40  1               _dow_len6:
00BA40  1  C9 06          cmp #6
00BA42  1  D0 03          bne :+
00BA44  1  4C 4A BA       jmp _dow_len6_do
00BA47  1               :
00BA47  1  4C 54 BC       jmp _dow_len7
00BA4A  1               _dow_len6_do:
00BA4A  1               
00BA4A  1                 ; BOTTLE
00BA4A  1  AD 30 07       lda noun_buf
00BA4D  1  C9 42          cmp #'B'
00BA4F  1  D0 29          bne _dow_mirror6
00BA51  1  AD 31 07       lda noun_buf+1
00BA54  1  C9 4F          cmp #'O'
00BA56  1  D0 22          bne _dow_mirror6
00BA58  1  AD 32 07       lda noun_buf+2
00BA5B  1  C9 54          cmp #'T'
00BA5D  1  D0 1B          bne _dow_mirror6
00BA5F  1  AD 33 07       lda noun_buf+3
00BA62  1  C9 54          cmp #'T'
00BA64  1  D0 14          bne _dow_mirror6
00BA66  1  AD 34 07       lda noun_buf+4
00BA69  1  C9 4C          cmp #'L'
00BA6B  1  D0 0D          bne _dow_mirror6
00BA6D  1  AD 35 07       lda noun_buf+5
00BA70  1  C9 45          cmp #'E'
00BA72  1  D0 06          bne _dow_mirror6
00BA74  1  A9 14          lda #20
00BA76  1  8D 74 07       sta command_object
00BA79  1  60             rts
00BA7A  1               _dow_mirror6:
00BA7A  1                 ; MIRROR
00BA7A  1  AD 30 07       lda noun_buf
00BA7D  1  C9 4D          cmp #'M'
00BA7F  1  D0 29          bne _dow_oyster6
00BA81  1  AD 31 07       lda noun_buf+1
00BA84  1  C9 49          cmp #'I'
00BA86  1  D0 22          bne _dow_oyster6
00BA88  1  AD 32 07       lda noun_buf+2
00BA8B  1  C9 52          cmp #'R'
00BA8D  1  D0 1B          bne _dow_oyster6
00BA8F  1  AD 33 07       lda noun_buf+3
00BA92  1  C9 52          cmp #'R'
00BA94  1  D0 14          bne _dow_oyster6
00BA96  1  AD 34 07       lda noun_buf+4
00BA99  1  C9 4F          cmp #'O'
00BA9B  1  D0 0D          bne _dow_oyster6
00BA9D  1  AD 35 07       lda noun_buf+5
00BAA0  1  C9 52          cmp #'R'
00BAA2  1  D0 06          bne _dow_oyster6
00BAA4  1  A9 17          lda #23
00BAA6  1  8D 74 07       sta command_object
00BAA9  1  60             rts
00BAAA  1               _dow_oyster6:
00BAAA  1                 ; OYSTER
00BAAA  1  AD 30 07       lda noun_buf
00BAAD  1  C9 4F          cmp #'O'
00BAAF  1  D0 29          bne _dow_pirate6
00BAB1  1  AD 31 07       lda noun_buf+1
00BAB4  1  C9 59          cmp #'Y'
00BAB6  1  D0 22          bne _dow_pirate6
00BAB8  1  AD 32 07       lda noun_buf+2
00BABB  1  C9 53          cmp #'S'
00BABD  1  D0 1B          bne _dow_pirate6
00BABF  1  AD 33 07       lda noun_buf+3
00BAC2  1  C9 54          cmp #'T'
00BAC4  1  D0 14          bne _dow_pirate6
00BAC6  1  AD 34 07       lda noun_buf+4
00BAC9  1  C9 45          cmp #'E'
00BACB  1  D0 0D          bne _dow_pirate6
00BACD  1  AD 35 07       lda noun_buf+5
00BAD0  1  C9 52          cmp #'R'
00BAD2  1  D0 06          bne _dow_pirate6
00BAD4  1  A9 0F          lda #15
00BAD6  1  8D 74 07       sta command_object
00BAD9  1  60             rts
00BADA  1               _dow_pirate6:
00BADA  1                 ; PIRATE
00BADA  1  AD 30 07       lda noun_buf
00BADD  1  C9 50          cmp #'P'
00BADF  1  D0 29          bne _dow_dragon6
00BAE1  1  AD 31 07       lda noun_buf+1
00BAE4  1  C9 49          cmp #'I'
00BAE6  1  D0 22          bne _dow_dragon6
00BAE8  1  AD 32 07       lda noun_buf+2
00BAEB  1  C9 52          cmp #'R'
00BAED  1  D0 1B          bne _dow_dragon6
00BAEF  1  AD 33 07       lda noun_buf+3
00BAF2  1  C9 41          cmp #'A'
00BAF4  1  D0 14          bne _dow_dragon6
00BAF6  1  AD 34 07       lda noun_buf+4
00BAF9  1  C9 54          cmp #'T'
00BAFB  1  D0 0D          bne _dow_dragon6
00BAFD  1  AD 35 07       lda noun_buf+5
00BB00  1  C9 45          cmp #'E'
00BB02  1  D0 06          bne _dow_dragon6
00BB04  1  A9 1E          lda #30
00BB06  1  8D 74 07       sta command_object
00BB09  1  60             rts
00BB0A  1               _dow_dragon6:
00BB0A  1                 ; DRAGON
00BB0A  1  AD 30 07       lda noun_buf
00BB0D  1  C9 44          cmp #'D'
00BB0F  1  D0 29          bne _dow_chasm6
00BB11  1  AD 31 07       lda noun_buf+1
00BB14  1  C9 52          cmp #'R'
00BB16  1  D0 22          bne _dow_chasm6
00BB18  1  AD 32 07       lda noun_buf+2
00BB1B  1  C9 41          cmp #'A'
00BB1D  1  D0 1B          bne _dow_chasm6
00BB1F  1  AD 33 07       lda noun_buf+3
00BB22  1  C9 47          cmp #'G'
00BB24  1  D0 14          bne _dow_chasm6
00BB26  1  AD 34 07       lda noun_buf+4
00BB29  1  C9 4F          cmp #'O'
00BB2B  1  D0 0D          bne _dow_chasm6
00BB2D  1  AD 35 07       lda noun_buf+5
00BB30  1  C9 4E          cmp #'N'
00BB32  1  D0 06          bne _dow_chasm6
00BB34  1  A9 1F          lda #31
00BB36  1  8D 74 07       sta command_object
00BB39  1  60             rts
00BB3A  1               _dow_chasm6:
00BB3A  1                 ; CHASM
00BB3A  1  AD 30 07       lda noun_buf
00BB3D  1  C9 43          cmp #'C'
00BB3F  1  D0 22          bne _dow_pillow6
00BB41  1  AD 31 07       lda noun_buf+1
00BB44  1  C9 48          cmp #'H'
00BB46  1  D0 1B          bne _dow_pillow6
00BB48  1  AD 32 07       lda noun_buf+2
00BB4B  1  C9 41          cmp #'A'
00BB4D  1  D0 14          bne _dow_pillow6
00BB4F  1  AD 33 07       lda noun_buf+3
00BB52  1  C9 53          cmp #'S'
00BB54  1  D0 0D          bne _dow_pillow6
00BB56  1  AD 34 07       lda noun_buf+4
00BB59  1  C9 4D          cmp #'M'
00BB5B  1  D0 06          bne _dow_pillow6
00BB5D  1  A9 20          lda #32
00BB5F  1  8D 74 07       sta command_object
00BB62  1  60             rts
00BB63  1               _dow_pillow6:
00BB63  1                 ; PILLOW
00BB63  1  AD 30 07       lda noun_buf
00BB66  1  C9 50          cmp #'P'
00BB68  1  D0 29          bne _dow_tablet6
00BB6A  1  AD 31 07       lda noun_buf+1
00BB6D  1  C9 49          cmp #'I'
00BB6F  1  D0 22          bne _dow_tablet6
00BB71  1  AD 32 07       lda noun_buf+2
00BB74  1  C9 4C          cmp #'L'
00BB76  1  D0 1B          bne _dow_tablet6
00BB78  1  AD 33 07       lda noun_buf+3
00BB7B  1  C9 4C          cmp #'L'
00BB7D  1  D0 14          bne _dow_tablet6
00BB7F  1  AD 34 07       lda noun_buf+4
00BB82  1  C9 4F          cmp #'O'
00BB84  1  D0 0D          bne _dow_tablet6
00BB86  1  AD 35 07       lda noun_buf+5
00BB89  1  C9 57          cmp #'W'
00BB8B  1  D0 06          bne _dow_tablet6
00BB8D  1  A9 0A          lda #10
00BB8F  1  8D 74 07       sta command_object
00BB92  1  60             rts
00BB93  1               _dow_tablet6:
00BB93  1                 ; TABLET
00BB93  1  AD 30 07       lda noun_buf
00BB96  1  C9 54          cmp #'T'
00BB98  1  D0 29          bne _dow_silver6
00BB9A  1  AD 31 07       lda noun_buf+1
00BB9D  1  C9 41          cmp #'A'
00BB9F  1  D0 22          bne _dow_silver6
00BBA1  1  AD 32 07       lda noun_buf+2
00BBA4  1  C9 42          cmp #'B'
00BBA6  1  D0 1B          bne _dow_silver6
00BBA8  1  AD 33 07       lda noun_buf+3
00BBAB  1  C9 4C          cmp #'L'
00BBAD  1  D0 14          bne _dow_silver6
00BBAF  1  AD 34 07       lda noun_buf+4
00BBB2  1  C9 45          cmp #'E'
00BBB4  1  D0 0D          bne _dow_silver6
00BBB6  1  AD 35 07       lda noun_buf+5
00BBB9  1  C9 54          cmp #'T'
00BBBB  1  D0 06          bne _dow_silver6
00BBBD  1  A9 0D          lda #13
00BBBF  1  8D 74 07       sta command_object
00BBC2  1  60             rts
00BBC3  1               _dow_silver6:
00BBC3  1                 ; SILVER
00BBC3  1  AD 30 07       lda noun_buf
00BBC6  1  C9 53          cmp #'S'
00BBC8  1  D0 29          bne _dow_nugget6
00BBCA  1  AD 31 07       lda noun_buf+1
00BBCD  1  C9 49          cmp #'I'
00BBCF  1  D0 22          bne _dow_nugget6
00BBD1  1  AD 32 07       lda noun_buf+2
00BBD4  1  C9 4C          cmp #'L'
00BBD6  1  D0 1B          bne _dow_nugget6
00BBD8  1  AD 33 07       lda noun_buf+3
00BBDB  1  C9 56          cmp #'V'
00BBDD  1  D0 14          bne _dow_nugget6
00BBDF  1  AD 34 07       lda noun_buf+4
00BBE2  1  C9 45          cmp #'E'
00BBE4  1  D0 0D          bne _dow_nugget6
00BBE6  1  AD 35 07       lda noun_buf+5
00BBE9  1  C9 52          cmp #'R'
00BBEB  1  D0 06          bne _dow_nugget6
00BBED  1  A9 34          lda #52
00BBEF  1  8D 74 07       sta command_object
00BBF2  1  60             rts
00BBF3  1               _dow_nugget6:
00BBF3  1                 ; NUGGET
00BBF3  1  AD 30 07       lda noun_buf
00BBF6  1  C9 4E          cmp #'N'
00BBF8  1  D0 29          bne _dow_carpet6
00BBFA  1  AD 31 07       lda noun_buf+1
00BBFD  1  C9 55          cmp #'U'
00BBFF  1  D0 22          bne _dow_carpet6
00BC01  1  AD 32 07       lda noun_buf+2
00BC04  1  C9 47          cmp #'G'
00BC06  1  D0 1B          bne _dow_carpet6
00BC08  1  AD 33 07       lda noun_buf+3
00BC0B  1  C9 47          cmp #'G'
00BC0D  1  D0 14          bne _dow_carpet6
00BC0F  1  AD 34 07       lda noun_buf+4
00BC12  1  C9 45          cmp #'E'
00BC14  1  D0 0D          bne _dow_carpet6
00BC16  1  AD 35 07       lda noun_buf+5
00BC19  1  C9 54          cmp #'T'
00BC1B  1  D0 06          bne _dow_carpet6
00BC1D  1  A9 32          lda #50
00BC1F  1  8D 74 07       sta command_object
00BC22  1  60             rts
00BC23  1               _dow_carpet6:
00BC23  1                 ; CARPET
00BC23  1  AD 30 07       lda noun_buf
00BC26  1  C9 43          cmp #'C'
00BC28  1  D0 29          bne _dow_no6
00BC2A  1  AD 31 07       lda noun_buf+1
00BC2D  1  C9 41          cmp #'A'
00BC2F  1  D0 22          bne _dow_no6
00BC31  1  AD 32 07       lda noun_buf+2
00BC34  1  C9 52          cmp #'R'
00BC36  1  D0 1B          bne _dow_no6
00BC38  1  AD 33 07       lda noun_buf+3
00BC3B  1  C9 50          cmp #'P'
00BC3D  1  D0 14          bne _dow_no6
00BC3F  1  AD 34 07       lda noun_buf+4
00BC42  1  C9 45          cmp #'E'
00BC44  1  D0 0D          bne _dow_no6
00BC46  1  AD 35 07       lda noun_buf+5
00BC49  1  C9 54          cmp #'T'
00BC4B  1  D0 06          bne _dow_no6
00BC4D  1  A9 28          lda #40
00BC4F  1  8D 74 07       sta command_object
00BC52  1  60             rts
00BC53  1               _dow_no6:
00BC53  1  60             rts
00BC54  1               
00BC54  1               _dow_len7:
00BC54  1  C9 07          cmp #7
00BC56  1  D0 03          bne :+
00BC58  1  4C 5E BC       jmp _dow_len7_do
00BC5B  1               :
00BC5B  1  4C A9 BD       jmp _dow_len8
00BC5E  1               _dow_len7_do:
00BC5E  1               
00BC5E  1                 ; EMERALD
00BC5E  1  AD 30 07       lda noun_buf
00BC61  1  C9 45          cmp #'E'
00BC63  1  D0 30          bne _dow_fissure7
00BC65  1  AD 31 07       lda noun_buf+1
00BC68  1  C9 4D          cmp #'M'
00BC6A  1  D0 29          bne _dow_fissure7
00BC6C  1  AD 32 07       lda noun_buf+2
00BC6F  1  C9 45          cmp #'E'
00BC71  1  D0 22          bne _dow_fissure7
00BC73  1  AD 33 07       lda noun_buf+3
00BC76  1  C9 52          cmp #'R'
00BC78  1  D0 1B          bne _dow_fissure7
00BC7A  1  AD 34 07       lda noun_buf+4
00BC7D  1  C9 41          cmp #'A'
00BC7F  1  D0 14          bne _dow_fissure7
00BC81  1  AD 35 07       lda noun_buf+5
00BC84  1  C9 4C          cmp #'L'
00BC86  1  D0 0D          bne _dow_fissure7
00BC88  1  AD 36 07       lda noun_buf+6
00BC8B  1  C9 44          cmp #'D'
00BC8D  1  D0 06          bne _dow_fissure7
00BC8F  1  A9 3B          lda #59
00BC91  1  8D 74 07       sta command_object
00BC94  1  60             rts
00BC95  1               _dow_fissure7:
00BC95  1                 ; FISSURE
00BC95  1  AD 30 07       lda noun_buf
00BC98  1  C9 46          cmp #'F'
00BC9A  1  D0 30          bne _dow_trident7
00BC9C  1  AD 31 07       lda noun_buf+1
00BC9F  1  C9 49          cmp #'I'
00BCA1  1  D0 29          bne _dow_trident7
00BCA3  1  AD 32 07       lda noun_buf+2
00BCA6  1  C9 53          cmp #'S'
00BCA8  1  D0 22          bne _dow_trident7
00BCAA  1  AD 33 07       lda noun_buf+3
00BCAD  1  C9 53          cmp #'S'
00BCAF  1  D0 1B          bne _dow_trident7
00BCB1  1  AD 34 07       lda noun_buf+4
00BCB4  1  C9 55          cmp #'U'
00BCB6  1  D0 14          bne _dow_trident7
00BCB8  1  AD 35 07       lda noun_buf+5
00BCBB  1  C9 52          cmp #'R'
00BCBD  1  D0 0D          bne _dow_trident7
00BCBF  1  AD 36 07       lda noun_buf+6
00BCC2  1  C9 45          cmp #'E'
00BCC4  1  D0 06          bne _dow_trident7
00BCC6  1  A9 0C          lda #12
00BCC8  1  8D 74 07       sta command_object
00BCCB  1  60             rts
00BCCC  1               _dow_trident7:
00BCCC  1                 ; TRIDENT
00BCCC  1  AD 30 07       lda noun_buf
00BCCF  1  C9 54          cmp #'T'
00BCD1  1  D0 30          bne _dow_jewelry7
00BCD3  1  AD 31 07       lda noun_buf+1
00BCD6  1  C9 52          cmp #'R'
00BCD8  1  D0 29          bne _dow_jewelry7
00BCDA  1  AD 32 07       lda noun_buf+2
00BCDD  1  C9 49          cmp #'I'
00BCDF  1  D0 22          bne _dow_jewelry7
00BCE1  1  AD 33 07       lda noun_buf+3
00BCE4  1  C9 44          cmp #'D'
00BCE6  1  D0 1B          bne _dow_jewelry7
00BCE8  1  AD 34 07       lda noun_buf+4
00BCEB  1  C9 45          cmp #'E'
00BCED  1  D0 14          bne _dow_jewelry7
00BCEF  1  AD 35 07       lda noun_buf+5
00BCF2  1  C9 4E          cmp #'N'
00BCF4  1  D0 0D          bne _dow_jewelry7
00BCF6  1  AD 36 07       lda noun_buf+6
00BCF9  1  C9 54          cmp #'T'
00BCFB  1  D0 06          bne _dow_jewelry7
00BCFD  1  A9 39          lda #57
00BCFF  1  8D 74 07       sta command_object
00BD02  1  60             rts
00BD03  1               _dow_jewelry7:
00BD03  1                 ; JEWELRY
00BD03  1  AD 30 07       lda noun_buf
00BD06  1  C9 4A          cmp #'J'
00BD08  1  D0 30          bne _dow_battery7
00BD0A  1  AD 31 07       lda noun_buf+1
00BD0D  1  C9 45          cmp #'E'
00BD0F  1  D0 29          bne _dow_battery7
00BD11  1  AD 32 07       lda noun_buf+2
00BD14  1  C9 57          cmp #'W'
00BD16  1  D0 22          bne _dow_battery7
00BD18  1  AD 33 07       lda noun_buf+3
00BD1B  1  C9 45          cmp #'E'
00BD1D  1  D0 1B          bne _dow_battery7
00BD1F  1  AD 34 07       lda noun_buf+4
00BD22  1  C9 4C          cmp #'L'
00BD24  1  D0 14          bne _dow_battery7
00BD26  1  AD 35 07       lda noun_buf+5
00BD29  1  C9 52          cmp #'R'
00BD2B  1  D0 0D          bne _dow_battery7
00BD2D  1  AD 36 07       lda noun_buf+6
00BD30  1  C9 59          cmp #'Y'
00BD32  1  D0 06          bne _dow_battery7
00BD34  1  A9 35          lda #53
00BD36  1  8D 74 07       sta command_object
00BD39  1  60             rts
00BD3A  1               _dow_battery7:
00BD3A  1                 ; BATTERY
00BD3A  1  AD 30 07       lda noun_buf
00BD3D  1  C9 42          cmp #'B'
00BD3F  1  D0 30          bne _dow_pyramid7
00BD41  1  AD 31 07       lda noun_buf+1
00BD44  1  C9 41          cmp #'A'
00BD46  1  D0 29          bne _dow_pyramid7
00BD48  1  AD 32 07       lda noun_buf+2
00BD4B  1  C9 54          cmp #'T'
00BD4D  1  D0 22          bne _dow_pyramid7
00BD4F  1  AD 33 07       lda noun_buf+3
00BD52  1  C9 54          cmp #'T'
00BD54  1  D0 1B          bne _dow_pyramid7
00BD56  1  AD 34 07       lda noun_buf+4
00BD59  1  C9 45          cmp #'E'
00BD5B  1  D0 14          bne _dow_pyramid7
00BD5D  1  AD 35 07       lda noun_buf+5
00BD60  1  C9 52          cmp #'R'
00BD62  1  D0 0D          bne _dow_pyramid7
00BD64  1  AD 36 07       lda noun_buf+6
00BD67  1  C9 59          cmp #'Y'
00BD69  1  D0 06          bne _dow_pyramid7
00BD6B  1  A9 27          lda #39
00BD6D  1  8D 74 07       sta command_object
00BD70  1  60             rts
00BD71  1               _dow_pyramid7:
00BD71  1                 ; PYRAMID
00BD71  1  AD 30 07       lda noun_buf
00BD74  1  C9 50          cmp #'P'
00BD76  1  D0 30          bne _dow_no7
00BD78  1  AD 31 07       lda noun_buf+1
00BD7B  1  C9 59          cmp #'Y'
00BD7D  1  D0 29          bne _dow_no7
00BD7F  1  AD 32 07       lda noun_buf+2
00BD82  1  C9 52          cmp #'R'
00BD84  1  D0 22          bne _dow_no7
00BD86  1  AD 33 07       lda noun_buf+3
00BD89  1  C9 41          cmp #'A'
00BD8B  1  D0 1B          bne _dow_no7
00BD8D  1  AD 34 07       lda noun_buf+4
00BD90  1  C9 4D          cmp #'M'
00BD92  1  D0 14          bne _dow_no7
00BD94  1  AD 35 07       lda noun_buf+5
00BD97  1  C9 49          cmp #'I'
00BD99  1  D0 0D          bne _dow_no7
00BD9B  1  AD 36 07       lda noun_buf+6
00BD9E  1  C9 44          cmp #'D'
00BDA0  1  D0 06          bne _dow_no7
00BDA2  1  A9 3C          lda #60
00BDA4  1  8D 74 07       sta command_object
00BDA7  1  60             rts
00BDA8  1               _dow_no7:
00BDA8  1  60             rts
00BDA9  1               
00BDA9  1               _dow_len8:
00BDA9  1  C9 08          cmp #8
00BDAB  1  D0 03          bne :+
00BDAD  1  4C B3 BD       jmp _dow_len8_do
00BDB0  1               :
00BDB0  1  4C 70 BE       jmp _dow_len9
00BDB3  1               _dow_len8_do:
00BDB3  1               
00BDB3  1                 ; DIAMONDS
00BDB3  1  AD 30 07       lda noun_buf
00BDB6  1  C9 44          cmp #'D'
00BDB8  1  D0 37          bne _dow_magazine8
00BDBA  1  AD 31 07       lda noun_buf+1
00BDBD  1  C9 49          cmp #'I'
00BDBF  1  D0 30          bne _dow_magazine8
00BDC1  1  AD 32 07       lda noun_buf+2
00BDC4  1  C9 41          cmp #'A'
00BDC6  1  D0 29          bne _dow_magazine8
00BDC8  1  AD 33 07       lda noun_buf+3
00BDCB  1  C9 4D          cmp #'M'
00BDCD  1  D0 22          bne _dow_magazine8
00BDCF  1  AD 34 07       lda noun_buf+4
00BDD2  1  C9 4F          cmp #'O'
00BDD4  1  D0 1B          bne _dow_magazine8
00BDD6  1  AD 35 07       lda noun_buf+5
00BDD9  1  C9 4E          cmp #'N'
00BDDB  1  D0 14          bne _dow_magazine8
00BDDD  1  AD 36 07       lda noun_buf+6
00BDE0  1  C9 44          cmp #'D'
00BDE2  1  D0 0D          bne _dow_magazine8
00BDE4  1  AD 37 07       lda noun_buf+7
00BDE7  1  C9 53          cmp #'S'
00BDE9  1  D0 06          bne _dow_magazine8
00BDEB  1  A9 33          lda #51
00BDED  1  8D 74 07       sta command_object
00BDF0  1  60             rts
00BDF1  1               _dow_magazine8:
00BDF1  1                 ; MAGAZINE
00BDF1  1  AD 30 07       lda noun_buf
00BDF4  1  C9 4D          cmp #'M'
00BDF6  1  D0 37          bne _dow_drawings8
00BDF8  1  AD 31 07       lda noun_buf+1
00BDFB  1  C9 41          cmp #'A'
00BDFD  1  D0 30          bne _dow_drawings8
00BDFF  1  AD 32 07       lda noun_buf+2
00BE02  1  C9 47          cmp #'G'
00BE04  1  D0 29          bne _dow_drawings8
00BE06  1  AD 33 07       lda noun_buf+3
00BE09  1  C9 41          cmp #'A'
00BE0B  1  D0 22          bne _dow_drawings8
00BE0D  1  AD 34 07       lda noun_buf+4
00BE10  1  C9 5A          cmp #'Z'
00BE12  1  D0 1B          bne _dow_drawings8
00BE14  1  AD 35 07       lda noun_buf+5
00BE17  1  C9 49          cmp #'I'
00BE19  1  D0 14          bne _dow_drawings8
00BE1B  1  AD 36 07       lda noun_buf+6
00BE1E  1  C9 4E          cmp #'N'
00BE20  1  D0 0D          bne _dow_drawings8
00BE22  1  AD 37 07       lda noun_buf+7
00BE25  1  C9 45          cmp #'E'
00BE27  1  D0 06          bne _dow_drawings8
00BE29  1  A9 10          lda #16
00BE2B  1  8D 74 07       sta command_object
00BE2E  1  60             rts
00BE2F  1               _dow_drawings8:
00BE2F  1                 ; DRAWINGS
00BE2F  1  AD 30 07       lda noun_buf
00BE32  1  C9 44          cmp #'D'
00BE34  1  D0 37          bne _dow_drawings8_no
00BE36  1  AD 31 07       lda noun_buf+1
00BE39  1  C9 52          cmp #'R'
00BE3B  1  D0 30          bne _dow_drawings8_no
00BE3D  1  AD 32 07       lda noun_buf+2
00BE40  1  C9 41          cmp #'A'
00BE42  1  D0 29          bne _dow_drawings8_no
00BE44  1  AD 33 07       lda noun_buf+3
00BE47  1  C9 57          cmp #'W'
00BE49  1  D0 22          bne _dow_drawings8_no
00BE4B  1  AD 34 07       lda noun_buf+4
00BE4E  1  C9 49          cmp #'I'
00BE50  1  D0 1B          bne _dow_drawings8_no
00BE52  1  AD 35 07       lda noun_buf+5
00BE55  1  C9 4E          cmp #'N'
00BE57  1  D0 14          bne _dow_drawings8_no
00BE59  1  AD 36 07       lda noun_buf+6
00BE5C  1  C9 47          cmp #'G'
00BE5E  1  D0 0D          bne _dow_drawings8_no
00BE60  1  AD 37 07       lda noun_buf+7
00BE63  1  C9 53          cmp #'S'
00BE65  1  D0 06          bne _dow_drawings8_no
00BE67  1  A9 1D          lda #29
00BE69  1  8D 74 07       sta command_object
00BE6C  1  60             rts
00BE6D  1               _dow_drawings8_no:
00BE6D  1  4C B9 BE       jmp _dow_no
00BE70  1               
00BE70  1               _dow_len9:
00BE70  1  C9 09          cmp #9
00BE72  1  D0 45          bne _dow_no
00BE74  1               
00BE74  1                 ; BATTERIES
00BE74  1  AD 30 07       lda noun_buf
00BE77  1  C9 42          cmp #'B'
00BE79  1  D0 3E          bne _dow_no
00BE7B  1  AD 31 07       lda noun_buf+1
00BE7E  1  C9 41          cmp #'A'
00BE80  1  D0 37          bne _dow_no
00BE82  1  AD 32 07       lda noun_buf+2
00BE85  1  C9 54          cmp #'T'
00BE87  1  D0 30          bne _dow_no
00BE89  1  AD 33 07       lda noun_buf+3
00BE8C  1  C9 54          cmp #'T'
00BE8E  1  D0 29          bne _dow_no
00BE90  1  AD 34 07       lda noun_buf+4
00BE93  1  C9 45          cmp #'E'
00BE95  1  D0 22          bne _dow_no
00BE97  1  AD 35 07       lda noun_buf+5
00BE9A  1  C9 52          cmp #'R'
00BE9C  1  D0 1B          bne _dow_no
00BE9E  1  AD 36 07       lda noun_buf+6
00BEA1  1  C9 49          cmp #'I'
00BEA3  1  D0 14          bne _dow_no
00BEA5  1  AD 37 07       lda noun_buf+7
00BEA8  1  C9 45          cmp #'E'
00BEAA  1  D0 0D          bne _dow_no
00BEAC  1  AD 38 07       lda noun_buf+8
00BEAF  1  C9 53          cmp #'S'
00BEB1  1  D0 06          bne _dow_no
00BEB3  1  A9 27          lda #39
00BEB5  1  8D 74 07       sta command_object
00BEB8  1  60             rts
00BEB9  1               
00BEB9  1               _dow_no:
00BEB9  1  60             rts
00BEBA  1               
00BEBA  1               decode_motion_word:
00BEBA  1                 ; Default stays target_verb=1 if no match.
00BEBA  1  AD 70 07       lda cmd_len
00BEBD  1  C9 01          cmp #1
00BEBF  1  D0 03          bne _dm_chk2
00BEC1  1  4C 04 BF       jmp _dm_len1
00BEC4  1               _dm_chk2:
00BEC4  1  C9 02          cmp #2
00BEC6  1  D0 03          bne _dm_chk3
00BEC8  1  4C 58 BF       jmp _dm_len2
00BECB  1               _dm_chk3:
00BECB  1  C9 03          cmp #3
00BECD  1  D0 03          bne _dm_chk4
00BECF  1  4C 21 C0       jmp _dm_len3
00BED2  1               _dm_chk4:
00BED2  1  C9 04          cmp #4
00BED4  1  D0 03          bne _dm_chk5
00BED6  1  4C 58 C0       jmp _dm_len4
00BED9  1               _dm_chk5:
00BED9  1  C9 05          cmp #5
00BEDB  1  D0 03          bne _dm_chk6
00BEDD  1  4C CF C1       jmp _dm_len5
00BEE0  1               _dm_chk6:
00BEE0  1  C9 06          cmp #6
00BEE2  1  D0 03          bne _dm_chk7
00BEE4  1  4C 6A C3       jmp _dm_len6
00BEE7  1               _dm_chk7:
00BEE7  1  C9 07          cmp #7
00BEE9  1  D0 03          bne _dm_chk8
00BEEB  1  4C 44 C5       jmp _dm_len7
00BEEE  1               _dm_chk8:
00BEEE  1  C9 08          cmp #8
00BEF0  1  D0 03          bne _dm_chk9
00BEF2  1  4C 1A C6       jmp _dm_len8
00BEF5  1               _dm_chk9:
00BEF5  1  C9 09          cmp #9
00BEF7  1  D0 03          bne _dm_chk10
00BEF9  1  4C 13 C7       jmp _dm_len9
00BEFC  1               _dm_chk10:
00BEFC  1  C9 0A          cmp #10
00BEFE  1  D0 03          bne _dm_dispatch_no
00BF00  1  4C E1 C7       jmp _dm_len10
00BF03  1               _dm_dispatch_no:
00BF03  1  60             rts
00BF04  1               
00BF04  1               _dm_len1:
00BF04  1  AD 20 07       lda cmd_buf
00BF07  1  C9 4E          cmp #'N'
00BF09  1  D0 06          bne :+
00BF0B  1  A9 2D          lda #45
00BF0D  1  8D 01 07       sta target_verb
00BF10  1  60             rts
00BF11  1               :
00BF11  1  C9 53          cmp #'S'
00BF13  1  D0 06          bne :+
00BF15  1  A9 2E          lda #46
00BF17  1  8D 01 07       sta target_verb
00BF1A  1  60             rts
00BF1B  1               :
00BF1B  1  C9 45          cmp #'E'
00BF1D  1  D0 06          bne :+
00BF1F  1  A9 2B          lda #43
00BF21  1  8D 01 07       sta target_verb
00BF24  1  60             rts
00BF25  1               :
00BF25  1  C9 57          cmp #'W'
00BF27  1  D0 06          bne :+
00BF29  1  A9 2C          lda #44
00BF2B  1  8D 01 07       sta target_verb
00BF2E  1  60             rts
00BF2F  1               :
00BF2F  1  C9 55          cmp #'U'
00BF31  1  D0 06          bne :+
00BF33  1  A9 1D          lda #29
00BF35  1  8D 01 07       sta target_verb
00BF38  1  60             rts
00BF39  1               :
00BF39  1  C9 44          cmp #'D'
00BF3B  1  D0 06          bne :+
00BF3D  1  A9 1E          lda #30
00BF3F  1  8D 01 07       sta target_verb
00BF42  1  60             rts
00BF43  1               :
00BF43  1  C9 49          cmp #'I'
00BF45  1  D0 06          bne :+
00BF47  1  A9 13          lda #19
00BF49  1  8D 01 07       sta target_verb
00BF4C  1  60             rts
00BF4D  1               :
00BF4D  1  C9 4F          cmp #'O'
00BF4F  1  D0 06          bne _dm_len1_no
00BF51  1  A9 0B          lda #11
00BF53  1  8D 01 07       sta target_verb
00BF56  1  60             rts
00BF57  1               _dm_len1_no:
00BF57  1  60             rts
00BF58  1               
00BF58  1               _dm_len2:
00BF58  1  AD 20 07       lda cmd_buf
00BF5B  1  C9 4E          cmp #'N'
00BF5D  1  D0 0D          bne :+
00BF5F  1  AD 21 07       lda cmd_buf+1
00BF62  1  C9 45          cmp #'E'
00BF64  1  D0 06          bne :+
00BF66  1  A9 2F          lda #47
00BF68  1  8D 01 07       sta target_verb
00BF6B  1  60             rts
00BF6C  1               :
00BF6C  1  AD 20 07       lda cmd_buf
00BF6F  1  C9 4E          cmp #'N'
00BF71  1  D0 0D          bne :+
00BF73  1  AD 21 07       lda cmd_buf+1
00BF76  1  C9 57          cmp #'W'
00BF78  1  D0 06          bne :+
00BF7A  1  A9 32          lda #50
00BF7C  1  8D 01 07       sta target_verb
00BF7F  1  60             rts
00BF80  1               :
00BF80  1  AD 20 07       lda cmd_buf
00BF83  1  C9 53          cmp #'S'
00BF85  1  D0 0D          bne :+
00BF87  1  AD 21 07       lda cmd_buf+1
00BF8A  1  C9 45          cmp #'E'
00BF8C  1  D0 06          bne :+
00BF8E  1  A9 30          lda #48
00BF90  1  8D 01 07       sta target_verb
00BF93  1  60             rts
00BF94  1               :
00BF94  1  AD 20 07       lda cmd_buf
00BF97  1  C9 53          cmp #'S'
00BF99  1  D0 0D          bne :+
00BF9B  1  AD 21 07       lda cmd_buf+1
00BF9E  1  C9 57          cmp #'W'
00BFA0  1  D0 06          bne :+
00BFA2  1  A9 31          lda #49
00BFA4  1  8D 01 07       sta target_verb
00BFA7  1  60             rts
00BFA8  1               :
00BFA8  1  AD 20 07       lda cmd_buf
00BFAB  1  C9 4E          cmp #'N'
00BFAD  1  D0 0D          bne :+
00BFAF  1  AD 21 07       lda cmd_buf+1
00BFB2  1  C9 4F          cmp #'O'
00BFB4  1  D0 06          bne :+
00BFB6  1  A9 2D          lda #45
00BFB8  1  8D 01 07       sta target_verb
00BFBB  1  60             rts
00BFBC  1               :
00BFBC  1  AD 20 07       lda cmd_buf
00BFBF  1  C9 53          cmp #'S'
00BFC1  1  D0 0D          bne :+
00BFC3  1  AD 21 07       lda cmd_buf+1
00BFC6  1  C9 4F          cmp #'O'
00BFC8  1  D0 06          bne :+
00BFCA  1  A9 2E          lda #46
00BFCC  1  8D 01 07       sta target_verb
00BFCF  1  60             rts
00BFD0  1               :
00BFD0  1  AD 20 07       lda cmd_buf
00BFD3  1  C9 45          cmp #'E'
00BFD5  1  D0 0D          bne :+
00BFD7  1  AD 21 07       lda cmd_buf+1
00BFDA  1  C9 41          cmp #'A'
00BFDC  1  D0 06          bne :+
00BFDE  1  A9 2B          lda #43
00BFE0  1  8D 01 07       sta target_verb
00BFE3  1  60             rts
00BFE4  1               :
00BFE4  1  AD 20 07       lda cmd_buf
00BFE7  1  C9 57          cmp #'W'
00BFE9  1  D0 0D          bne :+
00BFEB  1  AD 21 07       lda cmd_buf+1
00BFEE  1  C9 45          cmp #'E'
00BFF0  1  D0 06          bne :+
00BFF2  1  A9 2C          lda #44
00BFF4  1  8D 01 07       sta target_verb
00BFF7  1  60             rts
00BFF8  1               :
00BFF8  1  AD 20 07       lda cmd_buf
00BFFB  1  C9 55          cmp #'U'
00BFFD  1  D0 0D          bne :+
00BFFF  1  AD 21 07       lda cmd_buf+1
00C002  1  C9 50          cmp #'P'
00C004  1  D0 06          bne :+
00C006  1  A9 1D          lda #29
00C008  1  8D 01 07       sta target_verb
00C00B  1  60             rts
00C00C  1               :
00C00C  1  AD 20 07       lda cmd_buf
00C00F  1  C9 49          cmp #'I'
00C011  1  D0 0D          bne _dm_len2_no
00C013  1  AD 21 07       lda cmd_buf+1
00C016  1  C9 4E          cmp #'N'
00C018  1  D0 06          bne _dm_len2_no
00C01A  1  A9 13          lda #19
00C01C  1  8D 01 07       sta target_verb
00C01F  1  60             rts
00C020  1               _dm_len2_no:
00C020  1  60             rts
00C021  1               
00C021  1               _dm_len3:
00C021  1  AD 20 07       lda cmd_buf
00C024  1  C9 4F          cmp #'O'
00C026  1  D0 14          bne _dm_len3_pit
00C028  1  AD 21 07       lda cmd_buf+1
00C02B  1  C9 55          cmp #'U'
00C02D  1  D0 0D          bne _dm_len3_pit
00C02F  1  AD 22 07       lda cmd_buf+2
00C032  1  C9 54          cmp #'T'
00C034  1  D0 06          bne _dm_len3_pit
00C036  1  A9 0B          lda #11
00C038  1  8D 01 07       sta target_verb
00C03B  1  60             rts
00C03C  1               _dm_len3_pit:
00C03C  1  AD 20 07       lda cmd_buf
00C03F  1  C9 50          cmp #'P'
00C041  1  D0 14          bne _dm_len3_no
00C043  1  AD 21 07       lda cmd_buf+1
00C046  1  C9 49          cmp #'I'
00C048  1  D0 0D          bne _dm_len3_no
00C04A  1  AD 22 07       lda cmd_buf+2
00C04D  1  C9 54          cmp #'T'
00C04F  1  D0 06          bne _dm_len3_no
00C051  1  A9 3F          lda #63
00C053  1  8D 01 07       sta target_verb
00C056  1  60             rts
00C057  1               _dm_len3_no:
00C057  1  60             rts
00C058  1               
00C058  1               _dm_len4:
00C058  1  AD 20 07       lda cmd_buf
00C05B  1  C9 45          cmp #'E'
00C05D  1  D0 1B          bne :+
00C05F  1  AD 21 07       lda cmd_buf+1
00C062  1  C9 41          cmp #'A'
00C064  1  D0 14          bne :+
00C066  1  AD 22 07       lda cmd_buf+2
00C069  1  C9 53          cmp #'S'
00C06B  1  D0 0D          bne :+
00C06D  1  AD 23 07       lda cmd_buf+3
00C070  1  C9 54          cmp #'T'
00C072  1  D0 06          bne :+
00C074  1  A9 2B          lda #43
00C076  1  8D 01 07       sta target_verb
00C079  1  60             rts
00C07A  1               :
00C07A  1  AD 20 07       lda cmd_buf
00C07D  1  C9 57          cmp #'W'
00C07F  1  D0 1B          bne :+
00C081  1  AD 21 07       lda cmd_buf+1
00C084  1  C9 45          cmp #'E'
00C086  1  D0 14          bne :+
00C088  1  AD 22 07       lda cmd_buf+2
00C08B  1  C9 53          cmp #'S'
00C08D  1  D0 0D          bne :+
00C08F  1  AD 23 07       lda cmd_buf+3
00C092  1  C9 54          cmp #'T'
00C094  1  D0 06          bne :+
00C096  1  A9 2C          lda #44
00C098  1  8D 01 07       sta target_verb
00C09B  1  60             rts
00C09C  1               :
00C09C  1  AD 20 07       lda cmd_buf
00C09F  1  C9 44          cmp #'D'
00C0A1  1  D0 1B          bne :+
00C0A3  1  AD 21 07       lda cmd_buf+1
00C0A6  1  C9 4F          cmp #'O'
00C0A8  1  D0 14          bne :+
00C0AA  1  AD 22 07       lda cmd_buf+2
00C0AD  1  C9 57          cmp #'W'
00C0AF  1  D0 0D          bne :+
00C0B1  1  AD 23 07       lda cmd_buf+3
00C0B4  1  C9 4E          cmp #'N'
00C0B6  1  D0 06          bne :+
00C0B8  1  A9 1E          lda #30
00C0BA  1  8D 01 07       sta target_verb
00C0BD  1  60             rts
00C0BE  1               :
00C0BE  1  AD 20 07       lda cmd_buf
00C0C1  1  C9 4C          cmp #'L'
00C0C3  1  D0 1B          bne :+
00C0C5  1  AD 21 07       lda cmd_buf+1
00C0C8  1  C9 45          cmp #'E'
00C0CA  1  D0 14          bne :+
00C0CC  1  AD 22 07       lda cmd_buf+2
00C0CF  1  C9 46          cmp #'F'
00C0D1  1  D0 0D          bne :+
00C0D3  1  AD 23 07       lda cmd_buf+3
00C0D6  1  C9 54          cmp #'T'
00C0D8  1  D0 06          bne :+
00C0DA  1  A9 2C          lda #44
00C0DC  1  8D 01 07       sta target_verb
00C0DF  1  60             rts
00C0E0  1               :
00C0E0  1  AD 20 07       lda cmd_buf
00C0E3  1  C9 57          cmp #'W'
00C0E5  1  D0 1B          bne :+
00C0E7  1  AD 21 07       lda cmd_buf+1
00C0EA  1  C9 45          cmp #'E'
00C0EC  1  D0 14          bne :+
00C0EE  1  AD 22 07       lda cmd_buf+2
00C0F1  1  C9 4C          cmp #'L'
00C0F3  1  D0 0D          bne :+
00C0F5  1  AD 23 07       lda cmd_buf+3
00C0F8  1  C9 4C          cmp #'L'
00C0FA  1  D0 06          bne :+
00C0FC  1  A9 0C          lda #12
00C0FE  1  8D 01 07       sta target_verb
00C101  1  60             rts
00C102  1               :
00C102  1  AD 20 07       lda cmd_buf
00C105  1  C9 48          cmp #'H'
00C107  1  D0 1B          bne :+
00C109  1  AD 21 07       lda cmd_buf+1
00C10C  1  C9 4F          cmp #'O'
00C10E  1  D0 14          bne :+
00C110  1  AD 22 07       lda cmd_buf+2
00C113  1  C9 4D          cmp #'M'
00C115  1  D0 0D          bne :+
00C117  1  AD 23 07       lda cmd_buf+3
00C11A  1  C9 45          cmp #'E'
00C11C  1  D0 06          bne :+
00C11E  1  A9 0C          lda #12
00C120  1  8D 01 07       sta target_verb
00C123  1  60             rts
00C124  1               :
00C124  1  AD 20 07       lda cmd_buf
00C127  1  C9 47          cmp #'G'
00C129  1  D0 1B          bne :+
00C12B  1  AD 21 07       lda cmd_buf+1
00C12E  1  C9 41          cmp #'A'
00C130  1  D0 14          bne :+
00C132  1  AD 22 07       lda cmd_buf+2
00C135  1  C9 54          cmp #'T'
00C137  1  D0 0D          bne :+
00C139  1  AD 23 07       lda cmd_buf+3
00C13C  1  C9 45          cmp #'E'
00C13E  1  D0 06          bne :+
00C140  1  A9 3F          lda #63
00C142  1  8D 01 07       sta target_verb
00C145  1  60             rts
00C146  1               :
00C146  1  AD 20 07       lda cmd_buf
00C149  1  C9 52          cmp #'R'
00C14B  1  D0 1B          bne :+
00C14D  1  AD 21 07       lda cmd_buf+1
00C150  1  C9 4F          cmp #'O'
00C152  1  D0 14          bne :+
00C154  1  AD 22 07       lda cmd_buf+2
00C157  1  C9 41          cmp #'A'
00C159  1  D0 0D          bne :+
00C15B  1  AD 23 07       lda cmd_buf+3
00C15E  1  C9 44          cmp #'D'
00C160  1  D0 06          bne :+
00C162  1  A9 02          lda #2
00C164  1  8D 01 07       sta target_verb
00C167  1  60             rts
00C168  1               :
00C168  1  AD 20 07       lda cmd_buf
00C16B  1  C9 42          cmp #'B'
00C16D  1  D0 1B          bne :+
00C16F  1  AD 21 07       lda cmd_buf+1
00C172  1  C9 41          cmp #'A'
00C174  1  D0 14          bne :+
00C176  1  AD 22 07       lda cmd_buf+2
00C179  1  C9 43          cmp #'C'
00C17B  1  D0 0D          bne :+
00C17D  1  AD 23 07       lda cmd_buf+3
00C180  1  C9 4B          cmp #'K'
00C182  1  D0 06          bne :+
00C184  1  A9 08          lda #8
00C186  1  8D 01 07       sta target_verb
00C189  1  60             rts
00C18A  1               :
00C18A  1  AD 20 07       lda cmd_buf
00C18D  1  C9 45          cmp #'E'
00C18F  1  D0 1B          bne :+
00C191  1  AD 21 07       lda cmd_buf+1
00C194  1  C9 58          cmp #'X'
00C196  1  D0 14          bne :+
00C198  1  AD 22 07       lda cmd_buf+2
00C19B  1  C9 49          cmp #'I'
00C19D  1  D0 0D          bne :+
00C19F  1  AD 23 07       lda cmd_buf+3
00C1A2  1  C9 54          cmp #'T'
00C1A4  1  D0 06          bne :+
00C1A6  1  A9 0B          lda #11
00C1A8  1  8D 01 07       sta target_verb
00C1AB  1  60             rts
00C1AC  1               :
00C1AC  1  AD 20 07       lda cmd_buf
00C1AF  1  C9 4A          cmp #'J'
00C1B1  1  D0 1B          bne _dm_len4_no
00C1B3  1  AD 21 07       lda cmd_buf+1
00C1B6  1  C9 55          cmp #'U'
00C1B8  1  D0 14          bne _dm_len4_no
00C1BA  1  AD 22 07       lda cmd_buf+2
00C1BD  1  C9 4D          cmp #'M'
00C1BF  1  D0 0D          bne _dm_len4_no
00C1C1  1  AD 23 07       lda cmd_buf+3
00C1C4  1  C9 50          cmp #'P'
00C1C6  1  D0 06          bne _dm_len4_no
00C1C8  1  A9 27          lda #39
00C1CA  1  8D 01 07       sta target_verb
00C1CD  1  60             rts
00C1CE  1               _dm_len4_no:
00C1CE  1  60             rts
00C1CF  1               
00C1CF  1               _dm_len5:
00C1CF  1  AD 20 07       lda cmd_buf
00C1D2  1  C9 4E          cmp #'N'
00C1D4  1  D0 22          bne :+
00C1D6  1  AD 21 07       lda cmd_buf+1
00C1D9  1  C9 4F          cmp #'O'
00C1DB  1  D0 1B          bne :+
00C1DD  1  AD 22 07       lda cmd_buf+2
00C1E0  1  C9 52          cmp #'R'
00C1E2  1  D0 14          bne :+
00C1E4  1  AD 23 07       lda cmd_buf+3
00C1E7  1  C9 54          cmp #'T'
00C1E9  1  D0 0D          bne :+
00C1EB  1  AD 24 07       lda cmd_buf+4
00C1EE  1  C9 48          cmp #'H'
00C1F0  1  D0 06          bne :+
00C1F2  1  A9 2D          lda #45
00C1F4  1  8D 01 07       sta target_verb
00C1F7  1  60             rts
00C1F8  1               :
00C1F8  1  AD 20 07       lda cmd_buf
00C1FB  1  C9 53          cmp #'S'
00C1FD  1  D0 22          bne :+
00C1FF  1  AD 21 07       lda cmd_buf+1
00C202  1  C9 4F          cmp #'O'
00C204  1  D0 1B          bne :+
00C206  1  AD 22 07       lda cmd_buf+2
00C209  1  C9 55          cmp #'U'
00C20B  1  D0 14          bne :+
00C20D  1  AD 23 07       lda cmd_buf+3
00C210  1  C9 54          cmp #'T'
00C212  1  D0 0D          bne :+
00C214  1  AD 24 07       lda cmd_buf+4
00C217  1  C9 48          cmp #'H'
00C219  1  D0 06          bne :+
00C21B  1  A9 2E          lda #46
00C21D  1  8D 01 07       sta target_verb
00C220  1  60             rts
00C221  1               :
00C221  1  AD 20 07       lda cmd_buf
00C224  1  C9 52          cmp #'R'
00C226  1  D0 22          bne :+
00C228  1  AD 21 07       lda cmd_buf+1
00C22B  1  C9 49          cmp #'I'
00C22D  1  D0 1B          bne :+
00C22F  1  AD 22 07       lda cmd_buf+2
00C232  1  C9 47          cmp #'G'
00C234  1  D0 14          bne :+
00C236  1  AD 23 07       lda cmd_buf+3
00C239  1  C9 48          cmp #'H'
00C23B  1  D0 0D          bne :+
00C23D  1  AD 24 07       lda cmd_buf+4
00C240  1  C9 54          cmp #'T'
00C242  1  D0 06          bne :+
00C244  1  A9 25          lda #37
00C246  1  8D 01 07       sta target_verb
00C249  1  60             rts
00C24A  1               :
00C24A  1  AD 20 07       lda cmd_buf
00C24D  1  C9 45          cmp #'E'
00C24F  1  D0 22          bne :+
00C251  1  AD 21 07       lda cmd_buf+1
00C254  1  C9 4E          cmp #'N'
00C256  1  D0 1B          bne :+
00C258  1  AD 22 07       lda cmd_buf+2
00C25B  1  C9 54          cmp #'T'
00C25D  1  D0 14          bne :+
00C25F  1  AD 23 07       lda cmd_buf+3
00C262  1  C9 45          cmp #'E'
00C264  1  D0 0D          bne :+
00C266  1  AD 24 07       lda cmd_buf+4
00C269  1  C9 52          cmp #'R'
00C26B  1  D0 06          bne :+
00C26D  1  A9 03          lda #3
00C26F  1  8D 01 07       sta target_verb
00C272  1  60             rts
00C273  1               :
00C273  1  AD 20 07       lda cmd_buf
00C276  1  C9 58          cmp #'X'
00C278  1  D0 22          bne :+
00C27A  1  AD 21 07       lda cmd_buf+1
00C27D  1  C9 59          cmp #'Y'
00C27F  1  D0 1B          bne :+
00C281  1  AD 22 07       lda cmd_buf+2
00C284  1  C9 5A          cmp #'Z'
00C286  1  D0 14          bne :+
00C288  1  AD 23 07       lda cmd_buf+3
00C28B  1  C9 5A          cmp #'Z'
00C28D  1  D0 0D          bne :+
00C28F  1  AD 24 07       lda cmd_buf+4
00C292  1  C9 59          cmp #'Y'
00C294  1  D0 06          bne :+
00C296  1  A9 3E          lda #62
00C298  1  8D 01 07       sta target_verb
00C29B  1  60             rts
00C29C  1               :
00C29C  1  AD 20 07       lda cmd_buf
00C29F  1  C9 50          cmp #'P'
00C2A1  1  D0 22          bne :+
00C2A3  1  AD 21 07       lda cmd_buf+1
00C2A6  1  C9 4C          cmp #'L'
00C2A8  1  D0 1B          bne :+
00C2AA  1  AD 22 07       lda cmd_buf+2
00C2AD  1  C9 55          cmp #'U'
00C2AF  1  D0 14          bne :+
00C2B1  1  AD 23 07       lda cmd_buf+3
00C2B4  1  C9 47          cmp #'G'
00C2B6  1  D0 0D          bne :+
00C2B8  1  AD 24 07       lda cmd_buf+4
00C2BB  1  C9 48          cmp #'H'
00C2BD  1  D0 06          bne :+
00C2BF  1  A9 41          lda #65
00C2C1  1  8D 01 07       sta target_verb
00C2C4  1  60             rts
00C2C5  1               :
00C2C5  1  AD 20 07       lda cmd_buf
00C2C8  1  C9 48          cmp #'H'
00C2CA  1  D0 22          bne :+
00C2CC  1  AD 21 07       lda cmd_buf+1
00C2CF  1  C9 4F          cmp #'O'
00C2D1  1  D0 1B          bne :+
00C2D3  1  AD 22 07       lda cmd_buf+2
00C2D6  1  C9 55          cmp #'U'
00C2D8  1  D0 14          bne :+
00C2DA  1  AD 23 07       lda cmd_buf+3
00C2DD  1  C9 53          cmp #'S'
00C2DF  1  D0 0D          bne :+
00C2E1  1  AD 24 07       lda cmd_buf+4
00C2E4  1  C9 45          cmp #'E'
00C2E6  1  D0 06          bne :+
00C2E8  1  A9 0C          lda #12
00C2EA  1  8D 01 07       sta target_verb
00C2ED  1  60             rts
00C2EE  1               :
00C2EE  1  AD 20 07       lda cmd_buf
00C2F1  1  C9 47          cmp #'G'
00C2F3  1  D0 22          bne :+
00C2F5  1  AD 21 07       lda cmd_buf+1
00C2F8  1  C9 52          cmp #'R'
00C2FA  1  D0 1B          bne :+
00C2FC  1  AD 22 07       lda cmd_buf+2
00C2FF  1  C9 41          cmp #'A'
00C301  1  D0 14          bne :+
00C303  1  AD 23 07       lda cmd_buf+3
00C306  1  C9 54          cmp #'T'
00C308  1  D0 0D          bne :+
00C30A  1  AD 24 07       lda cmd_buf+4
00C30D  1  C9 45          cmp #'E'
00C30F  1  D0 06          bne :+
00C311  1  A9 3F          lda #63
00C313  1  8D 01 07       sta target_verb
00C316  1  60             rts
00C317  1               :
00C317  1  AD 20 07       lda cmd_buf
00C31A  1  C9 53          cmp #'S'
00C31C  1  D0 22          bne :+
00C31E  1  AD 21 07       lda cmd_buf+1
00C321  1  C9 48          cmp #'H'
00C323  1  D0 1B          bne :+
00C325  1  AD 22 07       lda cmd_buf+2
00C328  1  C9 41          cmp #'A'
00C32A  1  D0 14          bne :+
00C32C  1  AD 23 07       lda cmd_buf+3
00C32F  1  C9 43          cmp #'C'
00C331  1  D0 0D          bne :+
00C333  1  AD 24 07       lda cmd_buf+4
00C336  1  C9 4B          cmp #'K'
00C338  1  D0 06          bne :+
00C33A  1  A9 0C          lda #12
00C33C  1  8D 01 07       sta target_verb
00C33F  1  60             rts
00C340  1               :
00C340  1  AD 20 07       lda cmd_buf
00C343  1  C9 43          cmp #'C'
00C345  1  D0 22          bne _dm_len5_no
00C347  1  AD 21 07       lda cmd_buf+1
00C34A  1  C9 52          cmp #'R'
00C34C  1  D0 1B          bne _dm_len5_no
00C34E  1  AD 22 07       lda cmd_buf+2
00C351  1  C9 41          cmp #'A'
00C353  1  D0 14          bne _dm_len5_no
00C355  1  AD 23 07       lda cmd_buf+3
00C358  1  C9 57          cmp #'W'
00C35A  1  D0 0D          bne _dm_len5_no
00C35C  1  AD 24 07       lda cmd_buf+4
00C35F  1  C9 4C          cmp #'L'
00C361  1  D0 06          bne _dm_len5_no
00C363  1  A9 11          lda #17
00C365  1  8D 01 07       sta target_verb
00C368  1  60             rts
00C369  1               _dm_len5_no:
00C369  1  60             rts
00C36A  1               
00C36A  1               _dm_len6:
00C36A  1  AD 20 07       lda cmd_buf
00C36D  1  C9 46          cmp #'F'
00C36F  1  D0 29          bne :+
00C371  1  AD 21 07       lda cmd_buf+1
00C374  1  C9 4F          cmp #'O'
00C376  1  D0 22          bne :+
00C378  1  AD 22 07       lda cmd_buf+2
00C37B  1  C9 52          cmp #'R'
00C37D  1  D0 1B          bne :+
00C37F  1  AD 23 07       lda cmd_buf+3
00C382  1  C9 45          cmp #'E'
00C384  1  D0 14          bne :+
00C386  1  AD 24 07       lda cmd_buf+4
00C389  1  C9 53          cmp #'S'
00C38B  1  D0 0D          bne :+
00C38D  1  AD 25 07       lda cmd_buf+5
00C390  1  C9 54          cmp #'T'
00C392  1  D0 06          bne :+
00C394  1  A9 06          lda #6
00C396  1  8D 01 07       sta target_verb
00C399  1  60             rts
00C39A  1               :
00C39A  1  AD 20 07       lda cmd_buf
00C39D  1  C9 49          cmp #'I'
00C39F  1  D0 29          bne :+
00C3A1  1  AD 21 07       lda cmd_buf+1
00C3A4  1  C9 4E          cmp #'N'
00C3A6  1  D0 22          bne :+
00C3A8  1  AD 22 07       lda cmd_buf+2
00C3AB  1  C9 53          cmp #'S'
00C3AD  1  D0 1B          bne :+
00C3AF  1  AD 23 07       lda cmd_buf+3
00C3B2  1  C9 49          cmp #'I'
00C3B4  1  D0 14          bne :+
00C3B6  1  AD 24 07       lda cmd_buf+4
00C3B9  1  C9 44          cmp #'D'
00C3BB  1  D0 0D          bne :+
00C3BD  1  AD 25 07       lda cmd_buf+5
00C3C0  1  C9 45          cmp #'E'
00C3C2  1  D0 06          bne :+
00C3C4  1  A9 13          lda #19
00C3C6  1  8D 01 07       sta target_verb
00C3C9  1  60             rts
00C3CA  1               :
00C3CA  1  AD 20 07       lda cmd_buf
00C3CD  1  C9 50          cmp #'P'
00C3CF  1  D0 29          bne :+
00C3D1  1  AD 21 07       lda cmd_buf+1
00C3D4  1  C9 4C          cmp #'L'
00C3D6  1  D0 22          bne :+
00C3D8  1  AD 22 07       lda cmd_buf+2
00C3DB  1  C9 4F          cmp #'O'
00C3DD  1  D0 1B          bne :+
00C3DF  1  AD 23 07       lda cmd_buf+3
00C3E2  1  C9 56          cmp #'V'
00C3E4  1  D0 14          bne :+
00C3E6  1  AD 24 07       lda cmd_buf+4
00C3E9  1  C9 45          cmp #'E'
00C3EB  1  D0 0D          bne :+
00C3ED  1  AD 25 07       lda cmd_buf+5
00C3F0  1  C9 52          cmp #'R'
00C3F2  1  D0 06          bne :+
00C3F4  1  A9 47          lda #71
00C3F6  1  8D 01 07       sta target_verb
00C3F9  1  60             rts
00C3FA  1               :
00C3FA  1  AD 20 07       lda cmd_buf
00C3FD  1  C9 52          cmp #'R'
00C3FF  1  D0 29          bne :+
00C401  1  AD 21 07       lda cmd_buf+1
00C404  1  C9 45          cmp #'E'
00C406  1  D0 22          bne :+
00C408  1  AD 22 07       lda cmd_buf+2
00C40B  1  C9 54          cmp #'T'
00C40D  1  D0 1B          bne :+
00C40F  1  AD 23 07       lda cmd_buf+3
00C412  1  C9 55          cmp #'U'
00C414  1  D0 14          bne :+
00C416  1  AD 24 07       lda cmd_buf+4
00C419  1  C9 52          cmp #'R'
00C41B  1  D0 0D          bne :+
00C41D  1  AD 25 07       lda cmd_buf+5
00C420  1  C9 4E          cmp #'N'
00C422  1  D0 06          bne :+
00C424  1  A9 08          lda #8
00C426  1  8D 01 07       sta target_verb
00C429  1  60             rts
00C42A  1               :
00C42A  1  AD 20 07       lda cmd_buf
00C42D  1  C9 56          cmp #'V'
00C42F  1  D0 29          bne :+
00C431  1  AD 21 07       lda cmd_buf+1
00C434  1  C9 41          cmp #'A'
00C436  1  D0 22          bne :+
00C438  1  AD 22 07       lda cmd_buf+2
00C43B  1  C9 4C          cmp #'L'
00C43D  1  D0 1B          bne :+
00C43F  1  AD 23 07       lda cmd_buf+3
00C442  1  C9 4C          cmp #'L'
00C444  1  D0 14          bne :+
00C446  1  AD 24 07       lda cmd_buf+4
00C449  1  C9 45          cmp #'E'
00C44B  1  D0 0D          bne :+
00C44D  1  AD 25 07       lda cmd_buf+5
00C450  1  C9 59          cmp #'Y'
00C452  1  D0 06          bne :+
00C454  1  A9 09          lda #9
00C456  1  8D 01 07       sta target_verb
00C459  1  60             rts
00C45A  1               :
00C45A  1  AD 20 07       lda cmd_buf
00C45D  1  C9 47          cmp #'G'
00C45F  1  D0 22          bne :+
00C461  1  AD 21 07       lda cmd_buf+1
00C464  1  C9 55          cmp #'U'
00C466  1  D0 1B          bne :+
00C468  1  AD 22 07       lda cmd_buf+2
00C46B  1  C9 4C          cmp #'L'
00C46D  1  D0 14          bne :+
00C46F  1  AD 23 07       lda cmd_buf+3
00C472  1  C9 4C          cmp #'L'
00C474  1  D0 0D          bne :+
00C476  1  AD 24 07       lda cmd_buf+4
00C479  1  C9 59          cmp #'Y'
00C47B  1  D0 06          bne :+
00C47D  1  A9 0D          lda #13
00C47F  1  8D 01 07       sta target_verb
00C482  1  60             rts
00C483  1               :
00C483  1  AD 20 07       lda cmd_buf
00C486  1  C9 49          cmp #'I'
00C488  1  D0 29          bne :+
00C48A  1  AD 21 07       lda cmd_buf+1
00C48D  1  C9 4E          cmp #'N'
00C48F  1  D0 22          bne :+
00C491  1  AD 22 07       lda cmd_buf+2
00C494  1  C9 57          cmp #'W'
00C496  1  D0 1B          bne :+
00C498  1  AD 23 07       lda cmd_buf+3
00C49B  1  C9 41          cmp #'A'
00C49D  1  D0 14          bne :+
00C49F  1  AD 24 07       lda cmd_buf+4
00C4A2  1  C9 52          cmp #'R'
00C4A4  1  D0 0D          bne :+
00C4A6  1  AD 25 07       lda cmd_buf+5
00C4A9  1  C9 44          cmp #'D'
00C4AB  1  D0 06          bne :+
00C4AD  1  A9 13          lda #19
00C4AF  1  8D 01 07       sta target_verb
00C4B2  1  60             rts
00C4B3  1               :
00C4B3  1  AD 20 07       lda cmd_buf
00C4B6  1  C9 4F          cmp #'O'
00C4B8  1  D0 29          bne :+
00C4BA  1  AD 21 07       lda cmd_buf+1
00C4BD  1  C9 4E          cmp #'N'
00C4BF  1  D0 22          bne :+
00C4C1  1  AD 22 07       lda cmd_buf+2
00C4C4  1  C9 57          cmp #'W'
00C4C6  1  D0 1B          bne :+
00C4C8  1  AD 23 07       lda cmd_buf+3
00C4CB  1  C9 41          cmp #'A'
00C4CD  1  D0 14          bne :+
00C4CF  1  AD 24 07       lda cmd_buf+4
00C4D2  1  C9 52          cmp #'R'
00C4D4  1  D0 0D          bne :+
00C4D6  1  AD 25 07       lda cmd_buf+5
00C4D9  1  C9 44          cmp #'D'
00C4DB  1  D0 06          bne :+
00C4DD  1  A9 07          lda #7
00C4DF  1  8D 01 07       sta target_verb
00C4E2  1  60             rts
00C4E3  1               :
00C4E3  1  AD 20 07       lda cmd_buf
00C4E6  1  C9 55          cmp #'U'
00C4E8  1  D0 29          bne :+
00C4EA  1  AD 21 07       lda cmd_buf+1
00C4ED  1  C9 50          cmp #'P'
00C4EF  1  D0 22          bne :+
00C4F1  1  AD 22 07       lda cmd_buf+2
00C4F4  1  C9 57          cmp #'W'
00C4F6  1  D0 1B          bne :+
00C4F8  1  AD 23 07       lda cmd_buf+3
00C4FB  1  C9 41          cmp #'A'
00C4FD  1  D0 14          bne :+
00C4FF  1  AD 24 07       lda cmd_buf+4
00C502  1  C9 52          cmp #'R'
00C504  1  D0 0D          bne :+
00C506  1  AD 25 07       lda cmd_buf+5
00C509  1  C9 44          cmp #'D'
00C50B  1  D0 06          bne :+
00C50D  1  A9 1D          lda #29
00C50F  1  8D 01 07       sta target_verb
00C512  1  60             rts
00C513  1               :
00C513  1  AD 20 07       lda cmd_buf
00C516  1  C9 53          cmp #'S'
00C518  1  D0 29          bne _dm_len6_no
00C51A  1  AD 21 07       lda cmd_buf+1
00C51D  1  C9 54          cmp #'T'
00C51F  1  D0 22          bne _dm_len6_no
00C521  1  AD 22 07       lda cmd_buf+2
00C524  1  C9 52          cmp #'R'
00C526  1  D0 1B          bne _dm_len6_no
00C528  1  AD 23 07       lda cmd_buf+3
00C52B  1  C9 45          cmp #'E'
00C52D  1  D0 14          bne _dm_len6_no
00C52F  1  AD 24 07       lda cmd_buf+4
00C532  1  C9 41          cmp #'A'
00C534  1  D0 0D          bne _dm_len6_no
00C536  1  AD 25 07       lda cmd_buf+5
00C539  1  C9 4D          cmp #'M'
00C53B  1  D0 06          bne _dm_len6_no
00C53D  1  A9 0E          lda #14
00C53F  1  8D 01 07       sta target_verb
00C542  1  60             rts
00C543  1               _dm_len6_no:
00C543  1  60             rts
00C544  1               
00C544  1               _dm_len7:
00C544  1  AD 20 07       lda cmd_buf
00C547  1  C9 46          cmp #'F'
00C549  1  D0 30          bne :+
00C54B  1  AD 21 07       lda cmd_buf+1
00C54E  1  C9 4F          cmp #'O'
00C550  1  D0 29          bne :+
00C552  1  AD 22 07       lda cmd_buf+2
00C555  1  C9 52          cmp #'R'
00C557  1  D0 22          bne :+
00C559  1  AD 23 07       lda cmd_buf+3
00C55C  1  C9 57          cmp #'W'
00C55E  1  D0 1B          bne :+
00C560  1  AD 24 07       lda cmd_buf+4
00C563  1  C9 41          cmp #'A'
00C565  1  D0 14          bne :+
00C567  1  AD 25 07       lda cmd_buf+5
00C56A  1  C9 52          cmp #'R'
00C56C  1  D0 0D          bne :+
00C56E  1  AD 26 07       lda cmd_buf+6
00C571  1  C9 44          cmp #'D'
00C573  1  D0 06          bne :+
00C575  1  A9 07          lda #7
00C577  1  8D 01 07       sta target_verb
00C57A  1  60             rts
00C57B  1               :
00C57B  1  AD 20 07       lda cmd_buf
00C57E  1  C9 52          cmp #'R'
00C580  1  D0 30          bne :+
00C582  1  AD 21 07       lda cmd_buf+1
00C585  1  C9 45          cmp #'E'
00C587  1  D0 29          bne :+
00C589  1  AD 22 07       lda cmd_buf+2
00C58C  1  C9 54          cmp #'T'
00C58E  1  D0 22          bne :+
00C590  1  AD 23 07       lda cmd_buf+3
00C593  1  C9 52          cmp #'R'
00C595  1  D0 1B          bne :+
00C597  1  AD 24 07       lda cmd_buf+4
00C59A  1  C9 45          cmp #'E'
00C59C  1  D0 14          bne :+
00C59E  1  AD 25 07       lda cmd_buf+5
00C5A1  1  C9 41          cmp #'A'
00C5A3  1  D0 0D          bne :+
00C5A5  1  AD 26 07       lda cmd_buf+6
00C5A8  1  C9 54          cmp #'T'
00C5AA  1  D0 06          bne :+
00C5AC  1  A9 08          lda #8
00C5AE  1  8D 01 07       sta target_verb
00C5B1  1  60             rts
00C5B2  1               :
00C5B2  1  AD 20 07       lda cmd_buf
00C5B5  1  C9 52          cmp #'R'
00C5B7  1  D0 29          bne :+
00C5B9  1  AD 21 07       lda cmd_buf+1
00C5BC  1  C9 45          cmp #'E'
00C5BE  1  D0 22          bne :+
00C5C0  1  AD 22 07       lda cmd_buf+2
00C5C3  1  C9 54          cmp #'T'
00C5C5  1  D0 1B          bne :+
00C5C7  1  AD 23 07       lda cmd_buf+3
00C5CA  1  C9 55          cmp #'U'
00C5CC  1  D0 14          bne :+
00C5CE  1  AD 24 07       lda cmd_buf+4
00C5D1  1  C9 52          cmp #'R'
00C5D3  1  D0 0D          bne :+
00C5D5  1  AD 25 07       lda cmd_buf+5
00C5D8  1  C9 4E          cmp #'N'
00C5DA  1  D0 06          bne :+
00C5DC  1  A9 08          lda #8
00C5DE  1  8D 01 07       sta target_verb
00C5E1  1  60             rts
00C5E2  1               :
00C5E2  1  AD 20 07       lda cmd_buf
00C5E5  1  C9 4F          cmp #'O'
00C5E7  1  D0 30          bne _dm_len7_no
00C5E9  1  AD 21 07       lda cmd_buf+1
00C5EC  1  C9 55          cmp #'U'
00C5EE  1  D0 29          bne _dm_len7_no
00C5F0  1  AD 22 07       lda cmd_buf+2
00C5F3  1  C9 54          cmp #'T'
00C5F5  1  D0 22          bne _dm_len7_no
00C5F7  1  AD 23 07       lda cmd_buf+3
00C5FA  1  C9 53          cmp #'S'
00C5FC  1  D0 1B          bne _dm_len7_no
00C5FE  1  AD 24 07       lda cmd_buf+4
00C601  1  C9 49          cmp #'I'
00C603  1  D0 14          bne _dm_len7_no
00C605  1  AD 25 07       lda cmd_buf+5
00C608  1  C9 44          cmp #'D'
00C60A  1  D0 0D          bne _dm_len7_no
00C60C  1  AD 26 07       lda cmd_buf+6
00C60F  1  C9 45          cmp #'E'
00C611  1  D0 06          bne _dm_len7_no
00C613  1  A9 0B          lda #11
00C615  1  8D 01 07       sta target_verb
00C618  1  60             rts
00C619  1               _dm_len7_no:
00C619  1  60             rts
00C61A  1               
00C61A  1               _dm_len8:
00C61A  1  AD 20 07       lda cmd_buf
00C61D  1  C9 4F          cmp #'O'
00C61F  1  D0 37          bne :+
00C621  1  AD 21 07       lda cmd_buf+1
00C624  1  C9 55          cmp #'U'
00C626  1  D0 30          bne :+
00C628  1  AD 22 07       lda cmd_buf+2
00C62B  1  C9 54          cmp #'T'
00C62D  1  D0 29          bne :+
00C62F  1  AD 23 07       lda cmd_buf+3
00C632  1  C9 44          cmp #'D'
00C634  1  D0 22          bne :+
00C636  1  AD 24 07       lda cmd_buf+4
00C639  1  C9 4F          cmp #'O'
00C63B  1  D0 1B          bne :+
00C63D  1  AD 25 07       lda cmd_buf+5
00C640  1  C9 4F          cmp #'O'
00C642  1  D0 14          bne :+
00C644  1  AD 26 07       lda cmd_buf+6
00C647  1  C9 52          cmp #'R'
00C649  1  D0 0D          bne :+
00C64B  1  AD 27 07       lda cmd_buf+7
00C64E  1  C9 53          cmp #'S'
00C650  1  D0 06          bne :+
00C652  1  A9 20          lda #32
00C654  1  8D 01 07       sta target_verb
00C657  1  60             rts
00C658  1               :
00C658  1  AD 20 07       lda cmd_buf
00C65B  1  C9 45          cmp #'E'
00C65D  1  D0 37          bne :+
00C65F  1  AD 21 07       lda cmd_buf+1
00C662  1  C9 4E          cmp #'N'
00C664  1  D0 30          bne :+
00C666  1  AD 22 07       lda cmd_buf+2
00C669  1  C9 54          cmp #'T'
00C66B  1  D0 29          bne :+
00C66D  1  AD 23 07       lda cmd_buf+3
00C670  1  C9 52          cmp #'R'
00C672  1  D0 22          bne :+
00C674  1  AD 24 07       lda cmd_buf+4
00C677  1  C9 41          cmp #'A'
00C679  1  D0 1B          bne :+
00C67B  1  AD 25 07       lda cmd_buf+5
00C67E  1  C9 4E          cmp #'N'
00C680  1  D0 14          bne :+
00C682  1  AD 26 07       lda cmd_buf+6
00C685  1  C9 43          cmp #'C'
00C687  1  D0 0D          bne :+
00C689  1  AD 27 07       lda cmd_buf+7
00C68C  1  C9 45          cmp #'E'
00C68E  1  D0 06          bne :+
00C690  1  A9 40          lda #64
00C692  1  8D 01 07       sta target_verb
00C695  1  60             rts
00C696  1               :
00C696  1  AD 20 07       lda cmd_buf
00C699  1  C9 55          cmp #'U'
00C69B  1  D0 37          bne :+
00C69D  1  AD 21 07       lda cmd_buf+1
00C6A0  1  C9 50          cmp #'P'
00C6A2  1  D0 30          bne :+
00C6A4  1  AD 22 07       lda cmd_buf+2
00C6A7  1  C9 53          cmp #'S'
00C6A9  1  D0 29          bne :+
00C6AB  1  AD 23 07       lda cmd_buf+3
00C6AE  1  C9 54          cmp #'T'
00C6B0  1  D0 22          bne :+
00C6B2  1  AD 24 07       lda cmd_buf+4
00C6B5  1  C9 52          cmp #'R'
00C6B7  1  D0 1B          bne :+
00C6B9  1  AD 25 07       lda cmd_buf+5
00C6BC  1  C9 45          cmp #'E'
00C6BE  1  D0 14          bne :+
00C6C0  1  AD 26 07       lda cmd_buf+6
00C6C3  1  C9 41          cmp #'A'
00C6C5  1  D0 0D          bne :+
00C6C7  1  AD 27 07       lda cmd_buf+7
00C6CA  1  C9 4D          cmp #'M'
00C6CC  1  D0 06          bne :+
00C6CE  1  A9 04          lda #4
00C6D0  1  8D 01 07       sta target_verb
00C6D3  1  60             rts
00C6D4  1               :
00C6D4  1  AD 20 07       lda cmd_buf
00C6D7  1  C9 42          cmp #'B'
00C6D9  1  D0 37          bne _dm_len8_no
00C6DB  1  AD 21 07       lda cmd_buf+1
00C6DE  1  C9 55          cmp #'U'
00C6E0  1  D0 30          bne _dm_len8_no
00C6E2  1  AD 22 07       lda cmd_buf+2
00C6E5  1  C9 49          cmp #'I'
00C6E7  1  D0 29          bne _dm_len8_no
00C6E9  1  AD 23 07       lda cmd_buf+3
00C6EC  1  C9 4C          cmp #'L'
00C6EE  1  D0 22          bne _dm_len8_no
00C6F0  1  AD 24 07       lda cmd_buf+4
00C6F3  1  C9 44          cmp #'D'
00C6F5  1  D0 1B          bne _dm_len8_no
00C6F7  1  AD 25 07       lda cmd_buf+5
00C6FA  1  C9 49          cmp #'I'
00C6FC  1  D0 14          bne _dm_len8_no
00C6FE  1  AD 26 07       lda cmd_buf+6
00C701  1  C9 4E          cmp #'N'
00C703  1  D0 0D          bne _dm_len8_no
00C705  1  AD 27 07       lda cmd_buf+7
00C708  1  C9 47          cmp #'G'
00C70A  1  D0 06          bne _dm_len8_no
00C70C  1  A9 0C          lda #12
00C70E  1  8D 01 07       sta target_verb
00C711  1  60             rts
00C712  1               _dm_len8_no:
00C712  1  60             rts
00C713  1               
00C713  1               _dm_len9:
00C713  1                 ; NORTHEAST / NORTHWEST / SOUTHEAST / SOUTHWEST
00C713  1  AD 20 07       lda cmd_buf
00C716  1  C9 4E          cmp #'N'
00C718  1  D0 60          bne _dm_len9_se
00C71A  1  AD 21 07       lda cmd_buf+1
00C71D  1  C9 4F          cmp #'O'
00C71F  1  D0 59          bne _dm_len9_se
00C721  1  AD 22 07       lda cmd_buf+2
00C724  1  C9 52          cmp #'R'
00C726  1  D0 52          bne _dm_len9_se
00C728  1  AD 23 07       lda cmd_buf+3
00C72B  1  C9 54          cmp #'T'
00C72D  1  D0 4B          bne _dm_len9_se
00C72F  1  AD 24 07       lda cmd_buf+4
00C732  1  C9 48          cmp #'H'
00C734  1  D0 44          bne _dm_len9_se
00C736  1  AD 25 07       lda cmd_buf+5
00C739  1  C9 45          cmp #'E'
00C73B  1  F0 07          beq _dm_len9_ne
00C73D  1  C9 57          cmp #'W'
00C73F  1  F0 1E          beq _dm_len9_nw
00C741  1  4C 7A C7       jmp _dm_len9_se
00C744  1               _dm_len9_ne:
00C744  1  AD 26 07       lda cmd_buf+6
00C747  1  C9 41          cmp #'A'
00C749  1  D0 2F          bne _dm_len9_se
00C74B  1  AD 27 07       lda cmd_buf+7
00C74E  1  C9 53          cmp #'S'
00C750  1  D0 28          bne _dm_len9_se
00C752  1  AD 28 07       lda cmd_buf+8
00C755  1  C9 54          cmp #'T'
00C757  1  D0 21          bne _dm_len9_se
00C759  1  A9 2F          lda #47
00C75B  1  8D 01 07       sta target_verb
00C75E  1  60             rts
00C75F  1               _dm_len9_nw:
00C75F  1  AD 26 07       lda cmd_buf+6
00C762  1  C9 45          cmp #'E'
00C764  1  D0 14          bne _dm_len9_se
00C766  1  AD 27 07       lda cmd_buf+7
00C769  1  C9 53          cmp #'S'
00C76B  1  D0 0D          bne _dm_len9_se
00C76D  1  AD 28 07       lda cmd_buf+8
00C770  1  C9 54          cmp #'T'
00C772  1  D0 06          bne _dm_len9_se
00C774  1  A9 32          lda #50
00C776  1  8D 01 07       sta target_verb
00C779  1  60             rts
00C77A  1               _dm_len9_se:
00C77A  1  AD 20 07       lda cmd_buf
00C77D  1  C9 53          cmp #'S'
00C77F  1  D0 5F          bne _dm_len9_no
00C781  1  AD 21 07       lda cmd_buf+1
00C784  1  C9 4F          cmp #'O'
00C786  1  D0 58          bne _dm_len9_no
00C788  1  AD 22 07       lda cmd_buf+2
00C78B  1  C9 55          cmp #'U'
00C78D  1  D0 51          bne _dm_len9_no
00C78F  1  AD 23 07       lda cmd_buf+3
00C792  1  C9 54          cmp #'T'
00C794  1  D0 4A          bne _dm_len9_no
00C796  1  AD 24 07       lda cmd_buf+4
00C799  1  C9 48          cmp #'H'
00C79B  1  D0 43          bne _dm_len9_no
00C79D  1  AD 25 07       lda cmd_buf+5
00C7A0  1  C9 45          cmp #'E'
00C7A2  1  F0 06          beq _dm_len9_southeast
00C7A4  1  C9 57          cmp #'W'
00C7A6  1  F0 1D          beq _dm_len9_southwest
00C7A8  1  D0 36          bne _dm_len9_no
00C7AA  1               _dm_len9_southeast:
00C7AA  1  AD 26 07       lda cmd_buf+6
00C7AD  1  C9 41          cmp #'A'
00C7AF  1  D0 2F          bne _dm_len9_no
00C7B1  1  AD 27 07       lda cmd_buf+7
00C7B4  1  C9 53          cmp #'S'
00C7B6  1  D0 28          bne _dm_len9_no
00C7B8  1  AD 28 07       lda cmd_buf+8
00C7BB  1  C9 54          cmp #'T'
00C7BD  1  D0 21          bne _dm_len9_no
00C7BF  1  A9 30          lda #48
00C7C1  1  8D 01 07       sta target_verb
00C7C4  1  60             rts
00C7C5  1               _dm_len9_southwest:
00C7C5  1  AD 26 07       lda cmd_buf+6
00C7C8  1  C9 45          cmp #'E'
00C7CA  1  D0 14          bne _dm_len9_no
00C7CC  1  AD 27 07       lda cmd_buf+7
00C7CF  1  C9 53          cmp #'S'
00C7D1  1  D0 0D          bne _dm_len9_no
00C7D3  1  AD 28 07       lda cmd_buf+8
00C7D6  1  C9 54          cmp #'T'
00C7D8  1  D0 06          bne _dm_len9_no
00C7DA  1  A9 31          lda #49
00C7DC  1  8D 01 07       sta target_verb
00C7DF  1  60             rts
00C7E0  1               _dm_len9_no:
00C7E0  1  60             rts
00C7E1  1               
00C7E1  1               _dm_len10:
00C7E1  1  AD 20 07       lda cmd_buf
00C7E4  1  C9 44          cmp #'D'
00C7E6  1  D0 45          bne _dm_len10_dep
00C7E8  1  AD 21 07       lda cmd_buf+1
00C7EB  1  C9 4F          cmp #'O'
00C7ED  1  D0 3E          bne _dm_len10_dep
00C7EF  1  AD 22 07       lda cmd_buf+2
00C7F2  1  C9 57          cmp #'W'
00C7F4  1  D0 37          bne _dm_len10_dep
00C7F6  1  AD 23 07       lda cmd_buf+3
00C7F9  1  C9 4E          cmp #'N'
00C7FB  1  D0 30          bne _dm_len10_dep
00C7FD  1  AD 24 07       lda cmd_buf+4
00C800  1  C9 53          cmp #'S'
00C802  1  D0 29          bne _dm_len10_dep
00C804  1  AD 25 07       lda cmd_buf+5
00C807  1  C9 54          cmp #'T'
00C809  1  D0 22          bne _dm_len10_dep
00C80B  1  AD 26 07       lda cmd_buf+6
00C80E  1  C9 52          cmp #'R'
00C810  1  D0 1B          bne _dm_len10_dep
00C812  1  AD 27 07       lda cmd_buf+7
00C815  1  C9 45          cmp #'E'
00C817  1  D0 14          bne _dm_len10_dep
00C819  1  AD 28 07       lda cmd_buf+8
00C81C  1  C9 41          cmp #'A'
00C81E  1  D0 0D          bne _dm_len10_dep
00C820  1  AD 29 07       lda cmd_buf+9
00C823  1  C9 4D          cmp #'M'
00C825  1  D0 06          bne _dm_len10_dep
00C827  1  A9 04          lda #4
00C829  1  8D 01 07       sta target_verb
00C82C  1  60             rts
00C82D  1               _dm_len10_dep:
00C82D  1  AD 20 07       lda cmd_buf
00C830  1  C9 44          cmp #'D'
00C832  1  D0 45          bne _dm_len10_no
00C834  1  AD 21 07       lda cmd_buf+1
00C837  1  C9 45          cmp #'E'
00C839  1  D0 3E          bne _dm_len10_no
00C83B  1  AD 22 07       lda cmd_buf+2
00C83E  1  C9 50          cmp #'P'
00C840  1  D0 37          bne _dm_len10_no
00C842  1  AD 23 07       lda cmd_buf+3
00C845  1  C9 52          cmp #'R'
00C847  1  D0 30          bne _dm_len10_no
00C849  1  AD 24 07       lda cmd_buf+4
00C84C  1  C9 45          cmp #'E'
00C84E  1  D0 29          bne _dm_len10_no
00C850  1  AD 25 07       lda cmd_buf+5
00C853  1  C9 53          cmp #'S'
00C855  1  D0 22          bne _dm_len10_no
00C857  1  AD 26 07       lda cmd_buf+6
00C85A  1  C9 53          cmp #'S'
00C85C  1  D0 1B          bne _dm_len10_no
00C85E  1  AD 27 07       lda cmd_buf+7
00C861  1  C9 49          cmp #'I'
00C863  1  D0 14          bne _dm_len10_no
00C865  1  AD 28 07       lda cmd_buf+8
00C868  1  C9 4F          cmp #'O'
00C86A  1  D0 0D          bne _dm_len10_no
00C86C  1  AD 29 07       lda cmd_buf+9
00C86F  1  C9 4E          cmp #'N'
00C871  1  D0 06          bne _dm_len10_no
00C873  1  A9 3F          lda #63
00C875  1  8D 01 07       sta target_verb
00C878  1  60             rts
00C879  1               _dm_len10_no:
00C879  1  60             rts
00C87A  1               
00C87A  1               execute_action_command:
00C87A  1  AD 73 07       lda command_type
00C87D  1  C9 03          cmp #3
00C87F  1  D0 03          bne _eac_chk_take
00C881  1  4C 81 C9       jmp _eac_inventory
00C884  1               _eac_chk_take:
00C884  1  C9 01          cmp #1
00C886  1  D0 03          bne _eac_chk_drop
00C888  1  4C E5 C9       jmp _eac_take
00C88B  1               _eac_chk_drop:
00C88B  1  C9 02          cmp #2
00C88D  1  D0 03          bne _eac_chk_look
00C88F  1  4C 9E CA       jmp _eac_drop
00C892  1               _eac_chk_look:
00C892  1  C9 04          cmp #4
00C894  1  D0 03          bne _eac_chk_quit
00C896  1  4C 49 CB       jmp _eac_look
00C899  1               _eac_chk_quit:
00C899  1  C9 05          cmp #5
00C89B  1  D0 03          bne _eac_chk_examine
00C89D  1  4C 5E CB       jmp _eac_quit
00C8A0  1               _eac_chk_examine:
00C8A0  1  C9 06          cmp #6
00C8A2  1  D0 03          bne _eac_chk_read
00C8A4  1  4C 83 CB       jmp _eac_examine
00C8A7  1               _eac_chk_read:
00C8A7  1  C9 07          cmp #7
00C8A9  1  D0 03          bne _eac_chk_parse
00C8AB  1  4C A7 CB       jmp _eac_read
00C8AE  1               _eac_chk_parse:
00C8AE  1  C9 08          cmp #8
00C8B0  1  D0 03          bne _eac_chk_open
00C8B2  1  4C EE D8       jmp _eac_parse_error
00C8B5  1               _eac_chk_open:
00C8B5  1  C9 09          cmp #9
00C8B7  1  D0 03          bne _eac_chk_close
00C8B9  1  4C CB CB       jmp _eac_openish
00C8BC  1               _eac_chk_close:
00C8BC  1  C9 0A          cmp #10
00C8BE  1  D0 03          bne _eac_chk_help
00C8C0  1  4C 80 CD       jmp _eac_closeish
00C8C3  1               _eac_chk_help:
00C8C3  1  C9 0B          cmp #11
00C8C5  1  D0 03          bne _eac_chk_light
00C8C7  1  4C D9 CE       jmp _eac_help
00C8CA  1               _eac_chk_light:
00C8CA  1  C9 0C          cmp #12
00C8CC  1  D0 03          bne _eac_chk_dark
00C8CE  1  4C 02 CF       jmp _eac_light
00C8D1  1               _eac_chk_dark:
00C8D1  1  C9 0D          cmp #13
00C8D3  1  D0 03          bne _eac_chk_eat
00C8D5  1  4C 36 CF       jmp _eac_dark
00C8D8  1               _eac_chk_eat:
00C8D8  1  C9 0E          cmp #14
00C8DA  1  D0 03          bne _eac_chk_drink
00C8DC  1  4C 6A CF       jmp _eac_eat
00C8DF  1               _eac_chk_drink:
00C8DF  1  C9 0F          cmp #15
00C8E1  1  D0 03          bne _eac_chk_fill
00C8E3  1  4C 94 CF       jmp _eac_drink
00C8E6  1               _eac_chk_fill:
00C8E6  1  C9 10          cmp #16
00C8E8  1  D0 03          bne _eac_chk_pour
00C8EA  1  4C 00 D0       jmp _eac_fill
00C8ED  1               _eac_chk_pour:
00C8ED  1  C9 11          cmp #17
00C8EF  1  D0 03          bne _eac_chk_wave
00C8F1  1  4C C4 D0       jmp _eac_pour
00C8F4  1               _eac_chk_wave:
00C8F4  1  C9 12          cmp #18
00C8F6  1  D0 03          bne _eac_chk_find
00C8F8  1  4C 83 D1       jmp _eac_wave
00C8FB  1               _eac_chk_find:
00C8FB  1  C9 13          cmp #19
00C8FD  1  D0 03          bne _eac_chk_say
00C8FF  1  4C D1 D1       jmp _eac_find
00C902  1               _eac_chk_say:
00C902  1  C9 14          cmp #20
00C904  1  D0 03          bne _eac_chk_kill
00C906  1  4C 32 D2       jmp _eac_say
00C909  1               _eac_chk_kill:
00C909  1  C9 15          cmp #21
00C90B  1  D0 03          bne _eac_chk_throw
00C90D  1  4C 57 D2       jmp _eac_kill
00C910  1               _eac_chk_throw:
00C910  1  C9 16          cmp #22
00C912  1  D0 03          bne _eac_chk_feed
00C914  1  4C F4 D2       jmp _eac_throw
00C917  1               _eac_chk_feed:
00C917  1  C9 17          cmp #23
00C919  1  D0 03          bne _eac_chk_break
00C91B  1  4C 8D D3       jmp _eac_feed
00C91E  1               _eac_chk_break:
00C91E  1  C9 18          cmp #24
00C920  1  D0 03          bne _eac_chk_rub
00C922  1  4C 6A D4       jmp _eac_break
00C925  1               _eac_chk_rub:
00C925  1  C9 19          cmp #25
00C927  1  D0 03          bne _eac_chk_wake
00C929  1  4C B8 D4       jmp _eac_rub
00C92C  1               _eac_chk_wake:
00C92C  1  C9 1A          cmp #26
00C92E  1  D0 03          bne _eac_chk_blast
00C930  1  4C D8 D4       jmp _eac_wake
00C933  1               _eac_chk_blast:
00C933  1  C9 1B          cmp #27
00C935  1  D0 03          bne _eac_chk_score
00C937  1  4C F8 D4       jmp _eac_blast
00C93A  1               _eac_chk_score:
00C93A  1  C9 1C          cmp #28
00C93C  1  D0 03          bne _eac_chk_calm
00C93E  1  4C 00 D5       jmp _eac_score
00C941  1               _eac_chk_calm:
00C941  1  C9 1D          cmp #29
00C943  1  D0 03          bne _eac_chk_walk2
00C945  1  4C 11 D5       jmp _eac_calm
00C948  1               _eac_chk_walk2:
00C948  1  C9 1E          cmp #30
00C94A  1  D0 03          bne _eac_chk_nothing
00C94C  1  4C 19 D5       jmp _eac_walk
00C94F  1               _eac_chk_nothing:
00C94F  1  C9 1F          cmp #31
00C951  1  D0 03          bne _eac_chk_brief
00C953  1  4C 21 D5       jmp _eac_nothing
00C956  1               _eac_chk_brief:
00C956  1  C9 20          cmp #32
00C958  1  D0 03          bne _eac_chk_suspend
00C95A  1  4C 29 D5       jmp _eac_brief
00C95D  1               _eac_chk_suspend:
00C95D  1  C9 21          cmp #33
00C95F  1  D0 03          bne _eac_chk_hours
00C961  1  4C 31 D5       jmp _eac_suspend
00C964  1               _eac_chk_hours:
00C964  1  C9 22          cmp #34
00C966  1  D0 03          bne _eac_chk_log
00C968  1  4C 59 D5       jmp _eac_hours
00C96B  1               _eac_chk_log:
00C96B  1  C9 23          cmp #35
00C96D  1  D0 03          bne _eac_chk_load
00C96F  1  4C 61 D5       jmp _eac_log
00C972  1               _eac_chk_load:
00C972  1  C9 24          cmp #36
00C974  1  D0 03          bne _eac_chk_foo
00C976  1  4C 69 D5       jmp _eac_load
00C979  1               _eac_chk_foo:
00C979  1  C9 25          cmp #37
00C97B  1  D0 03          bne _eac_done
00C97D  1  4C A2 D5       jmp _eac_foo
00C980  1               _eac_done:
00C980  1  60             rts
00C981  1               
00C981  1               _eac_inventory:
00C981  1  A9 49          lda #'I'
00C983  1  20 B2 ED       jsr print_char
00C986  1  A9 4E          lda #'N'
00C988  1  20 B2 ED       jsr print_char
00C98B  1  A9 56          lda #'V'
00C98D  1  20 B2 ED       jsr print_char
00C990  1  A9 3A          lda #':'
00C992  1  20 B2 ED       jsr print_char
00C995  1  A9 20          lda #' '
00C997  1  20 B2 ED       jsr print_char
00C99A  1               
00C99A  1  A9 00          lda #0
00C99C  1  8D 02 07       sta input_seen
00C99F  1  A2 01          ldx #1
00C9A1  1               _eac_inv_loop:
00C9A1  1  E0 64          cpx #100
00C9A3  1  B0 1A          bcs _eac_inv_done
00C9A5  1  BD E4 07       lda toting_table,x
00C9A8  1  F0 11          beq _eac_inv_next
00C9AA  1  A9 01          lda #1
00C9AC  1  8D 02 07       sta input_seen
00C9AF  1  8A             txa
00C9B0  1  48             pha
00C9B1  1  20 86 DF       jsr print_inventory_item
00C9B4  1  68             pla
00C9B5  1  AA             tax
00C9B6  1  A9 20          lda #' '
00C9B8  1  20 B2 ED       jsr print_char
00C9BB  1               _eac_inv_next:
00C9BB  1  E8             inx
00C9BC  1  4C A1 C9       jmp _eac_inv_loop
00C9BF  1               
00C9BF  1               _eac_inv_done:
00C9BF  1  AD 02 07       lda input_seen
00C9C2  1  D0 1D          bne _eac_inv_ok
00C9C4  1  A9 45          lda #'E'
00C9C6  1  20 B2 ED       jsr print_char
00C9C9  1  A9 4D          lda #'M'
00C9CB  1  20 B2 ED       jsr print_char
00C9CE  1  A9 50          lda #'P'
00C9D0  1  20 B2 ED       jsr print_char
00C9D3  1  A9 54          lda #'T'
00C9D5  1  20 B2 ED       jsr print_char
00C9D8  1  A9 59          lda #'Y'
00C9DA  1  20 B2 ED       jsr print_char
00C9DD  1  20 A7 ED       jsr newline
00C9E0  1  60             rts
00C9E1  1               
00C9E1  1               _eac_inv_ok:
00C9E1  1  20 A7 ED       jsr newline
00C9E4  1  60             rts
00C9E5  1               
00C9E5  1               _eac_take:
00C9E5  1  20 4E DF       jsr noun_is_all
00C9E8  1  90 03          bcc _eac_take_one
00C9EA  1  4C 35 CA       jmp _eac_take_all
00C9ED  1               _eac_take_one:
00C9ED  1  AD 74 07       lda command_object
00C9F0  1  D0 03          bne _eac_take_have_obj
00C9F2  1  4C 1A D9       jmp _eac_no
00C9F5  1               _eac_take_have_obj:
00C9F5  1  20 B8 D8       jsr object_is_portable
00C9F8  1  B0 0B          bcs :+
00C9FA  1  A2 FD          ldx #<msg_cant_take
00C9FC  1  A0 F0          ldy #>msg_cant_take
00C9FE  1  20 4D DD       jsr print_zstr_xy
00CA01  1  20 A7 ED       jsr newline
00CA04  1  60             rts
00CA05  1               :
00CA05  1  AA             tax
00CA06  1  E0 64          cpx #100
00CA08  1  90 03          bcc _eac_take_in_range
00CA0A  1  4C 1A D9       jmp _eac_no
00CA0D  1               _eac_take_in_range:
00CA0D  1  BD 48 08       lda present_table,x
00CA10  1  D0 03          bne _eac_take_present
00CA12  1  4C 86 CA       jmp _eac_take_not_here
00CA15  1               _eac_take_present:
00CA15  1  A9 00          lda #0
00CA17  1  9D 48 08       sta present_table,x
00CA1A  1  A9 01          lda #1
00CA1C  1  9D E4 07       sta toting_table,x
00CA1F  1  A9 FF          lda #$FF
00CA21  1  9D 00 20       sta place_table,x
00CA24  1  A2 D8          ldx #<msg_taken_prefix
00CA26  1  A0 EF          ldy #>msg_taken_prefix
00CA28  1  20 4D DD       jsr print_zstr_xy
00CA2B  1  AE 74 07       ldx command_object
00CA2E  1  20 86 DF       jsr print_inventory_item
00CA31  1  20 A7 ED       jsr newline
00CA34  1  60             rts
00CA35  1               
00CA35  1               _eac_take_all:
00CA35  1  A9 00          lda #0
00CA37  1  8D 02 07       sta input_seen
00CA3A  1  A2 01          ldx #1
00CA3C  1               _eac_take_all_loop:
00CA3C  1  E0 64          cpx #100
00CA3E  1  B0 3D          bcs _eac_take_all_done
00CA40  1  8A             txa
00CA41  1  48             pha
00CA42  1  8D 74 07       sta command_object
00CA45  1  20 B8 D8       jsr object_is_portable
00CA48  1  68             pla
00CA49  1  AA             tax
00CA4A  1  90 2D          bcc _eac_take_all_next
00CA4C  1  BD 48 08       lda present_table,x
00CA4F  1  F0 28          beq _eac_take_all_next
00CA51  1  A9 01          lda #1
00CA53  1  8D 02 07       sta input_seen
00CA56  1  A9 00          lda #0
00CA58  1  9D 48 08       sta present_table,x
00CA5B  1  A9 01          lda #1
00CA5D  1  9D E4 07       sta toting_table,x
00CA60  1  A9 FF          lda #$FF
00CA62  1  9D 00 20       sta place_table,x
00CA65  1  8A             txa
00CA66  1  48             pha
00CA67  1  A2 D8          ldx #<msg_taken_prefix
00CA69  1  A0 EF          ldy #>msg_taken_prefix
00CA6B  1  20 4D DD       jsr print_zstr_xy
00CA6E  1  68             pla
00CA6F  1  48             pha
00CA70  1  AA             tax
00CA71  1  20 86 DF       jsr print_inventory_item
00CA74  1  68             pla
00CA75  1  AA             tax
00CA76  1  20 A7 ED       jsr newline
00CA79  1               _eac_take_all_next:
00CA79  1  E8             inx
00CA7A  1  4C 3C CA       jmp _eac_take_all_loop
00CA7D  1               _eac_take_all_done:
00CA7D  1  AD 02 07       lda input_seen
00CA80  1  D0 03          bne _eac_take_all_ok
00CA82  1  4C 1A D9       jmp _eac_no
00CA85  1               _eac_take_all_ok:
00CA85  1  60             rts
00CA86  1               
00CA86  1               _eac_take_not_here:
00CA86  1  A2 CE          ldx #<msg_no_here_prefix
00CA88  1  A0 EF          ldy #>msg_no_here_prefix
00CA8A  1  20 4D DD       jsr print_zstr_xy
00CA8D  1  AE 74 07       ldx command_object
00CA90  1  20 86 DF       jsr print_inventory_item
00CA93  1  A2 D2          ldx #<msg_here_suffix
00CA95  1  A0 EF          ldy #>msg_here_suffix
00CA97  1  20 4D DD       jsr print_zstr_xy
00CA9A  1  20 A7 ED       jsr newline
00CA9D  1  60             rts
00CA9E  1               
00CA9E  1               _eac_drop:
00CA9E  1  20 4E DF       jsr noun_is_all
00CAA1  1  90 03          bcc _eac_drop_one
00CAA3  1  4C E7 CA       jmp _eac_drop_all
00CAA6  1               _eac_drop_one:
00CAA6  1  AD 74 07       lda command_object
00CAA9  1  D0 03          bne _eac_drop_have_obj
00CAAB  1  4C 1A D9       jmp _eac_no
00CAAE  1               _eac_drop_have_obj:
00CAAE  1  AA             tax
00CAAF  1  E0 64          cpx #100
00CAB1  1  90 03          bcc _eac_drop_in_range
00CAB3  1  4C 1A D9       jmp _eac_no
00CAB6  1               _eac_drop_in_range:
00CAB6  1  BD E4 07       lda toting_table,x
00CAB9  1  D0 0B          bne _eac_drop_holding
00CABB  1  BD 00 20       lda place_table,x
00CABE  1  CD 00 07       cmp target_room
00CAC1  1  F0 6A          beq _eac_drop_already_here
00CAC3  1  4C 38 CB       jmp _eac_drop_not_carrying
00CAC6  1               _eac_drop_holding:
00CAC6  1  A9 00          lda #0
00CAC8  1  9D E4 07       sta toting_table,x
00CACB  1  A9 01          lda #1
00CACD  1  9D 48 08       sta present_table,x
00CAD0  1  AD 00 07       lda target_room
00CAD3  1  9D 00 20       sta place_table,x
00CAD6  1  A2 E0          ldx #<msg_dropped_prefix
00CAD8  1  A0 EF          ldy #>msg_dropped_prefix
00CADA  1  20 4D DD       jsr print_zstr_xy
00CADD  1  AE 74 07       ldx command_object
00CAE0  1  20 86 DF       jsr print_inventory_item
00CAE3  1  20 A7 ED       jsr newline
00CAE6  1  60             rts
00CAE7  1               
00CAE7  1               _eac_drop_all:
00CAE7  1  A9 00          lda #0
00CAE9  1  8D 02 07       sta input_seen
00CAEC  1  A2 01          ldx #1
00CAEE  1               _eac_drop_all_loop:
00CAEE  1  E0 64          cpx #100
00CAF0  1  B0 32          bcs _eac_drop_all_done
00CAF2  1  BD E4 07       lda toting_table,x
00CAF5  1  F0 29          beq _eac_drop_all_next
00CAF7  1  A9 01          lda #1
00CAF9  1  8D 02 07       sta input_seen
00CAFC  1  A9 00          lda #0
00CAFE  1  9D E4 07       sta toting_table,x
00CB01  1  A9 01          lda #1
00CB03  1  9D 48 08       sta present_table,x
00CB06  1  AD 00 07       lda target_room
00CB09  1  9D 00 20       sta place_table,x
00CB0C  1  8A             txa
00CB0D  1  48             pha
00CB0E  1  A2 E0          ldx #<msg_dropped_prefix
00CB10  1  A0 EF          ldy #>msg_dropped_prefix
00CB12  1  20 4D DD       jsr print_zstr_xy
00CB15  1  68             pla
00CB16  1  48             pha
00CB17  1  AA             tax
00CB18  1  20 86 DF       jsr print_inventory_item
00CB1B  1  68             pla
00CB1C  1  AA             tax
00CB1D  1  20 A7 ED       jsr newline
00CB20  1               _eac_drop_all_next:
00CB20  1  E8             inx
00CB21  1  4C EE CA       jmp _eac_drop_all_loop
00CB24  1               _eac_drop_all_done:
00CB24  1  AD 02 07       lda input_seen
00CB27  1  D0 03          bne _eac_drop_all_ok
00CB29  1  4C 1A D9       jmp _eac_no
00CB2C  1               _eac_drop_all_ok:
00CB2C  1  60             rts
00CB2D  1               
00CB2D  1               _eac_drop_already_here:
00CB2D  1  A2 B3          ldx #<msg_already_here
00CB2F  1  A0 EF          ldy #>msg_already_here
00CB31  1  20 4D DD       jsr print_zstr_xy
00CB34  1  20 A7 ED       jsr newline
00CB37  1  60             rts
00CB38  1               
00CB38  1               _eac_drop_not_carrying:
00CB38  1  A2 C0          ldx #<msg_not_carrying_prefix
00CB3A  1  A0 EF          ldy #>msg_not_carrying_prefix
00CB3C  1  20 4D DD       jsr print_zstr_xy
00CB3F  1  AE 74 07       ldx command_object
00CB42  1  20 86 DF       jsr print_inventory_item
00CB45  1  20 A7 ED       jsr newline
00CB48  1  60             rts
00CB49  1               
00CB49  1               _eac_look:
00CB49  1  20 C1 DC       jsr sync_present_from_room
00CB4C  1  A9 00          lda #0
00CB4E  1  8D 76 07       sta desc_mode
00CB51  1  20 A7 ED       jsr newline
00CB54  1  20 E5 E0       jsr print_room_long
00CB57  1  20 E1 DC       jsr print_room_objects
00CB5A  1  20 A7 ED       jsr newline
00CB5D  1  60             rts
00CB5E  1               
00CB5E  1               _eac_quit:
00CB5E  1  A2 50          ldx #<msg_quit_confirm
00CB60  1  A0 F7          ldy #>msg_quit_confirm
00CB62  1  20 4D DD       jsr print_zstr_xy
00CB65  1  20 A7 ED       jsr newline
00CB68  1  20 4D D9       jsr prompt_yes_no
00CB6B  1  08             php
00CB6C  1  20 A7 ED       jsr newline
00CB6F  1  28             plp
00CB70  1  90 10          bcc _eac_quit_cancel
00CB72  1  A2 70          ldx #<msg_quit_ok
00CB74  1  A0 F7          ldy #>msg_quit_ok
00CB76  1  20 4D DD       jsr print_zstr_xy
00CB79  1  20 A7 ED       jsr newline
00CB7C  1  20 E3 D5       jsr print_quit_summary
00CB7F  1  4C 9E A4       jmp halt_loop
00CB82  1               _eac_quit_cancel:
00CB82  1  60             rts
00CB83  1               
00CB83  1               _eac_examine:
00CB83  1  AD 74 07       lda command_object
00CB86  1  D0 03          bne _eac_exam_have_obj
00CB88  1  4C 1A D9       jmp _eac_no
00CB8B  1               _eac_exam_have_obj:
00CB8B  1  AA             tax
00CB8C  1  E0 64          cpx #100
00CB8E  1  90 03          bcc :+
00CB90  1  4C 1A D9       jmp _eac_no
00CB93  1               :
00CB93  1  BD E4 07       lda toting_table,x
00CB96  1  D0 08          bne _eac_exam_ok
00CB98  1  BD 48 08       lda present_table,x
00CB9B  1  D0 03          bne _eac_exam_ok
00CB9D  1  4C 1A D9       jmp _eac_no
00CBA0  1               _eac_exam_ok:
00CBA0  1  20 72 DD       jsr print_examine_text
00CBA3  1  20 A7 ED       jsr newline
00CBA6  1  60             rts
00CBA7  1               
00CBA7  1               _eac_read:
00CBA7  1  AD 74 07       lda command_object
00CBAA  1  D0 03          bne _eac_read_have_obj
00CBAC  1  4C 1A D9       jmp _eac_no
00CBAF  1               _eac_read_have_obj:
00CBAF  1  AA             tax
00CBB0  1  E0 64          cpx #100
00CBB2  1  90 03          bcc :+
00CBB4  1  4C 1A D9       jmp _eac_no
00CBB7  1               :
00CBB7  1  BD E4 07       lda toting_table,x
00CBBA  1  D0 08          bne _eac_read_ok
00CBBC  1  BD 48 08       lda present_table,x
00CBBF  1  D0 03          bne _eac_read_ok
00CBC1  1  4C 1A D9       jmp _eac_no
00CBC4  1               _eac_read_ok:
00CBC4  1  20 CA DD       jsr print_read_text
00CBC7  1  20 A7 ED       jsr newline
00CBCA  1  60             rts
00CBCB  1               
00CBCB  1               _eac_openish:
00CBCB  1                 ; OPEN/UNLOCK supports GRATE and DOOR parity behavior.
00CBCB  1  AD 74 07       lda command_object
00CBCE  1  C9 09          cmp #9
00CBD0  1  D0 2D          bne _eac_open_check_grate
00CBD2  1  20 C3 D8       jsr object_is_accessible
00CBD5  1  B0 03          bcs :+
00CBD7  1  4C 1A D9       jmp _eac_no
00CBDA  1               :
00CBDA  1  A2 09          ldx #9
00CBDC  1  BD 80 07       lda prop_table,x
00CBDF  1  C9 01          cmp #1
00CBE1  1  F0 08          beq _eac_open_door_54
00CBE3  1  A9 6F          lda #111
00CBE5  1  8D 77 07       sta msg_target
00CBE8  1  4C F0 CB       jmp _eac_open_door_print
00CBEB  1               _eac_open_door_54:
00CBEB  1  A9 36          lda #54
00CBED  1  8D 77 07       sta msg_target
00CBF0  1               _eac_open_door_print:
00CBF0  1  20 A7 ED       jsr newline
00CBF3  1  20 C6 E1       jsr print_special_message
00CBF6  1  90 03          bcc :+
00CBF8  1  4C 1A D9       jmp _eac_no
00CBFB  1               :
00CBFB  1  20 A7 ED       jsr newline
00CBFE  1  60             rts
00CBFF  1               
00CBFF  1               _eac_open_check_grate:
00CBFF  1  AD 74 07       lda command_object
00CC02  1  C9 0E          cmp #14                  ; CLAM
00CC04  1  D0 03          bne :+
00CC06  1  4C A6 CC       jmp _eac_open_clam
00CC09  1               :
00CC09  1  C9 0F          cmp #15                  ; OYSTER
00CC0B  1  D0 03          bne :+
00CC0D  1  4C A6 CC       jmp _eac_open_clam
00CC10  1               :
00CC10  1  C9 3F          cmp #63                  ; CHAIN
00CC12  1  D0 03          bne :+
00CC14  1  4C 2E CD       jmp _eac_open_chain
00CC17  1               :
00CC17  1  AD 74 07       lda command_object
00CC1A  1  C9 03          cmp #3
00CC1C  1  F0 2C          beq _eac_open_room_check
00CC1E  1  C9 04          cmp #4
00CC20  1  F0 0C          beq _eac_open_msg32
00CC22  1  C9 01          cmp #1
00CC24  1  F0 10          beq _eac_open_msg55
00CC26  1  A9 21          lda #33
00CC28  1  8D 77 07       sta msg_target
00CC2B  1  4C 3B CC       jmp _eac_open_msg_only
00CC2E  1               _eac_open_msg32:
00CC2E  1  A9 20          lda #32
00CC30  1  8D 77 07       sta msg_target
00CC33  1  4C 3B CC       jmp _eac_open_msg_only
00CC36  1               _eac_open_msg55:
00CC36  1  A9 37          lda #55
00CC38  1  8D 77 07       sta msg_target
00CC3B  1               _eac_open_msg_only:
00CC3B  1  20 A7 ED       jsr newline
00CC3E  1  20 C6 E1       jsr print_special_message
00CC41  1  90 03          bcc :+
00CC43  1  4C 1A D9       jmp _eac_no
00CC46  1               :
00CC46  1  20 A7 ED       jsr newline
00CC49  1  60             rts
00CC4A  1               _eac_open_room_check:
00CC4A  1  AD 00 07       lda target_room
00CC4D  1  C9 08          cmp #8
00CC4F  1  D0 03          bne :+
00CC51  1  4C 5B CC       jmp _eac_open_do
00CC54  1               :
00CC54  1  C9 09          cmp #9
00CC56  1  F0 03          beq :+
00CC58  1  4C 1A D9       jmp _eac_no
00CC5B  1               :
00CC5B  1               _eac_open_do:
00CC5B  1  A2 03          ldx #3
00CC5D  1  BD 80 07       lda prop_table,x
00CC60  1  C9 01          cmp #1
00CC62  1  D0 03          bne :+
00CC64  1  4C 9B CC       jmp _eac_open_already
00CC67  1               :
00CC67  1  20 3D D8       jsr command_is_unlock
00CC6A  1  90 10          bcc _eac_open_set
00CC6C  1  20 9D D8       jsr player_has_keys
00CC6F  1  B0 0B          bcs _eac_open_set
00CC71  1  A2 5C          ldx #<msg_need_keys
00CC73  1  A0 F1          ldy #>msg_need_keys
00CC75  1  20 4D DD       jsr print_zstr_xy
00CC78  1  20 A7 ED       jsr newline
00CC7B  1  60             rts
00CC7C  1               _eac_open_set:
00CC7C  1  A2 03          ldx #3
00CC7E  1  A9 01          lda #1
00CC80  1  9D 80 07       sta prop_table,x
00CC83  1  A9 24          lda #36
00CC85  1  8D 77 07       sta msg_target
00CC88  1  20 A7 ED       jsr newline
00CC8B  1  20 C6 E1       jsr print_special_message
00CC8E  1  90 07          bcc _eac_open_done
00CC90  1                 ; Fallback if message lookup fails
00CC90  1  A2 12          ldx #<msg_opened
00CC92  1  A0 F1          ldy #>msg_opened
00CC94  1  20 4D DD       jsr print_zstr_xy
00CC97  1               _eac_open_done:
00CC97  1  20 A7 ED       jsr newline
00CC9A  1  60             rts
00CC9B  1               _eac_open_already:
00CC9B  1  A2 20          ldx #<msg_already_unlocked
00CC9D  1  A0 F1          ldy #>msg_already_unlocked
00CC9F  1  20 4D DD       jsr print_zstr_xy
00CCA2  1  20 A7 ED       jsr newline
00CCA5  1  60             rts
00CCA6  1               
00CCA6  1               _eac_open_clam:
00CCA6  1                 ; Adventure parity for OPEN CLAM/OYSTER:
00CCA6  1                 ; - no trident: 122/123
00CCA6  1                 ; - carrying object: 120/121
00CCA6  1                 ; - otherwise: 124/125 and CLAM->OYSTER with PEARL at 105
00CCA6  1  AD 74 07       lda command_object
00CCA9  1  C9 0F          cmp #15
00CCAB  1  D0 04          bne :+
00CCAD  1  A9 01          lda #1
00CCAF  1  D0 02          bne _eac_open_clam_have_oy
00CCB1  1               :
00CCB1  1  A9 00          lda #0
00CCB3  1               _eac_open_clam_have_oy:
00CCB3  1  8D 0B 07       sta tmp_digit
00CCB6  1  A2 39          ldx #57                  ; TRIDENT
00CCB8  1  BD E4 07       lda toting_table,x
00CCBB  1  D0 0C          bne _eac_open_clam_have_trident
00CCBD  1  A9 7A          lda #122
00CCBF  1  18             clc
00CCC0  1  6D 0B 07       adc tmp_digit
00CCC3  1  8D 77 07       sta msg_target
00CCC6  1  4C 1F CD       jmp _eac_open_clam_print
00CCC9  1               _eac_open_clam_have_trident:
00CCC9  1  AE 74 07       ldx command_object
00CCCC  1  BD E4 07       lda toting_table,x
00CCCF  1  F0 0C          beq _eac_open_clam_open_it
00CCD1  1  A9 78          lda #120
00CCD3  1  18             clc
00CCD4  1  6D 0B 07       adc tmp_digit
00CCD7  1  8D 77 07       sta msg_target
00CCDA  1  4C 1F CD       jmp _eac_open_clam_print
00CCDD  1               _eac_open_clam_open_it:
00CCDD  1  A9 7C          lda #124
00CCDF  1  18             clc
00CCE0  1  6D 0B 07       adc tmp_digit
00CCE3  1  8D 77 07       sta msg_target
00CCE6  1                 ; dstroy(CLAM)
00CCE6  1  A2 0E          ldx #14
00CCE8  1  A9 00          lda #0
00CCEA  1  9D E4 07       sta toting_table,x
00CCED  1  9D 48 08       sta present_table,x
00CCF0  1  9D 00 20       sta place_table,x
00CCF3  1                 ; drop(OYSTER, loc)
00CCF3  1  A2 0F          ldx #15
00CCF5  1  9D E4 07       sta toting_table,x
00CCF8  1  A9 01          lda #1
00CCFA  1  9D 48 08       sta present_table,x
00CCFD  1  AD 00 07       lda target_room
00CD00  1  9D 00 20       sta place_table,x
00CD03  1                 ; drop(PEARL, 105)
00CD03  1  A2 3D          ldx #61
00CD05  1  A9 00          lda #0
00CD07  1  9D E4 07       sta toting_table,x
00CD0A  1  A9 69          lda #105
00CD0C  1  9D 00 20       sta place_table,x
00CD0F  1  AD 00 07       lda target_room
00CD12  1  C9 69          cmp #105
00CD14  1  D0 04          bne :+
00CD16  1  A9 01          lda #1
00CD18  1  D0 02          bne :++
00CD1A  1               :
00CD1A  1  A9 00          lda #0
00CD1C  1               :
00CD1C  1  9D 48 08       sta present_table,x
00CD1F  1               _eac_open_clam_print:
00CD1F  1  20 A7 ED       jsr newline
00CD22  1  20 C6 E1       jsr print_special_message
00CD25  1  90 03          bcc :+
00CD27  1  4C 1A D9       jmp _eac_no
00CD2A  1               :
00CD2A  1  20 A7 ED       jsr newline
00CD2D  1  60             rts
00CD2E  1               
00CD2E  1               _eac_open_chain:
00CD2E  1                 ; OPEN/UNLOCK CHAIN (verb != LOCK path in original).
00CD2E  1  20 A8 D8       jsr player_has_keys_here
00CD31  1  B0 08          bcs :+
00CD33  1  A9 1F          lda #31
00CD35  1  8D 77 07       sta msg_target
00CD38  1  4C 71 CD       jmp _eac_open_chain_print
00CD3B  1               :
00CD3B  1  A2 23          ldx #35                  ; BEAR
00CD3D  1  BD 80 07       lda prop_table,x
00CD40  1  D0 08          bne :+
00CD42  1  A9 29          lda #41
00CD44  1  8D 77 07       sta msg_target
00CD47  1  4C 71 CD       jmp _eac_open_chain_print
00CD4A  1               :
00CD4A  1  A2 3F          ldx #63                  ; CHAIN
00CD4C  1  BD 80 07       lda prop_table,x
00CD4F  1  D0 08          bne :+
00CD51  1  A9 25          lda #37
00CD53  1  8D 77 07       sta msg_target
00CD56  1  4C 71 CD       jmp _eac_open_chain_print
00CD59  1               :
00CD59  1  A9 00          lda #0
00CD5B  1  9D 80 07       sta prop_table,x
00CD5E  1  A2 23          ldx #35
00CD60  1  BD 80 07       lda prop_table,x
00CD63  1  C9 03          cmp #3
00CD65  1  F0 05          beq :+
00CD67  1  A9 02          lda #2
00CD69  1  9D 80 07       sta prop_table,x
00CD6C  1               :
00CD6C  1  A9 AB          lda #171
00CD6E  1  8D 77 07       sta msg_target
00CD71  1               _eac_open_chain_print:
00CD71  1  20 A7 ED       jsr newline
00CD74  1  20 C6 E1       jsr print_special_message
00CD77  1  90 03          bcc :+
00CD79  1  4C 1A D9       jmp _eac_no
00CD7C  1               :
00CD7C  1  20 A7 ED       jsr newline
00CD7F  1  60             rts
00CD80  1               
00CD80  1               _eac_closeish:
00CD80  1                 ; CLOSE/LOCK supports GRATE and DOOR parity behavior.
00CD80  1  AD 74 07       lda command_object
00CD83  1  C9 09          cmp #9
00CD85  1  D0 2D          bne _eac_close_check_grate
00CD87  1  20 C3 D8       jsr object_is_accessible
00CD8A  1  B0 03          bcs :+
00CD8C  1  4C 1A D9       jmp _eac_no
00CD8F  1               :
00CD8F  1  A2 09          ldx #9
00CD91  1  BD 80 07       lda prop_table,x
00CD94  1  C9 01          cmp #1
00CD96  1  F0 08          beq _eac_close_door_54
00CD98  1  A9 6F          lda #111
00CD9A  1  8D 77 07       sta msg_target
00CD9D  1  4C A5 CD       jmp _eac_close_door_print
00CDA0  1               _eac_close_door_54:
00CDA0  1  A9 36          lda #54
00CDA2  1  8D 77 07       sta msg_target
00CDA5  1               _eac_close_door_print:
00CDA5  1  20 A7 ED       jsr newline
00CDA8  1  20 C6 E1       jsr print_special_message
00CDAB  1  90 03          bcc :+
00CDAD  1  4C 1A D9       jmp _eac_no
00CDB0  1               :
00CDB0  1  20 A7 ED       jsr newline
00CDB3  1  60             rts
00CDB4  1               
00CDB4  1               _eac_close_check_grate:
00CDB4  1  AD 74 07       lda command_object
00CDB7  1  C9 0E          cmp #14                  ; CLAM
00CDB9  1  D0 03          bne :+
00CDBB  1  4C 66 CE       jmp _eac_close_clam
00CDBE  1               :
00CDBE  1  C9 0F          cmp #15                  ; OYSTER
00CDC0  1  D0 03          bne :+
00CDC2  1  4C 66 CE       jmp _eac_close_clam
00CDC5  1               :
00CDC5  1  C9 3F          cmp #63                  ; CHAIN
00CDC7  1  D0 03          bne :+
00CDC9  1  4C 7E CE       jmp _eac_close_chain
00CDCC  1               :
00CDCC  1  AD 74 07       lda command_object
00CDCF  1  C9 03          cmp #3
00CDD1  1  F0 2C          beq _eac_close_room_check
00CDD3  1  C9 04          cmp #4
00CDD5  1  F0 0C          beq _eac_close_msg32
00CDD7  1  C9 01          cmp #1
00CDD9  1  F0 10          beq _eac_close_msg55
00CDDB  1  A9 21          lda #33
00CDDD  1  8D 77 07       sta msg_target
00CDE0  1  4C F0 CD       jmp _eac_close_msg_only
00CDE3  1               _eac_close_msg32:
00CDE3  1  A9 20          lda #32
00CDE5  1  8D 77 07       sta msg_target
00CDE8  1  4C F0 CD       jmp _eac_close_msg_only
00CDEB  1               _eac_close_msg55:
00CDEB  1  A9 37          lda #55
00CDED  1  8D 77 07       sta msg_target
00CDF0  1               _eac_close_msg_only:
00CDF0  1  20 A7 ED       jsr newline
00CDF3  1  20 C6 E1       jsr print_special_message
00CDF6  1  90 03          bcc :+
00CDF8  1  4C 1A D9       jmp _eac_no
00CDFB  1               :
00CDFB  1  20 A7 ED       jsr newline
00CDFE  1  60             rts
00CDFF  1               _eac_close_room_check:
00CDFF  1  AD 00 07       lda target_room
00CE02  1  C9 08          cmp #8
00CE04  1  D0 03          bne :+
00CE06  1  4C 15 CE       jmp _eac_close_do
00CE09  1               :
00CE09  1  C9 09          cmp #9
00CE0B  1  F0 08          beq :+
00CE0D  1  A9 21          lda #33
00CE0F  1  8D 77 07       sta msg_target
00CE12  1  4C F0 CD       jmp _eac_close_msg_only
00CE15  1               :
00CE15  1               _eac_close_do:
00CE15  1  A2 03          ldx #3
00CE17  1  BD 80 07       lda prop_table,x
00CE1A  1  C9 00          cmp #0
00CE1C  1  D0 03          bne :+
00CE1E  1  4C 5B CE       jmp _eac_close_already
00CE21  1               :
00CE21  1  20 74 D8       jsr command_is_lock
00CE24  1  B0 03          bcs :+
00CE26  1  4C 3C CE       jmp _eac_close_set
00CE29  1               :
00CE29  1  20 9D D8       jsr player_has_keys
00CE2C  1  90 03          bcc :+
00CE2E  1  4C 3C CE       jmp _eac_close_set
00CE31  1               :
00CE31  1  A2 5C          ldx #<msg_need_keys
00CE33  1  A0 F1          ldy #>msg_need_keys
00CE35  1  20 4D DD       jsr print_zstr_xy
00CE38  1  20 A7 ED       jsr newline
00CE3B  1  60             rts
00CE3C  1               _eac_close_set:
00CE3C  1  A2 03          ldx #3
00CE3E  1  A9 00          lda #0
00CE40  1  9D 80 07       sta prop_table,x
00CE43  1  A9 23          lda #35
00CE45  1  8D 77 07       sta msg_target
00CE48  1  20 A7 ED       jsr newline
00CE4B  1  20 C6 E1       jsr print_special_message
00CE4E  1  90 07          bcc _eac_close_done
00CE50  1                 ; Fallback if message lookup fails
00CE50  1  A2 18          ldx #<msg_closed
00CE52  1  A0 F1          ldy #>msg_closed
00CE54  1  20 4D DD       jsr print_zstr_xy
00CE57  1               _eac_close_done:
00CE57  1  20 A7 ED       jsr newline
00CE5A  1  60             rts
00CE5B  1               _eac_close_already:
00CE5B  1  A2 3F          ldx #<msg_already_locked
00CE5D  1  A0 F1          ldy #>msg_already_locked
00CE5F  1  20 4D DD       jsr print_zstr_xy
00CE62  1  20 A7 ED       jsr newline
00CE65  1  60             rts
00CE66  1               
00CE66  1               _eac_close_clam:
00CE66  1                 ; LOCK/CLOSE CLAM or OYSTER -> message 61.
00CE66  1  A9 3D          lda #61
00CE68  1  8D 77 07       sta msg_target
00CE6B  1  20 A7 ED       jsr newline
00CE6E  1  20 C6 E1       jsr print_special_message
00CE71  1  90 07          bcc :+
00CE73  1  A2 05          ldx #<msg_clam_lock
00CE75  1  A0 F4          ldy #>msg_clam_lock
00CE77  1  20 4D DD       jsr print_zstr_xy
00CE7A  1               :
00CE7A  1  20 A7 ED       jsr newline
00CE7D  1  60             rts
00CE7E  1               
00CE7E  1               _eac_close_chain:
00CE7E  1                 ; CLOSE/LOCK CHAIN (verb == LOCK path in original).
00CE7E  1  20 A8 D8       jsr player_has_keys_here
00CE81  1  B0 08          bcs :+
00CE83  1  A9 1F          lda #31
00CE85  1  8D 77 07       sta msg_target
00CE88  1  4C CA CE       jmp _eac_close_chain_print
00CE8B  1               :
00CE8B  1  A2 3F          ldx #63                  ; CHAIN
00CE8D  1  BD 80 07       lda prop_table,x
00CE90  1  F0 08          beq :+
00CE92  1  A9 22          lda #34
00CE94  1  8D 77 07       sta msg_target
00CE97  1  4C CA CE       jmp _eac_close_chain_print
00CE9A  1               :
00CE9A  1  AD 00 07       lda target_room
00CE9D  1  C9 82          cmp #130
00CE9F  1  F0 08          beq :+
00CEA1  1  A9 AD          lda #173
00CEA3  1  8D 77 07       sta msg_target
00CEA6  1  4C CA CE       jmp _eac_close_chain_print
00CEA9  1               :
00CEA9  1  A2 3F          ldx #63
00CEAB  1  A9 02          lda #2
00CEAD  1  9D 80 07       sta prop_table,x
00CEB0  1  BD E4 07       lda toting_table,x
00CEB3  1  F0 10          beq :+
00CEB5  1  A9 00          lda #0
00CEB7  1  9D E4 07       sta toting_table,x
00CEBA  1  A9 01          lda #1
00CEBC  1  9D 48 08       sta present_table,x
00CEBF  1  AD 00 07       lda target_room
00CEC2  1  9D 00 20       sta place_table,x
00CEC5  1               :
00CEC5  1  A9 AC          lda #172
00CEC7  1  8D 77 07       sta msg_target
00CECA  1               _eac_close_chain_print:
00CECA  1  20 A7 ED       jsr newline
00CECD  1  20 C6 E1       jsr print_special_message
00CED0  1  90 03          bcc :+
00CED2  1  4C 1A D9       jmp _eac_no
00CED5  1               :
00CED5  1  20 A7 ED       jsr newline
00CED8  1  60             rts
00CED9  1               
00CED9  1               _eac_help:
00CED9  1  A2 96          ldx #<msg_help_1
00CEDB  1  A0 F1          ldy #>msg_help_1
00CEDD  1  20 4D DD       jsr print_zstr_xy
00CEE0  1  20 A7 ED       jsr newline
00CEE3  1  A2 C7          ldx #<msg_help_2
00CEE5  1  A0 F1          ldy #>msg_help_2
00CEE7  1  20 4D DD       jsr print_zstr_xy
00CEEA  1  20 A7 ED       jsr newline
00CEED  1  A2 F3          ldx #<msg_help_3
00CEEF  1  A0 F1          ldy #>msg_help_3
00CEF1  1  20 4D DD       jsr print_zstr_xy
00CEF4  1  20 A7 ED       jsr newline
00CEF7  1  A2 2D          ldx #<msg_help_4
00CEF9  1  A0 F2          ldy #>msg_help_4
00CEFB  1  20 4D DD       jsr print_zstr_xy
00CEFE  1  20 A7 ED       jsr newline
00CF01  1  60             rts
00CF02  1               
00CF02  1               _eac_light:
00CF02  1  AD 74 07       lda command_object
00CF05  1  C9 02          cmp #2
00CF07  1  F0 03          beq :+
00CF09  1  4C 1A D9       jmp _eac_no
00CF0C  1               :
00CF0C  1  20 C3 D8       jsr object_is_accessible
00CF0F  1  B0 03          bcs :+
00CF11  1  4C 1A D9       jmp _eac_no
00CF14  1               :
00CF14  1  A2 02          ldx #2
00CF16  1  BD 80 07       lda prop_table,x
00CF19  1  F0 0B          beq :+
00CF1B  1  A2 AA          ldx #<msg_lamp_already_on
00CF1D  1  A0 F2          ldy #>msg_lamp_already_on
00CF1F  1  20 4D DD       jsr print_zstr_xy
00CF22  1  20 A7 ED       jsr newline
00CF25  1  60             rts
00CF26  1               :
00CF26  1  A9 01          lda #1
00CF28  1  9D 80 07       sta prop_table,x
00CF2B  1  A2 7F          ldx #<msg_lamp_on
00CF2D  1  A0 F2          ldy #>msg_lamp_on
00CF2F  1  20 4D DD       jsr print_zstr_xy
00CF32  1  20 A7 ED       jsr newline
00CF35  1  60             rts
00CF36  1               
00CF36  1               _eac_dark:
00CF36  1  AD 74 07       lda command_object
00CF39  1  C9 02          cmp #2
00CF3B  1  F0 03          beq :+
00CF3D  1  4C 1A D9       jmp _eac_no
00CF40  1               :
00CF40  1  20 C3 D8       jsr object_is_accessible
00CF43  1  B0 03          bcs :+
00CF45  1  4C 1A D9       jmp _eac_no
00CF48  1               :
00CF48  1  A2 02          ldx #2
00CF4A  1  BD 80 07       lda prop_table,x
00CF4D  1  D0 0B          bne :+
00CF4F  1  A2 C3          ldx #<msg_lamp_already_off
00CF51  1  A0 F2          ldy #>msg_lamp_already_off
00CF53  1  20 4D DD       jsr print_zstr_xy
00CF56  1  20 A7 ED       jsr newline
00CF59  1  60             rts
00CF5A  1               :
00CF5A  1  A9 00          lda #0
00CF5C  1  9D 80 07       sta prop_table,x
00CF5F  1  A2 94          ldx #<msg_lamp_off
00CF61  1  A0 F2          ldy #>msg_lamp_off
00CF63  1  20 4D DD       jsr print_zstr_xy
00CF66  1  20 A7 ED       jsr newline
00CF69  1  60             rts
00CF6A  1               
00CF6A  1               _eac_eat:
00CF6A  1  AD 74 07       lda command_object
00CF6D  1  C9 13          cmp #19
00CF6F  1  F0 03          beq :+
00CF71  1  4C 1A D9       jmp _eac_no
00CF74  1               :
00CF74  1  20 C3 D8       jsr object_is_accessible
00CF77  1  B0 03          bcs :+
00CF79  1  4C 1A D9       jmp _eac_no
00CF7C  1               :
00CF7C  1  A2 13          ldx #19
00CF7E  1  A9 00          lda #0
00CF80  1  9D E4 07       sta toting_table,x
00CF83  1  9D 48 08       sta present_table,x
00CF86  1  9D 00 20       sta place_table,x
00CF89  1  A2 DD          ldx #<msg_eat_ok
00CF8B  1  A0 F2          ldy #>msg_eat_ok
00CF8D  1  20 4D DD       jsr print_zstr_xy
00CF90  1  20 A7 ED       jsr newline
00CF93  1  60             rts
00CF94  1               
00CF94  1               _eac_drink:
00CF94  1  AD 74 07       lda command_object
00CF97  1  C9 15          cmp #21
00CF99  1  D0 05          bne _eac_drink_not_water_obj
00CF9B  1  A9 14          lda #20
00CF9D  1  8D 74 07       sta command_object
00CFA0  1               _eac_drink_not_water_obj:
00CFA0  1  AD 74 07       lda command_object
00CFA3  1  C9 14          cmp #20
00CFA5  1  F0 11          beq _eac_drink_obj_ok
00CFA7  1  A9 6E          lda #110
00CFA9  1  8D 77 07       sta msg_target
00CFAC  1  20 C6 E1       jsr print_special_message
00CFAF  1  90 03          bcc :+
00CFB1  1  4C 1A D9       jmp _eac_no
00CFB4  1               :
00CFB4  1  20 A7 ED       jsr newline
00CFB7  1  60             rts
00CFB8  1               _eac_drink_obj_ok:
00CFB8  1  20 C3 D8       jsr object_is_accessible
00CFBB  1  B0 21          bcs _eac_drink_have_bottle
00CFBD  1  20 DB D8       jsr room_has_water
00CFC0  1  B0 11          bcs _eac_drink_stream
00CFC2  1  A9 6E          lda #110
00CFC4  1  8D 77 07       sta msg_target
00CFC7  1  20 C6 E1       jsr print_special_message
00CFCA  1  90 03          bcc :+
00CFCC  1  4C 1A D9       jmp _eac_no
00CFCF  1               :
00CFCF  1  20 A7 ED       jsr newline
00CFD2  1  60             rts
00CFD3  1               _eac_drink_stream:
00CFD3  1  A2 5B          ldx #<msg_drink_ok
00CFD5  1  A0 F3          ldy #>msg_drink_ok
00CFD7  1  20 4D DD       jsr print_zstr_xy
00CFDA  1  20 A7 ED       jsr newline
00CFDD  1  60             rts
00CFDE  1               _eac_drink_have_bottle:
00CFDE  1  A2 14          ldx #20
00CFE0  1  BD 80 07       lda prop_table,x
00CFE3  1  D0 0B          bne _eac_drink_have_water
00CFE5  1  A2 FA          ldx #<msg_no_water
00CFE7  1  A0 F2          ldy #>msg_no_water
00CFE9  1  20 4D DD       jsr print_zstr_xy
00CFEC  1  20 A7 ED       jsr newline
00CFEF  1  60             rts
00CFF0  1               _eac_drink_have_water:
00CFF0  1  A9 00          lda #0
00CFF2  1  9D 80 07       sta prop_table,x
00CFF5  1  A2 5B          ldx #<msg_drink_ok
00CFF7  1  A0 F3          ldy #>msg_drink_ok
00CFF9  1  20 4D DD       jsr print_zstr_xy
00CFFC  1  20 A7 ED       jsr newline
00CFFF  1  60             rts
00D000  1               
00D000  1               _eac_fill:
00D000  1  AD 74 07       lda command_object
00D003  1  C9 3A          cmp #58                  ; VASE
00D005  1  F0 51          beq _eac_fill_vase
00D007  1  C9 14          cmp #20
00D009  1  F0 11          beq _eac_fill_bottle
00D00B  1  A9 1D          lda #29
00D00D  1  8D 77 07       sta msg_target
00D010  1  20 C6 E1       jsr print_special_message
00D013  1  90 03          bcc :+
00D015  1  4C 1A D9       jmp _eac_no
00D018  1               :
00D018  1  20 A7 ED       jsr newline
00D01B  1  60             rts
00D01C  1               _eac_fill_bottle:
00D01C  1  A2 14          ldx #20
00D01E  1  BD E4 07       lda toting_table,x
00D021  1  D0 03          bne :+
00D023  1  4C 1A D9       jmp _eac_no
00D026  1               :
00D026  1  20 DB D8       jsr room_has_water
00D029  1  B0 0B          bcs :+
00D02B  1  A2 0D          ldx #<msg_no_water_here
00D02D  1  A0 F3          ldy #>msg_no_water_here
00D02F  1  20 4D DD       jsr print_zstr_xy
00D032  1  20 A7 ED       jsr newline
00D035  1  60             rts
00D036  1               :
00D036  1  A2 14          ldx #20
00D038  1  BD 80 07       lda prop_table,x
00D03B  1  F0 0B          beq :+
00D03D  1  A2 25          ldx #<msg_bottle_full
00D03F  1  A0 F3          ldy #>msg_bottle_full
00D041  1  20 4D DD       jsr print_zstr_xy
00D044  1  20 A7 ED       jsr newline
00D047  1  60             rts
00D048  1               :
00D048  1  A9 01          lda #1
00D04A  1  9D 80 07       sta prop_table,x
00D04D  1  A2 42          ldx #<msg_fill_ok
00D04F  1  A0 F3          ldy #>msg_fill_ok
00D051  1  20 4D DD       jsr print_zstr_xy
00D054  1  20 A7 ED       jsr newline
00D057  1  60             rts
00D058  1               
00D058  1               _eac_fill_vase:
00D058  1  20 DB D8       jsr room_has_water
00D05B  1  B0 0D          bcs :+
00D05D  1  A9 90          lda #144
00D05F  1  8D 77 07       sta msg_target
00D062  1  20 C6 E1       jsr print_special_message
00D065  1  90 03          bcc :+
00D067  1  4C 1A D9       jmp _eac_no
00D06A  1               :
00D06A  1  20 A7 ED       jsr newline
00D06D  1  60             rts
00D06E  1               :
00D06E  1  A2 3A          ldx #58
00D070  1  BD E4 07       lda toting_table,x
00D073  1  D0 0D          bne :+
00D075  1  A9 1D          lda #29
00D077  1  8D 77 07       sta msg_target
00D07A  1  20 C6 E1       jsr print_special_message
00D07D  1  90 03          bcc :+
00D07F  1  4C 1A D9       jmp _eac_no
00D082  1               :
00D082  1  20 A7 ED       jsr newline
00D085  1  60             rts
00D086  1               :
00D086  1  A9 91          lda #145
00D088  1  8D 77 07       sta msg_target
00D08B  1  20 C6 E1       jsr print_special_message
00D08E  1  90 03          bcc :+
00D090  1  4C 1A D9       jmp _eac_no
00D093  1               :
00D093  1  20 A7 ED       jsr newline
00D096  1                 ; vdrop(VASE)-like simplification after filling.
00D096  1  A2 3A          ldx #58
00D098  1  A9 00          lda #0
00D09A  1  9D E4 07       sta toting_table,x
00D09D  1  A9 01          lda #1
00D09F  1  9D 48 08       sta present_table,x
00D0A2  1  AD 00 07       lda target_room
00D0A5  1  9D 00 20       sta place_table,x
00D0A8  1  A2 0A          ldx #10                  ; PILLOW
00D0AA  1  BD 48 08       lda present_table,x
00D0AD  1  D0 0D          bne :+
00D0AF  1  BD E4 07       lda toting_table,x
00D0B2  1  D0 08          bne :+
00D0B4  1  A2 3A          ldx #58
00D0B6  1  A9 02          lda #2
00D0B8  1  9D 80 07       sta prop_table,x
00D0BB  1  60             rts
00D0BC  1               :
00D0BC  1  A2 3A          ldx #58
00D0BE  1  A9 00          lda #0
00D0C0  1  9D 80 07       sta prop_table,x
00D0C3  1  60             rts
00D0C4  1               
00D0C4  1               _eac_pour:
00D0C4  1  AD 74 07       lda command_object
00D0C7  1  C9 14          cmp #20
00D0C9  1  F0 19          beq _eac_pour_bottle
00D0CB  1  C9 15          cmp #21                  ; WATER
00D0CD  1  F0 3F          beq _eac_pour_liquid_obj
00D0CF  1  C9 16          cmp #22                  ; OIL
00D0D1  1  F0 3B          beq _eac_pour_liquid_obj
00D0D3  1  A9 4E          lda #78
00D0D5  1  8D 77 07       sta msg_target
00D0D8  1  20 C6 E1       jsr print_special_message
00D0DB  1  90 03          bcc :+
00D0DD  1  4C 1A D9       jmp _eac_no
00D0E0  1               :
00D0E0  1  20 A7 ED       jsr newline
00D0E3  1  60             rts
00D0E4  1               _eac_pour_bottle:
00D0E4  1  20 C3 D8       jsr object_is_accessible
00D0E7  1  B0 03          bcs :+
00D0E9  1  4C 1A D9       jmp _eac_no
00D0EC  1               :
00D0EC  1  A2 14          ldx #20
00D0EE  1  BD 80 07       lda prop_table,x
00D0F1  1  D0 0B          bne :+
00D0F3  1  A2 73          ldx #<msg_bottle_empty
00D0F5  1  A0 F3          ldy #>msg_bottle_empty
00D0F7  1  20 4D DD       jsr print_zstr_xy
00D0FA  1  20 A7 ED       jsr newline
00D0FD  1  60             rts
00D0FE  1               :
00D0FE  1  A9 00          lda #0
00D100  1  9D 80 07       sta prop_table,x
00D103  1  A2 91          ldx #<msg_pour_ok
00D105  1  A0 F3          ldy #>msg_pour_ok
00D107  1  20 4D DD       jsr print_zstr_xy
00D10A  1  20 A7 ED       jsr newline
00D10D  1  60             rts
00D10E  1               
00D10E  1               _eac_pour_liquid_obj:
00D10E  1                 ; Simplified liquid handling: require accessible full bottle.
00D10E  1  A2 14          ldx #20
00D110  1  BD E4 07       lda toting_table,x
00D113  1  D0 12          bne :+
00D115  1  BD 48 08       lda present_table,x
00D118  1  D0 0D          bne :+
00D11A  1  A9 4E          lda #78
00D11C  1  8D 77 07       sta msg_target
00D11F  1  20 C6 E1       jsr print_special_message
00D122  1  90 03          bcc :+
00D124  1  4C 1A D9       jmp _eac_no
00D127  1               :
00D127  1  20 A7 ED       jsr newline
00D12A  1  60             rts
00D12B  1               :
00D12B  1  BD 80 07       lda prop_table,x
00D12E  1  D0 0D          bne :+
00D130  1  A9 4E          lda #78
00D132  1  8D 77 07       sta msg_target
00D135  1  20 C6 E1       jsr print_special_message
00D138  1  90 03          bcc :+
00D13A  1  4C 1A D9       jmp _eac_no
00D13D  1               :
00D13D  1  20 A7 ED       jsr newline
00D140  1  60             rts
00D141  1               :
00D141  1  A9 00          lda #0
00D143  1  9D 80 07       sta prop_table,x
00D146  1  A2 09          ldx #9                   ; DOOR
00D148  1  BD 48 08       lda present_table,x
00D14B  1  F0 25          beq _eac_pour_liquid_default
00D14D  1  AD 74 07       lda command_object
00D150  1  C9 16          cmp #22
00D152  1  D0 0F          bne _eac_pour_liquid_water
00D154  1  A2 09          ldx #9
00D156  1  A9 01          lda #1
00D158  1  9D 80 07       sta prop_table,x
00D15B  1  A9 72          lda #114
00D15D  1  8D 77 07       sta msg_target
00D160  1  4C 77 D1       jmp _eac_pour_liquid_print
00D163  1               _eac_pour_liquid_water:
00D163  1  A2 09          ldx #9
00D165  1  A9 00          lda #0
00D167  1  9D 80 07       sta prop_table,x
00D16A  1  A9 71          lda #113
00D16C  1  8D 77 07       sta msg_target
00D16F  1  4C 77 D1       jmp _eac_pour_liquid_print
00D172  1               _eac_pour_liquid_default:
00D172  1  A9 4D          lda #77
00D174  1  8D 77 07       sta msg_target
00D177  1               _eac_pour_liquid_print:
00D177  1  20 C6 E1       jsr print_special_message
00D17A  1  90 03          bcc :+
00D17C  1  4C 1A D9       jmp _eac_no
00D17F  1               :
00D17F  1  20 A7 ED       jsr newline
00D182  1  60             rts
00D183  1               
00D183  1               _eac_wave:
00D183  1  AD 74 07       lda command_object
00D186  1  C9 05          cmp #5
00D188  1  F0 03          beq :+
00D18A  1  4C 1A D9       jmp _eac_no
00D18D  1               :
00D18D  1  20 C3 D8       jsr object_is_accessible
00D190  1  B0 03          bcs :+
00D192  1  4C 1A D9       jmp _eac_no
00D195  1               :
00D195  1                 ; Adventure parity: waving the rod at the fissure toggles the bridge.
00D195  1  A2 0C          ldx #12
00D197  1  BD 48 08       lda present_table,x
00D19A  1  D0 03          bne :+
00D19C  1  4C C6 D1       jmp _eac_wave_nothing
00D19F  1               :
00D19F  1  BD 80 07       lda prop_table,x
00D1A2  1  D0 0F          bne _eac_wave_close_bridge
00D1A4  1  A9 01          lda #1
00D1A6  1  9D 80 07       sta prop_table,x
00D1A9  1  A2 AB          ldx #<msg_bridge_now_spans
00D1AB  1  A0 F3          ldy #>msg_bridge_now_spans
00D1AD  1  20 4D DD       jsr print_zstr_xy
00D1B0  1  4C C2 D1       jmp _eac_wave_done
00D1B3  1               _eac_wave_close_bridge:
00D1B3  1  A9 00          lda #0
00D1B5  1  9D 80 07       sta prop_table,x
00D1B8  1  A2 D3          ldx #<msg_bridge_vanished
00D1BA  1  A0 F3          ldy #>msg_bridge_vanished
00D1BC  1  20 4D DD       jsr print_zstr_xy
00D1BF  1  4C C2 D1       jmp _eac_wave_done
00D1C2  1               _eac_wave_done:
00D1C2  1  20 A7 ED       jsr newline
00D1C5  1  60             rts
00D1C6  1               _eac_wave_nothing:
00D1C6  1  A2 F4          ldx #<msg_nothing_happens
00D1C8  1  A0 F3          ldy #>msg_nothing_happens
00D1CA  1  20 4D DD       jsr print_zstr_xy
00D1CD  1  20 A7 ED       jsr newline
00D1D0  1  60             rts
00D1D1  1               
00D1D1  1               _eac_find:
00D1D1  1  AD 74 07       lda command_object
00D1D4  1  D0 03          bne :+
00D1D6  1  4C 1A D9       jmp _eac_no
00D1D9  1               :
00D1D9  1  AA             tax
00D1DA  1  E0 64          cpx #100
00D1DC  1  90 03          bcc :+
00D1DE  1  4C 1A D9       jmp _eac_no
00D1E1  1               :
00D1E1  1  BD E4 07       lda toting_table,x
00D1E4  1  F0 08          beq _eac_find_check_here
00D1E6  1  A9 18          lda #24
00D1E8  1  8D 77 07       sta msg_target
00D1EB  1  4C 22 D2       jmp _eac_find_print
00D1EE  1               _eac_find_check_here:
00D1EE  1                 ; Adventure parity: WATER is findable if local water exists
00D1EE  1                 ; or if the carried bottle currently contains water.
00D1EE  1                 ; Parser maps WATER to object id 21.
00D1EE  1  AD 74 07       lda command_object
00D1F1  1  C9 15          cmp #21
00D1F3  1  D0 1B          bne _eac_find_check_present
00D1F5  1  A2 14          ldx #20
00D1F7  1  BD E4 07       lda toting_table,x
00D1FA  1  F0 07          beq _eac_find_check_room_water
00D1FC  1  BD 80 07       lda prop_table,x
00D1FF  1  C9 01          cmp #1
00D201  1  F0 05          beq _eac_find_here
00D203  1               _eac_find_check_room_water:
00D203  1  20 DB D8       jsr room_has_water
00D206  1  90 15          bcc _eac_find_not_found
00D208  1               _eac_find_here:
00D208  1  A9 5E          lda #94
00D20A  1  8D 77 07       sta msg_target
00D20D  1  4C 22 D2       jmp _eac_find_print
00D210  1               _eac_find_check_present:
00D210  1  BD 48 08       lda present_table,x
00D213  1  F0 08          beq _eac_find_not_found
00D215  1  A9 5E          lda #94
00D217  1  8D 77 07       sta msg_target
00D21A  1  4C 22 D2       jmp _eac_find_print
00D21D  1               _eac_find_not_found:
00D21D  1  A9 3B          lda #59
00D21F  1  8D 77 07       sta msg_target
00D222  1               _eac_find_print:
00D222  1  20 C6 E1       jsr print_special_message
00D225  1  90 07          bcc :+
00D227  1  A2 B7          ldx #<msg_exam_default
00D229  1  A0 F0          ldy #>msg_exam_default
00D22B  1  20 4D DD       jsr print_zstr_xy
00D22E  1               :
00D22E  1  20 A7 ED       jsr newline
00D231  1  60             rts
00D232  1               
00D232  1               _eac_say:
00D232  1  A2 68          ldx #<msg_okay
00D234  1  A0 F2          ldy #>msg_okay
00D236  1  20 4D DD       jsr print_zstr_xy
00D239  1  20 A7 ED       jsr newline
00D23C  1  AD 72 07       lda noun_len
00D23F  1  D0 01          bne :+
00D241  1  60             rts
00D242  1               :
00D242  1  A2 00          ldx #0
00D244  1               _eac_say_loop:
00D244  1  EC 72 07       cpx noun_len
00D247  1  B0 0A          bcs _eac_say_done
00D249  1  BD 30 07       lda noun_buf,x
00D24C  1  20 B2 ED       jsr print_char
00D24F  1  E8             inx
00D250  1  4C 44 D2       jmp _eac_say_loop
00D253  1               _eac_say_done:
00D253  1  20 A7 ED       jsr newline
00D256  1  60             rts
00D257  1               
00D257  1               _eac_kill:
00D257  1  AD 74 07       lda command_object
00D25A  1  D0 08          bne _eac_kill_have_obj
00D25C  1  A9 2C          lda #44
00D25E  1  8D 77 07       sta msg_target
00D261  1  4C E8 D2       jmp _eac_kill_print
00D264  1               _eac_kill_have_obj:
00D264  1  C9 08          cmp #8                   ; BIRD
00D266  1  F0 1F          beq _eac_kill_bird
00D268  1  C9 0E          cmp #14                  ; CLAM
00D26A  1  F0 48          beq _eac_kill_clam
00D26C  1  C9 0F          cmp #15                  ; OYSTER
00D26E  1  F0 44          beq _eac_kill_clam
00D270  1  C9 0B          cmp #11                  ; SNAKE
00D272  1  F0 38          beq _eac_kill_snake
00D274  1  C9 11          cmp #17                  ; DWARF
00D276  1  F0 44          beq _eac_kill_dwarf
00D278  1  C9 21          cmp #33                  ; TROLL
00D27A  1  F0 48          beq _eac_kill_troll
00D27C  1  C9 1F          cmp #31                  ; DRAGON
00D27E  1  F0 4C          beq _eac_kill_dragon
00D280  1  C9 23          cmp #35                  ; BEAR
00D282  1  F0 5F          beq _eac_kill_bear
00D284  1  4C 1A D9       jmp _eac_no
00D287  1               _eac_kill_bird:
00D287  1  20 C3 D8       jsr object_is_accessible
00D28A  1  B0 08          bcs :+
00D28C  1  A9 2C          lda #44
00D28E  1  8D 77 07       sta msg_target
00D291  1  4C E8 D2       jmp _eac_kill_print
00D294  1               :
00D294  1  A2 08          ldx #8
00D296  1  A9 00          lda #0
00D298  1  9D E4 07       sta toting_table,x
00D29B  1  9D 48 08       sta present_table,x
00D29E  1  9D 00 20       sta place_table,x
00D2A1  1  9D 80 07       sta prop_table,x
00D2A4  1  A9 2D          lda #45
00D2A6  1  8D 77 07       sta msg_target
00D2A9  1  4C E8 D2       jmp _eac_kill_print
00D2AC  1               _eac_kill_snake:
00D2AC  1  A9 2E          lda #46
00D2AE  1  8D 77 07       sta msg_target
00D2B1  1  4C E8 D2       jmp _eac_kill_print
00D2B4  1               _eac_kill_clam:
00D2B4  1  A9 96          lda #150
00D2B6  1  8D 77 07       sta msg_target
00D2B9  1  4C E8 D2       jmp _eac_kill_print
00D2BC  1               _eac_kill_dwarf:
00D2BC  1  A9 31          lda #49
00D2BE  1  8D 77 07       sta msg_target
00D2C1  1  4C E8 D2       jmp _eac_kill_print
00D2C4  1               _eac_kill_troll:
00D2C4  1  A9 9D          lda #157
00D2C6  1  8D 77 07       sta msg_target
00D2C9  1  4C E8 D2       jmp _eac_kill_print
00D2CC  1               _eac_kill_dragon:
00D2CC  1  A2 1F          ldx #31
00D2CE  1  BD 80 07       lda prop_table,x
00D2D1  1  D0 08          bne :+
00D2D3  1  A9 31          lda #49
00D2D5  1  8D 77 07       sta msg_target
00D2D8  1  4C E8 D2       jmp _eac_kill_print
00D2DB  1               :
00D2DB  1  A9 A7          lda #167
00D2DD  1  8D 77 07       sta msg_target
00D2E0  1  4C E8 D2       jmp _eac_kill_print
00D2E3  1               _eac_kill_bear:
00D2E3  1  A9 A5          lda #165
00D2E5  1  8D 77 07       sta msg_target
00D2E8  1               _eac_kill_print:
00D2E8  1  20 C6 E1       jsr print_special_message
00D2EB  1  90 03          bcc :+
00D2ED  1  4C 1A D9       jmp _eac_no
00D2F0  1               :
00D2F0  1  20 A7 ED       jsr newline
00D2F3  1  60             rts
00D2F4  1               
00D2F4  1               _eac_throw:
00D2F4  1  AD 74 07       lda command_object
00D2F7  1  D0 03          bne _eac_throw_have_obj
00D2F9  1  4C 1A D9       jmp _eac_no
00D2FC  1               _eac_throw_have_obj:
00D2FC  1  AA             tax
00D2FD  1  BD E4 07       lda toting_table,x
00D300  1  D0 11          bne _eac_throw_check_axe
00D302  1  A9 1D          lda #29
00D304  1  8D 77 07       sta msg_target
00D307  1  20 C6 E1       jsr print_special_message
00D30A  1  90 03          bcc :+
00D30C  1  4C 1A D9       jmp _eac_no
00D30F  1               :
00D30F  1  20 A7 ED       jsr newline
00D312  1  60             rts
00D313  1               _eac_throw_check_axe:
00D313  1                 ; Throwing food at a nearby bear follows FEED behavior.
00D313  1  AD 74 07       lda command_object
00D316  1  C9 13          cmp #19                  ; FOOD
00D318  1  D0 0F          bne :+
00D31A  1  A2 23          ldx #35                  ; BEAR
00D31C  1  BD 48 08       lda present_table,x
00D31F  1  F0 08          beq :+
00D321  1  A9 23          lda #35
00D323  1  8D 74 07       sta command_object
00D326  1  4C 8D D3       jmp _eac_feed
00D329  1               :
00D329  1  AD 74 07       lda command_object
00D32C  1  C9 1C          cmp #28                  ; AXE special case
00D32E  1  F0 03          beq _eac_throw_axe
00D330  1  4C 9E CA       jmp _eac_drop
00D333  1               _eac_throw_axe:
00D333  1  A2 1F          ldx #31                  ; DRAGON
00D335  1  BD 48 08       lda present_table,x
00D338  1  F0 0D          beq _eac_throw_chk_troll
00D33A  1  BD 80 07       lda prop_table,x
00D33D  1  D0 08          bne _eac_throw_chk_troll
00D33F  1  A9 98          lda #152
00D341  1  8D 77 07       sta msg_target
00D344  1  4C 6F D3       jmp _eac_throw_axe_done
00D347  1               _eac_throw_chk_troll:
00D347  1  A2 21          ldx #33                  ; TROLL
00D349  1  BD 48 08       lda present_table,x
00D34C  1  F0 08          beq _eac_throw_chk_bear
00D34E  1  A9 9E          lda #158
00D350  1  8D 77 07       sta msg_target
00D353  1  4C 6F D3       jmp _eac_throw_axe_done
00D356  1               _eac_throw_chk_bear:
00D356  1  A2 23          ldx #35                  ; BEAR
00D358  1  BD 48 08       lda present_table,x
00D35B  1  F0 0D          beq _eac_throw_axe_default
00D35D  1  BD 80 07       lda prop_table,x
00D360  1  D0 08          bne _eac_throw_axe_default
00D362  1  A9 A4          lda #164
00D364  1  8D 77 07       sta msg_target
00D367  1  4C 6F D3       jmp _eac_throw_axe_done
00D36A  1               _eac_throw_axe_default:
00D36A  1  A9 31          lda #49
00D36C  1  8D 77 07       sta msg_target
00D36F  1               _eac_throw_axe_done:
00D36F  1  A2 1C          ldx #28
00D371  1  A9 00          lda #0
00D373  1  9D E4 07       sta toting_table,x
00D376  1  A9 01          lda #1
00D378  1  9D 48 08       sta present_table,x
00D37B  1  AD 00 07       lda target_room
00D37E  1  9D 00 20       sta place_table,x
00D381  1  20 C6 E1       jsr print_special_message
00D384  1  90 03          bcc :+
00D386  1  4C 1A D9       jmp _eac_no
00D389  1               :
00D389  1  20 A7 ED       jsr newline
00D38C  1  60             rts
00D38D  1               
00D38D  1               _eac_feed:
00D38D  1  AD 74 07       lda command_object
00D390  1  C9 08          cmp #8                   ; BIRD
00D392  1  F0 22          beq _eac_feed_bird
00D394  1  C9 11          cmp #17                  ; DWARF
00D396  1  F0 26          beq _eac_feed_dwarf
00D398  1  C9 0B          cmp #11                  ; SNAKE
00D39A  1  F0 3E          beq _eac_feed_snake
00D39C  1  C9 23          cmp #35                  ; BEAR
00D39E  1  F0 61          beq _eac_feed_bear
00D3A0  1  C9 1F          cmp #31                  ; DRAGON
00D3A2  1  D0 03          bne :+
00D3A4  1  4C 42 D4       jmp _eac_feed_dragon
00D3A7  1               :
00D3A7  1  C9 21          cmp #33                  ; TROLL
00D3A9  1  D0 03          bne :+
00D3AB  1  4C 59 D4       jmp _eac_feed_troll
00D3AE  1               :
00D3AE  1  A9 0E          lda #14
00D3B0  1  8D 77 07       sta msg_target
00D3B3  1  4C 5E D4       jmp _eac_feed_print
00D3B6  1               _eac_feed_bird:
00D3B6  1  A9 64          lda #100
00D3B8  1  8D 77 07       sta msg_target
00D3BB  1  4C 5E D4       jmp _eac_feed_print
00D3BE  1               _eac_feed_dwarf:
00D3BE  1  A2 13          ldx #19                  ; FOOD
00D3C0  1  BD 48 08       lda present_table,x
00D3C3  1  D0 0D          bne :+
00D3C5  1  BD E4 07       lda toting_table,x
00D3C8  1  D0 08          bne :+
00D3CA  1  A9 6E          lda #110
00D3CC  1  8D 77 07       sta msg_target
00D3CF  1  4C 5E D4       jmp _eac_feed_print
00D3D2  1               :
00D3D2  1  A9 67          lda #103
00D3D4  1  8D 77 07       sta msg_target
00D3D7  1  4C 5E D4       jmp _eac_feed_print
00D3DA  1               _eac_feed_snake:
00D3DA  1  A2 08          ldx #8
00D3DC  1  BD 48 08       lda present_table,x
00D3DF  1  D0 0D          bne _eac_feed_snake_yes
00D3E1  1  BD E4 07       lda toting_table,x
00D3E4  1  D0 08          bne _eac_feed_snake_yes
00D3E6  1  A9 66          lda #102
00D3E8  1  8D 77 07       sta msg_target
00D3EB  1  4C 5E D4       jmp _eac_feed_print
00D3EE  1               _eac_feed_snake_yes:
00D3EE  1  A9 00          lda #0
00D3F0  1  9D 48 08       sta present_table,x
00D3F3  1  9D E4 07       sta toting_table,x
00D3F6  1  9D 00 20       sta place_table,x
00D3F9  1  A9 65          lda #101
00D3FB  1  8D 77 07       sta msg_target
00D3FE  1  4C 5E D4       jmp _eac_feed_print
00D401  1               _eac_feed_bear:
00D401  1  A2 13          ldx #19                  ; FOOD
00D403  1  BD 48 08       lda present_table,x
00D406  1  D0 1E          bne _eac_feed_bear_eat
00D408  1  BD E4 07       lda toting_table,x
00D40B  1  D0 19          bne _eac_feed_bear_eat
00D40D  1  A2 23          ldx #35
00D40F  1  BD 80 07       lda prop_table,x
00D412  1  C9 03          cmp #3
00D414  1  90 08          bcc :+
00D416  1  A9 6E          lda #110
00D418  1  8D 77 07       sta msg_target
00D41B  1  4C 5E D4       jmp _eac_feed_print
00D41E  1               :
00D41E  1  A9 66          lda #102
00D420  1  8D 77 07       sta msg_target
00D423  1  4C 5E D4       jmp _eac_feed_print
00D426  1               _eac_feed_bear_eat:
00D426  1  A2 13          ldx #19
00D428  1  A9 00          lda #0
00D42A  1  9D 48 08       sta present_table,x
00D42D  1  9D E4 07       sta toting_table,x
00D430  1  9D 00 20       sta place_table,x
00D433  1  A2 23          ldx #35
00D435  1  A9 01          lda #1
00D437  1  9D 80 07       sta prop_table,x
00D43A  1  A9 A8          lda #168
00D43C  1  8D 77 07       sta msg_target
00D43F  1  4C 5E D4       jmp _eac_feed_print
00D442  1               _eac_feed_dragon:
00D442  1  A2 1F          ldx #31
00D444  1  BD 80 07       lda prop_table,x
00D447  1  F0 08          beq :+
00D449  1  A9 6E          lda #110
00D44B  1  8D 77 07       sta msg_target
00D44E  1  4C 5E D4       jmp _eac_feed_print
00D451  1               :
00D451  1  A9 66          lda #102
00D453  1  8D 77 07       sta msg_target
00D456  1  4C 5E D4       jmp _eac_feed_print
00D459  1               _eac_feed_troll:
00D459  1  A9 B6          lda #182
00D45B  1  8D 77 07       sta msg_target
00D45E  1               _eac_feed_print:
00D45E  1  20 C6 E1       jsr print_special_message
00D461  1  90 03          bcc :+
00D463  1  4C 1A D9       jmp _eac_no
00D466  1               :
00D466  1  20 A7 ED       jsr newline
00D469  1  60             rts
00D46A  1               
00D46A  1               _eac_break:
00D46A  1  AD 74 07       lda command_object
00D46D  1  C9 17          cmp #23                  ; MIRROR
00D46F  1  F0 07          beq _eac_break_mirror
00D471  1  C9 3A          cmp #58                  ; VASE
00D473  1  F0 0B          beq _eac_break_vase
00D475  1  4C 1A D9       jmp _eac_no
00D478  1               _eac_break_mirror:
00D478  1  A9 94          lda #148
00D47A  1  8D 77 07       sta msg_target
00D47D  1  4C AC D4       jmp _eac_break_print
00D480  1               _eac_break_vase:
00D480  1  A2 3A          ldx #58
00D482  1  BD 80 07       lda prop_table,x
00D485  1  D0 22          bne _eac_break_done
00D487  1  A9 02          lda #2
00D489  1  9D 80 07       sta prop_table,x
00D48C  1  BD E4 07       lda toting_table,x
00D48F  1  F0 10          beq :+
00D491  1  A9 00          lda #0
00D493  1  9D E4 07       sta toting_table,x
00D496  1  A9 01          lda #1
00D498  1  9D 48 08       sta present_table,x
00D49B  1  AD 00 07       lda target_room
00D49E  1  9D 00 20       sta place_table,x
00D4A1  1               :
00D4A1  1  A9 C6          lda #198
00D4A3  1  8D 77 07       sta msg_target
00D4A6  1  4C AC D4       jmp _eac_break_print
00D4A9  1               _eac_break_done:
00D4A9  1  4C 1A D9       jmp _eac_no
00D4AC  1               _eac_break_print:
00D4AC  1  20 C6 E1       jsr print_special_message
00D4AF  1  90 03          bcc :+
00D4B1  1  4C 1A D9       jmp _eac_no
00D4B4  1               :
00D4B4  1  20 A7 ED       jsr newline
00D4B7  1  60             rts
00D4B8  1               
00D4B8  1               _eac_rub:
00D4B8  1  AD 74 07       lda command_object
00D4BB  1  C9 02          cmp #2
00D4BD  1  D0 08          bne _eac_rub_other
00D4BF  1  A9 4B          lda #75
00D4C1  1  8D 77 07       sta msg_target
00D4C4  1  4C CC D4       jmp _eac_rub_print
00D4C7  1               _eac_rub_other:
00D4C7  1  A9 4C          lda #76
00D4C9  1  8D 77 07       sta msg_target
00D4CC  1               _eac_rub_print:
00D4CC  1  20 C6 E1       jsr print_special_message
00D4CF  1  90 03          bcc :+
00D4D1  1  4C 1A D9       jmp _eac_no
00D4D4  1               :
00D4D4  1  20 A7 ED       jsr newline
00D4D7  1  60             rts
00D4D8  1               
00D4D8  1               _eac_wake:
00D4D8  1  AD 74 07       lda command_object
00D4DB  1  C9 11          cmp #17                  ; DWARF
00D4DD  1  D0 08          bne _eac_wake_default
00D4DF  1  A9 C7          lda #199
00D4E1  1  8D 77 07       sta msg_target
00D4E4  1  4C EC D4       jmp _eac_wake_print
00D4E7  1               _eac_wake_default:
00D4E7  1  A9 6E          lda #110
00D4E9  1  8D 77 07       sta msg_target
00D4EC  1               _eac_wake_print:
00D4EC  1  20 C6 E1       jsr print_special_message
00D4EF  1  90 03          bcc :+
00D4F1  1  4C 1A D9       jmp _eac_no
00D4F4  1               :
00D4F4  1  20 A7 ED       jsr newline
00D4F7  1  60             rts
00D4F8  1               
00D4F8  1               _eac_blast:
00D4F8  1  A9 43          lda #67
00D4FA  1  8D 77 07       sta msg_target
00D4FD  1  4C AA D5       jmp _eac_verbmsg_print
00D500  1               
00D500  1               _eac_score:
00D500  1  AD 72 07       lda noun_len
00D503  1  F0 08          beq :+
00D505  1  A9 0D          lda #13
00D507  1  8D 77 07       sta msg_target
00D50A  1  4C AA D5       jmp _eac_verbmsg_print
00D50D  1               :
00D50D  1  20 B6 D5       jsr print_score
00D510  1  60             rts
00D511  1               
00D511  1               _eac_calm:
00D511  1  A9 0E          lda #14
00D513  1  8D 77 07       sta msg_target
00D516  1  4C AA D5       jmp _eac_verbmsg_print
00D519  1               
00D519  1               _eac_walk:
00D519  1  A9 2B          lda #43
00D51B  1  8D 77 07       sta msg_target
00D51E  1  4C AA D5       jmp _eac_verbmsg_print
00D521  1               
00D521  1               _eac_nothing:
00D521  1  A9 36          lda #54
00D523  1  8D 77 07       sta msg_target
00D526  1  4C AA D5       jmp _eac_verbmsg_print
00D529  1               
00D529  1               _eac_brief:
00D529  1  A9 9B          lda #155
00D52B  1  8D 77 07       sta msg_target
00D52E  1  4C AA D5       jmp _eac_verbmsg_print
00D531  1               
00D531  1               _eac_suspend:
00D531  1  AD 72 07       lda noun_len
00D534  1  F0 08          beq :+
00D536  1  A9 0D          lda #13
00D538  1  8D 77 07       sta msg_target
00D53B  1  4C AA D5       jmp _eac_verbmsg_print
00D53E  1               :
00D53E  1  20 A3 D6       jsr save_game_snapshot
00D541  1  B0 0B          bcs _eac_suspend_fail
00D543  1  A2 23          ldx #<msg_game_saved
00D545  1  A0 F4          ldy #>msg_game_saved
00D547  1  20 4D DD       jsr print_zstr_xy
00D54A  1  20 A7 ED       jsr newline
00D54D  1  60             rts
00D54E  1               _eac_suspend_fail:
00D54E  1  A2 4D          ldx #<msg_save_failed
00D550  1  A0 F4          ldy #>msg_save_failed
00D552  1  20 4D DD       jsr print_zstr_xy
00D555  1  20 A7 ED       jsr newline
00D558  1  60             rts
00D559  1               
00D559  1               _eac_hours:
00D559  1  A9 0D          lda #13
00D55B  1  8D 77 07       sta msg_target
00D55E  1  4C AA D5       jmp _eac_verbmsg_print
00D561  1               
00D561  1               _eac_log:
00D561  1  A9 0D          lda #13
00D563  1  8D 77 07       sta msg_target
00D566  1  4C AA D5       jmp _eac_verbmsg_print
00D569  1               
00D569  1               _eac_load:
00D569  1  AD 72 07       lda noun_len
00D56C  1  F0 08          beq :+
00D56E  1  A9 0D          lda #13
00D570  1  8D 77 07       sta msg_target
00D573  1  4C AA D5       jmp _eac_verbmsg_print
00D576  1               :
00D576  1  20 30 D7       jsr load_game_snapshot
00D579  1  B0 1C          bcs _eac_load_fail
00D57B  1  A2 2F          ldx #<msg_game_restored
00D57D  1  A0 F4          ldy #>msg_game_restored
00D57F  1  20 4D DD       jsr print_zstr_xy
00D582  1  20 A7 ED       jsr newline
00D585  1  20 E5 E0       jsr print_room_long
00D588  1  20 E1 DC       jsr print_room_objects
00D58B  1  AE 00 07       ldx target_room
00D58E  1  A9 01          lda #1
00D590  1  9D 00 09       sta visited_table,x
00D593  1  20 A7 ED       jsr newline
00D596  1  60             rts
00D597  1               _eac_load_fail:
00D597  1  A2 3E          ldx #<msg_no_saved_game
00D599  1  A0 F4          ldy #>msg_no_saved_game
00D59B  1  20 4D DD       jsr print_zstr_xy
00D59E  1  20 A7 ED       jsr newline
00D5A1  1  60             rts
00D5A2  1               
00D5A2  1               _eac_foo:
00D5A2  1  A9 93          lda #147
00D5A4  1  8D 77 07       sta msg_target
00D5A7  1  4C AA D5       jmp _eac_verbmsg_print
00D5AA  1               
00D5AA  1               _eac_verbmsg_print:
00D5AA  1  20 C6 E1       jsr print_special_message
00D5AD  1  90 03          bcc :+
00D5AF  1  4C 1A D9       jmp _eac_no
00D5B2  1               :
00D5B2  1  20 A7 ED       jsr newline
00D5B5  1  60             rts
00D5B6  1               
00D5B6  1               print_score:
00D5B6  1                 ; Approximate original Adventure scoring using currently tracked state:
00D5B6  1                 ; - treasure discovery/return points
00D5B6  1                 ; - magazine-at-witt bonus
00D5B6  1                 ; - fixed baseline +2
00D5B6  1  20 47 D6       jsr compute_score
00D5B9  1  A9 53          lda #'S'
00D5BB  1  20 B2 ED       jsr print_char
00D5BE  1  A9 43          lda #'C'
00D5C0  1  20 B2 ED       jsr print_char
00D5C3  1  A9 4F          lda #'O'
00D5C5  1  20 B2 ED       jsr print_char
00D5C8  1  A9 52          lda #'R'
00D5CA  1  20 B2 ED       jsr print_char
00D5CD  1  A9 45          lda #'E'
00D5CF  1  20 B2 ED       jsr print_char
00D5D2  1  A9 3A          lda #':'
00D5D4  1  20 B2 ED       jsr print_char
00D5D7  1  A9 20          lda #' '
00D5D9  1  20 B2 ED       jsr print_char
00D5DC  1  20 6D E4       jsr print_u16_dec
00D5DF  1  20 A7 ED       jsr newline
00D5E2  1  60             rts
00D5E3  1               
00D5E3  1               print_quit_summary:
00D5E3  1  A2 73          ldx #<msg_treasures_label
00D5E5  1  A0 F7          ldy #>msg_treasures_label
00D5E7  1  20 4D DD       jsr print_zstr_xy
00D5EA  1  20 20 D6       jsr compute_treasures
00D5ED  1  20 6D E4       jsr print_u16_dec
00D5F0  1  20 A7 ED       jsr newline
00D5F3  1               
00D5F3  1  A2 88          ldx #<msg_survival_label
00D5F5  1  A0 F7          ldy #>msg_survival_label
00D5F7  1  20 4D DD       jsr print_zstr_xy
00D5FA  1  A9 1E          lda #30
00D5FC  1  8D 10 07       sta work_lo
00D5FF  1  A9 00          lda #0
00D601  1  8D 11 07       sta work_hi
00D604  1  20 6D E4       jsr print_u16_dec
00D607  1  20 A7 ED       jsr newline
00D60A  1               
00D60A  1  A2 9D          ldx #<msg_score_label
00D60C  1  A0 F7          ldy #>msg_score_label
00D60E  1  20 4D DD       jsr print_zstr_xy
00D611  1  20 47 D6       jsr compute_score
00D614  1  A9 1E          lda #30
00D616  1  20 96 D6       jsr score_add_a
00D619  1  20 6D E4       jsr print_u16_dec
00D61C  1  20 A7 ED       jsr newline
00D61F  1  60             rts
00D620  1               
00D620  1               compute_treasures:
00D620  1  A9 00          lda #0
00D622  1  8D 10 07       sta work_lo
00D625  1  8D 11 07       sta work_hi
00D628  1  A2 32          ldx #50
00D62A  1               _ct_loop:
00D62A  1  E0 50          cpx #80
00D62C  1  B0 18          bcs _ct_done
00D62E  1  BD 80 07       lda prop_table,x
00D631  1  30 0F          bmi _ct_next
00D633  1  BD 00 20       lda place_table,x
00D636  1  C9 03          cmp #3
00D638  1  D0 08          bne _ct_next
00D63A  1  EE 10 07       inc work_lo
00D63D  1  D0 03          bne _ct_next
00D63F  1  EE 11 07       inc work_hi
00D642  1               _ct_next:
00D642  1  E8             inx
00D643  1  4C 2A D6       jmp _ct_loop
00D646  1               _ct_done:
00D646  1  60             rts
00D647  1               
00D647  1               compute_score:
00D647  1  A9 00          lda #0
00D649  1  8D 10 07       sta work_lo
00D64C  1  8D 11 07       sta work_hi
00D64F  1  A2 32          ldx #50
00D651  1               _cs_loop:
00D651  1  E0 50          cpx #80                  ; MAXTRS=79 in original
00D653  1  B0 2D          bcs _cs_done_treasures
00D655  1  BD 80 07       lda prop_table,x
00D658  1  30 05          bmi _cs_skip_seen
00D65A  1  A9 02          lda #2
00D65C  1  20 96 D6       jsr score_add_a
00D65F  1               _cs_skip_seen:
00D65F  1  BD 80 07       lda prop_table,x
00D662  1  D0 1A          bne _cs_next
00D664  1  BD 00 20       lda place_table,x
00D667  1  C9 03          cmp #3
00D669  1  D0 13          bne _cs_next
00D66B  1  E0 37          cpx #55                  ; CHEST
00D66D  1  F0 06          beq _cs_add_chest
00D66F  1  90 08          bcc _cs_add_regular
00D671  1  A9 0E          lda #14                  ; k-2 where k=16
00D673  1  D0 06          bne _cs_add_bonus
00D675  1               _cs_add_chest:
00D675  1  A9 0C          lda #12                  ; k-2 where k=14
00D677  1  D0 02          bne _cs_add_bonus
00D679  1               _cs_add_regular:
00D679  1  A9 0A          lda #10                  ; k-2 where k=12
00D67B  1               _cs_add_bonus:
00D67B  1  20 96 D6       jsr score_add_a
00D67E  1               _cs_next:
00D67E  1  E8             inx
00D67F  1  4C 51 D6       jmp _cs_loop
00D682  1               
00D682  1               _cs_done_treasures:
00D682  1  A2 10          ldx #16                  ; MAGAZINE
00D684  1  BD 00 20       lda place_table,x
00D687  1  C9 6C          cmp #108
00D689  1  D0 05          bne _cs_no_mag_bonus
00D68B  1  A9 01          lda #1
00D68D  1  20 96 D6       jsr score_add_a
00D690  1               _cs_no_mag_bonus:
00D690  1  A9 02          lda #2
00D692  1  20 96 D6       jsr score_add_a
00D695  1  60             rts
00D696  1               
00D696  1               score_add_a:
00D696  1  18             clc
00D697  1  6D 10 07       adc work_lo
00D69A  1  8D 10 07       sta work_lo
00D69D  1  90 03          bcc :+
00D69F  1  EE 11 07       inc work_hi
00D6A2  1               :
00D6A2  1  60             rts
00D6A3  1               
00D6A3  1               save_game_snapshot:
00D6A3  1  20 6B D7       jsr pack_snapshot_buffer
00D6A6  1  20 93 E9       jsr fat32_openroot
00D6A9  1  A2 E6          ldx #<save_filename
00D6AB  1  A0 ED          ldy #>save_filename
00D6AD  1  20 5A EC       jsr fat32_finddirent
00D6B0  1  90 11          bcc _sgs_found
00D6B2  1               
00D6B2  1                 ; Save file missing: create it, then re-open.
00D6B2  1  20 03 D7       jsr create_save_snapshot_file
00D6B5  1  B0 4A          bcs _sgs_fail
00D6B7  1  20 93 E9       jsr fat32_openroot
00D6BA  1  A2 E6          ldx #<save_filename
00D6BC  1  A0 ED          ldy #>save_filename
00D6BE  1  20 5A EC       jsr fat32_finddirent
00D6C1  1  B0 3E          bcs _sgs_fail
00D6C3  1               
00D6C3  1               _sgs_found:
00D6C3  1  20 E0 EA       jsr fat32_opendirent
00D6C6  1               
00D6C6  1                 ; Save file must be exactly the expected snapshot size.
00D6C6  1  AD 5D 00       lda fat32_bytesremaining+3
00D6C9  1  D0 36          bne _sgs_fail
00D6CB  1  AD 5C 00       lda fat32_bytesremaining+2
00D6CE  1  D0 31          bne _sgs_fail
00D6D0  1  AD 5B 00       lda fat32_bytesremaining+1
00D6D3  1  C9 03          cmp #snapshot_size_hi
00D6D5  1  D0 2A          bne _sgs_fail
00D6D7  1  AD 5A 00       lda fat32_bytesremaining
00D6DA  1  C9 28          cmp #snapshot_size_lo
00D6DC  1  D0 23          bne _sgs_fail
00D6DE  1               
00D6DE  1                 ; Overwrite snapshot image from RAM.
00D6DE  1  A9 00          lda #<snapshot_buf
00D6E0  1  8D 54 00       sta fat32_address
00D6E3  1  A9 22          lda #>snapshot_buf
00D6E5  1  8D 55 00       sta fat32_address+1
00D6E8  1  A9 28          lda #snapshot_size_lo
00D6EA  1  8D 5A 00       sta fat32_bytesremaining
00D6ED  1  A9 03          lda #snapshot_size_hi
00D6EF  1  8D 5B 00       sta fat32_bytesremaining+1
00D6F2  1  A9 00          lda #0
00D6F4  1  8D 5C 00       sta fat32_bytesremaining+2
00D6F7  1  8D 5D 00       sta fat32_bytesremaining+3
00D6FA  1  20 37 ED       jsr fat32_file_write
00D6FD  1  B0 02          bcs _sgs_fail
00D6FF  1  18             clc
00D700  1  60             rts
00D701  1               _sgs_fail:
00D701  1  38             sec
00D702  1  60             rts
00D703  1               
00D703  1               create_save_snapshot_file:
00D703  1                 ; Create ADVSAVE DAT with exact snapshot size.
00D703  1  A9 28          lda #snapshot_size_lo
00D705  1  8D 5A 00       sta fat32_bytesremaining
00D708  1  A9 03          lda #snapshot_size_hi
00D70A  1  8D 5B 00       sta fat32_bytesremaining+1
00D70D  1  A9 00          lda #0
00D70F  1  8D 5C 00       sta fat32_bytesremaining+2
00D712  1  8D 5D 00       sta fat32_bytesremaining+3
00D715  1  20 D4 E9       jsr fat32_allocatefile
00D718  1  B0 14          bcs _create_save_fail
00D71A  1               
00D71A  1                 ; Allocation traverses FAT and changes sector context.
00D71A  1                 ; Re-open root directory before writing a new dir entry.
00D71A  1  20 93 E9       jsr fat32_openroot
00D71D  1               
00D71D  1  A9 E6          lda #<save_filename
00D71F  1  8D 62 00       sta fat32_filenamepointer
00D722  1  A9 ED          lda #>save_filename
00D724  1  8D 63 00       sta fat32_filenamepointer+1
00D727  1  20 43 EB       jsr fat32_writedirent
00D72A  1  B0 02          bcs _create_save_fail
00D72C  1               
00D72C  1  18             clc
00D72D  1  60             rts
00D72E  1               
00D72E  1               _create_save_fail:
00D72E  1  38             sec
00D72F  1  60             rts
00D730  1               
00D730  1               load_game_snapshot:
00D730  1  20 93 E9       jsr fat32_openroot
00D733  1  A2 E6          ldx #<save_filename
00D735  1  A0 ED          ldy #>save_filename
00D737  1  20 5A EC       jsr fat32_finddirent
00D73A  1  B0 2D          bcs _lgs_fail
00D73C  1  20 E0 EA       jsr fat32_opendirent
00D73F  1               
00D73F  1                 ; Require exact snapshot file size.
00D73F  1  AD 5D 00       lda fat32_bytesremaining+3
00D742  1  D0 25          bne _lgs_fail
00D744  1  AD 5C 00       lda fat32_bytesremaining+2
00D747  1  D0 20          bne _lgs_fail
00D749  1  AD 5B 00       lda fat32_bytesremaining+1
00D74C  1  C9 03          cmp #snapshot_size_hi
00D74E  1  D0 19          bne _lgs_fail
00D750  1  AD 5A 00       lda fat32_bytesremaining
00D753  1  C9 28          cmp #snapshot_size_lo
00D755  1  D0 12          bne _lgs_fail
00D757  1               
00D757  1  A9 00          lda #<snapshot_buf
00D759  1  8D 54 00       sta fat32_address
00D75C  1  A9 22          lda #>snapshot_buf
00D75E  1  8D 55 00       sta fat32_address+1
00D761  1  20 17 ED       jsr fat32_file_read
00D764  1  20 AD D7       jsr unpack_snapshot_buffer
00D767  1  18             clc
00D768  1  60             rts
00D769  1               _lgs_fail:
00D769  1  38             sec
00D76A  1  60             rts
00D76B  1               
00D76B  1               pack_snapshot_buffer:
00D76B  1  A9 00          lda #<snapshot_block1_base
00D76D  1  8D 0C 07       sta old_lo
00D770  1  A9 07          lda #>snapshot_block1_base
00D772  1  8D 0D 07       sta old_hi
00D775  1  A9 00          lda #<snapshot_buf
00D777  1  8D 10 07       sta work_lo
00D77A  1  A9 22          lda #>snapshot_buf
00D77C  1  8D 11 07       sta work_hi
00D77F  1  A9 C8          lda #snapshot_block1_len_lo
00D781  1  8D 03 07       sta field_lo
00D784  1  A9 02          lda #snapshot_block1_len_hi
00D786  1  8D 04 07       sta field_hi
00D789  1  20 EF D7       jsr copy_mem_block
00D78C  1               
00D78C  1  A9 00          lda #<snapshot_block2_base
00D78E  1  8D 0C 07       sta old_lo
00D791  1  A9 20          lda #>snapshot_block2_base
00D793  1  8D 0D 07       sta old_hi
00D796  1  A9 C8          lda #<(snapshot_buf + $02C8)
00D798  1  8D 10 07       sta work_lo
00D79B  1  A9 24          lda #>(snapshot_buf + $02C8)
00D79D  1  8D 11 07       sta work_hi
00D7A0  1  A9 64          lda #snapshot_block2_len_lo
00D7A2  1  8D 03 07       sta field_lo
00D7A5  1  A9 00          lda #snapshot_block2_len_hi
00D7A7  1  8D 04 07       sta field_hi
00D7AA  1  4C EF D7       jmp copy_mem_block
00D7AD  1               
00D7AD  1               unpack_snapshot_buffer:
00D7AD  1  A9 00          lda #<snapshot_buf
00D7AF  1  8D 0C 07       sta old_lo
00D7B2  1  A9 22          lda #>snapshot_buf
00D7B4  1  8D 0D 07       sta old_hi
00D7B7  1  A9 00          lda #<snapshot_block1_base
00D7B9  1  8D 10 07       sta work_lo
00D7BC  1  A9 07          lda #>snapshot_block1_base
00D7BE  1  8D 11 07       sta work_hi
00D7C1  1  A9 C8          lda #snapshot_block1_len_lo
00D7C3  1  8D 03 07       sta field_lo
00D7C6  1  A9 02          lda #snapshot_block1_len_hi
00D7C8  1  8D 04 07       sta field_hi
00D7CB  1  20 EF D7       jsr copy_mem_block
00D7CE  1               
00D7CE  1  A9 C8          lda #<(snapshot_buf + $02C8)
00D7D0  1  8D 0C 07       sta old_lo
00D7D3  1  A9 24          lda #>(snapshot_buf + $02C8)
00D7D5  1  8D 0D 07       sta old_hi
00D7D8  1  A9 00          lda #<snapshot_block2_base
00D7DA  1  8D 10 07       sta work_lo
00D7DD  1  A9 20          lda #>snapshot_block2_base
00D7DF  1  8D 11 07       sta work_hi
00D7E2  1  A9 64          lda #snapshot_block2_len_lo
00D7E4  1  8D 03 07       sta field_lo
00D7E7  1  A9 00          lda #snapshot_block2_len_hi
00D7E9  1  8D 04 07       sta field_hi
00D7EC  1  4C EF D7       jmp copy_mem_block
00D7EF  1               
00D7EF  1               copy_mem_block:
00D7EF  1  AD 03 07       lda field_lo
00D7F2  1  0D 04 07       ora field_hi
00D7F5  1  F0 45          beq _cmb_done
00D7F7  1               _cmb_loop:
00D7F7  1  A0 00          ldy #0
00D7F9  1  AD 0C 07       lda old_lo
00D7FC  1  85 40          sta zp_sd_address
00D7FE  1  AD 0D 07       lda old_hi
00D801  1  85 41          sta zp_sd_address+1
00D803  1  B1 40          lda (zp_sd_address),y
00D805  1  8D 0B 07       sta tmp_digit
00D808  1  AD 10 07       lda work_lo
00D80B  1  8D 54 00       sta fat32_address
00D80E  1  AD 11 07       lda work_hi
00D811  1  8D 55 00       sta fat32_address+1
00D814  1  AD 0B 07       lda tmp_digit
00D817  1  91 54          sta (fat32_address),y
00D819  1  EE 0C 07       inc old_lo
00D81C  1  D0 03          bne :+
00D81E  1  EE 0D 07       inc old_hi
00D821  1               :
00D821  1  EE 10 07       inc work_lo
00D824  1  D0 03          bne :+
00D826  1  EE 11 07       inc work_hi
00D829  1               :
00D829  1  AD 03 07       lda field_lo
00D82C  1  D0 03          bne :+
00D82E  1  CE 04 07       dec field_hi
00D831  1               :
00D831  1  CE 03 07       dec field_lo
00D834  1  AD 03 07       lda field_lo
00D837  1  0D 04 07       ora field_hi
00D83A  1  D0 BB          bne _cmb_loop
00D83C  1               _cmb_done:
00D83C  1  60             rts
00D83D  1               
00D83D  1               command_is_unlock:
00D83D  1  AD 70 07       lda cmd_len
00D840  1  C9 06          cmp #6
00D842  1  B0 02          bcs :+
00D844  1  18             clc
00D845  1  60             rts
00D846  1               :
00D846  1  AD 20 07       lda cmd_buf
00D849  1  C9 55          cmp #'U'
00D84B  1  D0 25          bne _ciu_no
00D84D  1  AD 21 07       lda cmd_buf+1
00D850  1  C9 4E          cmp #'N'
00D852  1  D0 1E          bne _ciu_no
00D854  1  AD 22 07       lda cmd_buf+2
00D857  1  C9 4C          cmp #'L'
00D859  1  D0 17          bne _ciu_no
00D85B  1  AD 23 07       lda cmd_buf+3
00D85E  1  C9 4F          cmp #'O'
00D860  1  D0 10          bne _ciu_no
00D862  1  AD 24 07       lda cmd_buf+4
00D865  1  C9 43          cmp #'C'
00D867  1  D0 09          bne _ciu_no
00D869  1  AD 25 07       lda cmd_buf+5
00D86C  1  C9 4B          cmp #'K'
00D86E  1  D0 02          bne _ciu_no
00D870  1  38             sec
00D871  1  60             rts
00D872  1               _ciu_no:
00D872  1  18             clc
00D873  1  60             rts
00D874  1               
00D874  1               command_is_lock:
00D874  1  AD 70 07       lda cmd_len
00D877  1  C9 04          cmp #4
00D879  1  B0 02          bcs :+
00D87B  1  18             clc
00D87C  1  60             rts
00D87D  1               :
00D87D  1  AD 20 07       lda cmd_buf
00D880  1  C9 4C          cmp #'L'
00D882  1  D0 17          bne _cil_no
00D884  1  AD 21 07       lda cmd_buf+1
00D887  1  C9 4F          cmp #'O'
00D889  1  D0 10          bne _cil_no
00D88B  1  AD 22 07       lda cmd_buf+2
00D88E  1  C9 43          cmp #'C'
00D890  1  D0 09          bne _cil_no
00D892  1  AD 23 07       lda cmd_buf+3
00D895  1  C9 4B          cmp #'K'
00D897  1  D0 02          bne _cil_no
00D899  1  38             sec
00D89A  1  60             rts
00D89B  1               _cil_no:
00D89B  1  18             clc
00D89C  1  60             rts
00D89D  1               
00D89D  1               player_has_keys:
00D89D  1  A2 01          ldx #1
00D89F  1  BD E4 07       lda toting_table,x
00D8A2  1  F0 02          beq _phk_no
00D8A4  1  38             sec
00D8A5  1  60             rts
00D8A6  1               _phk_no:
00D8A6  1  18             clc
00D8A7  1  60             rts
00D8A8  1               
00D8A8  1               player_has_keys_here:
00D8A8  1  A2 01          ldx #1
00D8AA  1  BD E4 07       lda toting_table,x
00D8AD  1  D0 05          bne _phkh_yes
00D8AF  1  BD 48 08       lda present_table,x
00D8B2  1  F0 02          beq _phkh_no
00D8B4  1               _phkh_yes:
00D8B4  1  38             sec
00D8B5  1  60             rts
00D8B6  1               _phkh_no:
00D8B6  1  18             clc
00D8B7  1  60             rts
00D8B8  1               
00D8B8  1               object_is_portable:
00D8B8  1                 ; Returns C set if command_object can be carried.
00D8B8  1                 ; Keep fixed scenery objects out of inventory.
00D8B8  1  AD 74 07       lda command_object
00D8BB  1  C9 03          cmp #3                  ; GRATE
00D8BD  1  D0 02          bne _oip_yes
00D8BF  1  18             clc
00D8C0  1  60             rts
00D8C1  1               _oip_yes:
00D8C1  1  38             sec
00D8C2  1  60             rts
00D8C3  1               
00D8C3  1               object_is_accessible:
00D8C3  1                 ; Returns C set if command_object is in inventory or present in room.
00D8C3  1  AD 74 07       lda command_object
00D8C6  1  AA             tax
00D8C7  1  E0 64          cpx #100
00D8C9  1  90 02          bcc :+
00D8CB  1  18             clc
00D8CC  1  60             rts
00D8CD  1               :
00D8CD  1  BD E4 07       lda toting_table,x
00D8D0  1  D0 07          bne _oia_yes
00D8D2  1  BD 48 08       lda present_table,x
00D8D5  1  D0 02          bne _oia_yes
00D8D7  1  18             clc
00D8D8  1  60             rts
00D8D9  1               _oia_yes:
00D8D9  1  38             sec
00D8DA  1  60             rts
00D8DB  1               
00D8DB  1               room_has_water:
00D8DB  1                 ; Early-game water locations.
00D8DB  1  AD 00 07       lda target_room
00D8DE  1  C9 01          cmp #1
00D8E0  1  F0 0A          beq _rhw_yes
00D8E2  1  C9 04          cmp #4
00D8E4  1  F0 06          beq _rhw_yes
00D8E6  1  C9 07          cmp #7
00D8E8  1  F0 02          beq _rhw_yes
00D8EA  1  18             clc
00D8EB  1  60             rts
00D8EC  1               _rhw_yes:
00D8EC  1  38             sec
00D8ED  1  60             rts
00D8EE  1               
00D8EE  1               _eac_parse_error:
00D8EE  1  AD 75 07       lda parse_error
00D8F1  1  C9 02          cmp #2
00D8F3  1  D0 0B          bne _eac_perr_check_missing
00D8F5  1  A2 E0          ldx #<msg_unknown_obj
00D8F7  1  A0 F0          ldy #>msg_unknown_obj
00D8F9  1  20 4D DD       jsr print_zstr_xy
00D8FC  1  20 A7 ED       jsr newline
00D8FF  1  60             rts
00D900  1               _eac_perr_check_missing:
00D900  1  C9 03          cmp #3
00D902  1  D0 0B          bne _eac_perr_default
00D904  1  A2 F7          ldx #<msg_missing_obj
00D906  1  A0 F0          ldy #>msg_missing_obj
00D908  1  20 4D DD       jsr print_zstr_xy
00D90B  1  20 A7 ED       jsr newline
00D90E  1  60             rts
00D90F  1               _eac_perr_default:
00D90F  1  A2 C8          ldx #<msg_unknown_word
00D911  1  A0 F0          ldy #>msg_unknown_word
00D913  1  20 4D DD       jsr print_zstr_xy
00D916  1  20 A7 ED       jsr newline
00D919  1  60             rts
00D91A  1               
00D91A  1               _eac_no:
00D91A  1  A9 4E          lda #'N'
00D91C  1  20 B2 ED       jsr print_char
00D91F  1  A9 4F          lda #'O'
00D921  1  20 B2 ED       jsr print_char
00D924  1  20 A7 ED       jsr newline
00D927  1  60             rts
00D928  1               
00D928  1               read_pct_roll:
00D928  1                 ; Internal RNG roll: pct_roll = random value in 0..99.
00D928  1  20 3D D9       jsr rng_next_byte
00D92B  1  C9 64          cmp #100
00D92D  1  90 0A          bcc :+
00D92F  1  38             sec
00D930  1  E9 64          sbc #100
00D932  1  C9 64          cmp #100
00D934  1  90 03          bcc :+
00D936  1  38             sec
00D937  1  E9 64          sbc #100
00D939  1               :
00D939  1  8D 15 07       sta pct_roll
00D93C  1  60             rts
00D93D  1               
00D93D  1               rng_next_byte:
00D93D  1                 ; 8-bit Galois LFSR with polynomial 0x1D, period 255 (non-zero states).
00D93D  1  AD 7A 07       lda rng_state
00D940  1  D0 02          bne :+
00D942  1  A9 A7          lda #$A7
00D944  1               :
00D944  1  4A             lsr
00D945  1  90 02          bcc :+
00D947  1  49 1D          eor #$1D
00D949  1               :
00D949  1  8D 7A 07       sta rng_state
00D94C  1  60             rts
00D94D  1               
00D94D  1               prompt_yes_no:
00D94D  1                 ; Prompt and read one line. Returns C set for YES, clear for NO/other.
00D94D  1  A9 3E          lda #'>'
00D94F  1  20 B2 ED       jsr print_char
00D952  1  A9 20          lda #' '
00D954  1  20 B2 ED       jsr print_char
00D957  1  A9 00          lda #0
00D959  1  8D 02 07       sta input_seen
00D95C  1  8D 0B 07       sta tmp_digit
00D95F  1               _pyn_loop:
00D95F  1  20 28 A4       jsr get_input_filtered
00D962  1  C9 0D          cmp #$0D
00D964  1  F0 24          beq _pyn_done
00D966  1  C9 0A          cmp #$0A
00D968  1  F0 20          beq _pyn_done
00D96A  1  C9 61          cmp #'a'
00D96C  1  90 06          bcc :+
00D96E  1  C9 7B          cmp #('z'+1)
00D970  1  B0 02          bcs :+
00D972  1  29 DF          and #$DF
00D974  1               :
00D974  1  C9 41          cmp #'A'
00D976  1  90 E7          bcc _pyn_loop
00D978  1  C9 5B          cmp #('Z'+1)
00D97A  1  B0 E3          bcs _pyn_loop
00D97C  1  AE 02 07       ldx input_seen
00D97F  1  D0 DE          bne _pyn_loop
00D981  1  8D 0B 07       sta tmp_digit
00D984  1  EE 02 07       inc input_seen
00D987  1  4C 5F D9       jmp _pyn_loop
00D98A  1               _pyn_done:
00D98A  1  AD 0B 07       lda tmp_digit
00D98D  1  C9 59          cmp #'Y'
00D98F  1  F0 02          beq _pyn_yes
00D991  1  18             clc
00D992  1  60             rts
00D993  1               _pyn_yes:
00D993  1  38             sec
00D994  1  60             rts
00D995  1               
00D995  1               read_carried_obj:
00D995  1                 ; Read carried object id entry (0..99), default 0.
00D995  1  A9 00          lda #0
00D997  1  8D 16 07       sta carried_obj
00D99A  1  A9 00          lda #0
00D99C  1  8D 02 07       sta input_seen
00D99F  1               
00D99F  1  A9 43          lda #'C'
00D9A1  1  20 B2 ED       jsr print_char
00D9A4  1  A9 3F          lda #'?'
00D9A6  1  20 B2 ED       jsr print_char
00D9A9  1  A9 20          lda #' '
00D9AB  1  20 B2 ED       jsr print_char
00D9AE  1               
00D9AE  1               _rc_loop:
00D9AE  1  20 28 A4       jsr get_input_filtered
00D9B1  1  C9 0D          cmp #$0D
00D9B3  1  F0 36          beq _rc_eol
00D9B5  1  C9 0A          cmp #$0A
00D9B7  1  F0 32          beq _rc_eol
00D9B9  1  C9 30          cmp #'0'
00D9BB  1  90 F1          bcc _rc_loop
00D9BD  1  C9 3A          cmp #('9'+1)
00D9BF  1  B0 ED          bcs _rc_loop
00D9C1  1               
00D9C1  1  29 0F          and #$0F
00D9C3  1  8D 0B 07       sta tmp_digit
00D9C6  1  AD 02 07       lda input_seen
00D9C9  1  D0 05          bne _rc_accum
00D9CB  1  A9 00          lda #0
00D9CD  1  8D 16 07       sta carried_obj
00D9D0  1               _rc_accum:
00D9D0  1  A9 01          lda #1
00D9D2  1  8D 02 07       sta input_seen
00D9D5  1               
00D9D5  1  AD 16 07       lda carried_obj
00D9D8  1  0A             asl
00D9D9  1  8D 0E 07       sta mul_lo
00D9DC  1  0A             asl
00D9DD  1  0A             asl
00D9DE  1  18             clc
00D9DF  1  6D 0E 07       adc mul_lo
00D9E2  1  6D 0B 07       adc tmp_digit
00D9E5  1  8D 16 07       sta carried_obj
00D9E8  1  4C AE D9       jmp _rc_loop
00D9EB  1               
00D9EB  1               _rc_eol:
00D9EB  1  AD 02 07       lda input_seen
00D9EE  1  F0 BE          beq _rc_loop
00D9F0  1               
00D9F0  1               _rc_done:
00D9F0  1  20 A7 ED       jsr newline
00D9F3  1  60             rts
00D9F4  1               
00D9F4  1               read_present_obj:
00D9F4  1                 ; Read present object id entry (0..99), default 0.
00D9F4  1  A9 00          lda #0
00D9F6  1  8D 17 07       sta present_obj
00D9F9  1  A9 00          lda #0
00D9FB  1  8D 02 07       sta input_seen
00D9FE  1               
00D9FE  1  A9 41          lda #'A'
00DA00  1  20 B2 ED       jsr print_char
00DA03  1  A9 3F          lda #'?'
00DA05  1  20 B2 ED       jsr print_char
00DA08  1  A9 20          lda #' '
00DA0A  1  20 B2 ED       jsr print_char
00DA0D  1               
00DA0D  1               _ra_loop:
00DA0D  1  20 28 A4       jsr get_input_filtered
00DA10  1  C9 0D          cmp #$0D
00DA12  1  F0 36          beq _ra_eol
00DA14  1  C9 0A          cmp #$0A
00DA16  1  F0 32          beq _ra_eol
00DA18  1  C9 30          cmp #'0'
00DA1A  1  90 F1          bcc _ra_loop
00DA1C  1  C9 3A          cmp #('9'+1)
00DA1E  1  B0 ED          bcs _ra_loop
00DA20  1               
00DA20  1  29 0F          and #$0F
00DA22  1  8D 0B 07       sta tmp_digit
00DA25  1  AD 02 07       lda input_seen
00DA28  1  D0 05          bne _ra_accum
00DA2A  1  A9 00          lda #0
00DA2C  1  8D 17 07       sta present_obj
00DA2F  1               _ra_accum:
00DA2F  1  A9 01          lda #1
00DA31  1  8D 02 07       sta input_seen
00DA34  1               
00DA34  1  AD 17 07       lda present_obj
00DA37  1  0A             asl
00DA38  1  8D 0E 07       sta mul_lo
00DA3B  1  0A             asl
00DA3C  1  0A             asl
00DA3D  1  18             clc
00DA3E  1  6D 0E 07       adc mul_lo
00DA41  1  6D 0B 07       adc tmp_digit
00DA44  1  8D 17 07       sta present_obj
00DA47  1  4C 0D DA       jmp _ra_loop
00DA4A  1               
00DA4A  1               _ra_eol:
00DA4A  1  AD 02 07       lda input_seen
00DA4D  1  F0 BE          beq _ra_loop
00DA4F  1               
00DA4F  1               _ra_done:
00DA4F  1  20 A7 ED       jsr newline
00DA52  1  60             rts
00DA53  1               
00DA53  1               read_prop_obj_id:
00DA53  1                 ; Read property override object id (0..99), default 0.
00DA53  1  A9 00          lda #0
00DA55  1  8D 1A 07       sta prop_obj_id
00DA58  1  A9 00          lda #0
00DA5A  1  8D 02 07       sta input_seen
00DA5D  1               
00DA5D  1  A9 4F          lda #'O'
00DA5F  1  20 B2 ED       jsr print_char
00DA62  1  A9 3F          lda #'?'
00DA64  1  20 B2 ED       jsr print_char
00DA67  1  A9 20          lda #' '
00DA69  1  20 B2 ED       jsr print_char
00DA6C  1               
00DA6C  1               _ro_loop:
00DA6C  1  20 28 A4       jsr get_input_filtered
00DA6F  1  C9 0D          cmp #$0D
00DA71  1  F0 36          beq _ro_eol
00DA73  1  C9 0A          cmp #$0A
00DA75  1  F0 32          beq _ro_eol
00DA77  1  C9 30          cmp #'0'
00DA79  1  90 F1          bcc _ro_loop
00DA7B  1  C9 3A          cmp #('9'+1)
00DA7D  1  B0 ED          bcs _ro_loop
00DA7F  1               
00DA7F  1  29 0F          and #$0F
00DA81  1  8D 0B 07       sta tmp_digit
00DA84  1  AD 02 07       lda input_seen
00DA87  1  D0 05          bne _ro_accum
00DA89  1  A9 00          lda #0
00DA8B  1  8D 1A 07       sta prop_obj_id
00DA8E  1               _ro_accum:
00DA8E  1  A9 01          lda #1
00DA90  1  8D 02 07       sta input_seen
00DA93  1               
00DA93  1  AD 1A 07       lda prop_obj_id
00DA96  1  0A             asl
00DA97  1  8D 0E 07       sta mul_lo
00DA9A  1  0A             asl
00DA9B  1  0A             asl
00DA9C  1  18             clc
00DA9D  1  6D 0E 07       adc mul_lo
00DAA0  1  6D 0B 07       adc tmp_digit
00DAA3  1  8D 1A 07       sta prop_obj_id
00DAA6  1  4C 6C DA       jmp _ro_loop
00DAA9  1               
00DAA9  1               _ro_eol:
00DAA9  1  AD 02 07       lda input_seen
00DAAC  1  F0 BE          beq _ro_loop
00DAAE  1               
00DAAE  1               _ro_done:
00DAAE  1  20 A7 ED       jsr newline
00DAB1  1  60             rts
00DAB2  1               
00DAB2  1               read_prop_obj_state:
00DAB2  1                 ; Read property override state (0..99), default 0.
00DAB2  1  A9 00          lda #0
00DAB4  1  8D 1B 07       sta prop_obj_state
00DAB7  1  A9 00          lda #0
00DAB9  1  8D 02 07       sta input_seen
00DABC  1               
00DABC  1  A9 53          lda #'S'
00DABE  1  20 B2 ED       jsr print_char
00DAC1  1  A9 3F          lda #'?'
00DAC3  1  20 B2 ED       jsr print_char
00DAC6  1  A9 20          lda #' '
00DAC8  1  20 B2 ED       jsr print_char
00DACB  1               
00DACB  1               _rs_loop:
00DACB  1  20 28 A4       jsr get_input_filtered
00DACE  1  C9 0D          cmp #$0D
00DAD0  1  F0 36          beq _rs_eol
00DAD2  1  C9 0A          cmp #$0A
00DAD4  1  F0 32          beq _rs_eol
00DAD6  1  C9 30          cmp #'0'
00DAD8  1  90 F1          bcc _rs_loop
00DADA  1  C9 3A          cmp #('9'+1)
00DADC  1  B0 ED          bcs _rs_loop
00DADE  1               
00DADE  1  29 0F          and #$0F
00DAE0  1  8D 0B 07       sta tmp_digit
00DAE3  1  AD 02 07       lda input_seen
00DAE6  1  D0 05          bne _rs_accum
00DAE8  1  A9 00          lda #0
00DAEA  1  8D 1B 07       sta prop_obj_state
00DAED  1               _rs_accum:
00DAED  1  A9 01          lda #1
00DAEF  1  8D 02 07       sta input_seen
00DAF2  1               
00DAF2  1  AD 1B 07       lda prop_obj_state
00DAF5  1  0A             asl
00DAF6  1  8D 0E 07       sta mul_lo
00DAF9  1  0A             asl
00DAFA  1  0A             asl
00DAFB  1  18             clc
00DAFC  1  6D 0E 07       adc mul_lo
00DAFF  1  6D 0B 07       adc tmp_digit
00DB02  1  8D 1B 07       sta prop_obj_state
00DB05  1  4C CB DA       jmp _rs_loop
00DB08  1               
00DB08  1               _rs_eol:
00DB08  1  AD 02 07       lda input_seen
00DB0B  1  F0 BE          beq _rs_loop
00DB0D  1               
00DB0D  1               _rs_done:
00DB0D  1  20 A7 ED       jsr newline
00DB10  1  60             rts
00DB11  1               
00DB11  1               init_prop_table:
00DB11  1                 ; Parity with original Adventure:
00DB11  1                 ; prop[0..49] = 0, prop[50..99] = -1 ($FF)
00DB11  1  A2 00          ldx #0
00DB13  1  A9 00          lda #0
00DB15  1               _ipt_loop:
00DB15  1  9D 80 07       sta prop_table,x
00DB18  1  E8             inx
00DB19  1  E0 32          cpx #50
00DB1B  1  90 F8          bcc _ipt_loop
00DB1D  1  A9 FF          lda #$FF
00DB1F  1               _ipt_loop_neg:
00DB1F  1  9D 80 07       sta prop_table,x
00DB22  1  E8             inx
00DB23  1  E0 64          cpx #100
00DB25  1  90 F8          bcc _ipt_loop_neg
00DB27  1  60             rts
00DB28  1               
00DB28  1               init_toting_table:
00DB28  1                 ; Initialize toting table values to zero.
00DB28  1  A2 00          ldx #0
00DB2A  1  A9 00          lda #0
00DB2C  1               _itt_loop:
00DB2C  1  9D E4 07       sta toting_table,x
00DB2F  1  E8             inx
00DB30  1  E0 64          cpx #100
00DB32  1  90 F8          bcc _itt_loop
00DB34  1  60             rts
00DB35  1               
00DB35  1               init_present_table:
00DB35  1                 ; Initialize present table values to zero.
00DB35  1  A2 00          ldx #0
00DB37  1  A9 00          lda #0
00DB39  1               _iat_loop:
00DB39  1  9D 48 08       sta present_table,x
00DB3C  1  E8             inx
00DB3D  1  E0 64          cpx #100
00DB3F  1  90 F8          bcc _iat_loop
00DB41  1  60             rts
00DB42  1               
00DB42  1               init_visited_table:
00DB42  1                 ; Initialize visited-room flags to zero.
00DB42  1  A2 00          ldx #0
00DB44  1  A9 00          lda #0
00DB46  1               _ivt_loop:
00DB46  1  9D 00 09       sta visited_table,x
00DB49  1  E8             inx
00DB4A  1  E0 C8          cpx #200
00DB4C  1  90 F8          bcc _ivt_loop
00DB4E  1  60             rts
00DB4F  1               
00DB4F  1               init_place_table:
00DB4F  1                 ; Initialize place table to default Adventure object locations.
00DB4F  1  A2 00          ldx #0
00DB51  1  A9 00          lda #0
00DB53  1               _ipl_zero:
00DB53  1  9D 00 20       sta place_table,x
00DB56  1  E8             inx
00DB57  1  E0 64          cpx #100
00DB59  1  90 F8          bcc _ipl_zero
00DB5B  1               
00DB5B  1                 ; place[1..10]
00DB5B  1  A2 01          ldx #1
00DB5D  1  A9 03          lda #3
00DB5F  1  9D 00 20       sta place_table,x
00DB62  1  A2 02          ldx #2
00DB64  1  A9 03          lda #3
00DB66  1  9D 00 20       sta place_table,x
00DB69  1  A2 03          ldx #3
00DB6B  1  A9 08          lda #8
00DB6D  1  9D 00 20       sta place_table,x
00DB70  1  A2 04          ldx #4
00DB72  1  A9 0A          lda #10
00DB74  1  9D 00 20       sta place_table,x
00DB77  1  A2 05          ldx #5
00DB79  1  A9 0B          lda #11
00DB7B  1  9D 00 20       sta place_table,x
00DB7E  1  A2 06          ldx #6
00DB80  1  A9 00          lda #0
00DB82  1  9D 00 20       sta place_table,x
00DB85  1  A2 07          ldx #7
00DB87  1  A9 0E          lda #14
00DB89  1  9D 00 20       sta place_table,x
00DB8C  1  A2 08          ldx #8
00DB8E  1  A9 0D          lda #13
00DB90  1  9D 00 20       sta place_table,x
00DB93  1  A2 09          ldx #9
00DB95  1  A9 5E          lda #94
00DB97  1  9D 00 20       sta place_table,x
00DB9A  1  A2 0A          ldx #10
00DB9C  1  A9 60          lda #96
00DB9E  1  9D 00 20       sta place_table,x
00DBA1  1               
00DBA1  1                 ; place[11..20]
00DBA1  1  A2 0B          ldx #11
00DBA3  1  A9 13          lda #19
00DBA5  1  9D 00 20       sta place_table,x
00DBA8  1  A2 0C          ldx #12
00DBAA  1  A9 11          lda #17
00DBAC  1  9D 00 20       sta place_table,x
00DBAF  1  A2 0D          ldx #13
00DBB1  1  A9 65          lda #101
00DBB3  1  9D 00 20       sta place_table,x
00DBB6  1  A2 0E          ldx #14
00DBB8  1  A9 67          lda #103
00DBBA  1  9D 00 20       sta place_table,x
00DBBD  1  A2 0F          ldx #15
00DBBF  1  A9 00          lda #0
00DBC1  1  9D 00 20       sta place_table,x
00DBC4  1  A2 10          ldx #16
00DBC6  1  A9 6A          lda #106
00DBC8  1  9D 00 20       sta place_table,x
00DBCB  1  A2 11          ldx #17
00DBCD  1  A9 00          lda #0
00DBCF  1  9D 00 20       sta place_table,x
00DBD2  1  A2 12          ldx #18
00DBD4  1  A9 00          lda #0
00DBD6  1  9D 00 20       sta place_table,x
00DBD9  1  A2 13          ldx #19
00DBDB  1  A9 03          lda #3
00DBDD  1  9D 00 20       sta place_table,x
00DBE0  1  A2 14          ldx #20
00DBE2  1  A9 03          lda #3
00DBE4  1  9D 00 20       sta place_table,x
00DBE7  1               
00DBE7  1                 ; place[23..29]
00DBE7  1  A2 17          ldx #23
00DBE9  1  A9 6D          lda #109
00DBEB  1  9D 00 20       sta place_table,x
00DBEE  1  A2 18          ldx #24
00DBF0  1  A9 19          lda #25
00DBF2  1  9D 00 20       sta place_table,x
00DBF5  1  A2 19          ldx #25
00DBF7  1  A9 17          lda #23
00DBF9  1  9D 00 20       sta place_table,x
00DBFC  1  A2 1A          ldx #26
00DBFE  1  A9 6F          lda #111
00DC00  1  9D 00 20       sta place_table,x
00DC03  1  A2 1B          ldx #27
00DC05  1  A9 23          lda #35
00DC07  1  9D 00 20       sta place_table,x
00DC0A  1  A2 1C          ldx #28
00DC0C  1  A9 00          lda #0
00DC0E  1  9D 00 20       sta place_table,x
00DC11  1  A2 1D          ldx #29
00DC13  1  A9 61          lda #97
00DC15  1  9D 00 20       sta place_table,x
00DC18  1               
00DC18  1                 ; place[31..40]
00DC18  1  A2 1F          ldx #31
00DC1A  1  A9 77          lda #119
00DC1C  1  9D 00 20       sta place_table,x
00DC1F  1  A2 20          ldx #32
00DC21  1  A9 75          lda #117
00DC23  1  9D 00 20       sta place_table,x
00DC26  1  A2 21          ldx #33
00DC28  1  A9 75          lda #117
00DC2A  1  9D 00 20       sta place_table,x
00DC2D  1  A2 22          ldx #34
00DC2F  1  A9 00          lda #0
00DC31  1  9D 00 20       sta place_table,x
00DC34  1  A2 23          ldx #35
00DC36  1  A9 82          lda #130
00DC38  1  9D 00 20       sta place_table,x
00DC3B  1  A2 24          ldx #36
00DC3D  1  A9 00          lda #0
00DC3F  1  9D 00 20       sta place_table,x
00DC42  1  A2 25          ldx #37
00DC44  1  A9 7E          lda #126
00DC46  1  9D 00 20       sta place_table,x
00DC49  1  A2 26          ldx #38
00DC4B  1  A9 8C          lda #140
00DC4D  1  9D 00 20       sta place_table,x
00DC50  1  A2 27          ldx #39
00DC52  1  A9 00          lda #0
00DC54  1  9D 00 20       sta place_table,x
00DC57  1  A2 28          ldx #40
00DC59  1  A9 60          lda #96
00DC5B  1  9D 00 20       sta place_table,x
00DC5E  1               
00DC5E  1                 ; place[50..54]
00DC5E  1  A2 32          ldx #50
00DC60  1  A9 12          lda #18
00DC62  1  9D 00 20       sta place_table,x
00DC65  1  A2 33          ldx #51
00DC67  1  A9 1B          lda #27
00DC69  1  9D 00 20       sta place_table,x
00DC6C  1  A2 34          ldx #52
00DC6E  1  A9 1C          lda #28
00DC70  1  9D 00 20       sta place_table,x
00DC73  1  A2 35          ldx #53
00DC75  1  A9 1D          lda #29
00DC77  1  9D 00 20       sta place_table,x
00DC7A  1  A2 36          ldx #54
00DC7C  1  A9 1E          lda #30
00DC7E  1  9D 00 20       sta place_table,x
00DC81  1               
00DC81  1                 ; place[56..64]
00DC81  1  A2 38          ldx #56
00DC83  1  A9 5C          lda #92
00DC85  1  9D 00 20       sta place_table,x
00DC88  1  A2 39          ldx #57
00DC8A  1  A9 5F          lda #95
00DC8C  1  9D 00 20       sta place_table,x
00DC8F  1  A2 3A          ldx #58
00DC91  1  A9 61          lda #97
00DC93  1  9D 00 20       sta place_table,x
00DC96  1  A2 3B          ldx #59
00DC98  1  A9 64          lda #100
00DC9A  1  9D 00 20       sta place_table,x
00DC9D  1  A2 3C          ldx #60
00DC9F  1  A9 65          lda #101
00DCA1  1  9D 00 20       sta place_table,x
00DCA4  1  A2 3D          ldx #61
00DCA6  1  A9 00          lda #0
00DCA8  1  9D 00 20       sta place_table,x
00DCAB  1  A2 3E          ldx #62
00DCAD  1  A9 77          lda #119
00DCAF  1  9D 00 20       sta place_table,x
00DCB2  1  A2 3F          ldx #63
00DCB4  1  A9 7F          lda #127
00DCB6  1  9D 00 20       sta place_table,x
00DCB9  1  A2 40          ldx #64
00DCBB  1  A9 82          lda #130
00DCBD  1  9D 00 20       sta place_table,x
00DCC0  1  60             rts
00DCC1  1               
00DCC1  1               sync_present_from_room:
00DCC1  1                 ; Rebuild present_table from place_table and target_room, excluding carried items.
00DCC1  1  20 35 DB       jsr init_present_table
00DCC4  1  A2 01          ldx #1
00DCC6  1               _spr_loop:
00DCC6  1  E0 64          cpx #100
00DCC8  1  B0 16          bcs _spr_done
00DCCA  1  BD E4 07       lda toting_table,x
00DCCD  1  D0 0D          bne _spr_next
00DCCF  1  BD 00 20       lda place_table,x
00DCD2  1  CD 00 07       cmp target_room
00DCD5  1  D0 05          bne _spr_next
00DCD7  1  A9 01          lda #1
00DCD9  1  9D 48 08       sta present_table,x
00DCDC  1               _spr_next:
00DCDC  1  E8             inx
00DCDD  1  4C C6 DC       jmp _spr_loop
00DCE0  1               _spr_done:
00DCE0  1  60             rts
00DCE1  1               
00DCE1  1               print_room_objects:
00DCE1  1                 ; Print all objects currently present in room.
00DCE1  1  A9 00          lda #0
00DCE3  1  8D 02 07       sta input_seen
00DCE6  1  A2 01          ldx #1
00DCE8  1               _pro_loop:
00DCE8  1  E0 64          cpx #100
00DCEA  1  B0 26          bcs _pro_end
00DCEC  1  BD 48 08       lda present_table,x
00DCEF  1  F0 1D          beq _pro_next
00DCF1  1  A9 01          lda #1
00DCF3  1  8D 02 07       sta input_seen
00DCF6  1  8A             txa
00DCF7  1  48             pha
00DCF8  1  20 A7 ED       jsr newline
00DCFB  1  A9 2D          lda #'-'
00DCFD  1  20 B2 ED       jsr print_char
00DD00  1  A9 20          lda #' '
00DD02  1  20 B2 ED       jsr print_char
00DD05  1  68             pla
00DD06  1  AA             tax
00DD07  1  8A             txa
00DD08  1  48             pha
00DD09  1  20 86 DF       jsr print_inventory_item
00DD0C  1  68             pla
00DD0D  1  AA             tax
00DD0E  1               _pro_next:
00DD0E  1  E8             inx
00DD0F  1  4C E8 DC       jmp _pro_loop
00DD12  1               _pro_end:
00DD12  1  AD 02 07       lda input_seen
00DD15  1  F0 03          beq _pro_done
00DD17  1  20 A7 ED       jsr newline
00DD1A  1               _pro_done:
00DD1A  1  60             rts
00DD1B  1               
00DD1B  1               print_object_line:
00DD1B  1                 ; In X/Y = pointer to zero-terminated object name string.
00DD1B  1  8E 10 07       stx work_lo
00DD1E  1  8C 11 07       sty work_hi
00DD21  1  20 A7 ED       jsr newline
00DD24  1  A9 2D          lda #'-'
00DD26  1  20 B2 ED       jsr print_char
00DD29  1  A9 20          lda #' '
00DD2B  1  20 B2 ED       jsr print_char
00DD2E  1               _pol_loop:
00DD2E  1                 ; OUTCH/print routines can clobber monitor scratch ZP,
00DD2E  1                 ; so reload the indirect pointer on every character fetch.
00DD2E  1  AD 10 07       lda work_lo
00DD31  1  85 40          sta zp_sd_address
00DD33  1  AD 11 07       lda work_hi
00DD36  1  85 41          sta zp_sd_address+1
00DD38  1  A0 00          ldy #0
00DD3A  1  B1 40          lda (zp_sd_address),y
00DD3C  1  F0 0E          beq _pol_done
00DD3E  1  20 B2 ED       jsr print_char
00DD41  1  EE 10 07       inc work_lo
00DD44  1  D0 E8          bne _pol_loop
00DD46  1  EE 11 07       inc work_hi
00DD49  1  4C 2E DD       jmp _pol_loop
00DD4C  1               _pol_done:
00DD4C  1  60             rts
00DD4D  1               
00DD4D  1               print_zstr_xy:
00DD4D  1                 ; In X/Y = pointer to zero-terminated string.
00DD4D  1  8E 10 07       stx work_lo
00DD50  1  8C 11 07       sty work_hi
00DD53  1               _pzs_loop:
00DD53  1  AD 10 07       lda work_lo
00DD56  1  85 40          sta zp_sd_address
00DD58  1  AD 11 07       lda work_hi
00DD5B  1  85 41          sta zp_sd_address+1
00DD5D  1  A0 00          ldy #0
00DD5F  1  B1 40          lda (zp_sd_address),y
00DD61  1  F0 0E          beq _pzs_done
00DD63  1  20 B2 ED       jsr print_char
00DD66  1  EE 10 07       inc work_lo
00DD69  1  D0 E8          bne _pzs_loop
00DD6B  1  EE 11 07       inc work_hi
00DD6E  1  4C 53 DD       jmp _pzs_loop
00DD71  1               _pzs_done:
00DD71  1  60             rts
00DD72  1               
00DD72  1               print_examine_text:
00DD72  1  AD 74 07       lda command_object
00DD75  1  C9 01          cmp #1
00DD77  1  D0 07          bne _pet_lamp
00DD79  1  A2 EA          ldx #<msg_exam_keys
00DD7B  1  A0 EF          ldy #>msg_exam_keys
00DD7D  1  4C C6 DD       jmp _pet_print
00DD80  1               _pet_lamp:
00DD80  1  C9 02          cmp #2
00DD82  1  D0 07          bne _pet_food
00DD84  1  A2 06          ldx #<msg_exam_lamp
00DD86  1  A0 F0          ldy #>msg_exam_lamp
00DD88  1  4C C6 DD       jmp _pet_print
00DD8B  1               _pet_food:
00DD8B  1  C9 13          cmp #19
00DD8D  1  D0 07          bne _pet_bottle
00DD8F  1  A2 20          ldx #<msg_exam_food
00DD91  1  A0 F0          ldy #>msg_exam_food
00DD93  1  4C C6 DD       jmp _pet_print
00DD96  1               _pet_bottle:
00DD96  1  C9 14          cmp #20
00DD98  1  D0 07          bne _pet_axe
00DD9A  1  A2 3F          ldx #<msg_exam_bottle
00DD9C  1  A0 F0          ldy #>msg_exam_bottle
00DD9E  1  4C C6 DD       jmp _pet_print
00DDA1  1               _pet_axe:
00DDA1  1  C9 1C          cmp #28
00DDA3  1  D0 07          bne _pet_cage
00DDA5  1  A2 5D          ldx #<msg_exam_axe
00DDA7  1  A0 F0          ldy #>msg_exam_axe
00DDA9  1  4C C6 DD       jmp _pet_print
00DDAC  1               _pet_cage:
00DDAC  1  C9 04          cmp #4
00DDAE  1  D0 07          bne _pet_rod
00DDB0  1  A2 78          ldx #<msg_exam_cage
00DDB2  1  A0 F0          ldy #>msg_exam_cage
00DDB4  1  4C C6 DD       jmp _pet_print
00DDB7  1               _pet_rod:
00DDB7  1  C9 05          cmp #5
00DDB9  1  D0 07          bne _pet_default
00DDBB  1  A2 93          ldx #<msg_exam_rod
00DDBD  1  A0 F0          ldy #>msg_exam_rod
00DDBF  1  4C C6 DD       jmp _pet_print
00DDC2  1               _pet_default:
00DDC2  1  A2 B7          ldx #<msg_exam_default
00DDC4  1  A0 F0          ldy #>msg_exam_default
00DDC6  1               _pet_print:
00DDC6  1  20 4D DD       jsr print_zstr_xy
00DDC9  1  60             rts
00DDCA  1               
00DDCA  1               print_read_text:
00DDCA  1  AD 74 07       lda command_object
00DDCD  1  C9 10          cmp #16                  ; MAGAZINE
00DDCF  1  D0 08          bne _prt_tablet
00DDD1  1  A9 BE          lda #190
00DDD3  1  8D 77 07       sta msg_target
00DDD6  1  4C F1 DD       jmp _prt_special
00DDD9  1               _prt_tablet:
00DDD9  1  C9 0D          cmp #13                  ; TABLET
00DDDB  1  D0 08          bne _prt_message
00DDDD  1  A9 C4          lda #196
00DDDF  1  8D 77 07       sta msg_target
00DDE2  1  4C F1 DD       jmp _prt_special
00DDE5  1               _prt_message:
00DDE5  1  C9 24          cmp #36                  ; MESSAGE
00DDE7  1  D0 0D          bne _prt_default
00DDE9  1  A9 BF          lda #191
00DDEB  1  8D 77 07       sta msg_target
00DDEE  1  4C F1 DD       jmp _prt_special
00DDF1  1               _prt_special:
00DDF1  1  20 C6 E1       jsr print_special_message
00DDF4  1  90 07          bcc _prt_done
00DDF6  1               _prt_default:
00DDF6  1  A2 6E          ldx #<msg_read_default
00DDF8  1  A0 F2          ldy #>msg_read_default
00DDFA  1               _prt_print:
00DDFA  1  20 4D DD       jsr print_zstr_xy
00DDFD  1               _prt_done:
00DDFD  1  60             rts
00DDFE  1               
00DDFE  1               noun_is_filler_word:
00DDFE  1                 ; Returns C set if noun token should be ignored as filler.
00DDFE  1  AD 72 07       lda noun_len
00DE01  1  C9 01          cmp #1
00DE03  1  D0 0D          bne _nfw_chk2
00DE05  1  AD 30 07       lda noun_buf
00DE08  1  C9 41          cmp #'A'
00DE0A  1  F0 03          beq _nfw_yesjmp
00DE0C  1  4C D8 DE       jmp _nfw_no
00DE0F  1               _nfw_yesjmp:
00DE0F  1  4C D6 DE       jmp _nfw_yes
00DE12  1               _nfw_chk2:
00DE12  1  C9 02          cmp #2
00DE14  1  D0 65          bne _nfw_chk3
00DE16  1                 ; AN
00DE16  1  AD 30 07       lda noun_buf
00DE19  1  C9 41          cmp #'A'
00DE1B  1  D0 07          bne _nfw_to2
00DE1D  1  AD 31 07       lda noun_buf+1
00DE20  1  C9 4E          cmp #'N'
00DE22  1  F0 EB          beq _nfw_yesjmp
00DE24  1               _nfw_to2:
00DE24  1                 ; TO
00DE24  1  AD 30 07       lda noun_buf
00DE27  1  C9 54          cmp #'T'
00DE29  1  D0 07          bne _nfw_at2
00DE2B  1  AD 31 07       lda noun_buf+1
00DE2E  1  C9 4F          cmp #'O'
00DE30  1  F0 DD          beq _nfw_yesjmp
00DE32  1               _nfw_at2:
00DE32  1                 ; AT
00DE32  1  AD 30 07       lda noun_buf
00DE35  1  C9 41          cmp #'A'
00DE37  1  D0 07          bne _nfw_in2
00DE39  1  AD 31 07       lda noun_buf+1
00DE3C  1  C9 54          cmp #'T'
00DE3E  1  F0 CF          beq _nfw_yesjmp
00DE40  1               _nfw_in2:
00DE40  1                 ; IN
00DE40  1  AD 30 07       lda noun_buf
00DE43  1  C9 49          cmp #'I'
00DE45  1  D0 07          bne _nfw_on2
00DE47  1  AD 31 07       lda noun_buf+1
00DE4A  1  C9 4E          cmp #'N'
00DE4C  1  F0 C1          beq _nfw_yesjmp
00DE4E  1               _nfw_on2:
00DE4E  1                 ; ON
00DE4E  1  AD 30 07       lda noun_buf
00DE51  1  C9 4F          cmp #'O'
00DE53  1  D0 07          bne _nfw_of2
00DE55  1  AD 31 07       lda noun_buf+1
00DE58  1  C9 4E          cmp #'N'
00DE5A  1  F0 B3          beq _nfw_yesjmp
00DE5C  1               _nfw_of2:
00DE5C  1                 ; OF
00DE5C  1  AD 30 07       lda noun_buf
00DE5F  1  C9 4F          cmp #'O'
00DE61  1  D0 07          bne _nfw_up2
00DE63  1  AD 31 07       lda noun_buf+1
00DE66  1  C9 46          cmp #'F'
00DE68  1  F0 A5          beq _nfw_yesjmp
00DE6A  1               _nfw_up2:
00DE6A  1                 ; UP
00DE6A  1  AD 30 07       lda noun_buf
00DE6D  1  C9 55          cmp #'U'
00DE6F  1  D0 67          bne _nfw_no
00DE71  1  AD 31 07       lda noun_buf+1
00DE74  1  C9 50          cmp #'P'
00DE76  1  F0 97          beq _nfw_yesjmp
00DE78  1  4C D8 DE       jmp _nfw_no
00DE7B  1               _nfw_chk3:
00DE7B  1  C9 03          cmp #3
00DE7D  1  D0 18          bne _nfw_chk4
00DE7F  1                 ; THE
00DE7F  1  AD 30 07       lda noun_buf
00DE82  1  C9 54          cmp #'T'
00DE84  1  D0 52          bne _nfw_no
00DE86  1  AD 31 07       lda noun_buf+1
00DE89  1  C9 48          cmp #'H'
00DE8B  1  D0 4B          bne _nfw_no
00DE8D  1  AD 32 07       lda noun_buf+2
00DE90  1  C9 45          cmp #'E'
00DE92  1  D0 44          bne _nfw_no
00DE94  1  4C D6 DE       jmp _nfw_yes
00DE97  1               _nfw_chk4:
00DE97  1  C9 04          cmp #4
00DE99  1  D0 3D          bne _nfw_no
00DE9B  1                 ; WITH
00DE9B  1  AD 30 07       lda noun_buf
00DE9E  1  C9 57          cmp #'W'
00DEA0  1  D0 15          bne _nfw_with4
00DEA2  1  AD 31 07       lda noun_buf+1
00DEA5  1  C9 49          cmp #'I'
00DEA7  1  D0 0E          bne _nfw_with4
00DEA9  1  AD 32 07       lda noun_buf+2
00DEAC  1  C9 54          cmp #'T'
00DEAE  1  D0 07          bne _nfw_with4
00DEB0  1  AD 33 07       lda noun_buf+3
00DEB3  1  C9 48          cmp #'H'
00DEB5  1  F0 1F          beq _nfw_yes
00DEB7  1               _nfw_with4:
00DEB7  1                 ; FROM
00DEB7  1  AD 30 07       lda noun_buf
00DEBA  1  C9 46          cmp #'F'
00DEBC  1  D0 1A          bne _nfw_no
00DEBE  1  AD 31 07       lda noun_buf+1
00DEC1  1  C9 52          cmp #'R'
00DEC3  1  D0 13          bne _nfw_no
00DEC5  1  AD 32 07       lda noun_buf+2
00DEC8  1  C9 4F          cmp #'O'
00DECA  1  D0 0C          bne _nfw_no
00DECC  1  AD 33 07       lda noun_buf+3
00DECF  1  C9 4D          cmp #'M'
00DED1  1  F0 03          beq _nfw_yes
00DED3  1  4C D8 DE       jmp _nfw_no
00DED6  1               _nfw_yes:
00DED6  1  38             sec
00DED7  1  60             rts
00DED8  1               _nfw_no:
00DED8  1  18             clc
00DED9  1  60             rts
00DEDA  1               
00DEDA  1               noun_is_descriptor_word:
00DEDA  1                 ; Returns C set for a small set of common adjectives in location
00DEDA  1                 ; phrases, e.g. GO TO SMALL BRICK BUILDING.
00DEDA  1  AD 72 07       lda noun_len
00DEDD  1  C9 05          cmp #5
00DEDF  1  D0 6B          bne _ndw_no
00DEE1  1                 ; SMALL
00DEE1  1  AD 30 07       lda noun_buf
00DEE4  1  C9 53          cmp #'S'
00DEE6  1  D0 1C          bne _ndw_brick5
00DEE8  1  AD 31 07       lda noun_buf+1
00DEEB  1  C9 4D          cmp #'M'
00DEED  1  D0 15          bne _ndw_brick5
00DEEF  1  AD 32 07       lda noun_buf+2
00DEF2  1  C9 41          cmp #'A'
00DEF4  1  D0 0E          bne _ndw_brick5
00DEF6  1  AD 33 07       lda noun_buf+3
00DEF9  1  C9 4C          cmp #'L'
00DEFB  1  D0 07          bne _ndw_brick5
00DEFD  1  AD 34 07       lda noun_buf+4
00DF00  1  C9 4C          cmp #'L'
00DF02  1  F0 46          beq _ndw_yes
00DF04  1               _ndw_brick5:
00DF04  1                 ; BRICK
00DF04  1  AD 30 07       lda noun_buf
00DF07  1  C9 42          cmp #'B'
00DF09  1  D0 1C          bne _ndw_steel5
00DF0B  1  AD 31 07       lda noun_buf+1
00DF0E  1  C9 52          cmp #'R'
00DF10  1  D0 15          bne _ndw_steel5
00DF12  1  AD 32 07       lda noun_buf+2
00DF15  1  C9 49          cmp #'I'
00DF17  1  D0 0E          bne _ndw_steel5
00DF19  1  AD 33 07       lda noun_buf+3
00DF1C  1  C9 43          cmp #'C'
00DF1E  1  D0 07          bne _ndw_steel5
00DF20  1  AD 34 07       lda noun_buf+4
00DF23  1  C9 4B          cmp #'K'
00DF25  1  F0 23          beq _ndw_yes
00DF27  1               _ndw_steel5:
00DF27  1                 ; STEEL
00DF27  1  AD 30 07       lda noun_buf
00DF2A  1  C9 53          cmp #'S'
00DF2C  1  D0 1E          bne _ndw_no
00DF2E  1  AD 31 07       lda noun_buf+1
00DF31  1  C9 54          cmp #'T'
00DF33  1  D0 17          bne _ndw_no
00DF35  1  AD 32 07       lda noun_buf+2
00DF38  1  C9 45          cmp #'E'
00DF3A  1  D0 10          bne _ndw_no
00DF3C  1  AD 33 07       lda noun_buf+3
00DF3F  1  C9 45          cmp #'E'
00DF41  1  D0 09          bne _ndw_no
00DF43  1  AD 34 07       lda noun_buf+4
00DF46  1  C9 4C          cmp #'L'
00DF48  1  D0 02          bne _ndw_no
00DF4A  1               _ndw_yes:
00DF4A  1  38             sec
00DF4B  1  60             rts
00DF4C  1               _ndw_no:
00DF4C  1  18             clc
00DF4D  1  60             rts
00DF4E  1               
00DF4E  1               noun_is_all:
00DF4E  1                 ; Returns C set if noun token is "ALL".
00DF4E  1  AD 72 07       lda noun_len
00DF51  1  C9 03          cmp #3
00DF53  1  D0 17          bne _nia_no
00DF55  1  AD 30 07       lda noun_buf
00DF58  1  C9 41          cmp #'A'
00DF5A  1  D0 10          bne _nia_no
00DF5C  1  AD 31 07       lda noun_buf+1
00DF5F  1  C9 4C          cmp #'L'
00DF61  1  D0 09          bne _nia_no
00DF63  1  AD 32 07       lda noun_buf+2
00DF66  1  C9 4C          cmp #'L'
00DF68  1  D0 02          bne _nia_no
00DF6A  1  38             sec
00DF6B  1  60             rts
00DF6C  1               _nia_no:
00DF6C  1  18             clc
00DF6D  1  60             rts
00DF6E  1               
00DF6E  1               count_holding:
00DF6E  1                 ; Count carried items into entry_count.
00DF6E  1  A9 00          lda #0
00DF70  1  8D 1C 07       sta entry_count
00DF73  1  A2 01          ldx #1
00DF75  1               _ch_loop:
00DF75  1  E0 64          cpx #100
00DF77  1  B0 0C          bcs _ch_done
00DF79  1  BD E4 07       lda toting_table,x
00DF7C  1  F0 03          beq _ch_next
00DF7E  1  EE 1C 07       inc entry_count
00DF81  1               _ch_next:
00DF81  1  E8             inx
00DF82  1  4C 75 DF       jmp _ch_loop
00DF85  1               _ch_done:
00DF85  1  60             rts
00DF86  1               
00DF86  1               print_inventory_item:
00DF86  1  8E 0B 07       stx tmp_digit
00DF89  1  20 A2 DF       jsr object_name_ptr_by_id
00DF8C  1  90 04          bcc _pii_num
00DF8E  1  20 4D DD       jsr print_zstr_xy
00DF91  1  60             rts
00DF92  1               _pii_num:
00DF92  1  AE 0B 07       ldx tmp_digit
00DF95  1  8A             txa
00DF96  1  8D 10 07       sta work_lo
00DF99  1  A9 00          lda #0
00DF9B  1  8D 11 07       sta work_hi
00DF9E  1  20 6D E4       jsr print_u16_dec
00DFA1  1  60             rts
00DFA2  1               
00DFA2  1               object_name_ptr_by_id:
00DFA2  1                 ; In:  X = object id
00DFA2  1                 ; Out: C set and X/Y -> zstr pointer if known, else C clear.
00DFA2  1  8A             txa
00DFA3  1  C9 40          cmp #64
00DFA5  1  B0 1F          bcs _onp_no
00DFA7  1  0A             asl
00DFA8  1  A8             tay
00DFA9  1  B9 33 EF       lda obj_name_table,y
00DFAC  1  8D 10 07       sta work_lo
00DFAF  1  C8             iny
00DFB0  1  B9 33 EF       lda obj_name_table,y
00DFB3  1  8D 11 07       sta work_hi
00DFB6  1  AD 10 07       lda work_lo
00DFB9  1  0D 11 07       ora work_hi
00DFBC  1  F0 08          beq _onp_no
00DFBE  1  AE 10 07       ldx work_lo
00DFC1  1  AC 11 07       ldy work_hi
00DFC4  1  38             sec
00DFC5  1  60             rts
00DFC6  1               _onp_no:
00DFC6  1  18             clc
00DFC7  1  60             rts
00DFC8  1               
00DFC8  1               read_toting_entry_count:
00DFC8  1                 ; Read number of toting entries (0..99), default 0.
00DFC8  1  A9 00          lda #0
00DFCA  1  8D 1C 07       sta entry_count
00DFCD  1  A9 00          lda #0
00DFCF  1  8D 02 07       sta input_seen
00DFD2  1               
00DFD2  1  A9 54          lda #'T'
00DFD4  1  20 B2 ED       jsr print_char
00DFD7  1  A9 3F          lda #'?'
00DFD9  1  20 B2 ED       jsr print_char
00DFDC  1  A9 20          lda #' '
00DFDE  1  20 B2 ED       jsr print_char
00DFE1  1               
00DFE1  1               _rt_loop:
00DFE1  1  20 28 A4       jsr get_input_filtered
00DFE4  1  C9 0D          cmp #$0D
00DFE6  1  F0 36          beq _rt_eol
00DFE8  1  C9 0A          cmp #$0A
00DFEA  1  F0 32          beq _rt_eol
00DFEC  1  C9 30          cmp #'0'
00DFEE  1  90 F1          bcc _rt_loop
00DFF0  1  C9 3A          cmp #('9'+1)
00DFF2  1  B0 ED          bcs _rt_loop
00DFF4  1               
00DFF4  1  29 0F          and #$0F
00DFF6  1  8D 0B 07       sta tmp_digit
00DFF9  1  AD 02 07       lda input_seen
00DFFC  1  D0 05          bne _rt_accum
00DFFE  1  A9 00          lda #0
00E000  1  8D 1C 07       sta entry_count
00E003  1               _rt_accum:
00E003  1  A9 01          lda #1
00E005  1  8D 02 07       sta input_seen
00E008  1               
00E008  1  AD 1C 07       lda entry_count
00E00B  1  0A             asl
00E00C  1  8D 0E 07       sta mul_lo
00E00F  1  0A             asl
00E010  1  0A             asl
00E011  1  18             clc
00E012  1  6D 0E 07       adc mul_lo
00E015  1  6D 0B 07       adc tmp_digit
00E018  1  8D 1C 07       sta entry_count
00E01B  1  4C E1 DF       jmp _rt_loop
00E01E  1               
00E01E  1               _rt_eol:
00E01E  1  AD 02 07       lda input_seen
00E021  1  F0 00          beq _rt_done
00E023  1               
00E023  1               _rt_done:
00E023  1  20 A7 ED       jsr newline
00E026  1  60             rts
00E027  1               
00E027  1               read_present_entry_count:
00E027  1                 ; Read number of present-at-location entries (0..99), default 0.
00E027  1  A9 00          lda #0
00E029  1  8D 1C 07       sta entry_count
00E02C  1  A9 00          lda #0
00E02E  1  8D 02 07       sta input_seen
00E031  1               
00E031  1  A9 4C          lda #'L'
00E033  1  20 B2 ED       jsr print_char
00E036  1  A9 3F          lda #'?'
00E038  1  20 B2 ED       jsr print_char
00E03B  1  A9 20          lda #' '
00E03D  1  20 B2 ED       jsr print_char
00E040  1               
00E040  1               _rlc_loop:
00E040  1  20 28 A4       jsr get_input_filtered
00E043  1  C9 0D          cmp #$0D
00E045  1  F0 36          beq _rlc_eol
00E047  1  C9 0A          cmp #$0A
00E049  1  F0 32          beq _rlc_eol
00E04B  1  C9 30          cmp #'0'
00E04D  1  90 F1          bcc _rlc_loop
00E04F  1  C9 3A          cmp #('9'+1)
00E051  1  B0 ED          bcs _rlc_loop
00E053  1               
00E053  1  29 0F          and #$0F
00E055  1  8D 0B 07       sta tmp_digit
00E058  1  AD 02 07       lda input_seen
00E05B  1  D0 05          bne _rlc_accum
00E05D  1  A9 00          lda #0
00E05F  1  8D 1C 07       sta entry_count
00E062  1               _rlc_accum:
00E062  1  A9 01          lda #1
00E064  1  8D 02 07       sta input_seen
00E067  1               
00E067  1  AD 1C 07       lda entry_count
00E06A  1  0A             asl
00E06B  1  8D 0E 07       sta mul_lo
00E06E  1  0A             asl
00E06F  1  0A             asl
00E070  1  18             clc
00E071  1  6D 0E 07       adc mul_lo
00E074  1  6D 0B 07       adc tmp_digit
00E077  1  8D 1C 07       sta entry_count
00E07A  1  4C 40 E0       jmp _rlc_loop
00E07D  1               
00E07D  1               _rlc_eol:
00E07D  1  AD 02 07       lda input_seen
00E080  1  F0 00          beq _rlc_done
00E082  1               
00E082  1               _rlc_done:
00E082  1  20 A7 ED       jsr newline
00E085  1  60             rts
00E086  1               
00E086  1               read_prop_entry_count:
00E086  1                 ; Read number of prop override entries (0..99), default 0.
00E086  1  A9 00          lda #0
00E088  1  8D 1C 07       sta entry_count
00E08B  1  A9 00          lda #0
00E08D  1  8D 02 07       sta input_seen
00E090  1               
00E090  1  A9 4E          lda #'N'
00E092  1  20 B2 ED       jsr print_char
00E095  1  A9 3F          lda #'?'
00E097  1  20 B2 ED       jsr print_char
00E09A  1  A9 20          lda #' '
00E09C  1  20 B2 ED       jsr print_char
00E09F  1               
00E09F  1               _rn_loop:
00E09F  1  20 28 A4       jsr get_input_filtered
00E0A2  1  C9 0D          cmp #$0D
00E0A4  1  F0 36          beq _rn_eol
00E0A6  1  C9 0A          cmp #$0A
00E0A8  1  F0 32          beq _rn_eol
00E0AA  1  C9 30          cmp #'0'
00E0AC  1  90 F1          bcc _rn_loop
00E0AE  1  C9 3A          cmp #('9'+1)
00E0B0  1  B0 ED          bcs _rn_loop
00E0B2  1               
00E0B2  1  29 0F          and #$0F
00E0B4  1  8D 0B 07       sta tmp_digit
00E0B7  1  AD 02 07       lda input_seen
00E0BA  1  D0 05          bne _rn_accum
00E0BC  1  A9 00          lda #0
00E0BE  1  8D 1C 07       sta entry_count
00E0C1  1               _rn_accum:
00E0C1  1  A9 01          lda #1
00E0C3  1  8D 02 07       sta input_seen
00E0C6  1               
00E0C6  1  AD 1C 07       lda entry_count
00E0C9  1  0A             asl
00E0CA  1  8D 0E 07       sta mul_lo
00E0CD  1  0A             asl
00E0CE  1  0A             asl
00E0CF  1  18             clc
00E0D0  1  6D 0E 07       adc mul_lo
00E0D3  1  6D 0B 07       adc tmp_digit
00E0D6  1  8D 1C 07       sta entry_count
00E0D9  1  4C 9F E0       jmp _rn_loop
00E0DC  1               
00E0DC  1               _rn_eol:
00E0DC  1  AD 02 07       lda input_seen
00E0DF  1  F0 00          beq _rn_done
00E0E1  1               
00E0E1  1               _rn_done:
00E0E1  1  20 A7 ED       jsr newline
00E0E4  1  60             rts
00E0E5  1               
00E0E5  1               print_room_long:
00E0E5  1                 ; Print room description for target_room from ADVENT1.TXT.
00E0E5  1                 ; desc_mode=0 full text, desc_mode=1 first sentence.
00E0E5  1                 ; Out: C clear on success, set if file/room missing.
00E0E5  1  20 93 E9       jsr fat32_openroot
00E0E8  1  A2 CE          ldx #<room_filename1
00E0EA  1  A0 ED          ldy #>room_filename1
00E0EC  1  20 5A EC       jsr fat32_finddirent
00E0EF  1  90 02          bcc _prl_found
00E0F1  1  38             sec
00E0F2  1  60             rts
00E0F3  1               
00E0F3  1               _prl_found:
00E0F3  1  20 E0 EA       jsr fat32_opendirent
00E0F6  1               
00E0F6  1  A9 00          lda #0
00E0F8  1  8D 1E 07       sta room_in_section
00E0FB  1  A9 01          lda #1
00E0FD  1  8D 1F 07       sta room_line_start
00E100  1  A9 FF          lda #$FF
00E102  1  8D 78 07       sta prl_guard_lo
00E105  1  8D 79 07       sta prl_guard_hi
00E108  1               
00E108  1               _prl_readloop:
00E108  1                 ; Safety guard: avoid infinite loops if SD stream never reaches EOF.
00E108  1  AD 78 07       lda prl_guard_lo
00E10B  1  0D 79 07       ora prl_guard_hi
00E10E  1  D0 03          bne :+
00E110  1  4C BD E1       jmp _prl_eof
00E113  1               :
00E113  1  38             sec
00E114  1  AD 78 07       lda prl_guard_lo
00E117  1  E9 01          sbc #1
00E119  1  8D 78 07       sta prl_guard_lo
00E11C  1  AD 79 07       lda prl_guard_hi
00E11F  1  E9 00          sbc #0
00E121  1  8D 79 07       sta prl_guard_hi
00E124  1               
00E124  1  20 D6 EC       jsr fat32_file_readbyte
00E127  1  90 03          bcc :+
00E129  1  4C BD E1       jmp _prl_eof
00E12C  1               :
00E12C  1  8D AD 08       sta room_char
00E12F  1               
00E12F  1                 ; Ignore NUL padding/noise from SD stream.
00E12F  1  C9 00          cmp #$00
00E131  1  F0 D5          beq _prl_readloop
00E133  1               
00E133  1                 ; Ignore CR
00E133  1  C9 0D          cmp #$0D
00E135  1  F0 D1          beq _prl_readloop
00E137  1               
00E137  1                 ; Handle LF
00E137  1  C9 0A          cmp #$0A
00E139  1  D0 22          bne _prl_not_lf
00E13B  1  AD 1E 07       lda room_in_section
00E13E  1  F0 15          beq _prl_set_line_start
00E140  1  AD 76 07       lda desc_mode
00E143  1  F0 0D          beq _prl_emit_lf_long
00E145  1                 ; In short mode, keep wrapped lines as a single sentence.
00E145  1  AD 1F 07       lda room_line_start
00E148  1  D0 0B          bne _prl_set_line_start
00E14A  1  A9 20          lda #' '
00E14C  1  20 B2 ED       jsr print_char
00E14F  1  4C 55 E1       jmp _prl_set_line_start
00E152  1               _prl_emit_lf_long:
00E152  1  20 A7 ED       jsr newline
00E155  1               _prl_set_line_start:
00E155  1  A9 01          lda #1
00E157  1  8D 1F 07       sta room_line_start
00E15A  1  4C 08 E1       jmp _prl_readloop
00E15D  1               
00E15D  1               _prl_not_lf:
00E15D  1  AD 1E 07       lda room_in_section
00E160  1  F0 2C          beq _prl_not_in_room
00E162  1               
00E162  1                 ; If next room marker starts, we are done with this room.
00E162  1  AD 1F 07       lda room_line_start
00E165  1  F0 07          beq _prl_emit_char
00E167  1  AD AD 08       lda room_char
00E16A  1  C9 23          cmp #'#'
00E16C  1  F0 56          beq _prl_done_success
00E16E  1               
00E16E  1               _prl_emit_char:
00E16E  1  AD AD 08       lda room_char
00E171  1  20 B2 ED       jsr print_char
00E174  1  AD 76 07       lda desc_mode
00E177  1  F0 0D          beq _prl_emit_char_done
00E179  1  AD AD 08       lda room_char
00E17C  1  C9 2E          cmp #'.'
00E17E  1  D0 06          bne _prl_emit_char_done
00E180  1  20 A7 ED       jsr newline
00E183  1  4C C4 E1       jmp _prl_done_success
00E186  1               _prl_emit_char_done:
00E186  1  A9 00          lda #0
00E188  1  8D 1F 07       sta room_line_start
00E18B  1  4C 08 E1       jmp _prl_readloop
00E18E  1               
00E18E  1               _prl_not_in_room:
00E18E  1  AD AD 08       lda room_char
00E191  1  C9 23          cmp #'#'
00E193  1  D0 20          bne _prl_clear_line_start
00E195  1               
00E195  1                 ; Parse marker number after '#'
00E195  1  20 7A E2       jsr read_room_marker_line
00E198  1  90 03          bcc :+
00E19A  1  4C BD E1       jmp _prl_eof
00E19D  1               :
00E19D  1  AD AC 08       lda room_marker_num
00E1A0  1  CD 00 07       cmp target_room
00E1A3  1  F0 03          beq :+
00E1A5  1  4C 08 E1       jmp _prl_readloop
00E1A8  1               :
00E1A8  1  A9 01          lda #1
00E1AA  1  8D 1E 07       sta room_in_section
00E1AD  1  A9 01          lda #1
00E1AF  1  8D 1F 07       sta room_line_start
00E1B2  1  4C 08 E1       jmp _prl_readloop
00E1B5  1               
00E1B5  1               _prl_clear_line_start:
00E1B5  1  A9 00          lda #0
00E1B7  1  8D 1F 07       sta room_line_start
00E1BA  1  4C 08 E1       jmp _prl_readloop
00E1BD  1               
00E1BD  1               _prl_eof:
00E1BD  1  AD 1E 07       lda room_in_section
00E1C0  1  D0 02          bne _prl_done_success
00E1C2  1  38             sec
00E1C3  1  60             rts
00E1C4  1               
00E1C4  1               _prl_done_success:
00E1C4  1  18             clc
00E1C5  1  60             rts
00E1C6  1               
00E1C6  1               print_special_message:
00E1C6  1                 ; Print message section msg_target from ADVENT4.TXT.
00E1C6  1                 ; Out: C clear on success, set if file/section missing.
00E1C6  1  20 93 E9       jsr fat32_openroot
00E1C9  1  A2 DA          ldx #<msg_filename4
00E1CB  1  A0 ED          ldy #>msg_filename4
00E1CD  1  20 5A EC       jsr fat32_finddirent
00E1D0  1  90 02          bcc _psm_found
00E1D2  1  38             sec
00E1D3  1  60             rts
00E1D4  1               
00E1D4  1               _psm_found:
00E1D4  1  20 E0 EA       jsr fat32_opendirent
00E1D7  1               
00E1D7  1  A9 00          lda #0
00E1D9  1  8D 1E 07       sta room_in_section
00E1DC  1  A9 01          lda #1
00E1DE  1  8D 1F 07       sta room_line_start
00E1E1  1  A9 FF          lda #$FF
00E1E3  1  8D 78 07       sta prl_guard_lo
00E1E6  1  8D 79 07       sta prl_guard_hi
00E1E9  1               
00E1E9  1               _psm_readloop:
00E1E9  1                 ; Safety guard: avoid infinite loops if SD stream never reaches EOF.
00E1E9  1  AD 78 07       lda prl_guard_lo
00E1EC  1  0D 79 07       ora prl_guard_hi
00E1EF  1  D0 03          bne :+
00E1F1  1  4C 71 E2       jmp _psm_eof
00E1F4  1               :
00E1F4  1  38             sec
00E1F5  1  AD 78 07       lda prl_guard_lo
00E1F8  1  E9 01          sbc #1
00E1FA  1  8D 78 07       sta prl_guard_lo
00E1FD  1  AD 79 07       lda prl_guard_hi
00E200  1  E9 00          sbc #0
00E202  1  8D 79 07       sta prl_guard_hi
00E205  1               
00E205  1  20 D6 EC       jsr fat32_file_readbyte
00E208  1  B0 67          bcs _psm_eof
00E20A  1  8D AD 08       sta room_char
00E20D  1               
00E20D  1                 ; Ignore NUL padding/noise from SD stream.
00E20D  1  C9 00          cmp #$00
00E20F  1  F0 D8          beq _psm_readloop
00E211  1               
00E211  1  C9 0D          cmp #$0D
00E213  1  F0 D4          beq _psm_readloop
00E215  1  C9 0A          cmp #$0A
00E217  1  D0 10          bne _psm_not_lf
00E219  1  AD 1E 07       lda room_in_section
00E21C  1  F0 03          beq _psm_set_line_start
00E21E  1  20 A7 ED       jsr newline
00E221  1               _psm_set_line_start:
00E221  1  A9 01          lda #1
00E223  1  8D 1F 07       sta room_line_start
00E226  1  4C E9 E1       jmp _psm_readloop
00E229  1               
00E229  1               _psm_not_lf:
00E229  1  AD 1E 07       lda room_in_section
00E22C  1  F0 1A          beq _psm_not_in_msg
00E22E  1  AD 1F 07       lda room_line_start
00E231  1  F0 07          beq _psm_emit_char
00E233  1  AD AD 08       lda room_char
00E236  1  C9 23          cmp #'#'
00E238  1  F0 3E          beq _psm_done_success
00E23A  1               _psm_emit_char:
00E23A  1  AD AD 08       lda room_char
00E23D  1  20 B2 ED       jsr print_char
00E240  1  A9 00          lda #0
00E242  1  8D 1F 07       sta room_line_start
00E245  1  4C E9 E1       jmp _psm_readloop
00E248  1               
00E248  1               _psm_not_in_msg:
00E248  1  AD AD 08       lda room_char
00E24B  1  C9 23          cmp #'#'
00E24D  1  D0 1A          bne _psm_clear_line_start
00E24F  1  20 7A E2       jsr read_room_marker_line
00E252  1  B0 1D          bcs _psm_eof
00E254  1  AD AC 08       lda room_marker_num
00E257  1  CD 77 07       cmp msg_target
00E25A  1  D0 8D          bne _psm_readloop
00E25C  1  A9 01          lda #1
00E25E  1  8D 1E 07       sta room_in_section
00E261  1  A9 01          lda #1
00E263  1  8D 1F 07       sta room_line_start
00E266  1  4C E9 E1       jmp _psm_readloop
00E269  1               
00E269  1               _psm_clear_line_start:
00E269  1  A9 00          lda #0
00E26B  1  8D 1F 07       sta room_line_start
00E26E  1  4C E9 E1       jmp _psm_readloop
00E271  1               
00E271  1               _psm_eof:
00E271  1  AD 1E 07       lda room_in_section
00E274  1  D0 02          bne _psm_done_success
00E276  1  38             sec
00E277  1  60             rts
00E278  1               
00E278  1               _psm_done_success:
00E278  1  18             clc
00E279  1  60             rts
00E27A  1               
00E27A  1               read_room_marker_line:
00E27A  1                 ; Consume marker line after leading '#', parse decimal room number.
00E27A  1  A9 00          lda #0
00E27C  1  8D AC 08       sta room_marker_num
00E27F  1               
00E27F  1               _rml_loop:
00E27F  1                 ; Safety guard shared with print_room_long to prevent infinite loops
00E27F  1                 ; if the SD stream degrades into padding/noise bytes.
00E27F  1  AD 78 07       lda prl_guard_lo
00E282  1  0D 79 07       ora prl_guard_hi
00E285  1  D0 03          bne :+
00E287  1  4C D4 E2       jmp _rml_eof
00E28A  1               :
00E28A  1  38             sec
00E28B  1  AD 78 07       lda prl_guard_lo
00E28E  1  E9 01          sbc #1
00E290  1  8D 78 07       sta prl_guard_lo
00E293  1  AD 79 07       lda prl_guard_hi
00E296  1  E9 00          sbc #0
00E298  1  8D 79 07       sta prl_guard_hi
00E29B  1               
00E29B  1  20 D6 EC       jsr fat32_file_readbyte
00E29E  1  B0 34          bcs _rml_eof
00E2A0  1  8D AD 08       sta room_char
00E2A3  1               
00E2A3  1  C9 00          cmp #$00
00E2A5  1  F0 D8          beq _rml_loop
00E2A7  1  C9 0D          cmp #$0D
00E2A9  1  F0 D4          beq _rml_loop
00E2AB  1  C9 0A          cmp #$0A
00E2AD  1  F0 23          beq _rml_done
00E2AF  1               
00E2AF  1  C9 30          cmp #'0'
00E2B1  1  90 CC          bcc _rml_loop
00E2B3  1  C9 3A          cmp #('9'+1)
00E2B5  1  B0 C8          bcs _rml_loop
00E2B7  1               
00E2B7  1  29 0F          and #$0F
00E2B9  1  8D 0B 07       sta tmp_digit
00E2BC  1  AD AC 08       lda room_marker_num
00E2BF  1  0A             asl
00E2C0  1  8D 0E 07       sta mul_lo
00E2C3  1  0A             asl
00E2C4  1  0A             asl
00E2C5  1  18             clc
00E2C6  1  6D 0E 07       adc mul_lo
00E2C9  1  6D 0B 07       adc tmp_digit
00E2CC  1  8D AC 08       sta room_marker_num
00E2CF  1  4C 7F E2       jmp _rml_loop
00E2D2  1               
00E2D2  1               _rml_done:
00E2D2  1  18             clc
00E2D3  1  60             rts
00E2D4  1               
00E2D4  1               _rml_eof:
00E2D4  1  38             sec
00E2D5  1  60             rts
00E2D6  1               
00E2D6  1               read_line:
00E2D6  1                 ; Reads one text line (LF-terminated) into line_buf.
00E2D6  1                 ; Returns carry set if EOF with no data.
00E2D6  1  A9 00          lda #0
00E2D8  1  8D 14 07       sta line_idx
00E2DB  1               _rl_loop:
00E2DB  1  20 D6 EC       jsr fat32_file_readbyte
00E2DE  1  90 11          bcc _rl_got
00E2E0  1  AD 14 07       lda line_idx
00E2E3  1  F0 0A          beq _rl_eof_empty
00E2E5  1  AC 14 07       ldy line_idx
00E2E8  1  A9 00          lda #0
00E2EA  1  99 20 07       sta line_buf,y
00E2ED  1  18             clc
00E2EE  1  60             rts
00E2EF  1               _rl_eof_empty:
00E2EF  1  38             sec
00E2F0  1  60             rts
00E2F1  1               _rl_got:
00E2F1  1  8D 0B 07       sta tmp_digit
00E2F4  1  C9 00          cmp #$00
00E2F6  1  F0 E3          beq _rl_loop
00E2F8  1  C9 0D          cmp #$0D
00E2FA  1  F0 DF          beq _rl_loop
00E2FC  1  C9 0A          cmp #$0A
00E2FE  1  F0 14          beq _rl_done
00E300  1  AD 14 07       lda line_idx
00E303  1  C9 4F          cmp #79
00E305  1  B0 D4          bcs _rl_loop
00E307  1  A8             tay
00E308  1  AD 0B 07       lda tmp_digit
00E30B  1  99 20 07       sta line_buf,y
00E30E  1  EE 14 07       inc line_idx
00E311  1  4C DB E2       jmp _rl_loop
00E314  1               _rl_done:
00E314  1  AC 14 07       ldy line_idx
00E317  1  A9 00          lda #0
00E319  1  99 20 07       sta line_buf,y
00E31C  1  18             clc
00E31D  1  60             rts
00E31E  1               
00E31E  1               find_hash_in_line:
00E31E  1                 ; Find '#' anywhere in line_buf. If found, returns Y at first byte after '#'
00E31E  1                 ; with carry clear. If not found, carry set.
00E31E  1  A0 00          ldy #0
00E320  1               _fh_loop:
00E320  1  B9 20 07       lda line_buf,y
00E323  1  F0 09          beq _fh_not_found
00E325  1  C9 23          cmp #'#'
00E327  1  F0 07          beq _fh_found
00E329  1  C8             iny
00E32A  1  C0 4F          cpy #79
00E32C  1  90 F2          bcc _fh_loop
00E32E  1               _fh_not_found:
00E32E  1  38             sec
00E32F  1  60             rts
00E330  1               _fh_found:
00E330  1  C8             iny
00E331  1  18             clc
00E332  1  60             rts
00E333  1               
00E333  1               parse_u16_field:
00E333  1                 ; Parse unsigned decimal field from line_buf starting at Y.
00E333  1                 ; Stops at ',' or NUL. Consumes ',' if present.
00E333  1  A9 00          lda #0
00E335  1  8D 03 07       sta field_lo
00E338  1  8D 04 07       sta field_hi
00E33B  1               _puf_loop:
00E33B  1  B9 20 07       lda line_buf,y
00E33E  1  F0 74          beq _puf_done
00E340  1  C9 2C          cmp #','
00E342  1  F0 6F          beq _puf_comma
00E344  1  C9 30          cmp #'0'
00E346  1  90 67          bcc _puf_next
00E348  1  C9 3A          cmp #('9'+1)
00E34A  1  B0 63          bcs _puf_next
00E34C  1               
00E34C  1  29 0F          and #$0F
00E34E  1  8D 0B 07       sta tmp_digit
00E351  1               
00E351  1  AD 03 07       lda field_lo
00E354  1  8D 0C 07       sta old_lo
00E357  1  AD 04 07       lda field_hi
00E35A  1  8D 0D 07       sta old_hi
00E35D  1               
00E35D  1                 ; field = old * 2
00E35D  1  18             clc
00E35E  1  AD 0C 07       lda old_lo
00E361  1  6D 0C 07       adc old_lo
00E364  1  8D 03 07       sta field_lo
00E367  1  AD 0D 07       lda old_hi
00E36A  1  6D 0D 07       adc old_hi
00E36D  1  8D 04 07       sta field_hi
00E370  1               
00E370  1                 ; mul = old * 8
00E370  1  AD 0C 07       lda old_lo
00E373  1  0A             asl
00E374  1  8D 0E 07       sta mul_lo
00E377  1  AD 0D 07       lda old_hi
00E37A  1  2A             rol
00E37B  1  8D 0F 07       sta mul_hi
00E37E  1  0E 0E 07       asl mul_lo
00E381  1  2E 0F 07       rol mul_hi
00E384  1  0E 0E 07       asl mul_lo
00E387  1  2E 0F 07       rol mul_hi
00E38A  1               
00E38A  1                 ; field = old*2 + old*8 = old*10
00E38A  1  18             clc
00E38B  1  AD 03 07       lda field_lo
00E38E  1  6D 0E 07       adc mul_lo
00E391  1  8D 03 07       sta field_lo
00E394  1  AD 04 07       lda field_hi
00E397  1  6D 0F 07       adc mul_hi
00E39A  1  8D 04 07       sta field_hi
00E39D  1               
00E39D  1                 ; + digit
00E39D  1  18             clc
00E39E  1  AD 03 07       lda field_lo
00E3A1  1  6D 0B 07       adc tmp_digit
00E3A4  1  8D 03 07       sta field_lo
00E3A7  1  AD 04 07       lda field_hi
00E3AA  1  69 00          adc #0
00E3AC  1  8D 04 07       sta field_hi
00E3AF  1               
00E3AF  1               _puf_next:
00E3AF  1  C8             iny
00E3B0  1  4C 3B E3       jmp _puf_loop
00E3B3  1               _puf_comma:
00E3B3  1  C8             iny
00E3B4  1               _puf_done:
00E3B4  1  60             rts
00E3B5  1               
00E3B5  1               cond_matches:
00E3B5  1                 ; Returns C set if cond passes, clear if it fails.
00E3B5  1                 ; Supported condition classes:
00E3B5  1                 ;   0..99: 0=always, 1..99=pct_roll < cond
00E3B5  1                 ;   1xx: robject==0 or carrying robject
00E3B5  1                 ;   2xx: carrying robject or robject present at location
00E3B5  1                 ;   3xx/4xx/5xx/7xx: prop[robject] != class-3
00E3B5  1  AD 09 07       lda cond_lo
00E3B8  1  0D 0A 07       ora cond_hi
00E3BB  1  D0 03          bne _cm_not_zero
00E3BD  1  4C 6B E4       jmp _cm_yes
00E3C0  1               
00E3C0  1               _cm_not_zero:
00E3C0  1  A9 00          lda #0
00E3C2  1  8D 18 07       sta cond_group
00E3C5  1  AD 09 07       lda cond_lo
00E3C8  1  8D 10 07       sta work_lo
00E3CB  1  AD 0A 07       lda cond_hi
00E3CE  1  8D 11 07       sta work_hi
00E3D1  1               
00E3D1  1               _cm_div100:
00E3D1  1  AD 11 07       lda work_hi
00E3D4  1  D0 07          bne _cm_sub100
00E3D6  1  AD 10 07       lda work_lo
00E3D9  1  C9 64          cmp #100
00E3DB  1  90 17          bcc _cm_div_done
00E3DD  1               _cm_sub100:
00E3DD  1  38             sec
00E3DE  1  AD 10 07       lda work_lo
00E3E1  1  E9 64          sbc #100
00E3E3  1  8D 10 07       sta work_lo
00E3E6  1  AD 11 07       lda work_hi
00E3E9  1  E9 00          sbc #0
00E3EB  1  8D 11 07       sta work_hi
00E3EE  1  EE 18 07       inc cond_group
00E3F1  1  4C D1 E3       jmp _cm_div100
00E3F4  1               
00E3F4  1               _cm_div_done:
00E3F4  1  AD 11 07       lda work_hi
00E3F7  1  D0 70          bne _cm_no
00E3F9  1  AD 10 07       lda work_lo
00E3FC  1  8D 19 07       sta cond_object
00E3FF  1               
00E3FF  1  AD 18 07       lda cond_group
00E402  1  F0 1B          beq _cm_class0
00E404  1  C9 01          cmp #1
00E406  1  F0 22          beq _cm_class1
00E408  1  C9 02          cmp #2
00E40A  1  F0 30          beq _cm_class2
00E40C  1  C9 03          cmp #3
00E40E  1  F0 41          beq _cm_class3457
00E410  1  C9 04          cmp #4
00E412  1  F0 3D          beq _cm_class3457
00E414  1  C9 05          cmp #5
00E416  1  F0 39          beq _cm_class3457
00E418  1  C9 07          cmp #7
00E41A  1  F0 35          beq _cm_class3457
00E41C  1  4C 69 E4       jmp _cm_no
00E41F  1               
00E41F  1               _cm_class0:
00E41F  1                 ; remainder 1..99 means pct check, 0 already handled at start
00E41F  1  AD 15 07       lda pct_roll
00E422  1  CD 19 07       cmp cond_object
00E425  1  90 44          bcc _cm_yes
00E427  1  4C 69 E4       jmp _cm_no
00E42A  1               
00E42A  1               _cm_class1:
00E42A  1  AD 19 07       lda cond_object
00E42D  1  F0 3C          beq _cm_yes
00E42F  1  C9 64          cmp #100
00E431  1  B0 36          bcs _cm_no
00E433  1  AA             tax
00E434  1  BD E4 07       lda toting_table,x
00E437  1  D0 32          bne _cm_yes
00E439  1  4C 69 E4       jmp _cm_no
00E43C  1               
00E43C  1               _cm_class2:
00E43C  1  AD 19 07       lda cond_object
00E43F  1  C9 64          cmp #100
00E441  1  B0 26          bcs _cm_no
00E443  1  AA             tax
00E444  1  BD E4 07       lda toting_table,x
00E447  1  D0 22          bne _cm_yes
00E449  1  BD 48 08       lda present_table,x
00E44C  1  D0 1D          bne _cm_yes
00E44E  1  4C 69 E4       jmp _cm_no
00E451  1               
00E451  1               _cm_class3457:
00E451  1                 ; required state = cond_group - 3
00E451  1  AD 18 07       lda cond_group
00E454  1  38             sec
00E455  1  E9 03          sbc #3
00E457  1  8D 0B 07       sta tmp_digit
00E45A  1               
00E45A  1  AE 19 07       ldx cond_object
00E45D  1  E0 64          cpx #100
00E45F  1  B0 08          bcs _cm_no
00E461  1  BD 80 07       lda prop_table,x
00E464  1               
00E464  1               _cm_compare_prop:
00E464  1  CD 0B 07       cmp tmp_digit
00E467  1  D0 02          bne _cm_yes
00E469  1               
00E469  1               _cm_no:
00E469  1  18             clc
00E46A  1  60             rts
00E46B  1               
00E46B  1               _cm_yes:
00E46B  1  38             sec
00E46C  1  60             rts
00E46D  1               
00E46D  1               print_u16_dec:
00E46D  1                 ; Prints work_hi:work_lo as unsigned decimal (0..999 expected)
00E46D  1  A9 00          lda #0
00E46F  1  8D 12 07       sta hundreds
00E472  1  8D 13 07       sta tens
00E475  1               
00E475  1               _p100:
00E475  1  AD 11 07       lda work_hi
00E478  1  D0 07          bne _p100_sub
00E47A  1  AD 10 07       lda work_lo
00E47D  1  C9 64          cmp #100
00E47F  1  90 17          bcc _p100_done
00E481  1               _p100_sub:
00E481  1  38             sec
00E482  1  AD 10 07       lda work_lo
00E485  1  E9 64          sbc #100
00E487  1  8D 10 07       sta work_lo
00E48A  1  AD 11 07       lda work_hi
00E48D  1  E9 00          sbc #0
00E48F  1  8D 11 07       sta work_hi
00E492  1  EE 12 07       inc hundreds
00E495  1  4C 75 E4       jmp _p100
00E498  1               _p100_done:
00E498  1               
00E498  1               _p10:
00E498  1  AD 11 07       lda work_hi
00E49B  1  D0 07          bne _p10_sub
00E49D  1  AD 10 07       lda work_lo
00E4A0  1  C9 0A          cmp #10
00E4A2  1  90 17          bcc _p10_done
00E4A4  1               _p10_sub:
00E4A4  1  38             sec
00E4A5  1  AD 10 07       lda work_lo
00E4A8  1  E9 0A          sbc #10
00E4AA  1  8D 10 07       sta work_lo
00E4AD  1  AD 11 07       lda work_hi
00E4B0  1  E9 00          sbc #0
00E4B2  1  8D 11 07       sta work_hi
00E4B5  1  EE 13 07       inc tens
00E4B8  1  4C 98 E4       jmp _p10
00E4BB  1               _p10_done:
00E4BB  1               
00E4BB  1  AD 12 07       lda hundreds
00E4BE  1  F0 06          beq _ptens
00E4C0  1  18             clc
00E4C1  1  69 30          adc #'0'
00E4C3  1  20 B2 ED       jsr print_char
00E4C6  1               
00E4C6  1               _ptens:
00E4C6  1  AD 12 07       lda hundreds
00E4C9  1  D0 05          bne _ptens_emit
00E4CB  1  AD 13 07       lda tens
00E4CE  1  F0 09          beq _pones
00E4D0  1               _ptens_emit:
00E4D0  1  AD 13 07       lda tens
00E4D3  1  18             clc
00E4D4  1  69 30          adc #'0'
00E4D6  1  20 B2 ED       jsr print_char
00E4D9  1               
00E4D9  1               _pones:
00E4D9  1  AD 10 07       lda work_lo
00E4DC  1  18             clc
00E4DD  1  69 30          adc #'0'
00E4DF  1  20 B2 ED       jsr print_char
00E4E2  1  60             rts
00E4E3  1               
00E4E3  1                 .include "hwconfig.s"
00E4E3  2               PORTA = $1700
00E4E3  2               DDRA = $1701
00E4E3  2               PORTB = $1702
00E4E3  2               DDRB = $1703
00E4E3  2               
00E4E3  2               OUTCH = $1EA0
00E4E3  2               GETCH = $1E5A
00E4E3  2               PRTBYT = $1E3B
00E4E3  2               
00E4E3  2               EXIT  = $1C4F
00E4E3  2               
00E4E3  2               SD_CS   = %00010000
00E4E3  2               SD_SCK  = %00001000
00E4E3  2               SD_MOSI = %00000100
00E4E3  2               SD_MISO = %00000010
00E4E3  2               
00E4E3  2               PORTA_OUTPUTPINS = SD_CS | SD_SCK | SD_MOSI
00E4E3  2               
00E4E3  2               via_init:
00E4E3  2  A9 FF          lda #%11111111          ; Set all pins on port B to output
00E4E5  2  8D 03 17       sta DDRB
00E4E8  2  A9 1C          lda #PORTA_OUTPUTPINS   ; Set various pins on port A to output
00E4EA  2  8D 01 17       sta DDRA
00E4ED  2  60             rts
00E4EE  2               
00E4EE  1                 .include "libsd.s"
00E4EE  2               ; SD card interface module
00E4EE  2               ;
00E4EE  2               ; Requires zero-page variable storage:
00E4EE  2               ;   zp_sd_address - 2 bytes
00E4EE  2               ;   zp_sd_currentsector - 4 bytes
00E4EE  2               
00E4EE  2               sd_init:
00E4EE  2                 ; Let the SD card boot up, by pumping the clock with SD CS disabled
00E4EE  2               
00E4EE  2                 ; We need to apply around 80 clock pulses with CS and MOSI high.
00E4EE  2                 ; Normally MOSI doesn't matter when CS is high, but the card is
00E4EE  2                 ; not yet is SPI mode, and in this non-SPI state it does care.
00E4EE  2  A0 00          ldy #0
00E4F0  2               _initretry:
00E4F0  2  A9 14          lda #SD_CS | SD_MOSI
00E4F2  2  A2 A0          ldx #160               ; toggle the clock 160 times, so 80 low-high transitions
00E4F4  2               _preinitloop:
00E4F4  2  49 08          eor #SD_SCK
00E4F6  2  8D 00 17       sta PORTA
00E4F9  2  CA             dex
00E4FA  2  D0 F8          bne _preinitloop
00E4FC  2               
00E4FC  2               _cmd0: ; GO_IDLE_STATE - resets card to idle state, and SPI mode
00E4FC  2  A9 63          lda #<sd_cmd0_bytes
00E4FE  2  85 40          sta zp_sd_address
00E500  2  A9 E5          lda #>sd_cmd0_bytes
00E502  2  85 41          sta zp_sd_address+1
00E504  2               
00E504  2  20 B5 E5       jsr sd_sendcommand
00E507  2               
00E507  2                 ; Expect status response $01 (not initialized)
00E507  2  C9 01          cmp #$01
00E509  2  D0 4B          bne _initfailed
00E50B  2               
00E50B  2               _cmd8: ; SEND_IF_COND - tell the card how we want it to operate (3.3V, etc)
00E50B  2  A9 69          lda #<sd_cmd8_bytes
00E50D  2  85 40          sta zp_sd_address
00E50F  2  A9 E5          lda #>sd_cmd8_bytes
00E511  2  85 41          sta zp_sd_address+1
00E513  2               
00E513  2  20 B5 E5       jsr sd_sendcommand
00E516  2               
00E516  2                 ; Expect status response $01 (not initialized)
00E516  2  C9 01          cmp #$01
00E518  2  D0 3C          bne _initfailed
00E51A  2               
00E51A  2                 ; Read 32-bit return value, but ignore it
00E51A  2  20 7B E5       jsr sd_readbyte
00E51D  2  20 7B E5       jsr sd_readbyte
00E520  2  20 7B E5       jsr sd_readbyte
00E523  2  20 7B E5       jsr sd_readbyte
00E526  2               
00E526  2               _cmd55: ; APP_CMD - required prefix for ACMD commands
00E526  2  A9 6F          lda #<sd_cmd55_bytes
00E528  2  85 40          sta zp_sd_address
00E52A  2  A9 E5          lda #>sd_cmd55_bytes
00E52C  2  85 41          sta zp_sd_address+1
00E52E  2               
00E52E  2  20 B5 E5       jsr sd_sendcommand
00E531  2               
00E531  2                 ; Expect status response $01 (not initialized)
00E531  2  C9 01          cmp #$01
00E533  2  D0 21          bne _initfailed
00E535  2               
00E535  2               _cmd41: ; APP_SEND_OP_COND - send operating conditions, initialize card
00E535  2  A9 75          lda #<sd_cmd41_bytes
00E537  2  85 40          sta zp_sd_address
00E539  2  A9 E5          lda #>sd_cmd41_bytes
00E53B  2  85 41          sta zp_sd_address+1
00E53D  2               
00E53D  2  20 B5 E5       jsr sd_sendcommand
00E540  2               
00E540  2                 ; Status response $00 means initialised
00E540  2  C9 00          cmp #$00
00E542  2  F0 11          beq _initialized
00E544  2               
00E544  2                 ; Otherwise expect status response $01 (not initialized)
00E544  2  C9 01          cmp #$01
00E546  2  D0 0E          bne _initfailed
00E548  2               
00E548  2                 ; Not initialized yet, so wait a while then try again.
00E548  2                 ; This retry is important, to give the card time to initialize.
00E548  2               
00E548  2  A2 00          ldx #0
00E54A  2  A0 00          ldy #0
00E54C  2               _delayloop:
00E54C  2  88             dey
00E54D  2  D0 FD          bne _delayloop
00E54F  2  CA             dex
00E550  2  D0 FA          bne _delayloop
00E552  2               
00E552  2  4C 26 E5       jmp _cmd55
00E555  2               
00E555  2               
00E555  2               _initialized:
00E555  2                 ;lda #'Y'
00E555  2                 ;jsr print_char
00E555  2  60             rts
00E556  2               
00E556  2               _initfailed:
00E556  2  C8             iny
00E557  2  C0 02          cpy #2
00E559  2  D0 95          bne _initretry
00E55B  2  A9 58          lda #'X'
00E55D  2  20 B2 ED       jsr print_char
00E560  2               _loop:
00E560  2  4C 60 E5       jmp _loop
00E563  2               
00E563  2               
00E563  2               sd_cmd0_bytes:
00E563  2  40 00 00 00    .byte $40, $00, $00, $00, $00, $95
00E567  2  00 95        
00E569  2               sd_cmd8_bytes:
00E569  2  48 00 00 01    .byte $48, $00, $00, $01, $aa, $87
00E56D  2  AA 87        
00E56F  2               sd_cmd55_bytes:
00E56F  2  77 00 00 00    .byte $77, $00, $00, $00, $00, $01
00E573  2  00 01        
00E575  2               sd_cmd41_bytes:
00E575  2  69 40 00 00    .byte $69, $40, $00, $00, $00, $01
00E579  2  00 01        
00E57B  2               
00E57B  2               
00E57B  2               
00E57B  2               sd_readbyte:
00E57B  2                 ; Enable the card and tick the clock 8 times with MOSI high,
00E57B  2                 ; capturing bits from MISO and returning them
00E57B  2               
00E57B  2  A2 FE          ldx #$fe    ; Preloaded with seven ones and a zero, so we stop after eight bits
00E57D  2               
00E57D  2               _rbloop:
00E57D  2               
00E57D  2  A9 04          lda #SD_MOSI                ; enable card (CS low), set MOSI (resting state), SCK low
00E57F  2  8D 00 17       sta PORTA
00E582  2               
00E582  2  A9 0C          lda #SD_MOSI | SD_SCK       ; toggle the clock high
00E584  2  8D 00 17       sta PORTA
00E587  2               
00E587  2  AD 00 17       lda PORTA                   ; read next bit
00E58A  2  29 02          and #SD_MISO
00E58C  2               
00E58C  2  18             clc                         ; default to clearing the bottom bit
00E58D  2  F0 01          beq _bitnotset              ; unless MISO was set
00E58F  2  38             sec                         ; in which case get ready to set the bottom bit
00E590  2               _bitnotset:
00E590  2               
00E590  2  8A             txa                         ; transfer partial result from X
00E591  2  2A             rol                         ; rotate carry bit into read result, and loop bit into carry
00E592  2  AA             tax                         ; save partial result back to X
00E593  2               
00E593  2  B0 E8          bcs _rbloop                   ; loop if we need to read more bits
00E595  2               
00E595  2  60             rts
00E596  2               
00E596  2               
00E596  2               sd_writebyte:
00E596  2                 ; Tick the clock 8 times with descending bits on MOSI
00E596  2                 ; SD communication is mostly half-duplex so we ignore anything it sends back here
00E596  2               
00E596  2  A2 08          ldx #8                      ; send 8 bits
00E598  2               
00E598  2               _wbloop:
00E598  2  0A             asl                         ; shift next bit into carry
00E599  2  A8             tay                         ; save remaining bits for later
00E59A  2               
00E59A  2  A9 00          lda #0
00E59C  2  90 02          bcc _sendbit                ; if carry clear, don't set MOSI for this bit
00E59E  2  09 04          ora #SD_MOSI
00E5A0  2               
00E5A0  2               _sendbit:
00E5A0  2  8D 00 17       sta PORTA                   ; set MOSI (or not) first with SCK low
00E5A3  2  49 08          eor #SD_SCK
00E5A5  2  8D 00 17       sta PORTA                   ; raise SCK keeping MOSI the same, to send the bit
00E5A8  2               
00E5A8  2  98             tya                         ; restore remaining bits to send
00E5A9  2               
00E5A9  2  CA             dex
00E5AA  2  D0 EC          bne _wbloop                   ; loop if there are more bits to send
00E5AC  2               
00E5AC  2  60             rts
00E5AD  2               
00E5AD  2               
00E5AD  2               sd_waitresult:
00E5AD  2                 ; Wait for the SD card to return something other than $ff
00E5AD  2  20 7B E5       jsr sd_readbyte
00E5B0  2  C9 FF          cmp #$ff
00E5B2  2  F0 F9          beq sd_waitresult
00E5B4  2  60             rts
00E5B5  2               
00E5B5  2               
00E5B5  2               sd_sendcommand:
00E5B5  2                 ; Debug print which command is being executed
00E5B5  2                 ; lda #'c'
00E5B5  2                 ; jsr print_char
00E5B5  2                 ; ldx #0
00E5B5  2                 ; lda (zp_sd_address,x)
00E5B5  2                 ; jsr print_hex
00E5B5  2               
00E5B5  2  A9 04          lda #SD_MOSI           ; pull CS low to begin command
00E5B7  2  8D 00 17       sta PORTA
00E5BA  2               
00E5BA  2  A0 00          ldy #0
00E5BC  2  B1 40          lda (zp_sd_address),y    ; command byte
00E5BE  2  20 96 E5       jsr sd_writebyte
00E5C1  2  A0 01          ldy #1
00E5C3  2  B1 40          lda (zp_sd_address),y    ; data 1
00E5C5  2  20 96 E5       jsr sd_writebyte
00E5C8  2  A0 02          ldy #2
00E5CA  2  B1 40          lda (zp_sd_address),y    ; data 2
00E5CC  2  20 96 E5       jsr sd_writebyte
00E5CF  2  A0 03          ldy #3
00E5D1  2  B1 40          lda (zp_sd_address),y    ; data 3
00E5D3  2  20 96 E5       jsr sd_writebyte
00E5D6  2  A0 04          ldy #4
00E5D8  2  B1 40          lda (zp_sd_address),y    ; data 4
00E5DA  2  20 96 E5       jsr sd_writebyte
00E5DD  2  A0 05          ldy #5
00E5DF  2  B1 40          lda (zp_sd_address),y    ; crc
00E5E1  2  20 96 E5       jsr sd_writebyte
00E5E4  2               
00E5E4  2  20 AD E5       jsr sd_waitresult
00E5E7  2  48             pha
00E5E8  2               
00E5E8  2                 ; Debug print the result code
00E5E8  2                 ; jsr print_hex
00E5E8  2               
00E5E8  2                 ; End command
00E5E8  2  A9 14          lda #SD_CS | SD_MOSI   ; set CS high again
00E5EA  2  8D 00 17       sta PORTA
00E5ED  2               
00E5ED  2  68             pla   ; restore result code
00E5EE  2  60             rts
00E5EF  2               
00E5EF  2               
00E5EF  2               sd_readsector:
00E5EF  2                 ; Read a sector from the SD card.  A sector is 512 bytes.
00E5EF  2                 ;
00E5EF  2                 ; Parameters:
00E5EF  2                 ;    zp_sd_currentsector   32-bit sector number
00E5EF  2                 ;    zp_sd_address     address of buffer to receive data
00E5EF  2               
00E5EF  2  A9 04          lda #SD_MOSI
00E5F1  2  8D 00 17       sta PORTA
00E5F4  2               
00E5F4  2                 ; Command 17, arg is sector number, crc not checked
00E5F4  2  A9 51          lda #$51                    ; CMD17 - READ_SINGLE_BLOCK
00E5F6  2  20 96 E5       jsr sd_writebyte
00E5F9  2  A5 45          lda zp_sd_currentsector+3   ; sector 24:31
00E5FB  2  20 96 E5       jsr sd_writebyte
00E5FE  2  A5 44          lda zp_sd_currentsector+2   ; sector 16:23
00E600  2  20 96 E5       jsr sd_writebyte
00E603  2  A5 43          lda zp_sd_currentsector+1   ; sector 8:15
00E605  2  20 96 E5       jsr sd_writebyte
00E608  2  A5 42          lda zp_sd_currentsector     ; sector 0:7
00E60A  2  20 96 E5       jsr sd_writebyte
00E60D  2  A9 01          lda #$01                    ; crc (not checked)
00E60F  2  20 96 E5       jsr sd_writebyte
00E612  2               
00E612  2  20 AD E5       jsr sd_waitresult
00E615  2  C9 00          cmp #$00
00E617  2  D0 22          bne _libsdfail
00E619  2               
00E619  2                 ; wait for data
00E619  2  20 AD E5       jsr sd_waitresult
00E61C  2  C9 FE          cmp #$fe
00E61E  2  D0 1B          bne _libsdfail
00E620  2               
00E620  2                 ; Need to read 512 bytes - two pages of 256 bytes each
00E620  2  20 30 E6       jsr _readpage
00E623  2  E6 41          inc zp_sd_address+1
00E625  2  20 30 E6       jsr _readpage
00E628  2  C6 41          dec zp_sd_address+1
00E62A  2               
00E62A  2                 ; End command
00E62A  2  A9 14          lda #SD_CS | SD_MOSI
00E62C  2  8D 00 17       sta PORTA
00E62F  2               
00E62F  2  60             rts
00E630  2               
00E630  2               _readpage:
00E630  2                 ; Read 256 bytes to the address at zp_sd_address
00E630  2  A0 00          ldy #0
00E632  2               _readpageloop:
00E632  2  20 7B E5       jsr sd_readbyte
00E635  2  91 40          sta (zp_sd_address),y
00E637  2  C8             iny
00E638  2  D0 F8          bne _readpageloop
00E63A  2  60             rts
00E63B  2               
00E63B  2               _libsdfail:
00E63B  2  A9 73          lda #'s'
00E63D  2  20 B2 ED       jsr print_char
00E640  2  A9 3A          lda #':'
00E642  2  20 B2 ED       jsr print_char
00E645  2  A9 66          lda #'f'
00E647  2  20 B2 ED       jsr print_char
00E64A  2               _libsdfailloop:
00E64A  2  4C 4A E6       jmp _libsdfailloop
00E64D  2               
00E64D  2               sd_writesector:
00E64D  2                 ; Write a sector to the SD card.  A sector is 512 bytes.
00E64D  2                 ;
00E64D  2                 ; Parameters:
00E64D  2                 ;    zp_sd_currentsector   32-bit sector number
00E64D  2                 ;    zp_sd_address     address of buffer to take data from
00E64D  2               
00E64D  2  A9 04          lda #SD_MOSI
00E64F  2  8D 00 17       sta PORTA
00E652  2               
00E652  2                 ; Command 24, arg is sector number, crc not checked
00E652  2  A9 58          lda #$58                    ; CMD24 - WRITE_BLOCK
00E654  2  20 96 E5       jsr sd_writebyte
00E657  2  A5 45          lda zp_sd_currentsector+3   ; sector 24:31
00E659  2  20 96 E5       jsr sd_writebyte
00E65C  2  A5 44          lda zp_sd_currentsector+2   ; sector 16:23
00E65E  2  20 96 E5       jsr sd_writebyte
00E661  2  A5 43          lda zp_sd_currentsector+1   ; sector 8:15
00E663  2  20 96 E5       jsr sd_writebyte
00E666  2  A5 42          lda zp_sd_currentsector     ; sector 0:7
00E668  2  20 96 E5       jsr sd_writebyte
00E66B  2  A9 01          lda #$01                    ; crc (not checked)
00E66D  2  20 96 E5       jsr sd_writebyte
00E670  2               
00E670  2  20 AD E5       jsr sd_waitresult
00E673  2  C9 00          cmp #$00
00E675  2  D0 C4          bne _libsdfail
00E677  2               
00E677  2                 ; Send start token
00E677  2  A9 FE          lda #$fe
00E679  2  20 96 E5       jsr sd_writebyte
00E67C  2               
00E67C  2                 ; Need to write 512 bytes - two pages of 256 bytes each
00E67C  2  20 9C E6       jsr _writepage
00E67F  2  E6 41          inc zp_sd_address+1
00E681  2  20 9C E6       jsr _writepage
00E684  2  C6 41          dec zp_sd_address+1
00E686  2               
00E686  2                 ; wait for data response
00E686  2  20 AD E5       jsr sd_waitresult
00E689  2  29 1F          and #$1f
00E68B  2  C9 05          cmp #$05
00E68D  2  D0 AC          bne _libsdfail
00E68F  2               
00E68F  2               _waitidle:
00E68F  2  20 7B E5       jsr sd_readbyte
00E692  2  C9 FF          cmp #$ff
00E694  2  D0 F9          bne _waitidle
00E696  2               
00E696  2                 ; End command
00E696  2  A9 14          lda #SD_CS | SD_MOSI ; set cs and mosi high (disconnected)
00E698  2  8D 00 17       sta PORTA
00E69B  2               
00E69B  2  60             rts
00E69C  2               
00E69C  2               _writepage:
00E69C  2                 ; Write 256 bytes fom zp_sd_address
00E69C  2  A0 00          ldy #0
00E69E  2               _writeloop:
00E69E  2  98             tya ; transfer counter to a register
00E69F  2  48             pha ; push counter to stack
00E6A0  2  B1 40          lda (zp_sd_address),y
00E6A2  2  20 96 E5       jsr sd_writebyte
00E6A5  2  68             pla ; pull counter from stack
00E6A6  2  A8             tay ; transfer back
00E6A7  2  C8             iny
00E6A8  2  D0 F4          bne _writeloop
00E6AA  2  60             rts
00E6AB  2               
00E6AB  1                 .include "libfat32.s"
00E6AB  2               ; FAT32/SD interface library
00E6AB  2               ;
00E6AB  2               ; This module requires some RAM workspace to be defined elsewhere:
00E6AB  2               ;
00E6AB  2               ; fat32_workspace    - a large page-aligned 512-byte workspace
00E6AB  2               ; zp_fat32_variables - 52 bytes of zero-page storage for variables etc
00E6AB  2               
00E6AB  2               fat32_readbuffer = fat32_workspace
00E6AB  2               
00E6AB  2               fat32_fatstart                  = zp_fat32_variables + $00  ; 4 bytes
00E6AB  2               fat32_datastart                 = zp_fat32_variables + $04  ; 4 bytes
00E6AB  2               fat32_rootcluster               = zp_fat32_variables + $08  ; 4 bytes
00E6AB  2               fat32_sectorspercluster         = zp_fat32_variables + $0c  ; 1 byte
00E6AB  2               fat32_pendingsectors            = zp_fat32_variables + $0d  ; 1 byte
00E6AB  2               fat32_address                   = zp_fat32_variables + $0e  ; 2 bytes
00E6AB  2               fat32_nextcluster               = zp_fat32_variables + $10  ; 4 bytes
00E6AB  2               fat32_bytesremaining            = zp_fat32_variables + $14  ; 4 bytes
00E6AB  2               fat32_lastfoundfreecluster      = zp_fat32_variables + $18  ; 4 bytes
00E6AB  2               fat32_filenamepointer           = zp_fat32_variables + $1c  ; 2 bytes
00E6AB  2               fat32_lastcluster               = zp_fat32_variables + $1e  ; 4 bytes
00E6AB  2               fat32_lastsector                = zp_fat32_variables + $22  ; 4 bytes
00E6AB  2               fat32_numfats                   = zp_fat32_variables + $26  ; 1 byte
00E6AB  2               fat32_filecluster               = zp_fat32_variables + $27  ; 4 bytes
00E6AB  2               fat32_sectorsperfat             = zp_fat32_variables + $2b  ; 4 bytes
00E6AB  2               fat32_cdcluster                 = zp_fat32_variables + $2f  ; 4 bytes
00E6AB  2               
00E6AB  2               fat32_errorstage                = fat32_bytesremaining  ; only used during initialization
00E6AB  2               
00E6AB  2               fat32_init:
00E6AB  2                 ; Initialize the module - read the MBR etc, find the partition,
00E6AB  2                 ; and set up the variables ready for navigating the filesystem
00E6AB  2               
00E6AB  2                 ; Read the MBR and extract pertinent information
00E6AB  2               
00E6AB  2  A9 00          lda #0
00E6AD  2  85 5A          sta fat32_errorstage
00E6AF  2               
00E6AF  2                 ; Sector 0
00E6AF  2  A9 00          lda #0
00E6B1  2  85 42          sta zp_sd_currentsector
00E6B3  2  85 43          sta zp_sd_currentsector+1
00E6B5  2  85 44          sta zp_sd_currentsector+2
00E6B7  2  85 45          sta zp_sd_currentsector+3
00E6B9  2               
00E6B9  2                 ; Target buffer
00E6B9  2  A9 00          lda #<fat32_readbuffer
00E6BB  2  85 54          sta fat32_address
00E6BD  2  85 40          sta zp_sd_address
00E6BF  2  A9 02          lda #>fat32_readbuffer
00E6C1  2  85 55          sta fat32_address+1
00E6C3  2  85 41          sta zp_sd_address+1
00E6C5  2               
00E6C5  2                 ; Do the read
00E6C5  2  20 EF E5       jsr sd_readsector
00E6C8  2               
00E6C8  2               
00E6C8  2  E6 5A          inc fat32_errorstage ; stage 1 = boot sector signature check
00E6CA  2               
00E6CA  2                 ; Check some things
00E6CA  2  AD FE 03       lda fat32_readbuffer+510 ; Boot sector signature 55
00E6CD  2  C9 55          cmp #$55
00E6CF  2  D0 2D          bne _fail
00E6D1  2  AD FF 03       lda fat32_readbuffer+511 ; Boot sector signature aa
00E6D4  2  C9 AA          cmp #$aa
00E6D6  2  D0 26          bne _fail
00E6D8  2               
00E6D8  2               
00E6D8  2  E6 5A          inc fat32_errorstage ; stage 2 = finding partition
00E6DA  2               
00E6DA  2                 ; Find a FAT32 LBA partition, type 12 (0xc)
00E6DA  2               _FSTYPE_FAT32 = 12
00E6DA  2  A2 00          ldx #0
00E6DC  2  BD C2 03       lda fat32_readbuffer+$1c2,x
00E6DF  2  C9 0C          cmp #_FSTYPE_FAT32
00E6E1  2  F0 1E          beq _foundpart
00E6E3  2  A2 10          ldx #16
00E6E5  2  BD C2 03       lda fat32_readbuffer+$1c2,x
00E6E8  2  C9 0C          cmp #_FSTYPE_FAT32
00E6EA  2  F0 15          beq _foundpart
00E6EC  2  A2 20          ldx #32
00E6EE  2  BD C2 03       lda fat32_readbuffer+$1c2,x
00E6F1  2  C9 0C          cmp #_FSTYPE_FAT32
00E6F3  2  F0 0C          beq _foundpart
00E6F5  2  A2 30          ldx #48
00E6F7  2  BD C2 03       lda fat32_readbuffer+$1c2,x
00E6FA  2  C9 0C          cmp #_FSTYPE_FAT32
00E6FC  2  F0 03          beq _foundpart
00E6FE  2               
00E6FE  2               _fail:
00E6FE  2  4C DB E7       jmp _error
00E701  2               
00E701  2               _foundpart:
00E701  2               
00E701  2                 ; Read the FAT32 BPB
00E701  2  BD C6 03       lda fat32_readbuffer+$1c6,x
00E704  2  85 42          sta zp_sd_currentsector
00E706  2  BD C7 03       lda fat32_readbuffer+$1c7,x
00E709  2  85 43          sta zp_sd_currentsector+1
00E70B  2  BD C8 03       lda fat32_readbuffer+$1c8,x
00E70E  2  85 44          sta zp_sd_currentsector+2
00E710  2  BD C9 03       lda fat32_readbuffer+$1c9,x
00E713  2  85 45          sta zp_sd_currentsector+3
00E715  2               
00E715  2  20 EF E5       jsr sd_readsector
00E718  2               
00E718  2               
00E718  2  E6 5A          inc fat32_errorstage ; stage 3 = BPB signature check
00E71A  2               
00E71A  2                 ; Check some things
00E71A  2  AD FE 03       lda fat32_readbuffer+510 ; BPB sector signature 55
00E71D  2  C9 55          cmp #$55
00E71F  2  D0 DD          bne _fail
00E721  2  AD FF 03       lda fat32_readbuffer+511 ; BPB sector signature aa
00E724  2  C9 AA          cmp #$aa
00E726  2  D0 D6          bne _fail
00E728  2               
00E728  2  E6 5A          inc fat32_errorstage ; stage 4 = RootEntCnt check
00E72A  2               
00E72A  2  AD 11 02       lda fat32_readbuffer+17 ; RootEntCnt should be 0 for FAT32
00E72D  2  0D 12 02       ora fat32_readbuffer+18
00E730  2  D0 CC          bne _fail
00E732  2               
00E732  2  E6 5A          inc fat32_errorstage ; stage 5 = TotSec16 check
00E734  2               
00E734  2  AD 13 02       lda fat32_readbuffer+19 ; TotSec16 should be 0 for FAT32
00E737  2  0D 14 02       ora fat32_readbuffer+20
00E73A  2  D0 C2          bne _fail
00E73C  2               
00E73C  2  E6 5A          inc fat32_errorstage ; stage 6 = SectorsPerCluster check
00E73E  2               
00E73E  2                 ; Check bytes per filesystem sector, it should be 512 for any SD card that supports FAT32
00E73E  2  AD 0B 02       lda fat32_readbuffer+11 ; low byte should be zero
00E741  2  D0 BB          bne _fail
00E743  2  AD 0C 02       lda fat32_readbuffer+12 ; high byte is 2 (512), 4, 8, or 16
00E746  2  C9 02          cmp #2
00E748  2  D0 B4          bne _fail
00E74A  2               
00E74A  2                 ; Calculate the starting sector of the FAT
00E74A  2  18             clc
00E74B  2  A5 42          lda zp_sd_currentsector
00E74D  2  6D 0E 02       adc fat32_readbuffer+14    ; reserved sectors lo
00E750  2  85 46          sta fat32_fatstart
00E752  2  85 4A          sta fat32_datastart
00E754  2  A5 43          lda zp_sd_currentsector+1
00E756  2  6D 0F 02       adc fat32_readbuffer+15    ; reserved sectors hi
00E759  2  85 47          sta fat32_fatstart+1
00E75B  2  85 4B          sta fat32_datastart+1
00E75D  2  A5 44          lda zp_sd_currentsector+2
00E75F  2  69 00          adc #0
00E761  2  85 48          sta fat32_fatstart+2
00E763  2  85 4C          sta fat32_datastart+2
00E765  2  A5 45          lda zp_sd_currentsector+3
00E767  2  69 00          adc #0
00E769  2  85 49          sta fat32_fatstart+3
00E76B  2  85 4D          sta fat32_datastart+3
00E76D  2               
00E76D  2                 ; Calculate the starting sector of the data area
00E76D  2  AE 10 02       ldx fat32_readbuffer+16   ; number of FATs
00E770  2  86 6C          stx fat32_numfats         ; (stash for later as well)
00E772  2               _skipfatsloop:
00E772  2  18             clc
00E773  2  A5 4A          lda fat32_datastart
00E775  2  6D 24 02       adc fat32_readbuffer+36 ; fatsize 0
00E778  2  85 4A          sta fat32_datastart
00E77A  2  A5 4B          lda fat32_datastart+1
00E77C  2  6D 25 02       adc fat32_readbuffer+37 ; fatsize 1
00E77F  2  85 4B          sta fat32_datastart+1
00E781  2  A5 4C          lda fat32_datastart+2
00E783  2  6D 26 02       adc fat32_readbuffer+38 ; fatsize 2
00E786  2  85 4C          sta fat32_datastart+2
00E788  2  A5 4D          lda fat32_datastart+3
00E78A  2  6D 27 02       adc fat32_readbuffer+39 ; fatsize 3
00E78D  2  85 4D          sta fat32_datastart+3
00E78F  2  CA             dex
00E790  2  D0 E0          bne _skipfatsloop
00E792  2               
00E792  2                 ; Sectors-per-cluster is a power of two from 1 to 128
00E792  2  AD 0D 02       lda fat32_readbuffer+13
00E795  2  85 52          sta fat32_sectorspercluster
00E797  2               
00E797  2                 ; Remember the root cluster
00E797  2  AD 2C 02       lda fat32_readbuffer+44
00E79A  2  85 4E          sta fat32_rootcluster
00E79C  2  AD 2D 02       lda fat32_readbuffer+45
00E79F  2  85 4F          sta fat32_rootcluster+1
00E7A1  2  AD 2E 02       lda fat32_readbuffer+46
00E7A4  2  85 50          sta fat32_rootcluster+2
00E7A6  2  AD 2F 02       lda fat32_readbuffer+47
00E7A9  2  85 51          sta fat32_rootcluster+3
00E7AB  2               
00E7AB  2                 ; Save Sectors Per FAT
00E7AB  2  AD 24 02       lda fat32_readbuffer+36
00E7AE  2  85 71          sta fat32_sectorsperfat
00E7B0  2  AD 25 02       lda fat32_readbuffer+37
00E7B3  2  85 72          sta fat32_sectorsperfat+1
00E7B5  2  AD 26 02       lda fat32_readbuffer+38
00E7B8  2  85 73          sta fat32_sectorsperfat+2
00E7BA  2  AD 27 02       lda fat32_readbuffer+39
00E7BD  2  85 74          sta fat32_sectorsperfat+3
00E7BF  2               
00E7BF  2                 ; Set the last found free cluster to 0.
00E7BF  2  A9 00          lda #0
00E7C1  2  85 5E          sta fat32_lastfoundfreecluster
00E7C3  2  85 5F          sta fat32_lastfoundfreecluster+1
00E7C5  2  85 60          sta fat32_lastfoundfreecluster+2
00E7C7  2  85 61          sta fat32_lastfoundfreecluster+3
00E7C9  2               
00E7C9  2                 ; As well as the last read clusters and sectors
00E7C9  2  85 64          sta fat32_lastcluster
00E7CB  2  85 65          sta fat32_lastcluster+1
00E7CD  2  85 66          sta fat32_lastcluster+2
00E7CF  2  85 67          sta fat32_lastcluster+3
00E7D1  2  85 68          sta fat32_lastsector
00E7D3  2  85 69          sta fat32_lastsector+1
00E7D5  2  85 6A          sta fat32_lastsector+2
00E7D7  2  85 6B          sta fat32_lastsector+3
00E7D9  2               
00E7D9  2  18             clc
00E7DA  2  60             rts
00E7DB  2               
00E7DB  2               _error:
00E7DB  2  38             sec
00E7DC  2  60             rts
00E7DD  2               
00E7DD  2               
00E7DD  2               fat32_seekcluster:
00E7DD  2               ; Calculates the FAT sector given fat32_nextcluster and stores in zp_sd_currentsector
00E7DD  2               ; Optionally will load the 512 byte FAT sector into memory at fat32_readbuffer
00E7DD  2               ; If carry is set, subroutine is optimized to skip the loading if the expected
00E7DD  2               ; sector is already loaded. Clearing carry before calling will skip optimization
00E7DD  2               ; and force reload of the FAT sector. Once the FAT sector is loaded,
00E7DD  2               ; the next cluster in the chain is loaded into fat32_nextcluster and
00E7DD  2               ; zp_sd_currentsector is updated to point to the referenced data sector
00E7DD  2               
00E7DD  2               ; This routine also leaves Y pointing to the LSB for the 32 bit next cluster.
00E7DD  2               
00E7DD  2               ; Gets ready to read fat32_nextcluster, and advances it according to the FAT
00E7DD  2               ; Before calling, set carry to compare the current FAT sector with lastsector.
00E7DD  2               ; Otherwize, clear carry to force reading the FAT.
00E7DD  2               
00E7DD  2  08             php
00E7DE  2               
00E7DE  2                 ; Target buffer
00E7DE  2  A9 00          lda #<fat32_readbuffer
00E7E0  2  85 40          sta zp_sd_address
00E7E2  2  A9 02          lda #>fat32_readbuffer
00E7E4  2  85 41          sta zp_sd_address+1
00E7E6  2               
00E7E6  2                 ; FAT sector = (cluster*4) / 512 = (cluster*2) / 256
00E7E6  2  A5 56          lda fat32_nextcluster
00E7E8  2  0A             asl
00E7E9  2  A5 57          lda fat32_nextcluster+1
00E7EB  2  2A             rol
00E7EC  2  85 42          sta zp_sd_currentsector
00E7EE  2  A5 58          lda fat32_nextcluster+2
00E7F0  2  2A             rol
00E7F1  2  85 43          sta zp_sd_currentsector+1
00E7F3  2  A5 59          lda fat32_nextcluster+3
00E7F5  2  2A             rol
00E7F6  2  85 44          sta zp_sd_currentsector+2
00E7F8  2                 ; note: cluster numbers never have the top bit set, so no carry can occur
00E7F8  2               
00E7F8  2                 ; Add FAT starting sector
00E7F8  2  A5 42          lda zp_sd_currentsector
00E7FA  2  65 46          adc fat32_fatstart
00E7FC  2  85 42          sta zp_sd_currentsector
00E7FE  2  A5 43          lda zp_sd_currentsector+1
00E800  2  65 47          adc fat32_fatstart+1
00E802  2  85 43          sta zp_sd_currentsector+1
00E804  2  A5 44          lda zp_sd_currentsector+2
00E806  2  65 48          adc fat32_fatstart+2
00E808  2  85 44          sta zp_sd_currentsector+2
00E80A  2  A9 00          lda #0
00E80C  2  65 49          adc fat32_fatstart+3
00E80E  2  85 45          sta zp_sd_currentsector+3
00E810  2               
00E810  2                 ; Branch if we don't need to check
00E810  2  28             plp
00E811  2  90 18          bcc _newsector
00E813  2               
00E813  2                 ; Check if this sector is the same as the last one
00E813  2  A5 68          lda fat32_lastsector
00E815  2  C5 42          cmp zp_sd_currentsector
00E817  2  D0 12          bne _newsector
00E819  2  A5 69          lda fat32_lastsector+1
00E81B  2  C5 43          cmp zp_sd_currentsector+1
00E81D  2  D0 0C          bne _newsector
00E81F  2  A5 6A          lda fat32_lastsector+2
00E821  2  C5 44          cmp zp_sd_currentsector+2
00E823  2  D0 06          bne _newsector
00E825  2  A5 6B          lda fat32_lastsector+3
00E827  2  C5 45          cmp zp_sd_currentsector+3
00E829  2  F0 13          beq _notnew
00E82B  2               
00E82B  2               _newsector:
00E82B  2               
00E82B  2                 ; Read the sector from the FAT
00E82B  2  20 EF E5       jsr sd_readsector
00E82E  2               
00E82E  2                 ; Update fat32_lastsector
00E82E  2               
00E82E  2  A5 42          lda zp_sd_currentsector
00E830  2  85 68          sta fat32_lastsector
00E832  2  A5 43          lda zp_sd_currentsector+1
00E834  2  85 69          sta fat32_lastsector+1
00E836  2  A5 44          lda zp_sd_currentsector+2
00E838  2  85 6A          sta fat32_lastsector+2
00E83A  2  A5 45          lda zp_sd_currentsector+3
00E83C  2  85 6B          sta fat32_lastsector+3
00E83E  2               
00E83E  2               _notnew:
00E83E  2               
00E83E  2                 ; Before using this FAT data, set currentsector ready to read the cluster itself
00E83E  2                 ; We need to multiply the cluster number minus two by the number of sectors per
00E83E  2                 ; cluster, then add the data region start sector
00E83E  2               
00E83E  2                 ; Subtract two from cluster number
00E83E  2  38             sec
00E83F  2  A5 56          lda fat32_nextcluster
00E841  2  E9 02          sbc #2
00E843  2  85 42          sta zp_sd_currentsector
00E845  2  A5 57          lda fat32_nextcluster+1
00E847  2  E9 00          sbc #0
00E849  2  85 43          sta zp_sd_currentsector+1
00E84B  2  A5 58          lda fat32_nextcluster+2
00E84D  2  E9 00          sbc #0
00E84F  2  85 44          sta zp_sd_currentsector+2
00E851  2  A5 59          lda fat32_nextcluster+3
00E853  2  E9 00          sbc #0
00E855  2  85 45          sta zp_sd_currentsector+3
00E857  2               
00E857  2                 ; Multiply by sectors-per-cluster which is a power of two between 1 and 128
00E857  2  A5 52          lda fat32_sectorspercluster
00E859  2               _spcshiftloop:
00E859  2  4A             lsr
00E85A  2  B0 0B          bcs _spcshiftloopdone
00E85C  2  06 42          asl zp_sd_currentsector
00E85E  2  26 43          rol zp_sd_currentsector+1
00E860  2  26 44          rol zp_sd_currentsector+2
00E862  2  26 45          rol zp_sd_currentsector+3
00E864  2  4C 59 E8       jmp _spcshiftloop
00E867  2               _spcshiftloopdone:
00E867  2               
00E867  2                 ; Add the data region start sector
00E867  2  18             clc
00E868  2  A5 42          lda zp_sd_currentsector
00E86A  2  65 4A          adc fat32_datastart
00E86C  2  85 42          sta zp_sd_currentsector
00E86E  2  A5 43          lda zp_sd_currentsector+1
00E870  2  65 4B          adc fat32_datastart+1
00E872  2  85 43          sta zp_sd_currentsector+1
00E874  2  A5 44          lda zp_sd_currentsector+2
00E876  2  65 4C          adc fat32_datastart+2
00E878  2  85 44          sta zp_sd_currentsector+2
00E87A  2  A5 45          lda zp_sd_currentsector+3
00E87C  2  65 4D          adc fat32_datastart+3
00E87E  2  85 45          sta zp_sd_currentsector+3
00E880  2               
00E880  2                 ; That's now ready for later code to read this sector in - tell it how many consecutive
00E880  2                 ; sectors it can now read
00E880  2  A5 52          lda fat32_sectorspercluster
00E882  2  85 53          sta fat32_pendingsectors
00E884  2               
00E884  2                 ; Now go back to looking up the next cluster in the chain
00E884  2                 ; Find the offset to this cluster's entry in the FAT sector we loaded earlier
00E884  2               
00E884  2                 ; Offset = (cluster*4) & 511 = (cluster & 127) * 4
00E884  2  A5 56          lda fat32_nextcluster
00E886  2  29 7F          and #$7f
00E888  2  0A             asl
00E889  2  0A             asl
00E88A  2  A8             tay ; Y = low byte of offset
00E88B  2               
00E88B  2                 ; Add the potentially carried bit to the high byte of the address
00E88B  2  A5 41          lda zp_sd_address+1
00E88D  2  69 00          adc #0
00E88F  2  85 41          sta zp_sd_address+1
00E891  2               
00E891  2                 ; Stash the index to next value for the cluster
00E891  2  98             tya
00E892  2  48             pha
00E893  2               
00E893  2                 ; Copy out the next cluster in the chain for later use
00E893  2  B1 40          lda (zp_sd_address),y
00E895  2  85 56          sta fat32_nextcluster
00E897  2  C8             iny
00E898  2  B1 40          lda (zp_sd_address),y
00E89A  2  85 57          sta fat32_nextcluster+1
00E89C  2  C8             iny
00E89D  2  B1 40          lda (zp_sd_address),y
00E89F  2  85 58          sta fat32_nextcluster+2
00E8A1  2  C8             iny
00E8A2  2  B1 40          lda (zp_sd_address),y
00E8A4  2  29 0F          and #$0f
00E8A6  2  85 59          sta fat32_nextcluster+3
00E8A8  2               
00E8A8  2                 ; Restore index to the table entry for the cluster
00E8A8  2  68             pla
00E8A9  2  A8             tay
00E8AA  2               
00E8AA  2                 ; See if it's the end of the chain
00E8AA  2  A5 59          lda fat32_nextcluster+3
00E8AC  2  C9 0F          cmp #$0F
00E8AE  2  90 18          bcc _notendofchain
00E8B0  2  A5 58          lda fat32_nextcluster+2
00E8B2  2  C9 FF          cmp #$FF
00E8B4  2  D0 12          bne _notendofchain
00E8B6  2  A5 57          lda fat32_nextcluster+1
00E8B8  2  C9 FF          cmp #$FF
00E8BA  2  D0 0C          bne _notendofchain
00E8BC  2  A5 56          lda fat32_nextcluster
00E8BE  2  C9 F8          cmp #$F8
00E8C0  2  90 06          bcc _notendofchain
00E8C2  2               
00E8C2  2                 ; It's EOC
00E8C2  2  A9 FF          lda #$FF
00E8C4  2  85 59          sta fat32_nextcluster+3
00E8C6  2  38             sec
00E8C7  2  60             rts
00E8C8  2               _notendofchain:
00E8C8  2  18             clc
00E8C9  2  60             rts
00E8CA  2               
00E8CA  2               
00E8CA  2               fat32_readnextsector:
00E8CA  2                 ; Reads the next sector from a cluster chain into the buffer at fat32_address.
00E8CA  2                 ;
00E8CA  2                 ; Advances the current sector ready for the next read and looks up the next cluster
00E8CA  2                 ; in the chain when necessary.
00E8CA  2                 ;
00E8CA  2                 ; On return, carry is clear if data was read, or set if the cluster chain has ended.
00E8CA  2               
00E8CA  2                 ; Maybe there are pending sectors in the current cluster
00E8CA  2  A5 53          lda fat32_pendingsectors
00E8CC  2  D0 1F          bne _readsector
00E8CE  2               
00E8CE  2                 ; No pending sectors, check for end of cluster chain
00E8CE  2  A5 59          lda fat32_nextcluster+3
00E8D0  2  C9 0F          cmp #$0F
00E8D2  2  D0 15          bne _not_eoc
00E8D4  2  A5 58          lda fat32_nextcluster+2
00E8D6  2  C9 FF          cmp #$FF
00E8D8  2  D0 0F          bne _not_eoc
00E8DA  2  A5 57          lda fat32_nextcluster+1
00E8DC  2  C9 FF          cmp #$FF
00E8DE  2  D0 09          bne _not_eoc
00E8E0  2  A5 56          lda fat32_nextcluster
00E8E2  2  C9 F8          cmp #$F8     ; EOC starts at F8
00E8E4  2  90 03          bcc _not_eoc
00E8E6  2               
00E8E6  2  4C 0A E9       jmp _readendofchain
00E8E9  2               
00E8E9  2               _not_eoc:
00E8E9  2               
00E8E9  2                 ; Prepare to read the next cluster.
00E8E9  2                 ; Force FAT reload: fat32_readbuffer is also used for data sectors,
00E8E9  2                 ; so the cached FAT contents may have been overwritten.
00E8E9  2  18             clc
00E8EA  2  20 DD E7       jsr fat32_seekcluster
00E8ED  2               
00E8ED  2               _readsector:
00E8ED  2  C6 53          dec fat32_pendingsectors
00E8EF  2               
00E8EF  2                 ; Set up target address
00E8EF  2  A5 54          lda fat32_address
00E8F1  2  85 40          sta zp_sd_address
00E8F3  2  A5 55          lda fat32_address+1
00E8F5  2  85 41          sta zp_sd_address+1
00E8F7  2               
00E8F7  2                 ; Read the sector
00E8F7  2  20 EF E5       jsr sd_readsector
00E8FA  2               
00E8FA  2                 ; Advance to next sector
00E8FA  2  E6 42          inc zp_sd_currentsector
00E8FC  2  D0 0A          bne _sectorincrementdone
00E8FE  2  E6 43          inc zp_sd_currentsector+1
00E900  2  D0 06          bne _sectorincrementdone
00E902  2  E6 44          inc zp_sd_currentsector+2
00E904  2  D0 02          bne _sectorincrementdone
00E906  2  E6 45          inc zp_sd_currentsector+3
00E908  2               _sectorincrementdone:
00E908  2               
00E908  2                 ; Success - clear carry and return
00E908  2  18             clc
00E909  2  60             rts
00E90A  2               
00E90A  2               _readendofchain:
00E90A  2                 ; End of chain - set carry and return
00E90A  2  38             sec
00E90B  2  60             rts
00E90C  2               
00E90C  2               fat32_writenextsector:
00E90C  2                 ; Writes the next sector in a cluster chain from the buffer at fat32_address.
00E90C  2                 ;
00E90C  2                 ; On return, carry is set if its the end of the chain.
00E90C  2               
00E90C  2                 ; Maybe there are pending sectors in the current cluster
00E90C  2  A5 53          lda fat32_pendingsectors
00E90E  2  D0 08          bne _beginwrite
00E910  2               
00E910  2                 ; No pending sectors, check for end of cluster chain
00E910  2  A5 59          lda fat32_nextcluster+3
00E912  2  30 09          bmi _writeendofchain
00E914  2               
00E914  2                 ; Prepare to read the next cluster.
00E914  2                 ; Force FAT reload: fat32_readbuffer is also used for data sectors,
00E914  2                 ; so the cached FAT contents may have been overwritten.
00E914  2  18             clc
00E915  2  20 DD E7       jsr fat32_seekcluster
00E918  2               
00E918  2               _beginwrite:
00E918  2  20 22 E9       jsr _writesector
00E91B  2               
00E91B  2                 ; Success - clear carry and return
00E91B  2  18             clc
00E91C  2  60             rts
00E91D  2               
00E91D  2               _writeendofchain:
00E91D  2                 ; End of chain - set carry, write a sector, and return
00E91D  2  20 22 E9       jsr _writesector
00E920  2  38             sec
00E921  2  60             rts
00E922  2               
00E922  2               _writesector:
00E922  2  C6 53          dec fat32_pendingsectors
00E924  2               
00E924  2                 ; Set up target address
00E924  2  A5 54          lda fat32_address
00E926  2  85 40          sta zp_sd_address
00E928  2  A5 55          lda fat32_address+1
00E92A  2  85 41          sta zp_sd_address+1
00E92C  2               
00E92C  2                 ; Write the sector
00E92C  2  20 4D E6       jsr sd_writesector
00E92F  2               
00E92F  2                 ; Advance to next sector
00E92F  2  E6 42          inc zp_sd_currentsector
00E931  2  D0 0A          bne _nextsectorincrementdone
00E933  2  E6 43          inc zp_sd_currentsector+1
00E935  2  D0 06          bne _nextsectorincrementdone
00E937  2  E6 44          inc zp_sd_currentsector+2
00E939  2  D0 02          bne _nextsectorincrementdone
00E93B  2  E6 45          inc zp_sd_currentsector+3
00E93D  2               _nextsectorincrementdone:
00E93D  2  60             rts
00E93E  2               
00E93E  2               fat32_updatefat:
00E93E  2                ; Preserve the current sector
00E93E  2  A5 42          lda zp_sd_currentsector
00E940  2  48             pha
00E941  2  A5 43          lda zp_sd_currentsector+1
00E943  2  48             pha
00E944  2  A5 44          lda zp_sd_currentsector+2
00E946  2  48             pha
00E947  2  A5 45          lda zp_sd_currentsector+3
00E949  2  48             pha
00E94A  2               
00E94A  2                 ; Write FAT sector
00E94A  2  A5 68          lda fat32_lastsector
00E94C  2  85 42          sta zp_sd_currentsector
00E94E  2  A5 69          lda fat32_lastsector+1
00E950  2  85 43          sta zp_sd_currentsector+1
00E952  2  A5 6A          lda fat32_lastsector+2
00E954  2  85 44          sta zp_sd_currentsector+2
00E956  2  A5 6B          lda fat32_lastsector+3
00E958  2  85 45          sta zp_sd_currentsector+3
00E95A  2               
00E95A  2                 ; Target buffer
00E95A  2  A9 00          lda #<fat32_readbuffer
00E95C  2  85 40          sta zp_sd_address
00E95E  2  A9 02          lda #>fat32_readbuffer
00E960  2  85 41          sta zp_sd_address+1
00E962  2               
00E962  2                 ; Write the FAT sector
00E962  2  20 4D E6       jsr sd_writesector
00E965  2               
00E965  2                 ; Check if FAT mirroring is enabled
00E965  2  A5 6C          lda fat32_numfats
00E967  2  C9 02          cmp #2
00E969  2  D0 1B          bne _onefat
00E96B  2               
00E96B  2                 ; Add the last sector to the amount of sectors per FAT
00E96B  2                 ; (to get the second fat location)
00E96B  2  A5 68          lda fat32_lastsector
00E96D  2  65 71          adc fat32_sectorsperfat
00E96F  2  85 42          sta zp_sd_currentsector
00E971  2  A5 69          lda fat32_lastsector+1
00E973  2  65 72          adc fat32_sectorsperfat+1
00E975  2  85 43          sta zp_sd_currentsector+1
00E977  2  A5 6A          lda fat32_lastsector+2
00E979  2  65 73          adc fat32_sectorsperfat+2
00E97B  2  85 44          sta zp_sd_currentsector+2
00E97D  2  A5 6B          lda fat32_lastsector+3
00E97F  2  65 74          adc fat32_sectorsperfat+3
00E981  2  85 45          sta zp_sd_currentsector+3
00E983  2               
00E983  2                 ; Write the FAT sector
00E983  2  20 4D E6       jsr sd_writesector
00E986  2               
00E986  2               _onefat:
00E986  2                 ; Pull back the current sector
00E986  2  68             pla
00E987  2  85 45          sta zp_sd_currentsector+3
00E989  2  68             pla
00E98A  2  85 44          sta zp_sd_currentsector+2
00E98C  2  68             pla
00E98D  2  85 43          sta zp_sd_currentsector+1
00E98F  2  68             pla
00E990  2  85 42          sta zp_sd_currentsector
00E992  2               
00E992  2  60             rts
00E993  2               
00E993  2               fat32_openroot:
00E993  2                 ; Prepare to read the root directory
00E993  2               
00E993  2  A5 4E          lda fat32_rootcluster
00E995  2  85 56          sta fat32_nextcluster
00E997  2  85 75          sta fat32_cdcluster
00E999  2  A5 4F          lda fat32_rootcluster+1
00E99B  2  85 57          sta fat32_nextcluster+1
00E99D  2  85 76          sta fat32_cdcluster+1
00E99F  2  A5 50          lda fat32_rootcluster+2
00E9A1  2  85 58          sta fat32_nextcluster+2
00E9A3  2  85 77          sta fat32_cdcluster+2
00E9A5  2  A5 51          lda fat32_rootcluster+3
00E9A7  2  85 59          sta fat32_nextcluster+3
00E9A9  2  85 78          sta fat32_cdcluster+3
00E9AB  2               
00E9AB  2  18             clc
00E9AC  2  20 DD E7       jsr fat32_seekcluster
00E9AF  2               
00E9AF  2                 ; Set the pointer to a large value so we always read a sector the first time through
00E9AF  2  A9 FF          lda #$ff
00E9B1  2  85 41          sta zp_sd_address+1
00E9B3  2               
00E9B3  2  60             rts
00E9B4  2               
00E9B4  2               fat32_allocatecluster:
00E9B4  2                 ; Allocate a cluster to start storing a file at.
00E9B4  2               
00E9B4  2                 ; Find a free cluster
00E9B4  2  20 91 EA       jsr fat32_findnextfreecluster
00E9B7  2               
00E9B7  2                 ; Cache the value so we can add the address of the next one later, if any
00E9B7  2  A5 5E          lda fat32_lastfoundfreecluster
00E9B9  2  85 64          sta fat32_lastcluster
00E9BB  2  85 6D          sta fat32_filecluster
00E9BD  2  A5 5F          lda fat32_lastfoundfreecluster+1
00E9BF  2  85 65          sta fat32_lastcluster+1
00E9C1  2  85 6E          sta fat32_filecluster+1
00E9C3  2  A5 60          lda fat32_lastfoundfreecluster+2
00E9C5  2  85 66          sta fat32_lastcluster+2
00E9C7  2  85 6F          sta fat32_filecluster+2
00E9C9  2  A5 61          lda fat32_lastfoundfreecluster+3
00E9CB  2  85 67          sta fat32_lastcluster+3
00E9CD  2  85 70          sta fat32_filecluster+3
00E9CF  2               
00E9CF  2                 ; Add marker for the following routines, so we don't think this is free.
00E9CF  2                 ; (zp_sd_address),y is controlled by fat32_seekcluster, called in fat32_findnextfreecluster
00E9CF  2                 ; this points to the most significant byte in the last selected 32-bit FAT entry.
00E9CF  2  A9 0F          lda #$0f
00E9D1  2  91 40          sta (zp_sd_address),y
00E9D3  2               
00E9D3  2  60             rts
00E9D4  2               
00E9D4  2               fat32_allocatefile:
00E9D4  2                 ; Allocate an entire file in the FAT, with the
00E9D4  2                 ; file's size in fat32_bytesremaining
00E9D4  2               
00E9D4  2                 ; We will read a new sector the first time around
00E9D4  2  A9 00          lda #0
00E9D6  2  85 68          sta fat32_lastsector
00E9D8  2  85 69          sta fat32_lastsector+1
00E9DA  2  85 6A          sta fat32_lastsector+2
00E9DC  2  85 6B          sta fat32_lastsector+3
00E9DE  2               
00E9DE  2                 ; Allocate the first cluster.
00E9DE  2  20 B4 E9       jsr fat32_allocatecluster
00E9E1  2               
00E9E1  2                 ; We don't properly support 64k+ files, as it's unnecessary complication given
00E9E1  2                 ; the 6502's small address space. So we'll just empty out the top two bytes.
00E9E1  2  A9 00          lda #0
00E9E3  2  85 5C          sta fat32_bytesremaining+2
00E9E5  2  85 5D          sta fat32_bytesremaining+3
00E9E7  2               
00E9E7  2                 ; Stash filesize, as we will be clobbering it here
00E9E7  2  A5 5A          lda fat32_bytesremaining
00E9E9  2  48             pha
00E9EA  2  A5 5B          lda fat32_bytesremaining+1
00E9EC  2  48             pha
00E9ED  2               
00E9ED  2                 ; Round the size up to the next whole sector
00E9ED  2  A5 5A          lda fat32_bytesremaining
00E9EF  2  C9 01          cmp #1                      ; set carry if bottom 8 bits not zero
00E9F1  2  A5 5B          lda fat32_bytesremaining+1
00E9F3  2  69 00          adc #0                      ; add carry, if any
00E9F5  2  4A             lsr                         ; divide by 2
00E9F6  2  69 00          adc #0                      ; round up
00E9F8  2               
00E9F8  2                 ; No data?
00E9F8  2  D0 03          bne _nofail
00E9FA  2  4C 8A EA       jmp _lastclusterdone
00E9FD  2               
00E9FD  2               _nofail:
00E9FD  2                 ; This will be clustersremaining now.
00E9FD  2  85 5A          sta fat32_bytesremaining
00E9FF  2               
00E9FF  2                 ; Divide by sectors per cluster (power of 2)
00E9FF  2                 ; If it's 1, then skip
00E9FF  2  A5 52          lda fat32_sectorspercluster
00EA01  2               _cloop:
00EA01  2  C9 01          cmp #1
00EA03  2  F0 08          beq _one
00EA05  2               
00EA05  2  4A             lsr
00EA06  2  46 5B          lsr fat32_bytesremaining+1  ; high byte
00EA08  2  66 5A          ror fat32_bytesremaining    ; low byte, with carry from high
00EA0A  2               
00EA0A  2  4C 01 EA       jmp _cloop
00EA0D  2               
00EA0D  2               _one:
00EA0D  2               
00EA0D  2                 ; We will be making a new cluster every time
00EA0D  2  A9 00          lda #0
00EA0F  2  85 53          sta fat32_pendingsectors
00EA11  2               
00EA11  2                 ; Find free clusters and allocate them for use for this file.
00EA11  2               _allocateloop:
00EA11  2                 ; Check if it's the last cluster in the chain
00EA11  2  A5 5A          lda fat32_bytesremaining
00EA13  2  F0 04          beq _lastcluster
00EA15  2  C9 01          cmp #1                ; CHECK! is 1 the right amount for this?
00EA17  2  90 2B          bcc _notlastcluster   ; clustersremaining <=1?
00EA19  2               
00EA19  2                 ; It is the last one.
00EA19  2               
00EA19  2               _lastcluster:
00EA19  2               
00EA19  2               ; go back the previous one
00EA19  2  A5 64          lda fat32_lastcluster
00EA1B  2  85 56          sta fat32_nextcluster
00EA1D  2  A5 65          lda fat32_lastcluster+1
00EA1F  2  85 57          sta fat32_nextcluster+1
00EA21  2  A5 66          lda fat32_lastcluster+2
00EA23  2  85 58          sta fat32_nextcluster+2
00EA25  2  A5 67          lda fat32_lastcluster+3
00EA27  2  85 59          sta fat32_nextcluster+3
00EA29  2               
00EA29  2  38             sec
00EA2A  2  20 DD E7       jsr fat32_seekcluster
00EA2D  2               
00EA2D  2                 ; Write 0x0FFFFFFE (EOC)
00EA2D  2  A9 0F          lda #$0f
00EA2F  2  91 40          sta (zp_sd_address),y
00EA31  2  88             dey
00EA32  2  A9 FF          lda #$ff
00EA34  2  91 40          sta (zp_sd_address),y
00EA36  2  88             dey
00EA37  2  91 40          sta (zp_sd_address),y
00EA39  2  88             dey
00EA3A  2  A9 FE          lda #$fe
00EA3C  2  91 40          sta (zp_sd_address),y
00EA3E  2               
00EA3E  2                 ; Update the FAT
00EA3E  2  20 3E E9       jsr fat32_updatefat
00EA41  2               
00EA41  2                 ; End of chain - exit
00EA41  2  4C 8A EA       jmp _lastclusterdone
00EA44  2               
00EA44  2               _notlastcluster:
00EA44  2                 ; Wait! Is there exactly 1 cluster left?
00EA44  2  F0 D3          beq _lastcluster
00EA46  2               
00EA46  2                 ; Find the next cluster
00EA46  2  20 91 EA       jsr fat32_findnextfreecluster
00EA49  2               
00EA49  2                 ; Add marker so we don't think this is free.
00EA49  2  A9 0F          lda #$0f
00EA4B  2  91 40          sta (zp_sd_address),y
00EA4D  2               
00EA4D  2                 ; Seek to the previous cluster
00EA4D  2  A5 64          lda fat32_lastcluster
00EA4F  2  85 56          sta fat32_nextcluster
00EA51  2  A5 65          lda fat32_lastcluster+1
00EA53  2  85 57          sta fat32_nextcluster+1
00EA55  2  A5 66          lda fat32_lastcluster+2
00EA57  2  85 58          sta fat32_nextcluster+2
00EA59  2  A5 67          lda fat32_lastcluster+3
00EA5B  2  85 59          sta fat32_nextcluster+3
00EA5D  2               
00EA5D  2  38             sec
00EA5E  2  20 DD E7       jsr fat32_seekcluster
00EA61  2               
00EA61  2  98             tya
00EA62  2  48             pha
00EA63  2                 ; Enter the address of the next one into the FAT
00EA63  2  A5 61          lda fat32_lastfoundfreecluster+3
00EA65  2  85 67          sta fat32_lastcluster+3
00EA67  2  91 40          sta (zp_sd_address),y
00EA69  2  88             dey
00EA6A  2  A5 60          lda fat32_lastfoundfreecluster+2
00EA6C  2  85 66          sta fat32_lastcluster+2
00EA6E  2  91 40          sta (zp_sd_address),y
00EA70  2  88             dey
00EA71  2  A5 5F          lda fat32_lastfoundfreecluster+1
00EA73  2  85 65          sta fat32_lastcluster+1
00EA75  2  91 40          sta (zp_sd_address),y
00EA77  2  88             dey
00EA78  2  A5 5E          lda fat32_lastfoundfreecluster
00EA7A  2  85 64          sta fat32_lastcluster
00EA7C  2  91 40          sta (zp_sd_address),y
00EA7E  2  68             pla
00EA7F  2  A8             tay
00EA80  2               
00EA80  2                 ; Update the FAT
00EA80  2  20 3E E9       jsr fat32_updatefat
00EA83  2               
00EA83  2  A6 5A          ldx fat32_bytesremaining    ; note - actually loads clusters remaining
00EA85  2  CA             dex
00EA86  2  86 5A          stx fat32_bytesremaining    ; note - actually stores clusters remaining
00EA88  2               
00EA88  2  D0 87          bne _allocateloop
00EA8A  2               
00EA8A  2                 ; Done!
00EA8A  2               _lastclusterdone:
00EA8A  2                 ; Pull the filesize back from the stack
00EA8A  2  68             pla
00EA8B  2  85 5B          sta fat32_bytesremaining+1
00EA8D  2  68             pla
00EA8E  2  85 5A          sta fat32_bytesremaining
00EA90  2  60             rts
00EA91  2               
00EA91  2               
00EA91  2               fat32_findnextfreecluster:
00EA91  2               ; Find next free cluster
00EA91  2               ;
00EA91  2               ; This program will search the FAT for an empty entry, and
00EA91  2               ; save the 32-bit cluster number at fat32_lastfoundfreecluter.
00EA91  2               ;
00EA91  2               ; Also sets the carry bit if the SD card is full.
00EA91  2               ;
00EA91  2               
00EA91  2                 ; Find a free cluster and store it's location in fat32_lastfoundfreecluster
00EA91  2               
00EA91  2  A9 00          lda #0
00EA93  2  85 56          sta fat32_nextcluster
00EA95  2  85 5E          sta fat32_lastfoundfreecluster
00EA97  2  A9 00          lda #0
00EA99  2  85 57          sta fat32_nextcluster+1
00EA9B  2  85 5F          sta fat32_lastfoundfreecluster+1
00EA9D  2  85 58          sta fat32_nextcluster+2
00EA9F  2  85 60          sta fat32_lastfoundfreecluster+2
00EAA1  2  85 59          sta fat32_nextcluster+3
00EAA3  2  85 61          sta fat32_lastfoundfreecluster+3
00EAA5  2               
00EAA5  2               _searchclusters:
00EAA5  2               
00EAA5  2                 ; Seek cluster
00EAA5  2  38             sec
00EAA6  2  20 DD E7       jsr fat32_seekcluster
00EAA9  2               
00EAA9  2                 ; Is the cluster free?
00EAA9  2  A5 56          lda fat32_nextcluster
00EAAB  2  05 57          ora fat32_nextcluster+1
00EAAD  2  05 58          ora fat32_nextcluster+2
00EAAF  2  05 59          ora fat32_nextcluster+3
00EAB1  2  F0 29          beq _foundcluster
00EAB3  2               
00EAB3  2                 ; No, increment the cluster count
00EAB3  2  E6 5E          inc fat32_lastfoundfreecluster
00EAB5  2  D0 10          bne _copycluster
00EAB7  2  E6 5F          inc fat32_lastfoundfreecluster+1
00EAB9  2  D0 0C          bne _copycluster
00EABB  2  E6 60          inc fat32_lastfoundfreecluster+2
00EABD  2  D0 08          bne _copycluster
00EABF  2  E6 61          inc fat32_lastfoundfreecluster+3
00EAC1  2               
00EAC1  2  A5 5E          lda fat32_lastfoundfreecluster
00EAC3  2  C9 10          cmp #$10
00EAC5  2  B0 17          bcs _sd_full
00EAC7  2               
00EAC7  2               _copycluster:
00EAC7  2               
00EAC7  2                 ; Copy the cluster count to the next cluster
00EAC7  2  A5 5E          lda fat32_lastfoundfreecluster
00EAC9  2  85 56          sta fat32_nextcluster
00EACB  2  A5 5F          lda fat32_lastfoundfreecluster+1
00EACD  2  85 57          sta fat32_nextcluster+1
00EACF  2  A5 60          lda fat32_lastfoundfreecluster+2
00EAD1  2  85 58          sta fat32_nextcluster+2
00EAD3  2  A5 61          lda fat32_lastfoundfreecluster+3
00EAD5  2  29 0F          and #$0f
00EAD7  2  85 59          sta fat32_nextcluster+3
00EAD9  2               
00EAD9  2                 ; Go again for another pass
00EAD9  2  4C A5 EA       jmp _searchclusters
00EADC  2               
00EADC  2               _foundcluster:
00EADC  2                 ; done.
00EADC  2  18             clc
00EADD  2  60             rts
00EADE  2               
00EADE  2               _sd_full:
00EADE  2                 ; Card Full
00EADE  2  38             sec
00EADF  2  60             rts
00EAE0  2               
00EAE0  2               fat32_opendirent:
00EAE0  2                 ; Prepare to read/write a file or directory based on a dirent
00EAE0  2                 ;
00EAE0  2                 ; Point zp_sd_address at the dirent
00EAE0  2               
00EAE0  2                 ; Remember file size in bytes remaining
00EAE0  2  A0 1C          ldy #28
00EAE2  2  B1 40          lda (zp_sd_address),y
00EAE4  2  85 5A          sta fat32_bytesremaining
00EAE6  2  C8             iny
00EAE7  2  B1 40          lda (zp_sd_address),y
00EAE9  2  85 5B          sta fat32_bytesremaining+1
00EAEB  2  C8             iny
00EAEC  2  B1 40          lda (zp_sd_address),y
00EAEE  2  85 5C          sta fat32_bytesremaining+2
00EAF0  2  C8             iny
00EAF1  2  B1 40          lda (zp_sd_address),y
00EAF3  2  85 5D          sta fat32_bytesremaining+3
00EAF5  2               
00EAF5  2                 ; Seek to first cluster
00EAF5  2  A0 1A          ldy #26
00EAF7  2  B1 40          lda (zp_sd_address),y
00EAF9  2  85 56          sta fat32_nextcluster
00EAFB  2  C8             iny
00EAFC  2  B1 40          lda (zp_sd_address),y
00EAFE  2  85 57          sta fat32_nextcluster+1
00EB00  2  A0 14          ldy #20
00EB02  2  B1 40          lda (zp_sd_address),y
00EB04  2  85 58          sta fat32_nextcluster+2
00EB06  2  C8             iny
00EB07  2  B1 40          lda (zp_sd_address),y
00EB09  2  85 59          sta fat32_nextcluster+3
00EB0B  2               
00EB0B  2  18             clc
00EB0C  2  A0 0B          ldy #$0B
00EB0E  2  B1 40          lda (zp_sd_address),Y
00EB10  2  29 10          and #$10   ; is it a directory?
00EB12  2  F0 10          beq _fatskip_cd_cache
00EB14  2               
00EB14  2                 ; If it's a directory, cache the cluster
00EB14  2  A5 56          lda fat32_nextcluster
00EB16  2  85 75          sta fat32_cdcluster
00EB18  2  A5 57          lda fat32_nextcluster+1
00EB1A  2  85 76          sta fat32_cdcluster+1
00EB1C  2  A5 58          lda fat32_nextcluster+2
00EB1E  2  85 77          sta fat32_cdcluster+2
00EB20  2  A5 59          lda fat32_nextcluster+3
00EB22  2  85 78          sta fat32_cdcluster+3
00EB24  2               
00EB24  2               _fatskip_cd_cache:
00EB24  2               
00EB24  2                 ; if we're opening a directory entry with 0 cluster, use the root cluster
00EB24  2  A5 59          lda fat32_nextcluster+3
00EB26  2  D0 12          bne _fseek
00EB28  2  A5 58          lda fat32_nextcluster+2
00EB2A  2  D0 0E          bne _fseek
00EB2C  2  A5 57          lda fat32_nextcluster+1
00EB2E  2  D0 0A          bne _fseek
00EB30  2  A5 56          lda fat32_nextcluster
00EB32  2  D0 06          bne _fseek
00EB34  2  A5 4E          lda fat32_rootcluster
00EB36  2  85 56          sta fat32_nextcluster
00EB38  2  85 75          sta fat32_cdcluster
00EB3A  2               
00EB3A  2               _fseek:
00EB3A  2  18             clc
00EB3B  2  20 DD E7       jsr fat32_seekcluster
00EB3E  2               
00EB3E  2                 ; Set the pointer to a large value so we always read a sector the first time through
00EB3E  2  A9 FF          lda #$ff
00EB40  2  85 41          sta zp_sd_address+1
00EB42  2               
00EB42  2  60             rts
00EB43  2               
00EB43  2               fat32_writedirent:
00EB43  2                 ; Write a directory entry from the open directory
00EB43  2                 ; requires:
00EB43  2                 ;   fat32bytesremaining (2 bytes) = file size in bytes (little endian)
00EB43  2               
00EB43  2                 ; Increment pointer by 32 to point to next entry
00EB43  2  18             clc
00EB44  2  A5 40          lda zp_sd_address
00EB46  2  69 20          adc #32
00EB48  2  85 40          sta zp_sd_address
00EB4A  2  A5 41          lda zp_sd_address+1
00EB4C  2  69 00          adc #0
00EB4E  2  85 41          sta zp_sd_address+1
00EB50  2               
00EB50  2                 ; If it's not at the end of the buffer, we have data already
00EB50  2  C9 04          cmp #>(fat32_readbuffer+$200)
00EB52  2  90 0F          bcc _gotdirrent
00EB54  2               
00EB54  2                 ; Read another sector
00EB54  2  A9 00          lda #<fat32_readbuffer
00EB56  2  85 54          sta fat32_address
00EB58  2  A9 02          lda #>fat32_readbuffer
00EB5A  2  85 55          sta fat32_address+1
00EB5C  2               
00EB5C  2  20 CA E8       jsr fat32_readnextsector
00EB5F  2  90 02          bcc _gotdirrent
00EB61  2               
00EB61  2               _endofdirectorywrite:
00EB61  2  38             sec
00EB62  2  60             rts
00EB63  2               
00EB63  2               _gotdirrent:
00EB63  2                 ; Check first character
00EB63  2  18             clc
00EB64  2  A0 00          ldy #0
00EB66  2  B1 40          lda (zp_sd_address),y
00EB68  2  D0 D9          bne fat32_writedirent ; go again
00EB6A  2                 ; End of directory. Now make a new entry.
00EB6A  2               _dloop:
00EB6A  2  B1 62          lda (fat32_filenamepointer),y  ; copy filename
00EB6C  2  91 40          sta (zp_sd_address),y
00EB6E  2  C8             iny
00EB6F  2  C0 0B          cpy #$0b
00EB71  2  D0 F7          bne _dloop
00EB73  2                 ; The full Short filename is #11 bytes long so,
00EB73  2                 ; this start at 0x0b - File type
00EB73  2                 ; BUG assumes that we are making a file, not a folder...
00EB73  2  A9 20          lda #$20    ; File Type: ARCHIVE
00EB75  2  91 40          sta (zp_sd_address),y
00EB77  2  C8             iny   ; 0x0c - Checksum/File accsess password
00EB78  2  A9 10          lda #$10                ; No checksum or password
00EB7A  2  91 40          sta (zp_sd_address),y
00EB7C  2  C8             iny   ; 0x0d - first char of deleted file - 0x7d for nothing
00EB7D  2  A9 7D          lda #$7D
00EB7F  2  91 40          sta (zp_sd_address),y
00EB81  2  C8             iny  ; 0x0e-0x11 - File creation time/date
00EB82  2  A9 00          lda #0
00EB84  2               _empty:
00EB84  2  91 40          sta (zp_sd_address),y	; No time/date because I don't have an RTC
00EB86  2  C8             iny
00EB87  2  C0 14          cpy #$14 ; also empty the user ID (0x12-0x13)
00EB89  2  D0 F9          bne _empty
00EB8B  2                 ;sta (zp_sd_address),y
00EB8B  2                 ;iny
00EB8B  2                 ;sta (zp_sd_address),y
00EB8B  2                 ;iny
00EB8B  2                 ;sta (zp_sd_address),y
00EB8B  2                 ; if you have an RTC, refer to https://en.wikipedia.org/wiki/Design_of_the_FAT_file_system#Directory_entry
00EB8B  2                 ; show the "Directory entry" table and look at at 0x0E onward.
00EB8B  2                 ;iny   ; 0x12-0x13 - User ID
00EB8B  2                 ;lda #0
00EB8B  2                 ;sta (zp_sd_address),y  ; No ID
00EB8B  2                 ;iny
00EB8B  2                 ;sta (zp_sd_address),y
00EB8B  2                 ;iny
00EB8B  2                 ; 0x14-0x15 - File start cluster (high word)
00EB8B  2  A5 6F          lda fat32_filecluster+2
00EB8D  2  91 40          sta (zp_sd_address),y
00EB8F  2  C8             iny
00EB90  2  A5 70          lda fat32_filecluster+3
00EB92  2  91 40          sta (zp_sd_address),y
00EB94  2  C8             iny ; 0x16-0x19 - File modifiaction date
00EB95  2  A9 00          lda #0
00EB97  2  91 40          sta (zp_sd_address),y
00EB99  2  C8             iny
00EB9A  2  91 40          sta (zp_sd_address),y   ; no rtc
00EB9C  2  C8             iny
00EB9D  2  91 40          sta (zp_sd_address),y
00EB9F  2  C8             iny
00EBA0  2  91 40          sta (zp_sd_address),y
00EBA2  2  C8             iny ; 0x1a-0x1b - File start cluster (low word)
00EBA3  2  A5 6D          lda fat32_filecluster
00EBA5  2  91 40          sta (zp_sd_address),y
00EBA7  2  C8             iny
00EBA8  2  A5 6E          lda fat32_filecluster+1
00EBAA  2  91 40          sta (zp_sd_address),y
00EBAC  2  C8             iny ; 0x1c-0x1f File size in bytes
00EBAD  2  A5 5A          lda fat32_bytesremaining
00EBAF  2  91 40          sta (zp_sd_address),y
00EBB1  2  C8             iny
00EBB2  2  A5 5B          lda fat32_bytesremaining+1
00EBB4  2  91 40          sta (zp_sd_address),y
00EBB6  2  C8             iny
00EBB7  2  A9 00          lda #0
00EBB9  2  91 40          sta (zp_sd_address),y ; No bigger that 64k
00EBBB  2  C8             iny
00EBBC  2  91 40          sta (zp_sd_address),y
00EBBE  2  C8             iny
00EBBF  2                 ; are we over the buffer?
00EBBF  2  A5 41          lda zp_sd_address+1
00EBC1  2  C9 04          cmp #>(fat32_readbuffer+$200)
00EBC3  2  90 12          bcc _notoverbuffer
00EBC5  2  20 FA EB       jsr fat32_writecurrentsector       ; if so, write the current sector
00EBC8  2  20 CA E8       jsr fat32_readnextsector  ; then read the next one.
00EBCB  2  B0 2B          bcs _dfail
00EBCD  2  A0 00          ldy #0
00EBCF  2  A9 00          lda #<fat32_readbuffer
00EBD1  2  85 40          sta zp_sd_address
00EBD3  2  A9 02          lda #>fat32_readbuffer
00EBD5  2  85 41          sta zp_sd_address+1
00EBD7  2               _notoverbuffer:
00EBD7  2                 ; next entry is 0 (end of dir)
00EBD7  2  A9 00          lda #0
00EBD9  2  91 40          sta (zp_sd_address),y
00EBDB  2                 ; Write the dirent.
00EBDB  2  20 FA EB       jsr fat32_writecurrentsector
00EBDE  2               
00EBDE  2                 ; Great, lets get this ready for other code to read in.
00EBDE  2               
00EBDE  2                 ; Seek to first cluster
00EBDE  2  A5 6D          lda fat32_filecluster
00EBE0  2  85 56          sta fat32_nextcluster
00EBE2  2  A5 6E          lda fat32_filecluster+1
00EBE4  2  85 57          sta fat32_nextcluster+1
00EBE6  2  A5 6F          lda fat32_filecluster+2
00EBE8  2  85 58          sta fat32_nextcluster+2
00EBEA  2  A5 70          lda fat32_filecluster+3
00EBEC  2  85 59          sta fat32_nextcluster+3
00EBEE  2               
00EBEE  2  18             clc
00EBEF  2  20 DD E7       jsr fat32_seekcluster
00EBF2  2               
00EBF2  2                 ; Set the pointer to a large value so we always read a sector the first time through
00EBF2  2  A9 FF          lda #$ff
00EBF4  2  85 41          sta zp_sd_address+1
00EBF6  2               
00EBF6  2  18             clc
00EBF7  2  60             rts
00EBF8  2               
00EBF8  2               _dfail:
00EBF8  2                 ; Card Full
00EBF8  2  38             sec
00EBF9  2  60             rts
00EBFA  2               
00EBFA  2               fat32_writecurrentsector:
00EBFA  2               
00EBFA  2                 ; decrement the sector so we write the current one (not the next one)
00EBFA  2  A5 42          lda zp_sd_currentsector
00EBFC  2  D0 0A          bne _skip
00EBFE  2  C6 43          dec zp_sd_currentsector+1
00EC00  2  D0 06          bne _skip
00EC02  2  C6 44          dec zp_sd_currentsector+2
00EC04  2  D0 02          bne _skip
00EC06  2  C6 45          dec zp_sd_currentsector+3
00EC08  2               
00EC08  2               _skip:
00EC08  2  C6 42          dec zp_sd_currentsector
00EC0A  2               
00EC0A  2               _nodec:
00EC0A  2               
00EC0A  2  A5 54          lda fat32_address
00EC0C  2  85 40          sta zp_sd_address
00EC0E  2  A5 55          lda fat32_address+1
00EC10  2  85 41          sta zp_sd_address+1
00EC12  2               
00EC12  2                 ; Read the sector
00EC12  2  20 4D E6       jsr sd_writesector
00EC15  2               
00EC15  2                 ; Advance to next sector
00EC15  2  E6 42          inc zp_sd_currentsector
00EC17  2  D0 0A          bne _writesectorincrementdone
00EC19  2  E6 43          inc zp_sd_currentsector+1
00EC1B  2  D0 06          bne _writesectorincrementdone
00EC1D  2  E6 44          inc zp_sd_currentsector+2
00EC1F  2  D0 02          bne _writesectorincrementdone
00EC21  2  E6 45          inc zp_sd_currentsector+3
00EC23  2               
00EC23  2               _writesectorincrementdone:
00EC23  2  60             rts
00EC24  2               
00EC24  2               fat32_readdirent:
00EC24  2                 ; Read a directory entry from the open directory
00EC24  2                 ;
00EC24  2                 ; On exit the carry is set if there were no more directory entries.
00EC24  2                 ;
00EC24  2                 ; Otherwise, A is set to the file's attribute byte and
00EC24  2                 ; zp_sd_address points at the returned directory entry.
00EC24  2                 ; LFNs and empty entries are ignored automatically.
00EC24  2               
00EC24  2                 ; Increment pointer by 32 to point to next entry
00EC24  2  18             clc
00EC25  2  A5 40          lda zp_sd_address
00EC27  2  69 20          adc #32
00EC29  2  85 40          sta zp_sd_address
00EC2B  2  A5 41          lda zp_sd_address+1
00EC2D  2  69 00          adc #0
00EC2F  2  85 41          sta zp_sd_address+1
00EC31  2               
00EC31  2                 ; If it's not at the end of the buffer, we have data already
00EC31  2  C9 04          cmp #>(fat32_readbuffer+$200)
00EC33  2  90 0F          bcc _gotdirdata
00EC35  2               
00EC35  2                 ; Read another sector
00EC35  2  A9 00          lda #<fat32_readbuffer
00EC37  2  85 54          sta fat32_address
00EC39  2  A9 02          lda #>fat32_readbuffer
00EC3B  2  85 55          sta fat32_address+1
00EC3D  2               
00EC3D  2  20 CA E8       jsr fat32_readnextsector
00EC40  2  90 02          bcc _gotdirdata
00EC42  2               _endofdirectory:
00EC42  2  38             sec
00EC43  2  60             rts
00EC44  2               
00EC44  2               _gotdirdata:
00EC44  2                 ; Check first character
00EC44  2  A0 00          ldy #0
00EC46  2  B1 40          lda (zp_sd_address),y
00EC48  2               
00EC48  2                 ; End of directory => abort
00EC48  2  F0 F8          beq _endofdirectory
00EC4A  2               
00EC4A  2                 ; Empty entry => start again
00EC4A  2  C9 E5          cmp #$e5
00EC4C  2  F0 D6          beq fat32_readdirent
00EC4E  2               
00EC4E  2                 ; Check attributes
00EC4E  2  A0 0B          ldy #11
00EC50  2  B1 40          lda (zp_sd_address),y
00EC52  2  29 3F          and #$3f
00EC54  2  C9 0F          cmp #$0f ; LFN => start again
00EC56  2  F0 CC          beq fat32_readdirent
00EC58  2               
00EC58  2                 ; Yield this result
00EC58  2  18             clc
00EC59  2  60             rts
00EC5A  2               
00EC5A  2               
00EC5A  2               fat32_finddirent:
00EC5A  2                 ; Finds a particular directory entry. X,Y point to the 11-character filename to seek.
00EC5A  2                 ; The directory should already be open for iteration.
00EC5A  2               
00EC5A  2                 ; Form ZP pointer to user's filename
00EC5A  2  86 62          stx fat32_filenamepointer
00EC5C  2  84 63          sty fat32_filenamepointer+1
00EC5E  2               
00EC5E  2                 ; Iterate until name is found or end of directory
00EC5E  2               _direntloop:
00EC5E  2  20 24 EC       jsr fat32_readdirent
00EC61  2  A0 0A          ldy #10
00EC63  2  90 01          bcc _comparenameloop
00EC65  2  60             rts ; with carry set
00EC66  2               
00EC66  2               _comparenameloop:
00EC66  2  B1 40          lda (zp_sd_address),y
00EC68  2  D1 62          cmp (fat32_filenamepointer),y
00EC6A  2  D0 F2          bne _direntloop ; no match
00EC6C  2  88             dey
00EC6D  2  10 F7          bpl _comparenameloop
00EC6F  2               
00EC6F  2                 ; Found it
00EC6F  2  18             clc
00EC70  2  60             rts
00EC71  2               
00EC71  2               fat32_markdeleted:
00EC71  2                 ; Mark the file as deleted
00EC71  2                 ; We need to stash the first character at index 0x0D
00EC71  2  A0 00          ldy #$00
00EC73  2  B1 40          lda (zp_sd_address),y
00EC75  2  A0 0D          ldy #$0d
00EC77  2  91 40          sta (zp_sd_address),y
00EC79  2               
00EC79  2                 ; Now put 0xE5 at the first byte
00EC79  2  A0 00          ldy #$00
00EC7B  2  A9 E5          lda #$e5
00EC7D  2  91 40          sta (zp_sd_address),y
00EC7F  2               
00EC7F  2                 ; Get start cluster high word
00EC7F  2  A0 14          ldy #$14
00EC81  2  B1 40          lda (zp_sd_address),y
00EC83  2  85 58          sta fat32_nextcluster+2
00EC85  2  C8             iny
00EC86  2  B1 40          lda (zp_sd_address),y
00EC88  2  85 59          sta fat32_nextcluster+3
00EC8A  2               
00EC8A  2                 ; And low word
00EC8A  2  A0 1A          ldy #$1a
00EC8C  2  B1 40          lda (zp_sd_address),y
00EC8E  2  85 56          sta fat32_nextcluster
00EC90  2  C8             iny
00EC91  2  B1 40          lda (zp_sd_address),y
00EC93  2  85 57          sta fat32_nextcluster+1
00EC95  2               
00EC95  2                 ; Write the dirent
00EC95  2  20 FA EB       jsr fat32_writecurrentsector
00EC98  2               
00EC98  2                 ; Done
00EC98  2  18             clc
00EC99  2  60             rts
00EC9A  2               
00EC9A  2               fat32_deletefile:
00EC9A  2                 ; Removes the open file from the SD card.
00EC9A  2                 ; The directory needs to be open and
00EC9A  2                 ; zp_sd_address pointed to the first byte of the file entry.
00EC9A  2               
00EC9A  2                 ; Mark the file as "Removed"
00EC9A  2  20 71 EC       jsr fat32_markdeleted
00EC9D  2               
00EC9D  2                 ; We will read a new sector the first time around
00EC9D  2  A9 00          lda #$00
00EC9F  2  85 68          sta fat32_lastsector
00ECA1  2  85 69          sta fat32_lastsector+1
00ECA3  2  85 6A          sta fat32_lastsector+2
00ECA5  2  85 6B          sta fat32_lastsector+3
00ECA7  2               
00ECA7  2                 ; Now we need to iterate through this file's cluster chain, and remove it from the FAT.
00ECA7  2  A0 00          ldy #0
00ECA9  2               _chainloop:
00ECA9  2                 ; Seek to cluster
00ECA9  2  38             sec
00ECAA  2  20 DD E7       jsr fat32_seekcluster
00ECAD  2               
00ECAD  2                 ; Is this the end of the chain?
00ECAD  2  A5 59          lda fat32_nextcluster+3
00ECAF  2  30 13          bmi _deletefileendofchain
00ECB1  2               
00ECB1  2                 ; Zero it out
00ECB1  2  A9 00          lda #0
00ECB3  2  91 40          sta (zp_sd_address),y
00ECB5  2  88             dey
00ECB6  2  91 40          sta (zp_sd_address),y
00ECB8  2  88             dey
00ECB9  2  91 40          sta (zp_sd_address),y
00ECBB  2  88             dey
00ECBC  2  91 40          sta (zp_sd_address),y
00ECBE  2               
00ECBE  2                 ; Write the FAT
00ECBE  2  20 3E E9       jsr fat32_updatefat
00ECC1  2               
00ECC1  2                 ; And go again for another pass.
00ECC1  2  4C A9 EC       jmp _chainloop
00ECC4  2               
00ECC4  2               _deletefileendofchain:
00ECC4  2                 ; This is the last cluster in the chain.
00ECC4  2               
00ECC4  2                 ; Just zero it out,
00ECC4  2  A9 00          lda #0
00ECC6  2  91 40          sta (zp_sd_address),y
00ECC8  2  88             dey
00ECC9  2  91 40          sta (zp_sd_address),y
00ECCB  2  88             dey
00ECCC  2  91 40          sta (zp_sd_address),y
00ECCE  2  88             dey
00ECCF  2  91 40          sta (zp_sd_address),y
00ECD1  2               
00ECD1  2                 ; Write the FAT
00ECD1  2  20 3E E9       jsr fat32_updatefat
00ECD4  2               
00ECD4  2                 ; And we're done!
00ECD4  2  18             clc
00ECD5  2  60             rts
00ECD6  2               
00ECD6  2               fat32_file_readbyte:
00ECD6  2                 ; Read a byte from an open file
00ECD6  2                 ;
00ECD6  2                 ; The byte is returned in A with C clear; or if end-of-file was reached, C is set instead
00ECD6  2               
00ECD6  2  38             sec
00ECD7  2               
00ECD7  2                 ; Is there any data to read at all?
00ECD7  2  A5 5A          lda fat32_bytesremaining
00ECD9  2  05 5B          ora fat32_bytesremaining+1
00ECDB  2  05 5C          ora fat32_bytesremaining+2
00ECDD  2  05 5D          ora fat32_bytesremaining+3
00ECDF  2  F0 35          beq _rts
00ECE1  2               
00ECE1  2                 ; Decrement the remaining byte count
00ECE1  2  A5 5A          lda fat32_bytesremaining
00ECE3  2  E9 01          sbc #1
00ECE5  2  85 5A          sta fat32_bytesremaining
00ECE7  2  A5 5B          lda fat32_bytesremaining+1
00ECE9  2  E9 00          sbc #0
00ECEB  2  85 5B          sta fat32_bytesremaining+1
00ECED  2  A5 5C          lda fat32_bytesremaining+2
00ECEF  2  E9 00          sbc #0
00ECF1  2  85 5C          sta fat32_bytesremaining+2
00ECF3  2  A5 5D          lda fat32_bytesremaining+3
00ECF5  2  E9 00          sbc #0
00ECF7  2  85 5D          sta fat32_bytesremaining+3
00ECF9  2               
00ECF9  2                 ; Need to read a new sector?
00ECF9  2  A5 41          lda zp_sd_address+1
00ECFB  2  C9 04          cmp #>(fat32_readbuffer+$200)
00ECFD  2  90 0D          bcc _gotdata
00ECFF  2               
00ECFF  2                 ; Read another sector
00ECFF  2  A9 00          lda #<fat32_readbuffer
00ED01  2  85 54          sta fat32_address
00ED03  2  A9 02          lda #>fat32_readbuffer
00ED05  2  85 55          sta fat32_address+1
00ED07  2               
00ED07  2  20 CA E8       jsr fat32_readnextsector
00ED0A  2  B0 0A          bcs _rts
00ED0C  2               
00ED0C  2               _gotdata:
00ED0C  2  A0 00          ldy #0
00ED0E  2  B1 40          lda (zp_sd_address),y
00ED10  2               
00ED10  2  E6 40          inc zp_sd_address
00ED12  2  D0 02          bne _rts
00ED14  2  E6 41          inc zp_sd_address+1
00ED16  2               
00ED16  2               _rts:
00ED16  2  60             rts
00ED17  2               
00ED17  2               
00ED17  2               fat32_file_read:
00ED17  2                 ; Read a whole file into memory.  It's assumed the file has just been opened
00ED17  2                 ; and no data has been read yet.
00ED17  2                 ;
00ED17  2                 ; Also we read whole sectors, so data in the target region beyond the end of the
00ED17  2                 ; file may get overwritten, up to the next 512-byte boundary.
00ED17  2                 ;
00ED17  2                 ; And we don't properly support 64k+ files, as it's unnecessary complication given
00ED17  2                 ; the 6502's small address space
00ED17  2               
00ED17  2                 ; Round the size up to the next whole sector
00ED17  2  A5 5A          lda fat32_bytesremaining
00ED19  2  C9 01          cmp #1                      ; set carry if bottom 8 bits not zero
00ED1B  2  A5 5B          lda fat32_bytesremaining+1
00ED1D  2  69 00          adc #0                      ; add carry, if any
00ED1F  2  4A             lsr                         ; divide by 2
00ED20  2  69 00          adc #0                      ; round up
00ED22  2               
00ED22  2                 ; No data?
00ED22  2  F0 12          beq _fat32_file_read_done
00ED24  2               
00ED24  2                 ; Store sector count - not a byte count any more
00ED24  2  85 5A          sta fat32_bytesremaining
00ED26  2               
00ED26  2                 ; Read entire sectors to the user-supplied buffer
00ED26  2               _wholesectorreadloop:
00ED26  2                 ; Read a sector to fat32_address
00ED26  2  20 CA E8       jsr fat32_readnextsector
00ED29  2               
00ED29  2                 ; Advance fat32_address by 512 bytes
00ED29  2  A5 55          lda fat32_address+1
00ED2B  2  69 02          adc #2                      ; carry already clear
00ED2D  2  85 55          sta fat32_address+1
00ED2F  2               
00ED2F  2  A6 5A          ldx fat32_bytesremaining    ; note - actually loads sectors remaining
00ED31  2  CA             dex
00ED32  2  86 5A          stx fat32_bytesremaining    ; note - actually stores sectors remaining
00ED34  2               
00ED34  2  D0 F0          bne _wholesectorreadloop
00ED36  2               
00ED36  2               _fat32_file_read_done:
00ED36  2  60             rts
00ED37  2               
00ED37  2               fat32_file_write:
00ED37  2                 ; Write a whole file from memory.  It's assumed the dirent has just been created
00ED37  2                 ; and no data has been written yet.
00ED37  2               
00ED37  2                 ; Start at the first cluster for this file
00ED37  2  A5 6D          lda fat32_filecluster
00ED39  2  85 64          sta fat32_lastcluster
00ED3B  2  A5 6E          lda fat32_filecluster+1
00ED3D  2  85 65          sta fat32_lastcluster+1
00ED3F  2  A5 6F          lda fat32_filecluster+2
00ED41  2  85 66          sta fat32_lastcluster+2
00ED43  2  A5 70          lda fat32_filecluster+3
00ED45  2  85 67          sta fat32_lastcluster+3
00ED47  2               
00ED47  2  A5 6D          lda fat32_filecluster
00ED49  2  85 56          sta fat32_nextcluster
00ED4B  2  A5 6E          lda fat32_filecluster+1
00ED4D  2  85 57          sta fat32_nextcluster+1
00ED4F  2  A5 6F          lda fat32_filecluster+2
00ED51  2  85 58          sta fat32_nextcluster+2
00ED53  2  A5 70          lda fat32_filecluster+3
00ED55  2  85 59          sta fat32_nextcluster+3
00ED57  2               
00ED57  2                 ; Round the size up to the next whole sector
00ED57  2  A5 5A          lda fat32_bytesremaining
00ED59  2  C9 01          cmp #1                      ; set carry if bottom 8 bits not zero
00ED5B  2  A5 5B          lda fat32_bytesremaining+1
00ED5D  2  69 00          adc #0                      ; add carry, if any
00ED5F  2  4A             lsr                         ; divide by 2
00ED60  2  69 00          adc #0                      ; round up
00ED62  2               
00ED62  2                 ; No data?
00ED62  2  F0 17          beq _fat32_file_write_done
00ED64  2               
00ED64  2                 ; Store sector count - not a byte count anymore.
00ED64  2  85 5A          sta fat32_bytesremaining
00ED66  2               
00ED66  2                 ; We will be making a new cluster the first time around
00ED66  2  A9 00          lda #$00
00ED68  2  85 53          sta fat32_pendingsectors
00ED6A  2               
00ED6A  2                 ; Write entire sectors from the user-supplied buffer
00ED6A  2               _wholesectorwriteloop:
00ED6A  2                 ; Write a sector from fat32_address
00ED6A  2  20 0C E9       jsr fat32_writenextsector
00ED6D  2                 ;bcs _fail  ; this shouldn't happen
00ED6D  2               
00ED6D  2                 ; Advance fat32_address by 512 bytes
00ED6D  2  18             clc
00ED6E  2  A5 55          lda fat32_address+1
00ED70  2  69 02          adc #2
00ED72  2  85 55          sta fat32_address+1
00ED74  2               
00ED74  2  A6 5A          ldx fat32_bytesremaining    ; note - actually loads sectors remaining
00ED76  2  CA             dex
00ED77  2  86 5A          stx fat32_bytesremaining    ; note - actually stores sectors remaining
00ED79  2               
00ED79  2  D0 EF          bne _wholesectorwriteloop
00ED7B  2               
00ED7B  2                 ; Done!
00ED7B  2               _fat32_file_write_done:
00ED7B  2  60             rts
00ED7C  2               
00ED7C  2               fat32_open_cd:
00ED7C  2                 ; Prepare to read from the current (last opened) directory.
00ED7C  2               
00ED7C  2  48             pha
00ED7D  2  8A             txa
00ED7E  2  48             pha
00ED7F  2  98             tya
00ED80  2  48             pha
00ED81  2               
00ED81  2                 ; Seek to first cluster of current directory
00ED81  2  A5 75          lda fat32_cdcluster
00ED83  2  85 56          sta fat32_nextcluster
00ED85  2  A5 76          lda fat32_cdcluster+1
00ED87  2  85 57          sta fat32_nextcluster+1
00ED89  2  A5 77          lda fat32_cdcluster+2
00ED8B  2  85 58          sta fat32_nextcluster+2
00ED8D  2  A5 78          lda fat32_cdcluster+3
00ED8F  2  85 59          sta fat32_nextcluster+3
00ED91  2               
00ED91  2  A9 00          lda #<fat32_readbuffer
00ED93  2  85 54          sta fat32_address
00ED95  2  A9 02          lda #>fat32_readbuffer
00ED97  2  85 55          sta fat32_address+1
00ED99  2               
00ED99  2  18             clc
00ED9A  2  20 DD E7       jsr fat32_seekcluster
00ED9D  2               
00ED9D  2                 ; Set the pointer to a large value so we always read a sector the first time through
00ED9D  2  A9 FF          lda #$ff
00ED9F  2  85 41          sta zp_sd_address+1
00EDA1  2               
00EDA1  2  68             pla
00EDA2  2  A8             tay
00EDA3  2  68             pla
00EDA4  2  AA             tax
00EDA5  2  68             pla
00EDA6  2  60             rts
00EDA7  2               
00EDA7  1                 .include "libio.s"
00EDA7  2               newline:
00EDA7  2  A9 0D          lda #$0D                   ; CR
00EDA9  2  20 A0 1E       jsr OUTCH                  ; Send a carriage return
00EDAC  2  A9 0A          lda #$0A                   ; LF
00EDAE  2  20 A0 1E       jsr OUTCH                  ; Send the line feed
00EDB1  2  60             rts
00EDB2  2               
00EDB2  2               print_char:
00EDB2  2               ; JSR OUTCH    1EA0     Print ASCII char  A     -       Xis preserved
00EDB2  2               ;                       in A on TTY                     Y = FF
00EDB2  2               ;                                                       A = FF
00EDB2  2  20 A0 1E       jsr OUTCH
00EDB5  2  60             rts
00EDB6  2               
00EDB6  2               print_hex:
00EDB6  2               ; JSR PRTBYT   1E3B     Prints A as       A     -       A preserved
00EDB6  2               ;                       2 Hex Char.                     X preserved
00EDB6  2               ;                                                       Y = FF
00EDB6  2  20 3B 1E       jsr PRTBYT
00EDB9  2  60             rts
00EDBA  2               
00EDBA  2               get_input:
00EDBA  2               ; JSR GETCH    1E5A     Put character     -     A       X preserved
00EDBA  2               ;                       from TTY in A                   Y = FF
00EDBA  2  20 5A 1E       jsr GETCH
00EDBD  2  60             rts
00EDBE  2               
00EDBE  1               
00EDBE  1  00 A0          .word reset
00EDC0  1  00 00          .word $0000
00EDC2  1               
00EDC2  1               filename:
00EDC2  1  41 44 56 43    .asciiz "ADVCAVE TXT"
00EDC6  1  41 56 45 20  
00EDCA  1  54 58 54 00  
00EDCE  1               room_filename1:
00EDCE  1  41 44 56 45    .asciiz "ADVENT1 TXT"
00EDD2  1  4E 54 31 20  
00EDD6  1  54 58 54 00  
00EDDA  1               msg_filename4:
00EDDA  1  41 44 56 45    .asciiz "ADVENT4 TXT"
00EDDE  1  4E 54 34 20  
00EDE2  1  54 58 54 00  
00EDE6  1               save_filename:
00EDE6  1  41 44 56 53    .asciiz "ADVSAVE DAT"
00EDEA  1  41 56 45 20  
00EDEE  1  44 41 54 00  
00EDF2  1               
00EDF2  1               obj_name_keys:
00EDF2  1  4B 45 59 53    .asciiz "KEYS"
00EDF6  1  00           
00EDF7  1               obj_name_lamp:
00EDF7  1  4C 41 4D 50    .asciiz "LAMP"
00EDFB  1  00           
00EDFC  1               obj_name_grate:
00EDFC  1  47 52 41 54    .asciiz "GRATE"
00EE00  1  45 00        
00EE02  1               obj_name_steps:
00EE02  1  53 54 45 50    .asciiz "STEPS"
00EE06  1  53 00        
00EE08  1               obj_name_bird:
00EE08  1  42 49 52 44    .asciiz "BIRD"
00EE0C  1  00           
00EE0D  1               obj_name_door:
00EE0D  1  44 4F 4F 52    .asciiz "DOOR"
00EE11  1  00           
00EE12  1               obj_name_pillow:
00EE12  1  50 49 4C 4C    .asciiz "PILLOW"
00EE16  1  4F 57 00     
00EE19  1               obj_name_snake:
00EE19  1  53 4E 41 4B    .asciiz "SNAKE"
00EE1D  1  45 00        
00EE1F  1               obj_name_fissure:
00EE1F  1  46 49 53 53    .asciiz "FISSURE"
00EE23  1  55 52 45 00  
00EE27  1               obj_name_tablet:
00EE27  1  54 41 42 4C    .asciiz "TABLET"
00EE2B  1  45 54 00     
00EE2E  1               obj_name_clam:
00EE2E  1  43 4C 41 4D    .asciiz "CLAM"
00EE32  1  00           
00EE33  1               obj_name_oyster:
00EE33  1  4F 59 53 54    .asciiz "OYSTER"
00EE37  1  45 52 00     
00EE3A  1               obj_name_magazine:
00EE3A  1  4D 41 47 41    .asciiz "MAGAZINE"
00EE3E  1  5A 49 4E 45  
00EE42  1  00           
00EE43  1               obj_name_food:
00EE43  1  46 4F 4F 44    .asciiz "FOOD"
00EE47  1  00           
00EE48  1               obj_name_bottle:
00EE48  1  42 4F 54 54    .asciiz "BOTTLE"
00EE4C  1  4C 45 00     
00EE4F  1               obj_name_water:
00EE4F  1  57 41 54 45    .asciiz "WATER"
00EE53  1  52 00        
00EE55  1               obj_name_oil:
00EE55  1  4F 49 4C 00    .asciiz "OIL"
00EE59  1               obj_name_mirror:
00EE59  1  4D 49 52 52    .asciiz "MIRROR"
00EE5D  1  4F 52 00     
00EE60  1               obj_name_plant:
00EE60  1  50 4C 41 4E    .asciiz "PLANT"
00EE64  1  54 00        
00EE66  1               obj_name_stalactite:
00EE66  1  53 54 41 4C    .asciiz "STALACTITE"
00EE6A  1  41 43 54 49  
00EE6E  1  54 45 00     
00EE71  1               obj_name_figure:
00EE71  1  46 49 47 55    .asciiz "FIGURE"
00EE75  1  52 45 00     
00EE78  1               obj_name_axe:
00EE78  1  41 58 45 00    .asciiz "AXE"
00EE7C  1               obj_name_drawings:
00EE7C  1  44 52 41 57    .asciiz "DRAWINGS"
00EE80  1  49 4E 47 53  
00EE84  1  00           
00EE85  1               obj_name_pirate:
00EE85  1  50 49 52 41    .asciiz "PIRATE"
00EE89  1  54 45 00     
00EE8C  1               obj_name_dragon:
00EE8C  1  44 52 41 47    .asciiz "DRAGON"
00EE90  1  4F 4E 00     
00EE93  1               obj_name_chasm:
00EE93  1  43 48 41 53    .asciiz "CHASM"
00EE97  1  4D 00        
00EE99  1               obj_name_troll:
00EE99  1  54 52 4F 4C    .asciiz "TROLL"
00EE9D  1  4C 00        
00EE9F  1               obj_name_bear:
00EE9F  1  42 45 41 52    .asciiz "BEAR"
00EEA3  1  00           
00EEA4  1               obj_name_message:
00EEA4  1  4D 45 53 53    .asciiz "MESSAGE"
00EEA8  1  41 47 45 00  
00EEAC  1               obj_name_volcano:
00EEAC  1  56 4F 4C 43    .asciiz "VOLCANO"
00EEB0  1  41 4E 4F 00  
00EEB4  1               obj_name_machine:
00EEB4  1  4D 41 43 48    .asciiz "MACHINE"
00EEB8  1  49 4E 45 00  
00EEBC  1               obj_name_batteries:
00EEBC  1  42 41 54 54    .asciiz "BATTERIES"
00EEC0  1  45 52 49 45  
00EEC4  1  53 00        
00EEC6  1               obj_name_carpet:
00EEC6  1  43 41 52 50    .asciiz "CARPET"
00EECA  1  45 54 00     
00EECD  1               obj_name_nugget:
00EECD  1  4E 55 47 47    .asciiz "NUGGET"
00EED1  1  45 54 00     
00EED4  1               obj_name_diamonds:
00EED4  1  44 49 41 4D    .asciiz "DIAMONDS"
00EED8  1  4F 4E 44 53  
00EEDC  1  00           
00EEDD  1               obj_name_silver:
00EEDD  1  53 49 4C 56    .asciiz "SILVER"
00EEE1  1  45 52 00     
00EEE4  1               obj_name_jewelry:
00EEE4  1  4A 45 57 45    .asciiz "JEWELRY"
00EEE8  1  4C 52 59 00  
00EEEC  1               obj_name_coins:
00EEEC  1  43 4F 49 4E    .asciiz "COINS"
00EEF0  1  53 00        
00EEF2  1               obj_name_chest:
00EEF2  1  43 48 45 53    .asciiz "CHEST"
00EEF6  1  54 00        
00EEF8  1               obj_name_eggs:
00EEF8  1  45 47 47 53    .asciiz "EGGS"
00EEFC  1  00           
00EEFD  1               obj_name_trident:
00EEFD  1  54 52 49 44    .asciiz "TRIDENT"
00EF01  1  45 4E 54 00  
00EF05  1               obj_name_vase:
00EF05  1  56 41 53 45    .asciiz "VASE"
00EF09  1  00           
00EF0A  1               obj_name_emerald:
00EF0A  1  45 4D 45 52    .asciiz "EMERALD"
00EF0E  1  41 4C 44 00  
00EF12  1               obj_name_pyramid:
00EF12  1  50 59 52 41    .asciiz "PYRAMID"
00EF16  1  4D 49 44 00  
00EF1A  1               obj_name_pearl:
00EF1A  1  50 45 41 52    .asciiz "PEARL"
00EF1E  1  4C 00        
00EF20  1               obj_name_rug:
00EF20  1  52 55 47 00    .asciiz "RUG"
00EF24  1               obj_name_chain:
00EF24  1  43 48 41 49    .asciiz "CHAIN"
00EF28  1  4E 00        
00EF2A  1               obj_name_cage:
00EF2A  1  43 41 47 45    .asciiz "CAGE"
00EF2E  1  00           
00EF2F  1               obj_name_rod:
00EF2F  1  52 4F 44 00    .asciiz "ROD"
00EF33  1               
00EF33  1               ; object id -> display name pointer table for ids 0..63
00EF33  1               obj_name_table:
00EF33  1  00 00          .word 0                    ; 0
00EF35  1  F2 ED          .word obj_name_keys        ; 1
00EF37  1  F7 ED          .word obj_name_lamp        ; 2
00EF39  1  FC ED          .word obj_name_grate       ; 3
00EF3B  1  2A EF          .word obj_name_cage        ; 4
00EF3D  1  2F EF          .word obj_name_rod         ; 5
00EF3F  1  2F EF          .word obj_name_rod         ; 6
00EF41  1  02 EE          .word obj_name_steps       ; 7
00EF43  1  08 EE          .word obj_name_bird        ; 8
00EF45  1  0D EE          .word obj_name_door        ; 9
00EF47  1  12 EE          .word obj_name_pillow      ; 10
00EF49  1  19 EE          .word obj_name_snake       ; 11
00EF4B  1  1F EE          .word obj_name_fissure     ; 12
00EF4D  1  27 EE          .word obj_name_tablet      ; 13
00EF4F  1  2E EE          .word obj_name_clam        ; 14
00EF51  1  33 EE          .word obj_name_oyster      ; 15
00EF53  1  3A EE          .word obj_name_magazine    ; 16
00EF55  1  00 00          .word 0                    ; 17
00EF57  1  00 00          .word 0                    ; 18
00EF59  1  43 EE          .word obj_name_food        ; 19
00EF5B  1  48 EE          .word obj_name_bottle      ; 20
00EF5D  1  4F EE          .word obj_name_water       ; 21
00EF5F  1  55 EE          .word obj_name_oil         ; 22
00EF61  1  59 EE          .word obj_name_mirror      ; 23
00EF63  1  60 EE          .word obj_name_plant       ; 24
00EF65  1  60 EE          .word obj_name_plant       ; 25
00EF67  1  66 EE          .word obj_name_stalactite  ; 26
00EF69  1  71 EE          .word obj_name_figure      ; 27
00EF6B  1  78 EE          .word obj_name_axe         ; 28
00EF6D  1  7C EE          .word obj_name_drawings    ; 29
00EF6F  1  85 EE          .word obj_name_pirate      ; 30
00EF71  1  8C EE          .word obj_name_dragon      ; 31
00EF73  1  93 EE          .word obj_name_chasm       ; 32
00EF75  1  99 EE          .word obj_name_troll       ; 33
00EF77  1  99 EE          .word obj_name_troll       ; 34
00EF79  1  9F EE          .word obj_name_bear        ; 35
00EF7B  1  A4 EE          .word obj_name_message     ; 36
00EF7D  1  AC EE          .word obj_name_volcano     ; 37
00EF7F  1  B4 EE          .word obj_name_machine     ; 38
00EF81  1  BC EE          .word obj_name_batteries   ; 39
00EF83  1  C6 EE          .word obj_name_carpet      ; 40
00EF85  1  00 00          .word 0                    ; 41
00EF87  1  00 00          .word 0                    ; 42
00EF89  1  00 00          .word 0                    ; 43
00EF8B  1  00 00          .word 0                    ; 44
00EF8D  1  00 00          .word 0                    ; 45
00EF8F  1  00 00          .word 0                    ; 46
00EF91  1  00 00          .word 0                    ; 47
00EF93  1  00 00          .word 0                    ; 48
00EF95  1  00 00          .word 0                    ; 49
00EF97  1  CD EE          .word obj_name_nugget      ; 50
00EF99  1  D4 EE          .word obj_name_diamonds    ; 51
00EF9B  1  DD EE          .word obj_name_silver      ; 52
00EF9D  1  E4 EE          .word obj_name_jewelry     ; 53
00EF9F  1  EC EE          .word obj_name_coins       ; 54
00EFA1  1  F2 EE          .word obj_name_chest       ; 55
00EFA3  1  F8 EE          .word obj_name_eggs        ; 56
00EFA5  1  FD EE          .word obj_name_trident     ; 57
00EFA7  1  05 EF          .word obj_name_vase        ; 58
00EFA9  1  0A EF          .word obj_name_emerald     ; 59
00EFAB  1  12 EF          .word obj_name_pyramid     ; 60
00EFAD  1  1A EF          .word obj_name_pearl       ; 61
00EFAF  1  20 EF          .word obj_name_rug         ; 62
00EFB1  1  24 EF          .word obj_name_chain       ; 63
00EFB3  1               
00EFB3  1               msg_already_here:
00EFB3  1  41 4C 52 45    .asciiz "ALREADY HERE"
00EFB7  1  41 44 59 20  
00EFBB  1  48 45 52 45  
00EFC0  1               msg_not_carrying_prefix:
00EFC0  1  4E 4F 54 20    .asciiz "NOT CARRYING "
00EFC4  1  43 41 52 52  
00EFC8  1  59 49 4E 47  
00EFCE  1               msg_no_here_prefix:
00EFCE  1  4E 4F 20 00    .asciiz "NO "
00EFD2  1               msg_here_suffix:
00EFD2  1  20 48 45 52    .asciiz " HERE"
00EFD6  1  45 00        
00EFD8  1               msg_taken_prefix:
00EFD8  1  54 41 4B 45    .asciiz "TAKEN: "
00EFDC  1  4E 3A 20 00  
00EFE0  1               msg_dropped_prefix:
00EFE0  1  44 52 4F 50    .asciiz "DROPPED: "
00EFE4  1  50 45 44 3A  
00EFE8  1  20 00        
00EFEA  1               
00EFEA  1               msg_exam_keys:
00EFEA  1  4B 45 59 53    .asciiz "KEYS: A SMALL RING OF KEYS."
00EFEE  1  3A 20 41 20  
00EFF2  1  53 4D 41 4C  
00F006  1               msg_exam_lamp:
00F006  1  4C 41 4D 50    .asciiz "LAMP: A SHINY BRASS LAMP."
00F00A  1  3A 20 41 20  
00F00E  1  53 48 49 4E  
00F020  1               msg_exam_food:
00F020  1  46 4F 4F 44    .asciiz "FOOD: SOME TASTY-LOOKING FOOD."
00F024  1  3A 20 53 4F  
00F028  1  4D 45 20 54  
00F03F  1               msg_exam_bottle:
00F03F  1  42 4F 54 54    .asciiz "BOTTLE: A SMALL GLASS BOTTLE."
00F043  1  4C 45 3A 20  
00F047  1  41 20 53 4D  
00F05D  1               msg_exam_axe:
00F05D  1  41 58 45 3A    .asciiz "AXE: A LITTLE DWARF'S AXE."
00F061  1  20 41 20 4C  
00F065  1  49 54 54 4C  
00F078  1               msg_exam_cage:
00F078  1  43 41 47 45    .asciiz "CAGE: A SMALL WICKER CAGE."
00F07C  1  3A 20 41 20  
00F080  1  53 4D 41 4C  
00F093  1               msg_exam_rod:
00F093  1  52 4F 44 3A    .asciiz "ROD: A BLACK ROD WITH A RUSTY STAR."
00F097  1  20 41 20 42  
00F09B  1  4C 41 43 4B  
00F0B7  1               msg_exam_default:
00F0B7  1  4E 4F 54 48    .asciiz "NOTHING SPECIAL."
00F0BB  1  49 4E 47 20  
00F0BF  1  53 50 45 43  
00F0C8  1               
00F0C8  1               msg_unknown_word:
00F0C8  1  49 20 44 4F    .asciiz "I DON'T KNOW THAT WORD."
00F0CC  1  4E 27 54 20  
00F0D0  1  4B 4E 4F 57  
00F0E0  1               msg_unknown_obj:
00F0E0  1  49 20 44 4F    .asciiz "I DON'T SEE THAT HERE."
00F0E4  1  4E 27 54 20  
00F0E8  1  53 45 45 20  
00F0F7  1               msg_missing_obj:
00F0F7  1  57 48 41 54    .asciiz "WHAT?"
00F0FB  1  3F 00        
00F0FD  1               msg_cant_take:
00F0FD  1  59 4F 55 20    .asciiz "YOU CAN'T TAKE THAT."
00F101  1  43 41 4E 27  
00F105  1  54 20 54 41  
00F112  1               msg_opened:
00F112  1  4F 50 45 4E    .asciiz "OPEN."
00F116  1  2E 00        
00F118  1               msg_closed:
00F118  1  43 4C 4F 53    .asciiz "CLOSED."
00F11C  1  45 44 2E 00  
00F120  1               msg_already_unlocked:
00F120  1  54 48 45 20    .asciiz "THE GRATE IS ALREADY UNLOCKED."
00F124  1  47 52 41 54  
00F128  1  45 20 49 53  
00F13F  1               msg_already_locked:
00F13F  1  54 48 45 20    .asciiz "THE GRATE IS ALREADY LOCKED."
00F143  1  47 52 41 54  
00F147  1  45 20 49 53  
00F15C  1               msg_need_keys:
00F15C  1  59 4F 55 20    .asciiz "YOU NEED KEYS."
00F160  1  4E 45 45 44  
00F164  1  20 4B 45 59  
00F16B  1               msg_locked_grate:
00F16B  1  59 6F 75 20    .asciiz "You can't go through a locked steel grate!"
00F16F  1  63 61 6E 27  
00F173  1  74 20 67 6F  
00F196  1               msg_help_1:
00F196  1  43 4D 44 53    .asciiz "CMDS: LOOK, INV, TAKE/DROP <OBJ>, TAKE/DROP ALL."
00F19A  1  3A 20 4C 4F  
00F19E  1  4F 4B 2C 20  
00F1C7  1               msg_help_2:
00F1C7  1  4D 4F 56 45    .asciiz "MOVE: N,S,E,W,U,D, IN, OUT, GO <DIR/PLACE>."
00F1CB  1  3A 20 4E 2C  
00F1CF  1  53 2C 45 2C  
00F1F3  1               msg_help_3:
00F1F3  1  55 53 45 3A    .asciiz "USE: LIGHT/OFF/RUB LAMP, EAT/FEED/THROW, DRINK/FILL/POUR."
00F1F7  1  20 4C 49 47  
00F1FB  1  48 54 2F 4F  
00F22D  1               msg_help_4:
00F22D  1  41 43 54 3A    .asciiz "ACT: OPEN/CLOSE/LOCK/UNLOCK, WAVE, KILL/ATTACK, SAY, QUIT."
00F231  1  20 4F 50 45  
00F235  1  4E 2F 43 4C  
00F268  1               msg_okay:
00F268  1  4F 4B 41 59    .asciiz "OKAY."
00F26C  1  2E 00        
00F26E  1               
00F26E  1               msg_read_default:
00F26E  1  4E 4F 54 48    .asciiz "NOTHING TO READ."
00F272  1  49 4E 47 20  
00F276  1  54 4F 20 52  
00F27F  1               msg_lamp_on:
00F27F  1  59 4F 55 52    .asciiz "YOUR LAMP IS NOW ON."
00F283  1  20 4C 41 4D  
00F287  1  50 20 49 53  
00F294  1               msg_lamp_off:
00F294  1  59 4F 55 52    .asciiz "YOUR LAMP IS NOW OFF."
00F298  1  20 4C 41 4D  
00F29C  1  50 20 49 53  
00F2AA  1               msg_lamp_already_on:
00F2AA  1  59 4F 55 52    .asciiz "YOUR LAMP IS ALREADY ON."
00F2AE  1  20 4C 41 4D  
00F2B2  1  50 20 49 53  
00F2C3  1               msg_lamp_already_off:
00F2C3  1  59 4F 55 52    .asciiz "YOUR LAMP IS ALREADY OFF."
00F2C7  1  20 4C 41 4D  
00F2CB  1  50 20 49 53  
00F2DD  1               msg_eat_ok:
00F2DD  1  54 48 41 4E    .asciiz "THANK YOU, IT WAS DELICIOUS."
00F2E1  1  4B 20 59 4F  
00F2E5  1  55 2C 20 49  
00F2FA  1               msg_no_water:
00F2FA  1  59 4F 55 20    .asciiz "YOU HAVE NO WATER."
00F2FE  1  48 41 56 45  
00F302  1  20 4E 4F 20  
00F30D  1               msg_no_water_here:
00F30D  1  54 48 45 52    .asciiz "THERE IS NO WATER HERE."
00F311  1  45 20 49 53  
00F315  1  20 4E 4F 20  
00F325  1               msg_bottle_full:
00F325  1  59 4F 55 52    .asciiz "YOUR BOTTLE IS ALREADY FULL."
00F329  1  20 42 4F 54  
00F32D  1  54 4C 45 20  
00F342  1               msg_fill_ok:
00F342  1  59 4F 55 52    .asciiz "YOUR BOTTLE IS NOW FULL."
00F346  1  20 42 4F 54  
00F34A  1  54 4C 45 20  
00F35B  1               msg_drink_ok:
00F35B  1  54 48 45 20    .asciiz "THE WATER TASTES FRESH."
00F35F  1  57 41 54 45  
00F363  1  52 20 54 41  
00F373  1               msg_bottle_empty:
00F373  1  59 4F 55 52    .asciiz "YOUR BOTTLE IS ALREADY EMPTY."
00F377  1  20 42 4F 54  
00F37B  1  54 4C 45 20  
00F391  1               msg_pour_ok:
00F391  1  59 4F 55 52    .asciiz "YOUR BOTTLE IS NOW EMPTY."
00F395  1  20 42 4F 54  
00F399  1  54 4C 45 20  
00F3AB  1               msg_bridge_now_spans:
00F3AB  1  41 20 63 72    .asciiz "A crystal bridge now spans the fissure."
00F3AF  1  79 73 74 61  
00F3B3  1  6C 20 62 72  
00F3D3  1               msg_bridge_vanished:
00F3D3  1  54 68 65 20    .asciiz "The crystal bridge has vanished!"
00F3D7  1  63 72 79 73  
00F3DB  1  74 61 6C 20  
00F3F4  1               msg_nothing_happens:
00F3F4  1  4E 4F 54 48    .asciiz "NOTHING HAPPENS."
00F3F8  1  49 4E 47 20  
00F3FC  1  48 41 50 50  
00F405  1               msg_clam_lock:
00F405  1  59 4F 55 20    .asciiz "YOU HAVE NO WAY TO LOCK THAT."
00F409  1  48 41 56 45  
00F40D  1  20 4E 4F 20  
00F423  1               msg_game_saved:
00F423  1  47 41 4D 45    .asciiz "GAME SAVED."
00F427  1  20 53 41 56  
00F42B  1  45 44 2E 00  
00F42F  1               msg_game_restored:
00F42F  1  47 41 4D 45    .asciiz "GAME RESTORED."
00F433  1  20 52 45 53  
00F437  1  54 4F 52 45  
00F43E  1               msg_no_saved_game:
00F43E  1  4E 4F 20 53    .asciiz "NO SAVED GAME."
00F442  1  41 56 45 44  
00F446  1  20 47 41 4D  
00F44D  1               msg_save_failed:
00F44D  1  53 41 56 45    .asciiz "SAVE FAILED."
00F451  1  20 46 41 49  
00F455  1  4C 45 44 2E  
00F45A  1               msg_welcome_1:
00F45A  1  20 20 20 20    .asciiz "                              Welcome to"
00F45E  1  20 20 20 20  
00F462  1  20 20 20 20  
00F483  1               msg_welcome_2:
00F483  1  00             .asciiz ""
00F484  1               msg_welcome_3:
00F484  1  20 20 20 20    .asciiz "                       Colossal Cave Adventure!"
00F488  1  20 20 20 20  
00F48C  1  20 20 20 20  
00F4B4  1               msg_welcome_4:
00F4B4  1  00             .asciiz ""
00F4B5  1               msg_welcome_5:
00F4B5  1  20 20 20 20    .asciiz "               Original development by Willie Crowther."
00F4B9  1  20 20 20 20  
00F4BD  1  20 20 20 20  
00F4ED  1               msg_welcome_6:
00F4ED  1  20 20 20 20    .asciiz "                  Major features added by Don Woods."
00F4F1  1  20 20 20 20  
00F4F5  1  20 20 20 20  
00F522  1               msg_welcome_7:
00F522  1  20 20 20 20    .asciiz "                 Conversion to BDS C by J. R. Jaeger."
00F526  1  20 20 20 20  
00F52A  1  20 20 20 20  
00F558  1               msg_ask_instructions:
00F558  1  57 6F 75 6C    .asciiz "Would you like instructions?"
00F55C  1  64 20 79 6F  
00F560  1  75 20 6C 69  
00F575  1               msg_intro_help_1:
00F575  1  53 6F 6D 65    .asciiz "Somewhere nearby is Colossal Cave, where others have found fortunes in"
00F579  1  77 68 65 72  
00F57D  1  65 20 6E 65  
00F5BC  1               msg_intro_help_2:
00F5BC  1  74 72 65 61    .asciiz "treasure and gold, though it is rumored that some who enter are never"
00F5C0  1  73 75 72 65  
00F5C4  1  20 61 6E 64  
00F602  1               msg_intro_help_3:
00F602  1  73 65 65 6E    .asciiz "seen again.  Magic is said to work in the cave.  I will be your eyes"
00F606  1  20 61 67 61  
00F60A  1  69 6E 2E 20  
00F647  1               msg_intro_help_4:
00F647  1  61 6E 64 20    .asciiz "and hands.  Direct me with commands of 1 or 2 words.  I should warn"
00F64B  1  68 61 6E 64  
00F64F  1  73 2E 20 20  
00F68B  1               msg_intro_help_5:
00F68B  1  79 6F 75 20    .asciiz "you that I look at only the first five letters of each word, so you'll"
00F68F  1  74 68 61 74  
00F693  1  20 49 20 6C  
00F6D2  1               msg_intro_help_6:
00F6D2  1  68 61 76 65    .asciiz "have to enter 'Northeast' as 'ne' to distinguish it from 'North'."
00F6D6  1  20 74 6F 20  
00F6DA  1  65 6E 74 65  
00F714  1               msg_intro_help_7:
00F714  1  28 53 68 6F    .asciiz "(Should you get stuck, type 'help' for some general hints)."
00F718  1  75 6C 64 20  
00F71C  1  79 6F 75 20  
00F750  1               msg_quit_confirm:
00F750  1  44 6F 20 79    .asciiz "Do you really want to quit now?"
00F754  1  6F 75 20 72  
00F758  1  65 61 6C 6C  
00F770  1               msg_quit_ok:
00F770  1  4F 4B 00       .asciiz "OK"
00F773  1               msg_treasures_label:
00F773  1  54 72 65 61    .asciiz "Treasures:          "
00F777  1  73 75 72 65  
00F77B  1  73 3A 20 20  
00F788  1               msg_survival_label:
00F788  1  53 75 72 76    .asciiz "Survival:           "
00F78C  1  69 76 61 6C  
00F790  1  3A 20 20 20  
00F79D  1               msg_score_label:
00F79D  1  53 63 6F 72    .asciiz "Score:              "
00F7A1  1  65 3A 20 20  
00F7A5  1  20 20 20 20  
00F7B1  1               
